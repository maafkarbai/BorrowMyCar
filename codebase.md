# .gitignore

```
# Based on https://raw.githubusercontent.com/github/gitignore/main/Node.gitignore # Logs logs _.log npm-debug.log_ yarn-debug.log* yarn-error.log* lerna-debug.log* .pnpm-debug.log* # Caches .cache # Diagnostic reports (https://nodejs.org/api/report.html) report.[0-9]_.[0-9]_.[0-9]_.[0-9]_.json # Runtime data pids _.pid _.seed *.pid.lock # Directory for instrumented libs generated by jscoverage/JSCover lib-cov # Coverage directory used by tools like istanbul coverage *.lcov # nyc test coverage .nyc_output # Grunt intermediate storage (https://gruntjs.com/creating-plugins#storing-task-files) .grunt # Bower dependency directory (https://bower.io/) bower_components # node-waf configuration .lock-wscript # Compiled binary addons (https://nodejs.org/api/addons.html) build/Release # Dependency directories node_modules/ jspm_packages/ # Snowpack dependency directory (https://snowpack.dev/) web_modules/ # TypeScript cache *.tsbuildinfo # Optional npm cache directory .npm # Optional eslint cache .eslintcache # Optional stylelint cache .stylelintcache # Microbundle cache .rpt2_cache/ .rts2_cache_cjs/ .rts2_cache_es/ .rts2_cache_umd/ # Optional REPL history .node_repl_history # Output of 'npm pack' *.tgz # Yarn Integrity file .yarn-integrity # dotenv environment variable files .env .env.development.local .env.test.local .env.production.local .env.local # parcel-bundler cache (https://parceljs.org/) .parcel-cache # Next.js build output .next out # Nuxt.js build / generate output .nuxt dist # Gatsby files # Comment in the public line in if your project uses Gatsby and not Next.js # https://nextjs.org/blog/next-9-1#public-directory-support # public # vuepress build output .vuepress/dist # vuepress v2.x temp and cache directory .temp # Docusaurus cache and generated files .docusaurus # Serverless directories .serverless/ # FuseBox cache .fusebox/ # DynamoDB Local files .dynamodb/ # TernJS port file .tern-port # Stores VSCode versions used for testing VSCode extensions .vscode-test # yarn v2 .yarn/cache .yarn/unplugged .yarn/build-state.yml .yarn/install-state.gz .pnp.* # IntelliJ based IDEs .idea # Finder (MacOS) folder config .DS_Store
```

# borrowmycarfrontend\.gitignore

```
# Logs logs *.log npm-debug.log* yarn-debug.log* yarn-error.log* pnpm-debug.log* lerna-debug.log* node_modules dist dist-ssr *.local # Editor directories and files .vscode/* !.vscode/extensions.json .idea .DS_Store *.suo *.ntvs* *.njsproj *.sln *.sw?
```

# borrowmycarfrontend\eslint.config.js

```js
import js from '@eslint/js' import globals from 'globals' import reactHooks from 'eslint-plugin-react-hooks' import reactRefresh from 'eslint-plugin-react-refresh' export default [ { ignores: ['dist'] }, { files: ['**/*.{js,jsx}'], languageOptions: { ecmaVersion: 2020, globals: globals.browser, parserOptions: { ecmaVersion: 'latest', ecmaFeatures: { jsx: true }, sourceType: 'module', }, }, plugins: { 'react-hooks': reactHooks, 'react-refresh': reactRefresh, }, rules: { ...js.configs.recommended.rules, ...reactHooks.configs.recommended.rules, 'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }], 'react-refresh/only-export-components': [ 'warn', { allowConstantExport: true }, ], }, }, ]
```

# borrowmycarfrontend\index.html

```html
<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8" /> <link rel="icon" type="image/svg+xml" href="./src/assets/BorrowMyCar.png" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <title>BorrowMyCar</title> <link rel="stylesheet" href="src/global.css" /> </head> <body> <div id="root"></div> <script type="module" src="/src/index.jsx"></script> </body> </html>
```

# borrowmycarfrontend\package.json

```json
{ "name": "borrowmycarfrontend", "private": true, "version": "0.0.0", "type": "module", "scripts": { "dev": "vite", "build": "vite build", "lint": "eslint .", "preview": "vite preview" }, "dependencies": { "@stripe/react-stripe-js": "^3.7.0", "@stripe/stripe-js": "^7.3.1", "@tailwindcss/vite": "^4.1.8", "axios": "^1.9.0", "lucide-react": "^0.513.0", "mapbox-gl": "^3.12.0", "react": "^19.1.0", "react-dom": "^19.1.0", "react-helmet": "^6.1.0", "react-map-gl": "^8.0.4", "react-router-dom": "^7.6.1", "tailwindcss": "^4.1.8" }, "devDependencies": { "@eslint/js": "^9.25.0", "@types/react": "^19.1.2", "@types/react-dom": "^19.1.2", "@vitejs/plugin-react": "^4.4.1", "eslint": "^9.25.0", "eslint-plugin-react-hooks": "^5.2.0", "eslint-plugin-react-refresh": "^0.4.19", "globals": "^16.0.0", "vite": "^6.3.5" } }
```

# borrowmycarfrontend\public\vite.svg

This is a file of the type: SVG Image

# borrowmycarfrontend\README.md

```md
# React + Vite This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules. Currently, two official plugins are available: - [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) for Fast Refresh - [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh ## Expanding the ESLint configuration If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.
```

# borrowmycarfrontend\src\api.js

```js
// borrowmycarfrontend/src/api.js - Fixed API client import axios from "axios"; // Create API instance with comprehensive configuration const API = axios.create({ baseURL: import.meta.env.VITE_API_BASE_URL || "http://localhost:5000/api", timeout: 30000, // 30 second timeout headers: { "Content-Type": "application/json", }, }); // Request interceptor to automatically include token and handle requests API.interceptors.request.use( (req) => { // Get token from localStorage const token = localStorage.getItem("token"); if (token) { req.headers.Authorization = `Bearer ${token}`; } // Handle FormData for file uploads if (req.data instanceof FormData) { delete req.headers["Content-Type"]; // Let browser set it for FormData } // Log request in development if (import.meta.env.DEV) { console.log(`🚀 ${req.method?.toUpperCase()} ${req.url}`, { headers: req.headers, data: req.data instanceof FormData ? "FormData" : req.data, }); } return req; }, (error) => { console.error("❌ Request interceptor error:", error); return Promise.reject(error); } ); // Response interceptor for enhanced error handling and token management API.interceptors.response.use( (response) => { // Log successful responses in development if (import.meta.env.DEV) { console.log(`✅ Response ${response.status}:`, response.data); } return response; }, (error) => { console.error("❌ API Error:", error); // Handle different error scenarios if (error.response) { // Server responded with error status const { status, data } = error.response; switch (status) { case 401: // Unauthorized - clear auth data and redirect console.log("🔐 Authentication failed - clearing session"); localStorage.removeItem("token"); localStorage.removeItem("user"); // Only redirect if not already on auth pages const currentPath = window.location.pathname; if ( !currentPath.includes("/login") && !currentPath.includes("/signup") && !currentPath.includes("/auth") ) { // Delay redirect to prevent immediate redirect loops setTimeout(() => { window.location.href = "/auth/login"; }, 100); } break; case 403: console.log("🚫 Access forbidden"); break; case 404: console.log("❓ Resource not found"); break; case 422: console.log("⚠️ Validation error:", data.errors); break; case 429: console.log("🐌 Rate limit exceeded"); break; case 500: console.log("💥 Server error"); break; default: console.log(`❌ HTTP Error ${status}`); } // Use server error message if available if (data?.message) { error.message = data.message; } else if (data?.error) { error.message = data.error; } } else if (error.code === "ECONNABORTED") { // Timeout error error.message = "Request timeout. Please check your connection and try again."; } else if (!error.response) { // Network error error.message = "Network error. Please check your connection and try again."; } return Promise.reject(error); } ); // Helper functions for common API operations export const apiGet = async (url, config = {}) => { try { const response = await API.get(url, config); return { success: true, data: response.data }; } catch (error) { return { success: false, error: error.message }; } }; export const apiPost = async (url, data = {}, config = {}) => { try { const response = await API.post(url, data, config); return { success: true, data: response.data }; } catch (error) { return { success: false, error: error.message }; } }; export const apiPut = async (url, data = {}, config = {}) => { try { const response = await API.put(url, data, config); return { success: true, data: response.data }; } catch (error) { return { success: false, error: error.message }; } }; export const apiPatch = async (url, data = {}, config = {}) => { try { const response = await API.patch(url, data, config); return { success: true, data: response.data }; } catch (error) { return { success: false, error: error.message }; } }; export const apiDelete = async (url, config = {}) => { try { const response = await API.delete(url, config); return { success: true, data: response.data }; } catch (error) { return { success: false, error: error.message }; } }; // Upload file with progress tracking export const uploadFile = async (url, formData, onProgress = null) => { try { const response = await API.post(url, formData, { headers: { "Content-Type": "multipart/form-data", }, onUploadProgress: onProgress, }); return { success: true, data: response.data }; } catch (error) { return { success: false, error: error.message }; } }; // Check if user is authenticated export const isAuthenticated = () => { const token = localStorage.getItem("token"); if (!token) return false; try { // Check if token is expired (basic check) const payload = JSON.parse(atob(token.split(".")[1])); const currentTime = Date.now() / 1000; return payload.exp > currentTime; } catch { return false; } }; // Get current user from token export const getCurrentUser = () => { const token = localStorage.getItem("token"); if (!token) return null; try { const payload = JSON.parse(atob(token.split(".")[1])); return { id: payload.id || payload.userId || payload._id, role: payload.role, isApproved: payload.isApproved, email: payload.email, name: payload.name, }; } catch { return null; } }; // Clear authentication data export const clearAuth = () => { localStorage.removeItem("token"); localStorage.removeItem("user"); }; // API Health check export const checkAPIHealth = async () => { try { const response = await API.get("/health"); return { success: true, data: response.data }; } catch (error) { return { success: false, error: error.message }; } }; // Refresh token (if your backend supports it) export const refreshToken = async () => { try { const response = await API.post("/auth/refresh"); const { token } = response.data; if (token) { localStorage.setItem("token", token); return { success: true, token }; } throw new Error("No token received"); } catch (error) { clearAuth(); return { success: false, error: error.message }; } }; // Cars API functions export const getCars = async (params = {}) => { try { const queryString = new URLSearchParams(params).toString(); const response = await API.get( `/cars${queryString ? `?${queryString}` : ""}` ); return { success: true, data: response.data }; } catch (error) { return { success: false, error: error.message }; } }; export const getCar = async (carId) => { try { const response = await API.get(`/cars/${carId}`); return { success: true, data: response.data }; } catch (error) { return { success: false, error: error.message }; } }; export const createCar = async (carData) => { try { const response = await API.post("/cars", carData); return { success: true, data: response.data }; } catch (error) { return { success: false, error: error.message }; } }; // Bookings API functions export const getBookings = async (type = "me") => { try { const endpoint = type === "owner" ? "/bookings/owner" : "/bookings/me"; const response = await API.get(endpoint); return { success: true, data: response.data }; } catch (error) { return { success: false, error: error.message }; } }; export const createBooking = async (bookingData) => { try { const response = await API.post("/bookings", bookingData); return { success: true, data: response.data }; } catch (error) { return { success: false, error: error.message }; } }; export const updateBooking = async (bookingId, updateData) => { try { const response = await API.put(`/bookings/${bookingId}`, updateData); return { success: true, data: response.data }; } catch (error) { return { success: false, error: error.message }; } }; // Auth API functions export const loginUser = async (credentials) => { try { const response = await API.post("/auth/login", credentials); return { success: true, data: response.data }; } catch (error) { return { success: false, error: error.message }; } }; export const registerUser = async (userData) => { try { const response = await API.post("/auth/signup", userData); return { success: true, data: response.data }; } catch (error) { return { success: false, error: error.message }; } }; export const getUserProfile = async () => { try { const response = await API.get("/auth/profile"); return { success: true, data: response.data }; } catch (error) { return { success: false, error: error.message }; } }; // Export the main API instance as default export default API;
```

# borrowmycarfrontend\src\App.jsx

```jsx
import { Helmet } from "react-helmet"; import CarListingSection from "./CarListingSection"; const App = () => { return ( <> <Helmet> <title>BorrowMyCar | Home</title> </Helmet> <div className="min-h-screen"> <div className="min-h-fit"> <div className="max-w-7xl mx-auto px-4 py-6"> <h1 className="text-3xl font-bold text-gray-900"> Welcome to <span className="text-green-600">BorrowMyCar</span> </h1> <p className="mt-2 text-gray-600"> Your one-stop solution for car rentals. Explore our services and find the perfect car for your needs. </p> </div> <CarListingSection /> </div> </div> </> ); }; export default App;
```

# borrowmycarfrontend\src\assets\BorrowMyCar.png

This is a binary file of the type: Image

# borrowmycarfrontend\src\assets\catdriving-serious.gif

This is a binary file of the type: Image

# borrowmycarfrontend\src\assets\react.svg

This is a file of the type: SVG Image

# borrowmycarfrontend\src\assets\services\paymentService.js

```js
// src/services/paymentService.js - Payment Service with Stripe Integration import API from "../../api"; // Payment service class class PaymentService { constructor() { this.stripe = null; this.isStripeLoaded = false; } // Initialize Stripe async initializeStripe() { if (this.isStripeLoaded && this.stripe) { return this.stripe; } try { // Load Stripe.js dynamically if (!window.Stripe) { const script = document.createElement("script"); script.src = "https://js.stripe.com/v3/"; script.async = true; document.head.appendChild(script); await new Promise((resolve, reject) => { script.onload = resolve; script.onerror = reject; }); } // Get publishable key from your backend const response = await API.get("/payments/stripe-config"); const { publishableKey } = response.data; this.stripe = window.Stripe(publishableKey); this.isStripeLoaded = true; return this.stripe; } catch (error) { console.error("Failed to initialize Stripe:", error); throw new Error("Payment system unavailable. Please try again later."); } } // Process Stripe payment async processStripePayment(paymentData) { try { const stripe = await this.initializeStripe(); // Create payment intent on your backend const response = await API.post("/payments/create-payment-intent", { amount: paymentData.amount, currency: paymentData.currency || "AED", bookingId: paymentData.bookingId, metadata: { carId: paymentData.carId, carTitle: paymentData.carTitle, startDate: paymentData.startDate, endDate: paymentData.endDate, numberOfDays: paymentData.numberOfDays, }, }); const { clientSecret, paymentIntentId } = response.data; // Confirm payment with Stripe let result; if (paymentData.cardDetails.savedCardId) { // Use saved card result = await stripe.confirmCardPayment(clientSecret, { payment_method: paymentData.cardDetails.savedCardId, }); } else { // Use new card result = await stripe.confirmCardPayment(clientSecret, { payment_method: { card: { number: paymentData.cardDetails.cardNumber.replace(/\s/g, ""), exp_month: parseInt( paymentData.cardDetails.expiryDate.split("/")[0] ), exp_year: parseInt( "20" + paymentData.cardDetails.expiryDate.split("/")[1] ), cvc: paymentData.cardDetails.cvv, }, billing_details: { name: paymentData.cardDetails.cardholderName, }, }, save_payment_method: paymentData.cardDetails.saveCard, }); } if (result.error) { throw new Error(result.error.message); } return { success: true, paymentId: paymentIntentId, paymentMethod: "stripe", status: "completed", transactionId: result.paymentIntent.id, amount: paymentData.amount, currency: paymentData.currency || "AED", }; } catch (error) { console.error("Stripe payment error:", error); throw error; } } // Process bank transfer async processBankTransfer(paymentData) { try { const response = await API.post("/payments/bank-transfer", { amount: paymentData.amount, currency: paymentData.currency || "AED", bookingId: paymentData.bookingId, bankDetails: paymentData.bankDetails, metadata: { carId: paymentData.carId, carTitle: paymentData.carTitle, startDate: paymentData.startDate, endDate: paymentData.endDate, numberOfDays: paymentData.numberOfDays, }, }); return { success: true, paymentId: response.data.transferId, paymentMethod: "bank_transfer", status: "pending", instructions: response.data.instructions, amount: paymentData.amount, currency: paymentData.currency || "AED", }; } catch (error) { console.error("Bank transfer error:", error); throw error; } } // Process digital wallet payment async processDigitalWallet(paymentData) { try { const response = await API.post("/payments/digital-wallet", { amount: paymentData.amount, currency: paymentData.currency || "AED", bookingId: paymentData.bookingId, walletDetails: paymentData.walletDetails, metadata: { carId: paymentData.carId, carTitle: paymentData.carTitle, startDate: paymentData.startDate, endDate: paymentData.endDate, numberOfDays: paymentData.numberOfDays, }, }); // Handle different wallet types switch (paymentData.walletDetails.walletType) { case "apple_pay": case "google_pay": case "samsung_pay": return await this.processWalletPayment( response.data, paymentData.walletDetails.walletType ); case "paypal": return await this.processPayPalPayment(response.data); case "careem_pay": case "beam_wallet": return await this.processLocalWallet( response.data, paymentData.walletDetails ); default: throw new Error("Unsupported wallet type"); } } catch (error) { console.error("Digital wallet error:", error); throw error; } } // Process wallet payments (Apple Pay, Google Pay, Samsung Pay) async processWalletPayment(paymentData, walletType) { const stripe = await this.initializeStripe(); const paymentRequest = stripe.paymentRequest({ country: "AE", currency: paymentData.currency.toLowerCase(), total: { label: `BorrowMyCar - ${paymentData.description}`, amount: paymentData.amount * 100, // Stripe expects amount in fils }, requestPayerName: true, requestPayerEmail: true, }); // Check if the payment request is supported const result = await paymentRequest.canMakePayment(); if (!result) { throw new Error(`${walletType} is not supported on this device`); } return new Promise((resolve, reject) => { paymentRequest.on("paymentmethod", async (ev) => { try { const response = await API.post("/payments/confirm-wallet-payment", { paymentMethodId: ev.paymentMethod.id, paymentIntentId: paymentData.paymentIntentId, }); if (response.data.success) { ev.complete("success"); resolve({ success: true, paymentId: response.data.paymentId, paymentMethod: walletType, status: "completed", transactionId: ev.paymentMethod.id, amount: paymentData.amount, currency: paymentData.currency, }); } else { ev.complete("fail"); reject(new Error(response.data.message || "Payment failed")); } } catch (error) { ev.complete("fail"); reject(error); } }); paymentRequest.show(); }); } // Process PayPal payment async processPayPalPayment(paymentData) { try { // Redirect to PayPal or open PayPal modal window.location.href = paymentData.paypalRedirectUrl; // This would normally return after PayPal redirect return { success: true, paymentId: paymentData.paymentId, paymentMethod: "paypal", status: "pending", redirectUrl: paymentData.paypalRedirectUrl, }; } catch (error) { console.error("PayPal payment error:", error); throw error; } } // Process local wallet payments (Careem Pay, Beam Wallet) async processLocalWallet(paymentData, walletDetails) { try { const response = await API.post("/payments/local-wallet-payment", { paymentId: paymentData.paymentId, walletType: walletDetails.walletType, phoneNumber: walletDetails.phoneNumber, }); return { success: true, paymentId: response.data.paymentId, paymentMethod: walletDetails.walletType, status: "pending", instructions: response.data.instructions, amount: paymentData.amount, currency: paymentData.currency, }; } catch (error) { console.error("Local wallet error:", error); throw error; } } // Process cash on pickup async processCashOnPickup(paymentData) { try { const response = await API.post("/payments/cash-on-pickup", { amount: paymentData.amount, currency: paymentData.currency || "AED", bookingId: paymentData.bookingId, cashDetails: paymentData.cashDetails, metadata: { carId: paymentData.carId, carTitle: paymentData.carTitle, startDate: paymentData.startDate, endDate: paymentData.endDate, numberOfDays: paymentData.numberOfDays, meetingLocation: paymentData.cashDetails.meetingLocation, meetingTime: paymentData.cashDetails.meetingTime, notes: paymentData.cashDetails.notes, }, }); return { success: true, paymentId: response.data.paymentId, paymentMethod: "cash_on_pickup", status: "pending_pickup", meetingDetails: { location: paymentData.cashDetails.meetingLocation, time: paymentData.cashDetails.meetingTime, notes: paymentData.cashDetails.notes, amount: paymentData.amount, currency: paymentData.currency || "AED", }, }; } catch (error) { console.error("Cash on pickup error:", error); throw error; } } // Main payment processing method async processPayment(paymentData) { try { let result; switch (paymentData.paymentMethod) { case "stripe": result = await this.processStripePayment(paymentData); break; case "bank_transfer": result = await this.processBankTransfer(paymentData); break; case "digital_wallet": result = await this.processDigitalWallet(paymentData); break; case "cash_on_pickup": result = await this.processCashOnPickup(paymentData); break; default: throw new Error("Unsupported payment method"); } // Log successful payment console.log("Payment processed successfully:", result); return result; } catch (error) { // Log payment error console.error("Payment processing failed:", error); // Track failed payment try { await API.post("/payments/log-error", { bookingId: paymentData.bookingId, paymentMethod: paymentData.paymentMethod, error: error.message, amount: paymentData.amount, }); } catch (logError) { console.error("Failed to log payment error:", logError); } throw error; } } // Get saved payment methods async getSavedPaymentMethods() { try { const response = await API.get("/payments/saved-methods"); return response.data.data.paymentMethods || []; } catch (error) { console.error("Failed to fetch saved payment methods:", error); return []; } } // Delete saved payment method async deleteSavedPaymentMethod(paymentMethodId) { try { await API.delete(`/payments/saved-methods/${paymentMethodId}`); return true; } catch (error) { console.error("Failed to delete payment method:", error); throw error; } } // Get payment history async getPaymentHistory(page = 1, limit = 10) { try { const response = await API.get( `/payments/history?page=${page}&limit=${limit}` ); return response.data.data; } catch (error) { console.error("Failed to fetch payment history:", error); throw error; } } // Refund payment async refundPayment(paymentId, amount, reason) { try { const response = await API.post(`/payments/${paymentId}/refund`, { amount, reason, }); return response.data; } catch (error) { console.error("Failed to process refund:", error); throw error; } } } // Create singleton instance const paymentService = new PaymentService(); export default paymentService; // Export individual methods for easier imports export const { processPayment, getSavedPaymentMethods, deleteSavedPaymentMethod, getPaymentHistory, refundPayment, } = paymentService;
```

# borrowmycarfrontend\src\BrowseCars.jsx

```jsx
import { Helmet } from "react-helmet"; import CarListingSection from "./CarListingSection"; const BrowseCars = () => { return ( <> <Helmet> <title>Browse Cars - BorrowMyCar</title> </Helmet> <div className="min-h-screen bg-gray-50"> <div className="max-w-7xl mx-auto px-4 py-6"> <h1 className="text-3xl font-bold text-gray-900 mb-6"> Find Your Perfect Car </h1> <CarListingSection /> </div> </div> </> ); }; export default BrowseCars;
```

# borrowmycarfrontend\src\CarDetails.jsx

```jsx
// src/CarDetails.jsx - Updated with Payment Integration import { useEffect, useState } from "react"; import { useParams, useNavigate } from "react-router-dom"; import API from "./api"; import PaymentModal from "./components/PaymentModal"; const CarDetails = () => { const { id } = useParams(); const navigate = useNavigate(); const [car, setCar] = useState(null); const [loading, setLoading] = useState(true); const [error, setError] = useState(""); const [booking, setBooking] = useState({ startDate: "", endDate: "", }); const [bookingError, setBookingError] = useState(""); const [bookingLoading, setBookingLoading] = useState(false); const [user, setUser] = useState(null); const [currentImageIndex, setCurrentImageIndex] = useState(0); const [totalCost, setTotalCost] = useState(0); const [numberOfDays, setNumberOfDays] = useState(0); const [showPaymentModal, setShowPaymentModal] = useState(false); const [paymentData, setPaymentData] = useState(null); useEffect(() => { const fetchCar = async () => { try { const res = await API.get(`/cars/${id}`); setCar(res.data.data.car); } catch (err) { setError("Car not found or failed to load"); console.error("Error fetching car:", err); } finally { setLoading(false); } }; const getUser = () => { const token = localStorage.getItem("token"); if (token) { try { const payload = JSON.parse(atob(token.split(".")[1])); setUser(payload); } catch { setUser(null); } } }; fetchCar(); getUser(); }, [id]); // Calculate total cost and days when dates change useEffect(() => { if (booking.startDate && booking.endDate && car) { const start = new Date(booking.startDate); const end = new Date(booking.endDate); const diffTime = Math.abs(end - start); const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); if (diffDays > 0) { setNumberOfDays(diffDays); const dailyRate = car.price || car.pricePerDay; const subtotal = diffDays * dailyRate; const serviceFee = Math.round(subtotal * 0.05); // 5% service fee const insurance = Math.round(subtotal * 0.03); // 3% insurance const total = subtotal + serviceFee + insurance; setTotalCost(total); } else { setNumberOfDays(0); setTotalCost(0); } } else { setNumberOfDays(0); setTotalCost(0); } }, [booking.startDate, booking.endDate, car]); const handleBookingChange = (e) => { const { name, value } = e.target; setBooking((prev) => ({ ...prev, [name]: value, })); setBookingError(""); }; const validateBookingDates = () => { if (!booking.startDate || !booking.endDate) { setBookingError("Please select both start and end dates"); return false; } const start = new Date(booking.startDate); const end = new Date(booking.endDate); const today = new Date(); today.setHours(0, 0, 0, 0); if (start < today) { setBookingError("Start date cannot be in the past"); return false; } if (start >= end) { setBookingError("End date must be after start date"); return false; } const availableFrom = new Date(car.availabilityFrom); const availableTo = new Date(car.availabilityTo); if (start < availableFrom || end > availableTo) { setBookingError( `Selected dates must be between ${availableFrom.toLocaleDateString()} and ${availableTo.toLocaleDateString()}` ); return false; } return true; }; const handleBook = async (e) => { e.preventDefault(); if (!validateBookingDates()) { return; } // Prepare payment data const dailyRate = car.price || car.pricePerDay; const subtotal = numberOfDays * dailyRate; const serviceFee = Math.round(subtotal * 0.05); const insurance = Math.round(subtotal * 0.03); const total = subtotal + serviceFee + insurance; const bookingPaymentData = { // Booking details carId: car._id, carTitle: car.title, carImage: car.images?.[0], carLocation: car.city, startDate: booking.startDate, endDate: booking.endDate, numberOfDays: numberOfDays, // Pricing breakdown dailyRate: dailyRate, subtotal: subtotal, serviceFee: serviceFee, insurance: insurance, totalAmount: total, // For booking creation totalCost: total, // Generate temporary booking ID bookingId: `temp_${Date.now()}_${Math.random() .toString(36) .substr(2, 9)}`, }; setPaymentData(bookingPaymentData); setShowPaymentModal(true); }; const handlePaymentSuccess = async (paymentResult) => { setBookingLoading(true); setShowPaymentModal(false); try { // Create the actual booking with payment info const bookingPayload = { carId: car._id, startDate: booking.startDate, endDate: booking.endDate, totalCost: paymentData.totalAmount, numberOfDays: numberOfDays, paymentMethod: paymentResult.paymentMethod, paymentId: paymentResult.paymentId, paymentStatus: paymentResult.status || "completed", }; const response = await API.post("/bookings", bookingPayload); navigate("/my-bookings", { state: { message: "Booking confirmed successfully!", bookingId: response.data._id, paymentMethod: paymentResult.paymentMethod, }, }); } catch (err) { console.error("Booking creation error:", err); setBookingError( err.response?.data?.message || "Booking failed after payment. Please contact support." ); } finally { setBookingLoading(false); } }; const handlePaymentError = (error) => { setShowPaymentModal(false); setBookingError(error); }; const nextImage = () => { if (car?.images?.length > 1) { setCurrentImageIndex((prev) => (prev + 1) % car.images.length); } }; const prevImage = () => { if (car?.images?.length > 1) { setCurrentImageIndex((prev) => prev === 0 ? car.images.length - 1 : prev - 1 ); } }; if (loading) { return ( <div className="max-w-4xl mx-auto p-6"> <div className="animate-pulse"> <div className="grid md:grid-cols-2 gap-6"> <div className="bg-gray-200 h-64 rounded-xl"></div> <div className="space-y-4"> <div className="h-4 bg-gray-200 rounded w-3/4"></div> <div className="h-4 bg-gray-200 rounded w-1/2"></div> <div className="h-4 bg-gray-200 rounded w-full"></div> </div> </div> </div> </div> ); } if (error) { return ( <div className="max-w-4xl mx-auto p-6"> <div className="bg-red-50 border border-red-200 rounded-lg p-6 text-center"> <svg className="mx-auto h-12 w-12 text-red-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" /> </svg> <h3 className="text-lg font-medium text-red-800 mb-2"> Error Loading Car </h3> <p className="text-red-600 mb-4">{error}</p> <button onClick={() => navigate("/browse")} className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors" > Back to Browse </button> </div> </div> ); } if (!car) return null; return ( <> <div className="max-w-6xl mx-auto p-6"> {/* Breadcrumb */} <nav className="flex mb-6 text-sm"> <button onClick={() => navigate("/browse")} className="text-green-600 hover:text-green-800 font-medium" > ← Back to Browse </button> <span className="mx-2 text-gray-500">/</span> <span className="text-gray-700">{car.title}</span> </nav> <div className="grid lg:grid-cols-3 gap-8"> {/* Left Column - Images and Details */} <div className="lg:col-span-2 space-y-6"> {/* Image Gallery */} <div className="relative"> <div className="aspect-video bg-gray-100 rounded-xl overflow-hidden"> <img src={ car.images?.[currentImageIndex] || "https://via.placeholder.com/800x450?text=No+Image" } alt={`${car.title} - Image ${currentImageIndex + 1}`} className="w-full h-full object-cover" /> {/* Image Navigation */} {car.images?.length > 1 && ( <> <button onClick={prevImage} className="absolute left-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-2 rounded-full transition-all" > <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /> </svg> </button> <button onClick={nextImage} className="absolute right-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-2 rounded-full transition-all" > <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /> </svg> </button> {/* Image Counter */} <div className="absolute bottom-4 right-4 bg-black bg-opacity-70 text-white px-3 py-1 rounded-full text-sm"> {currentImageIndex + 1} / {car.images.length} </div> </> )} </div> {/* Thumbnail Strip */} {car.images?.length > 1 && ( <div className="flex gap-2 mt-4 overflow-x-auto pb-2"> {car.images.map((image, index) => ( <button key={index} onClick={() => setCurrentImageIndex(index)} className={`flex-shrink-0 w-20 h-16 rounded-lg overflow-hidden border-2 transition-all ${ index === currentImageIndex ? "border-green-500 ring-2 ring-green-200" : "border-gray-200 hover:border-gray-300" }`} > <img src={image} alt={`Thumbnail ${index + 1}`} className="w-full h-full object-cover" /> </button> ))} </div> )} </div> {/* Car Information */} <div className="bg-white border border-gray-200 rounded-xl p-6"> <div className="space-y-4"> <div> <h1 className="text-3xl font-bold text-gray-900 mb-2"> {car.title} </h1> <div className="flex items-center gap-4 text-sm text-gray-600"> <span className="flex items-center gap-1"> <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /> </svg> {car.city} </span> <span className="flex items-center gap-1"> <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" /> </svg> AED {car.price || car.pricePerDay} / day </span> </div> </div> <div className="border-t pt-4"> <h3 className="font-semibold text-gray-900 mb-2"> Description </h3> <p className="text-gray-700 leading-relaxed"> {car.description} </p> </div> <div className="border-t pt-4"> <h3 className="font-semibold text-gray-900 mb-2"> Availability </h3> <div className="flex items-center gap-2 text-sm text-gray-600"> <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /> </svg> {new Date(car.availabilityFrom).toLocaleDateString()} -{" "} {new Date(car.availabilityTo).toLocaleDateString()} </div> </div> </div> </div> </div> {/* Right Column - Booking */} <div className="lg:col-span-1"> <div className="sticky top-6"> {user && user.role === "renter" ? ( <div className="bg-white border border-gray-200 rounded-xl p-6 shadow-lg"> <h2 className="text-xl font-semibold text-gray-900 mb-4"> Book This Car </h2> <form onSubmit={handleBook} className="space-y-4"> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Start Date </label> <input type="date" name="startDate" value={booking.startDate} onChange={handleBookingChange} min={new Date().toISOString().split("T")[0]} max={car.availabilityTo} className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition-colors" required /> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> End Date </label> <input type="date" name="endDate" value={booking.endDate} onChange={handleBookingChange} min={ booking.startDate || new Date().toISOString().split("T")[0] } max={car.availabilityTo} className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition-colors" required /> </div> {/* Cost Breakdown */} {numberOfDays > 0 && ( <div className="bg-gray-50 p-4 rounded-lg space-y-2"> <div className="flex justify-between text-sm"> <span> AED {car.price || car.pricePerDay} × {numberOfDays}{" "} day{numberOfDays !== 1 ? "s" : ""} </span> <span> AED {numberOfDays * (car.price || car.pricePerDay)} </span> </div> <div className="flex justify-between text-sm text-gray-600"> <span>Service Fee (5%)</span> <span> AED{" "} {Math.round( numberOfDays * (car.price || car.pricePerDay) * 0.05 )} </span> </div> <div className="flex justify-between text-sm text-gray-600"> <span>Insurance (3%)</span> <span> AED{" "} {Math.round( numberOfDays * (car.price || car.pricePerDay) * 0.03 )} </span> </div> <div className="border-t pt-2 flex justify-between font-semibold"> <span>Total</span> <span className="text-green-600"> AED {totalCost} </span> </div> </div> )} {bookingError && ( <div className="bg-red-50 border border-red-200 rounded-lg p-3"> <p className="text-sm text-red-600">{bookingError}</p> </div> )} <button type="submit" disabled={bookingLoading || numberOfDays === 0} className="w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center" > {bookingLoading ? ( <> <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" > <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" ></circle> <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" ></path> </svg> Processing... </> ) : ( "Continue to Payment" )} </button> </form> <div className="mt-4 text-xs text-gray-500 text-center"> 🔒 Your booking is secure and protected </div> </div> ) : user && user.role === "owner" ? ( <div className="bg-blue-50 border border-blue-200 rounded-xl p-6"> <div className="text-center"> <svg className="mx-auto h-12 w-12 text-blue-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /> </svg> <h3 className="text-lg font-medium text-blue-800 mb-2"> Car Owner View </h3> <p className="text-blue-700"> This is your listed car. Switch to a renter account to book cars. </p> </div> </div> ) : ( <div className="bg-yellow-50 border border-yellow-200 rounded-xl p-6"> <div className="text-center"> <svg className="mx-auto h-12 w-12 text-yellow-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /> </svg> <h3 className="text-lg font-medium text-yellow-800 mb-2"> Login Required </h3> <p className="text-yellow-700 mb-4"> Please log in to book this car and enjoy our rental service. </p> <button onClick={() => navigate("/login")} className="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 rounded-lg font-medium transition-colors" > Login to Book </button> </div> </div> )} </div> </div> </div> </div> {/* Payment Modal */} <PaymentModal isOpen={showPaymentModal} onClose={() => setShowPaymentModal(false)} bookingData={paymentData} onPaymentSuccess={handlePaymentSuccess} onPaymentError={handlePaymentError} /> </> ); }; export default CarDetails;
```

# borrowmycarfrontend\src\CarFilterBar.jsx

```jsx
import { useState, useEffect } from "react"; const CarFilterBar = ({ onFiltersChange, onReset }) => { const [filters, setFilters] = useState({ city: "", makeModel: "", priceMin: "", priceMax: "", year: "", kilometers: "", transmission: "", }); const [showMakeModelSuggestions, setShowMakeModelSuggestions] = useState(false); const [filteredMakeModels, setFilteredMakeModels] = useState([]); const [activeFiltersCount, setActiveFiltersCount] = useState(0); // Compact data arrays const cities = [ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Al Ain", "Fujairah", ]; const makeModels = [ "Toyota Camry", "Toyota Corolla", "Honda Civic", "BMW 3 Series", "Mercedes C-Class", "Nissan Altima", "Hyundai Elantra", "Audi A4", "Ford Mustang", "Kia Forte", ]; const years = ["2024", "2023", "2022", "2021", "2020"]; const kilometers = ["0-30k", "30k-60k", "60k-100k", "100k+"]; const transmissions = ["Automatic", "Manual"]; // Handle filter changes const handleFilterChange = (key, value) => { const newFilters = { ...filters, [key]: value }; setFilters(newFilters); if (key === "makeModel") { if (value.length > 0) { const filtered = makeModels .filter((model) => model.toLowerCase().includes(value.toLowerCase())) .slice(0, 5); setFilteredMakeModels(filtered); setShowMakeModelSuggestions(filtered.length > 0); } else { setShowMakeModelSuggestions(false); } } if (onFiltersChange) onFiltersChange(newFilters); }; const handleMakeModelSelect = (model) => { handleFilterChange("makeModel", model); setShowMakeModelSuggestions(false); }; // Count active filters useEffect(() => { const count = Object.values(filters).filter((value) => value !== "").length; setActiveFiltersCount(count); }, [filters]); // Reset filters const handleReset = () => { const resetFilters = { city: "", makeModel: "", priceMin: "", priceMax: "", year: "", kilometers: "", transmission: "", }; setFilters(resetFilters); setShowMakeModelSuggestions(false); if (onReset) onReset(); if (onFiltersChange) onFiltersChange(resetFilters); }; // Close suggestions when clicking outside useEffect(() => { const handleClickOutside = (event) => { if (!event.target.closest(".makemodel-container")) { setShowMakeModelSuggestions(false); } }; document.addEventListener("mousedown", handleClickOutside); return () => document.removeEventListener("mousedown", handleClickOutside); }, []); return ( <div className="w-full max-w-6xl mx-auto bg-white border rounded-2xl shadow-sm p-4"> {/* Header */} <div className="flex justify-between items-center mb-4"> <div className="flex items-center gap-2"> <h3 className="font-semibold text-gray-800">Filter Cars</h3> {activeFiltersCount > 0 && ( <span className="bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full"> {activeFiltersCount} </span> )} </div> {activeFiltersCount > 0 && ( <button onClick={handleReset} className="text-red-600 hover:text-red-800 text-xs font-medium" > Clear All </button> )} </div> {/* Compact Filter Grid */} <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3"> {/* City */} <div> <select value={filters.city} onChange={(e) => handleFilterChange("city", e.target.value)} className="w-full text-xs border border-gray-300 rounded-lg px-2 py-2 focus:ring-1 focus:ring-green-500 outline-none" > <option value="">City</option> {cities.map((city, idx) => ( <option key={idx} value={city}> {city} </option> ))} </select> </div> {/* Make & Model */} <div className="makemodel-container relative"> <input type="text" placeholder="Make, Model" value={filters.makeModel} onChange={(e) => handleFilterChange("makeModel", e.target.value)} className="w-full text-xs border border-gray-300 rounded-lg px-2 py-2 focus:ring-1 focus:ring-green-500 outline-none" autoComplete="off" /> {showMakeModelSuggestions && filteredMakeModels.length > 0 && ( <div className="absolute top-full left-0 right-0 mt-1 bg-white border rounded-lg shadow-lg max-h-40 overflow-y-auto z-10"> {filteredMakeModels.map((model, index) => ( <button key={index} onClick={() => handleMakeModelSelect(model)} className="w-full text-left px-2 py-2 text-xs hover:bg-green-50 border-b last:border-b-0" > {model} </button> ))} </div> )} </div> {/* Year */} <div> <select value={filters.year} onChange={(e) => handleFilterChange("year", e.target.value)} className="w-full text-xs border border-gray-300 rounded-lg px-2 py-2 focus:ring-1 focus:ring-green-500 outline-none" > <option value="">Year</option> {years.map((year, idx) => ( <option key={idx} value={year}> {year} </option> ))} </select> </div> {/* Price Min */} <div> <input type="number" placeholder="Min AED" value={filters.priceMin} onChange={(e) => handleFilterChange("priceMin", e.target.value)} className="w-full text-xs border border-gray-300 rounded-lg px-2 py-2 focus:ring-1 focus:ring-green-500 outline-none" /> </div> {/* Price Max */} <div> <input type="number" placeholder="Max AED" value={filters.priceMax} onChange={(e) => handleFilterChange("priceMax", e.target.value)} className="w-full text-xs border border-gray-300 rounded-lg px-2 py-2 focus:ring-1 focus:ring-green-500 outline-none" /> </div> {/* Kilometers */} <div> <select value={filters.kilometers} onChange={(e) => handleFilterChange("kilometers", e.target.value)} className="w-full text-xs border border-gray-300 rounded-lg px-2 py-2 focus:ring-1 focus:ring-green-500 outline-none" > <option value="">Mileage</option> {kilometers.map((km, idx) => ( <option key={idx} value={km}> {km} </option> ))} </select> </div> {/* Transmission */} <div> <select value={filters.transmission} onChange={(e) => handleFilterChange("transmission", e.target.value)} className="w-full text-xs border border-gray-300 rounded-lg px-2 py-2 focus:ring-1 focus:ring-green-500 outline-none" > <option value="">Transmission</option> {transmissions.map((trans, idx) => ( <option key={idx} value={trans}> {trans} </option> ))} </select> </div> </div> {/* Quick Filters */} {activeFiltersCount === 0 && ( <div className="mt-3 pt-3 border-t border-gray-100"> <div className="flex flex-wrap gap-2"> {[ { label: "Luxury", filter: { priceMin: "300" } }, { label: "Economy", filter: { priceMax: "150" } }, { label: "New", filter: { year: "2024" } }, { label: "Dubai", filter: { city: "Dubai" } }, ].map((quickFilter, idx) => ( <button key={idx} onClick={() => { const newFilters = { ...filters, ...quickFilter.filter }; setFilters(newFilters); if (onFiltersChange) onFiltersChange(newFilters); }} className="bg-gray-100 hover:bg-green-100 text-gray-600 hover:text-green-700 px-3 py-1 rounded-full text-xs transition-colors" > {quickFilter.label} </button> ))} </div> </div> )} </div> ); }; export default CarFilterBar;
```

# borrowmycarfrontend\src\CarListingSection.jsx

```jsx
import { useState, useEffect } from "react"; import { Link } from "react-router-dom"; import CarFilterBar from "./CarFilterBar"; import API from "./api"; const CarListingSection = () => { const [cars, setCars] = useState([]); const [loading, setLoading] = useState(true); const [error, setError] = useState(""); const [filters, setFilters] = useState({}); const [pagination, setPagination] = useState({ currentPage: 1, totalPages: 1, totalCount: 0, limit: 12, }); const [sortBy, setSortBy] = useState("createdAt"); const [sortOrder, setSortOrder] = useState("desc"); // Fetch cars with filters const fetchCars = async (page = 1, newFilters = filters) => { setLoading(true); setError(""); try { const params = new URLSearchParams({ page: page.toString(), limit: pagination.limit.toString(), sortBy, sortOrder, ...newFilters, }); // Remove empty filter values Object.keys(newFilters).forEach((key) => { if (!newFilters[key]) { params.delete(key); } }); console.log("Fetching cars with params:", params.toString()); const response = await API.get(`/cars?${params.toString()}`); console.log("Cars API response:", response.data); // Handle different response structures let carsData = []; let paginationData = {}; if (response.data.data) { carsData = response.data.data.cars || response.data.data; paginationData = response.data.data.pagination || {}; } else if (response.data.cars) { carsData = response.data.cars; paginationData = response.data.pagination || {}; } else { carsData = Array.isArray(response.data) ? response.data : []; } setCars(carsData); setPagination((prev) => ({ ...prev, currentPage: page, ...paginationData, })); } catch (err) { console.error("Error fetching cars:", err); setError("Failed to load cars. Please try again."); setCars([]); } finally { setLoading(false); } }; // Initial load useEffect(() => { fetchCars(); }, [sortBy, sortOrder]); // Handle filter changes const handleFiltersChange = (newFilters) => { setFilters(newFilters); fetchCars(1, newFilters); // Reset to page 1 when filters change }; // Handle filter reset const handleFiltersReset = () => { setFilters({}); fetchCars(1, {}); }; // Handle pagination const handlePageChange = (page) => { fetchCars(page); window.scrollTo({ top: 0, behavior: "smooth" }); }; // Handle sorting const handleSortChange = (newSortBy, newSortOrder = "desc") => { setSortBy(newSortBy); setSortOrder(newSortOrder); }; // Car Card Component with proper price handling const CarCard = ({ car }) => { // Handle different price field names const getCarPrice = () => { return car.price || car.pricePerDay || car.dailyRate || 0; }; const carPrice = getCarPrice(); return ( <div className="bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-200"> {/* Car Image */} <div className="relative aspect-video bg-gray-100 overflow-hidden"> <img src={ car.images?.[0] || "https://via.placeholder.com/400x240?text=No+Image" } alt={car.title} className="w-full h-full object-cover hover:scale-105 transition-transform duration-300" onError={(e) => { e.target.src = "https://via.placeholder.com/400x240?text=Car+Image"; }} /> {/* Price Badge */} <div className="absolute top-3 right-3 bg-green-600 text-white px-3 py-1 rounded-full text-sm font-semibold"> AED {carPrice}/day </div> {/* Status Badge */} <div className="absolute top-3 left-3 bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium"> {car.status === "active" ? "Available" : car.status || "Available"} </div> </div> {/* Car Details */} <div className="p-4 space-y-3"> <div> <h3 className="font-semibold text-gray-900 text-lg mb-1 line-clamp-1"> {car.title} </h3> <p className="text-gray-600 text-sm line-clamp-2"> {car.description} </p> </div> {/* Car Info */} <div className="flex items-center justify-between text-sm text-gray-500"> <div className="flex items-center gap-1"> <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /> </svg> <span>{car.city}</span> </div> {car.year && ( <div className="flex items-center gap-1"> <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /> </svg> <span>{car.year}</span> </div> )} </div> {/* Additional Info */} <div className="flex items-center justify-between text-xs text-gray-400"> <span>{car.transmission || "Automatic"}</span> <span>{car.fuelType || "Petrol"}</span> {car.mileage && <span>{car.mileage} km</span>} </div> {/* Action Button */} <Link to={`/cars/${car._id}`} className="block w-full bg-green-600 hover:bg-green-700 text-white text-center py-2 px-4 rounded-lg font-medium transition-colors duration-200" > View Details </Link> </div> </div> ); }; // Loading Skeleton const LoadingSkeleton = () => ( <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"> {Array.from({ length: 8 }).map((_, index) => ( <div key={index} className="bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm animate-pulse" > <div className="aspect-video bg-gray-200"></div> <div className="p-4 space-y-3"> <div className="h-4 bg-gray-200 rounded w-3/4"></div> <div className="h-3 bg-gray-200 rounded w-full"></div> <div className="h-3 bg-gray-200 rounded w-2/3"></div> <div className="h-8 bg-gray-200 rounded"></div> </div> </div> ))} </div> ); // Pagination Component const Pagination = () => { if (pagination.totalPages <= 1) return null; const pages = []; const maxVisiblePages = 5; const halfVisible = Math.floor(maxVisiblePages / 2); let startPage = Math.max(1, pagination.currentPage - halfVisible); let endPage = Math.min( pagination.totalPages, startPage + maxVisiblePages - 1 ); if (endPage - startPage + 1 < maxVisiblePages) { startPage = Math.max(1, endPage - maxVisiblePages + 1); } for (let i = startPage; i <= endPage; i++) { pages.push(i); } return ( <div className="flex items-center justify-center space-x-2 mt-8"> {/* Previous Button */} <button onClick={() => handlePageChange(pagination.currentPage - 1)} disabled={pagination.currentPage === 1} className="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" > Previous </button> {/* Page Numbers */} {pages.map((page) => ( <button key={page} onClick={() => handlePageChange(page)} className={`px-3 py-2 text-sm font-medium rounded-lg ${ page === pagination.currentPage ? "bg-green-600 text-white" : "text-gray-500 bg-white border border-gray-300 hover:bg-gray-50" }`} > {page} </button> ))} {/* Next Button */} <button onClick={() => handlePageChange(pagination.currentPage + 1)} disabled={pagination.currentPage === pagination.totalPages} className="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" > Next </button> </div> ); }; return ( <div className="max-w-7xl mx-auto p-6 space-y-6"> {/* Filter Bar */} <CarFilterBar onFiltersChange={handleFiltersChange} onReset={handleFiltersReset} /> {/* Results Header */} <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4"> <div className="flex items-center gap-4"> <h2 className="text-2xl font-bold text-gray-900">Available Cars</h2> {!loading && ( <span className="text-gray-600 text-sm"> {pagination.totalCount || cars.length} cars found </span> )} </div> {/* Sort Options */} <div className="flex items-center gap-3"> <span className="text-sm text-gray-600">Sort by:</span> <select value={`${sortBy}-${sortOrder}`} onChange={(e) => { const [field, order] = e.target.value.split("-"); handleSortChange(field, order); }} className="text-sm border border-gray-300 rounded-lg px-3 py-2 focus:ring-1 focus:ring-green-500 outline-none" > <option value="createdAt-desc">Newest First</option> <option value="createdAt-asc">Oldest First</option> <option value="price-asc">Price: Low to High</option> <option value="price-desc">Price: High to Low</option> <option value="title-asc">Name: A to Z</option> <option value="title-desc">Name: Z to A</option> </select> </div> </div> {/* Error State */} {error && ( <div className="bg-red-50 border border-red-200 rounded-lg p-6 text-center"> <svg className="mx-auto h-12 w-12 text-red-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" /> </svg> <h3 className="text-lg font-medium text-red-800 mb-2"> Error Loading Cars </h3> <p className="text-red-600 mb-4">{error}</p> <button onClick={() => fetchCars()} className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors" > Try Again </button> </div> )} {/* Loading State */} {loading && <LoadingSkeleton />} {/* Empty State */} {!loading && !error && cars.length === 0 && ( <div className="text-center py-12"> <svg className="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /> </svg> <h3 className="text-lg font-medium text-gray-900 mb-2"> No Cars Found </h3> <p className="text-gray-600 mb-4"> Try adjusting your filters or search criteria to find more cars. </p> <button onClick={handleFiltersReset} className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors" > Clear All Filters </button> </div> )} {/* Cars Grid */} {!loading && !error && cars.length > 0 && ( <> <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"> {cars.map((car) => ( <CarCard key={car._id} car={car} /> ))} </div> {/* Pagination */} <Pagination /> </> )} </div> ); }; export default CarListingSection;
```

# borrowmycarfrontend\src\components\ButtonAccent.jsx

```jsx
import { useState, useEffect } from "react"; import { X, CreditCard, Building, Smartphone, Lock, CheckCircle, AlertCircle, MapPin, Clock, Banknote, Wallet, } from "lucide-react"; import API from "../api"; const PaymentModal = ({ isOpen, onClose, bookingData, onPaymentSuccess, onPaymentError, }) => { const [paymentMethod, setPaymentMethod] = useState("stripe"); const [processing, setProcessing] = useState(false); const [cardForm, setCardForm] = useState({ cardNumber: "", expiryDate: "", cvv: "", cardholderName: "", saveCard: false, }); const [bankForm, setBankForm] = useState({ bank: "", accountNumber: "", routingNumber: "", }); const [digitalWalletForm, setDigitalWalletForm] = useState({ walletType: "apple_pay", phoneNumber: "", }); const [cashOnPickupForm, setCashOnPickupForm] = useState({ meetingLocation: "", meetingTime: "", notes: "", agreeToTerms: false, }); const [errors, setErrors] = useState({}); const [savedCards, setSavedCards] = useState([]); const [selectedSavedCard, setSelectedSavedCard] = useState(""); // UAE Banks for bank transfer const uaeBanks = [ "Emirates NBD", "First Abu Dhabi Bank (FAB)", "Abu Dhabi Commercial Bank (ADCB)", "Dubai Islamic Bank (DIB)", "Mashreq Bank", "Commercial Bank of Dubai (CBD)", "Union National Bank (UNB)", "Ajman Bank", "Bank of Sharjah", "Invest Bank", ]; // Digital Wallet Options const digitalWallets = [ { id: "apple_pay", name: "Apple Pay", icon: "🍎" }, { id: "google_pay", name: "Google Pay", icon: "🔵" }, { id: "samsung_pay", name: "Samsung Pay", icon: "📱" }, { id: "paypal", name: "PayPal", icon: "💙" }, { id: "careem_pay", name: "Careem Pay", icon: "🚗" }, { id: "beam_wallet", name: "Beam Wallet", icon: "💫" }, ]; // Payment Methods Configuration const paymentMethods = [ { id: "stripe", name: "Credit/Debit Card", icon: CreditCard, description: "Pay securely with Visa, Mastercard, or American Express", processing: "Instant", fees: "3.5% + AED 1.50", }, { id: "bank_transfer", name: "Bank Transfer", icon: Building, description: "Direct bank transfer from UAE banks", processing: "1-2 business days", fees: "Free", }, { id: "digital_wallet", name: "Digital Wallet", icon: Smartphone, description: "Apple Pay, Google Pay, PayPal and more", processing: "Instant", fees: "2.9% + AED 1.00", }, { id: "cash_on_pickup", name: "Cash on Pickup", icon: Banknote, description: "Pay cash when you collect the car", processing: "At pickup", fees: "Free", }, ]; useEffect(() => { if (isOpen) { fetchSavedCards(); } }, [isOpen]); const fetchSavedCards = async () => { try { const response = await API.get("/payments/saved-cards"); setSavedCards(response.data.data.cards || []); } catch (error) { console.error("Failed to fetch saved cards:", error); } }; // Format card number for display const formatCardNumber = (value) => { const v = value.replace(/\s+/g, "").replace(/[^0-9]/gi, ""); const matches = v.match(/\d{4,16}/g); const match = (matches && matches[0]) || ""; const parts = []; for (let i = 0, len = match.length; i < len; i += 4) { parts.push(match.substring(i, i + 4)); } return parts.length ? parts.join(" ") : v; }; // Format expiry date const formatExpiryDate = (value) => { const v = value.replace(/\s+/g, "").replace(/[^0-9]/gi, ""); if (v.length >= 2) { return v.substring(0, 2) + "/" + v.substring(2, 4); } return v; }; // Validation functions const validateStripeForm = () => { const newErrors = {}; if (selectedSavedCard) { if (!cardForm.cvv || cardForm.cvv.length < 3) { newErrors.cvv = "CVV is required"; } } else { const cardNumber = cardForm.cardNumber.replace(/\s/g, ""); if (!cardNumber || cardNumber.length < 13 || cardNumber.length > 19) { newErrors.cardNumber = "Valid card number is required"; } if (!cardForm.expiryDate || !/^\d{2}\/\d{2}$/.test(cardForm.expiryDate)) { newErrors.expiryDate = "Valid expiry date is required (MM/YY)"; } else { const [month, year] = cardForm.expiryDate.split("/"); const currentDate = new Date(); const expiryDate = new Date(2000 + parseInt(year), parseInt(month) - 1); if (expiryDate < currentDate) { newErrors.expiryDate = "Card has expired"; } } if (!cardForm.cvv || cardForm.cvv.length < 3) { newErrors.cvv = "Valid CVV is required"; } if (!cardForm.cardholderName.trim()) { newErrors.cardholderName = "Cardholder name is required"; } } setErrors(newErrors); return Object.keys(newErrors).length === 0; }; const validateBankForm = () => { const newErrors = {}; if (!bankForm.bank) { newErrors.bank = "Please select a bank"; } if (!bankForm.accountNumber) { newErrors.accountNumber = "Account number is required"; } setErrors(newErrors); return Object.keys(newErrors).length === 0; }; const validateDigitalWallet = () => { const newErrors = {}; if ( digitalWalletForm.walletType === "careem_pay" || digitalWalletForm.walletType === "beam_wallet" ) { if (!digitalWalletForm.phoneNumber) { newErrors.phoneNumber = "Phone number is required"; } } setErrors(newErrors); return Object.keys(newErrors).length === 0; }; const validateCashOnPickup = () => { const newErrors = {}; if (!cashOnPickupForm.meetingLocation.trim()) { newErrors.meetingLocation = "Meeting location is required"; } if (!cashOnPickupForm.meetingTime) { newErrors.meetingTime = "Meeting time is required"; } if (!cashOnPickupForm.agreeToTerms) { newErrors.agreeToTerms = "You must agree to the terms"; } setErrors(newErrors); return Object.keys(newErrors).length === 0; }; const handleCardInputChange = (field, value) => { let formattedValue = value; if (field === "cardNumber") { formattedValue = formatCardNumber(value); } else if (field === "expiryDate") { formattedValue = formatExpiryDate(value); } else if (field === "cvv") { formattedValue = value.replace(/[^0-9]/g, "").substring(0, 4); } setCardForm((prev) => ({ ...prev, [field]: formattedValue })); if (errors[field]) { setErrors((prev) => ({ ...prev, [field]: "" })); } }; const processPayment = async () => { setProcessing(true); try { let paymentData = { bookingId: bookingData.bookingId, amount: bookingData.totalAmount, currency: "AED", paymentMethod: paymentMethod, ...bookingData, }; let isValid = false; // Validate based on payment method switch (paymentMethod) { case "stripe": isValid = validateStripeForm(); if (isValid) { paymentData.cardDetails = selectedSavedCard ? { savedCardId: selectedSavedCard, cvv: cardForm.cvv } : cardForm; } break; case "bank_transfer": isValid = validateBankForm(); if (isValid) { paymentData.bankDetails = bankForm; } break; case "digital_wallet": isValid = validateDigitalWallet(); if (isValid) { paymentData.walletDetails = digitalWalletForm; } break; case "cash_on_pickup": isValid = validateCashOnPickup(); if (isValid) { paymentData.cashDetails = cashOnPickupForm; } break; } if (!isValid) { setProcessing(false); return; } const response = await API.post("/payments/process", paymentData); if (response.data.success) { onPaymentSuccess?.(response.data.data); onClose(); } else { throw new Error(response.data.message || "Payment failed"); } } catch (error) { console.error("Payment error:", error); onPaymentError?.( error.response?.data?.message || error.message || "Payment failed" ); } finally { setProcessing(false); } }; if (!isOpen) return null; return ( <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"> <div className="bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"> {/* Header */} <div className="flex items-center justify-between p-6 border-b border-gray-200"> <div> <h2 className="text-2xl font-bold text-gray-900"> Complete Payment </h2> <p className="text-gray-600 mt-1"> Secure your booking for {bookingData?.carTitle} </p> </div> <button onClick={onClose} disabled={processing} className="text-gray-400 hover:text-gray-600 transition-colors disabled:opacity-50" > <X className="w-6 h-6" /> </button> </div> <div className="flex flex-col lg:flex-row"> {/* Left Side - Payment Methods */} <div className="lg:w-2/3 p-6 border-r border-gray-200"> <h3 className="text-lg font-semibold text-gray-900 mb-4"> Choose Payment Method </h3> {/* Payment Method Selection */} <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"> {paymentMethods.map((method) => ( <button key={method.id} onClick={() => setPaymentMethod(method.id)} className={`p-4 border-2 rounded-xl transition-all text-left ${ paymentMethod === method.id ? "border-green-500 bg-green-50" : "border-gray-200 hover:border-gray-300" }`} > <div className="flex items-center space-x-3 mb-2"> <method.icon className={`w-5 h-5 ${ paymentMethod === method.id ? "text-green-600" : "text-gray-600" }`} /> <span className="font-medium text-gray-900"> {method.name} </span> </div> <p className="text-sm text-gray-600 mb-2"> {method.description} </p> <div className="flex justify-between text-xs text-gray-500"> <span>Processing: {method.processing}</span> <span>Fees: {method.fees}</span> </div> </button> ))} </div> {/* Payment Form Based on Selected Method */} <div className="space-y-4"> {/* Stripe Payment Form */} {paymentMethod === "stripe" && ( <div className="space-y-4"> <h4 className="font-medium text-gray-900"> Card Information </h4> {/* Saved Cards */} {savedCards.length > 0 && ( <div className="space-y-2"> <label className="block text-sm font-medium text-gray-700"> Saved Cards </label> <select value={selectedSavedCard} onChange={(e) => setSelectedSavedCard(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" > <option value="">Use new card</option> {savedCards.map((card) => ( <option key={card.id} value={card.id}> **** **** **** {card.last4} ({card.brand}) </option> ))} </select> </div> )} {/* New Card Form */} {!selectedSavedCard && ( <> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Card Number </label> <input type="text" value={cardForm.cardNumber} onChange={(e) => handleCardInputChange("cardNumber", e.target.value) } placeholder="1234 5678 9012 3456" className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.cardNumber ? "border-red-500" : "border-gray-300" }`} /> {errors.cardNumber && ( <p className="text-red-500 text-xs mt-1"> {errors.cardNumber} </p> )} </div> <div className="grid grid-cols-2 gap-4"> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Expiry Date </label> <input type="text" value={cardForm.expiryDate} onChange={(e) => handleCardInputChange( "expiryDate", e.target.value ) } placeholder="MM/YY" className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.expiryDate ? "border-red-500" : "border-gray-300" }`} /> {errors.expiryDate && ( <p className="text-red-500 text-xs mt-1"> {errors.expiryDate} </p> )} </div> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> CVV </label> <input type="text" value={cardForm.cvv} onChange={(e) => handleCardInputChange("cvv", e.target.value) } placeholder="123" className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.cvv ? "border-red-500" : "border-gray-300" }`} /> {errors.cvv && ( <p className="text-red-500 text-xs mt-1"> {errors.cvv} </p> )} </div> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Cardholder Name </label> <input type="text" value={cardForm.cardholderName} onChange={(e) => handleCardInputChange( "cardholderName", e.target.value ) } placeholder="John Doe" className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.cardholderName ? "border-red-500" : "border-gray-300" }`} /> {errors.cardholderName && ( <p className="text-red-500 text-xs mt-1"> {errors.cardholderName} </p> )} </div> <div className="flex items-center"> <input type="checkbox" id="saveCard" checked={cardForm.saveCard} onChange={(e) => setCardForm((prev) => ({ ...prev, saveCard: e.target.checked, })) } className="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500" /> <label htmlFor="saveCard" className="ml-2 text-sm text-gray-700" > Save this card for future payments </label> </div> </> )} {/* CVV for saved cards */} {selectedSavedCard && ( <div> <label className="block text-sm font-medium text-gray-700 mb-1"> CVV for saved card </label> <input type="text" value={cardForm.cvv} onChange={(e) => handleCardInputChange("cvv", e.target.value) } placeholder="123" className={`w-full max-w-xs px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.cvv ? "border-red-500" : "border-gray-300" }`} /> {errors.cvv && ( <p className="text-red-500 text-xs mt-1"> {errors.cvv} </p> )} </div> )} </div> )} {/* Bank Transfer Form */} {paymentMethod === "bank_transfer" && ( <div className="space-y-4"> <h4 className="font-medium text-gray-900"> Bank Transfer Details </h4> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Select Bank </label> <select value={bankForm.bank} onChange={(e) => setBankForm((prev) => ({ ...prev, bank: e.target.value, })) } className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.bank ? "border-red-500" : "border-gray-300" }`} > <option value="">Choose your bank</option> {uaeBanks.map((bank) => ( <option key={bank} value={bank}> {bank} </option> ))} </select> {errors.bank && ( <p className="text-red-500 text-xs mt-1">{errors.bank}</p> )} </div> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Account Number </label> <input type="text" value={bankForm.accountNumber} onChange={(e) => setBankForm((prev) => ({ ...prev, accountNumber: e.target.value, })) } placeholder="Enter your account number" className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.accountNumber ? "border-red-500" : "border-gray-300" }`} /> {errors.accountNumber && ( <p className="text-red-500 text-xs mt-1"> {errors.accountNumber} </p> )} </div> <div className="bg-blue-50 p-4 rounded-lg"> <p className="text-blue-800 text-sm"> <strong>Note:</strong> After clicking "Complete Payment", you'll receive bank transfer instructions via email. Your booking will be confirmed once the transfer is completed. </p> </div> </div> )} {/* Digital Wallet Form */} {paymentMethod === "digital_wallet" && ( <div className="space-y-4"> <h4 className="font-medium text-gray-900">Digital Wallet</h4> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Select Wallet </label> <div className="grid grid-cols-2 gap-3"> {digitalWallets.map((wallet) => ( <button key={wallet.id} type="button" onClick={() => setDigitalWalletForm((prev) => ({ ...prev, walletType: wallet.id, })) } className={`p-3 border-2 rounded-lg transition-all ${ digitalWalletForm.walletType === wallet.id ? "border-green-500 bg-green-50" : "border-gray-200 hover:border-gray-300" }`} > <div className="text-center"> <span className="text-2xl mb-1 block"> {wallet.icon} </span> <span className="text-sm font-medium"> {wallet.name} </span> </div> </button> ))} </div> </div> {(digitalWalletForm.walletType === "careem_pay" || digitalWalletForm.walletType === "beam_wallet") && ( <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Phone Number </label> <input type="text" value={digitalWalletForm.phoneNumber} onChange={(e) => setDigitalWalletForm((prev) => ({ ...prev, phoneNumber: e.target.value, })) } placeholder="+971 50 123 4567" className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.phoneNumber ? "border-red-500" : "border-gray-300" }`} /> {errors.phoneNumber && ( <p className="text-red-500 text-xs mt-1"> {errors.phoneNumber} </p> )} </div> )} </div> )} {/* Cash on Pickup Form */} {paymentMethod === "cash_on_pickup" && ( <div className="space-y-4"> <h4 className="font-medium text-gray-900"> Cash Payment Details </h4> <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4"> <div className="flex items-start"> <Banknote className="w-5 h-5 text-yellow-600 mt-0.5 mr-2" /> <div> <h5 className="font-medium text-yellow-800 mb-1"> Cash Payment Instructions </h5> <p className="text-yellow-700 text-sm"> You'll pay cash directly to the car owner when you pick up the vehicle. Please bring the exact amount in AED. </p> </div> </div> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Meeting Location <span className="text-red-500">*</span> </label> <div className="relative"> <MapPin className="absolute left-3 top-3 w-4 h-4 text-gray-400" /> <input type="text" value={cashOnPickupForm.meetingLocation} onChange={(e) => setCashOnPickupForm((prev) => ({ ...prev, meetingLocation: e.target.value, })) } placeholder="Enter pickup location (e.g., Dubai Mall Parking)" className={`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.meetingLocation ? "border-red-500" : "border-gray-300" }`} /> </div> {errors.meetingLocation && ( <p className="text-red-500 text-xs mt-1"> {errors.meetingLocation} </p> )} </div> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Preferred Meeting Time{" "} <span className="text-red-500">*</span> </label> <div className="relative"> <Clock className="absolute left-3 top-3 w-4 h-4 text-gray-400" /> <input type="datetime-local" value={cashOnPickupForm.meetingTime} onChange={(e) => setCashOnPickupForm((prev) => ({ ...prev, meetingTime: e.target.value, })) } min={new Date().toISOString().slice(0, 16)} className={`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.meetingTime ? "border-red-500" : "border-gray-300" }`} /> </div> {errors.meetingTime && ( <p className="text-red-500 text-xs mt-1"> {errors.meetingTime} </p> )} </div> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Additional Notes </label> <textarea value={cashOnPickupForm.notes} onChange={(e) => setCashOnPickupForm((prev) => ({ ...prev, notes: e.target.value, })) } placeholder="Any special instructions for the meeting..." rows="3" className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" /> </div> <div className="flex items-start"> <input type="checkbox" id="agreeToTerms" checked={cashOnPickupForm.agreeToTerms} onChange={(e) => setCashOnPickupForm((prev) => ({ ...prev, agreeToTerms: e.target.checked, })) } className={`w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mt-1 ${ errors.agreeToTerms ? "border-red-500" : "" }`} /> <label htmlFor="agreeToTerms" className="ml-2 text-sm text-gray-700" > I agree to meet at the specified time and location, and understand that I need to bring the exact amount in cash (AED {bookingData?.totalAmount}). </label> </div> {errors.agreeToTerms && ( <p className="text-red-500 text-xs mt-1"> {errors.agreeToTerms} </p> )} <div className="bg-gray-50 p-4 rounded-lg"> <h5 className="font-medium text-gray-900 mb-2"> Important Reminders: </h5> <ul className="text-sm text-gray-600 space-y-1"> <li> • Bring exact change: AED {bookingData?.totalAmount} </li> <li>• Bring your Emirates ID and driving license</li> <li>• Inspect the vehicle before taking possession</li> <li> • The car owner will contact you to confirm meeting details </li> </ul> </div> </div> )} </div> </div> {/* Right Side - Booking Summary */} <div className="lg:w-1/3 p-6 bg-gray-50"> <h3 className="text-lg font-semibold text-gray-900 mb-4"> Booking Summary </h3> {/* Car Details */} <div className="bg-white rounded-lg p-4 mb-4"> <div className="flex items-center space-x-3 mb-3"> <img src={bookingData?.carImage || "/placeholder-car.jpg"} alt={bookingData?.carTitle} className="w-16 h-12 object-cover rounded-lg" /> <div> <h4 className="font-medium text-gray-900"> {bookingData?.carTitle} </h4> <p className="text-sm text-gray-600"> {bookingData?.carLocation} </p> </div> </div> <div className="space-y-2 text-sm"> <div className="flex justify-between"> <span className="text-gray-600">Pickup Date:</span> <span className="font-medium"> {new Date(bookingData?.startDate).toLocaleDateString()} </span> </div> <div className="flex justify-between"> <span className="text-gray-600">Return Date:</span> <span className="font-medium"> {new Date(bookingData?.endDate).toLocaleDateString()} </span> </div> <div className="flex justify-between"> <span className="text-gray-600">Duration:</span> <span className="font-medium"> {bookingData?.numberOfDays} day {bookingData?.numberOfDays !== 1 ? "s" : ""} </span> </div> </div> </div> {/* Price Breakdown */} <div className="bg-white rounded-lg p-4 mb-4"> <h4 className="font-medium text-gray-900 mb-3"> Price Breakdown </h4> <div className="space-y-2 text-sm"> <div className="flex justify-between"> <span className="text-gray-600">Daily Rate:</span> <span>AED {bookingData?.dailyRate}</span> </div> <div className="flex justify-between"> <span className="text-gray-600">Duration:</span> <span> {bookingData?.numberOfDays} day {bookingData?.numberOfDays !== 1 ? "s" : ""} </span> </div> <div className="flex justify-between"> <span className="text-gray-600">Subtotal:</span> <span>AED {bookingData?.subtotal}</span> </div> <div className="flex justify-between"> <span className="text-gray-600">Service Fee:</span> <span>AED {bookingData?.serviceFee || 0}</span> </div> <div className="flex justify-between"> <span className="text-gray-600">Insurance:</span> <span>AED {bookingData?.insurance || 0}</span> </div> {/* Payment Method Fees */} {paymentMethod === "stripe" && ( <div className="flex justify-between text-orange-600"> <span>Payment Processing:</span> <span> AED {(bookingData?.totalAmount * 0.035 + 1.5).toFixed(2)} </span> </div> )} {paymentMethod === "digital_wallet" && ( <div className="flex justify-between text-orange-600"> <span>Payment Processing:</span> <span> AED {(bookingData?.totalAmount * 0.029 + 1.0).toFixed(2)} </span> </div> )} <hr className="border-gray-200" /> <div className="flex justify-between font-semibold text-lg"> <span>Total:</span> <span className="text-green-600"> AED {bookingData?.totalAmount} </span> </div> </div> </div> {/* Security Features */} <div className="bg-white rounded-lg p-4 mb-6"> <h4 className="font-medium text-gray-900 mb-3 flex items-center"> <Lock className="w-4 h-4 mr-2 text-green-600" /> Secure Payment </h4> <div className="space-y-2 text-sm text-gray-600"> <div className="flex items-center"> <CheckCircle className="w-4 h-4 mr-2 text-green-500" /> <span>256-bit SSL encryption</span> </div> <div className="flex items-center"> <CheckCircle className="w-4 h-4 mr-2 text-green-500" /> <span>PCI DSS compliant</span> </div> <div className="flex items-center"> <CheckCircle className="w-4 h-4 mr-2 text-green-500" /> <span>Fraud protection</span> </div> <div className="flex items-center"> <CheckCircle className="w-4 h-4 mr-2 text-green-500" /> <span>Instant confirmation</span> </div> </div> </div> {/* Action Buttons */} <div className="space-y-3"> <button onClick={processPayment} disabled={processing} className="w-full bg-green-600 hover:bg-green-700 disabled:bg-green-400 disabled:cursor-not-allowed text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center" > {processing ? ( <> <div className="animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full mr-2"></div> Processing... </> ) : ( <> {paymentMethod === "cash_on_pickup" ? ( <> <Banknote className="w-5 h-5 mr-2" /> Confirm Cash Payment </> ) : paymentMethod === "bank_transfer" ? ( <> <Building className="w-5 h-5 mr-2" /> Complete Bank Transfer </> ) : ( <> <Lock className="w-5 h-5 mr-2" /> Pay AED {bookingData?.totalAmount} </> )} </> )} </button> <button onClick={onClose} disabled={processing} className="w-full border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 font-medium py-3 px-6 rounded-lg transition-colors" > Cancel </button> </div> {/* Additional Info */} <div className="mt-4 p-3 bg-blue-50 rounded-lg"> <p className="text-xs text-blue-800"> {paymentMethod === "cash_on_pickup" ? ( <> <strong>Cash Payment:</strong> You'll pay directly to the car owner at pickup. Make sure to bring exact change and inspect the vehicle before payment. </> ) : paymentMethod === "bank_transfer" ? ( <> <strong>Bank Transfer:</strong> Your booking will be confirmed once we receive your bank transfer. You'll receive detailed instructions via email. </> ) : ( <> <strong>Instant Booking:</strong> Your payment is secure and your booking will be confirmed immediately after successful payment. </> )} </p> </div> </div> </div> </div> </div> ); }; export default PaymentModal;
```

# borrowmycarfrontend\src\components\CarCard.jsx

```jsx
import React from "react"; import { MapPin, Navigation, Star } from "lucide-react"; const CarCard = ({ car, userLocation = null, showDistance = true }) => { const getDistanceText = () => { if (!userLocation || !car.location || !showDistance) return null; const distance = mapboxService.calculateDistance( userLocation.coordinates, car.location.coordinates ); return `${distance.toFixed(1)} km away`; }; return ( <div className="bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-shadow"> <div className="relative"> <img src={car.images?.[0] || "/placeholder-car.jpg"} alt={car.title} className="w-full h-48 object-cover" /> {/* Price Badge */} <div className="absolute top-3 right-3 bg-green-600 text-white px-3 py-1 rounded-full text-sm font-semibold"> AED {car.price}/day </div> {/* Distance Badge */} {getDistanceText() && ( <div className="absolute top-3 left-3 bg-white bg-opacity-90 px-2 py-1 rounded-full text-xs font-medium flex items-center"> <Navigation className="w-3 h-3 mr-1" /> {getDistanceText()} </div> )} </div> <div className="p-4"> <h3 className="font-semibold text-gray-900 text-lg mb-1"> {car.title} </h3> {car.location && ( <div className="flex items-center text-gray-600 text-sm mb-2"> <MapPin className="w-4 h-4 mr-1" /> <span className="truncate">{car.location.name}</span> </div> )} <div className="flex items-center justify-between"> <div className="flex items-center"> <Star className="w-4 h-4 text-yellow-400 mr-1" /> <span className="text-sm text-gray-600"> {car.averageRating || "5.0"} ({car.totalBookings || 0} reviews) </span> </div> <Link to={`/cars/${car._id}`} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors" > View Details </Link> </div> </div> </div> ); };
```

# borrowmycarfrontend\src\components\DeliveryLocationPicker.jsx

```jsx
import React, { useState } from "react"; import { Truck, MapPin, Clock, DollarSign } from "lucide-react"; import LocationPicker from "./LocationPicker"; import { mapboxService } from "../utils/mapboxUtils"; const DeliveryLocationPicker = ({ carLocation, onDeliveryChange, className = "", }) => { const [deliveryRequested, setDeliveryRequested] = useState(false); const [deliveryLocation, setDeliveryLocation] = useState(null); const [deliveryInfo, setDeliveryInfo] = useState(null); const [isCalculating, setIsCalculating] = useState(false); const calculateDeliveryInfo = async (location) => { if (!carLocation || !location) return; setIsCalculating(true); try { const distance = mapboxService.calculateDistance( carLocation.coordinates, location.coordinates ); const deliveryFee = Math.max(20, distance * 2); // AED 2 per km, minimum AED 20 const estimatedTime = Math.max(30, distance * 3); // 3 minutes per km, minimum 30 min const info = { distance: distance.toFixed(1), fee: Math.round(deliveryFee), estimatedTime: Math.round(estimatedTime), }; setDeliveryInfo(info); onDeliveryChange({ requested: true, location: location, ...info, }); } catch (error) { console.error("Error calculating delivery info:", error); } finally { setIsCalculating(false); } }; const handleDeliveryToggle = (enabled) => { setDeliveryRequested(enabled); if (!enabled) { setDeliveryLocation(null); setDeliveryInfo(null); onDeliveryChange({ requested: false }); } }; const handleLocationSelect = (location) => { setDeliveryLocation(location); if (location) { calculateDeliveryInfo(location); } else { setDeliveryInfo(null); onDeliveryChange({ requested: deliveryRequested, location: null }); } }; return ( <div className={`space-y-4 ${className}`}> {/* Delivery Toggle */} <div className="flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg"> <div className="flex items-center space-x-3"> <Truck className="w-5 h-5 text-blue-600" /> <div> <h3 className="font-medium text-blue-900">Car Delivery</h3> <p className="text-sm text-blue-700"> Get the car delivered to your location </p> </div> </div> <label className="relative inline-flex items-center cursor-pointer"> <input type="checkbox" checked={deliveryRequested} onChange={(e) => handleDeliveryToggle(e.target.checked)} className="sr-only peer" /> <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div> </label> </div> {/* Delivery Location Picker */} {deliveryRequested && ( <div className="space-y-4"> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Delivery Address </label> <LocationPicker onLocationSelect={handleLocationSelect} placeholder="Where should we deliver the car?" showCurrentLocation={true} /> </div> {/* Delivery Information */} {deliveryLocation && ( <div className="bg-white border border-gray-200 rounded-lg p-4"> <h4 className="font-medium text-gray-900 mb-3"> Delivery Details </h4> {isCalculating ? ( <div className="flex items-center space-x-2 text-gray-600"> <div className="animate-spin w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full"></div> <span className="text-sm">Calculating delivery info...</span> </div> ) : ( deliveryInfo && ( <div className="grid grid-cols-1 md:grid-cols-3 gap-4"> <div className="flex items-center space-x-2"> <MapPin className="w-4 h-4 text-gray-400" /> <div> <p className="text-sm text-gray-600">Distance</p> <p className="font-medium"> {deliveryInfo.distance} km </p> </div> </div> <div className="flex items-center space-x-2"> <Clock className="w-4 h-4 text-gray-400" /> <div> <p className="text-sm text-gray-600">Est. Time</p> <p className="font-medium"> {deliveryInfo.estimatedTime} min </p> </div> </div> <div className="flex items-center space-x-2"> <DollarSign className="w-4 h-4 text-gray-400" /> <div> <p className="text-sm text-gray-600">Delivery Fee</p> <p className="font-medium text-green-600"> AED {deliveryInfo.fee} </p> </div> </div> </div> ) )} <div className="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg"> <p className="text-sm text-yellow-800"> <strong>Note:</strong> Delivery time may vary based on traffic conditions. The car owner will contact you to confirm the delivery time. </p> </div> </div> )} </div> )} </div> ); }; export default DeliveryLocationPicker;
```

# borrowmycarfrontend\src\components\GeocodingSearch.jsx

```jsx
import React, { useState, useRef, useEffect } from "react"; import { Search, MapPin, Loader, X } from "lucide-react"; import { mapboxService } from "../utils/mapboxUtils"; const GeocodingSearch = ({ onLocationSelect, placeholder = "Search locations...", className = "", }) => { const [query, setQuery] = useState(""); const [results, setResults] = useState([]); const [loading, setLoading] = useState(false); const [showResults, setShowResults] = useState(false); const searchRef = useRef(null); const timeoutRef = useRef(null); useEffect(() => { const handleClickOutside = (event) => { if (searchRef.current && !searchRef.current.contains(event.target)) { setShowResults(false); } }; document.addEventListener("mousedown", handleClickOutside); return () => document.removeEventListener("mousedown", handleClickOutside); }, []); const searchLocations = async (searchQuery) => { if (searchQuery.length < 2) { setResults([]); setShowResults(false); return; } setLoading(true); try { const geocodeResult = await mapboxService.geocodeAddress(searchQuery); if (geocodeResult.success) { setResults(geocodeResult.results); setShowResults(true); } } catch (error) { console.error("Geocoding error:", error); setResults([]); } finally { setLoading(false); } }; const handleInputChange = (e) => { const value = e.target.value; setQuery(value); // Debounce search if (timeoutRef.current) { clearTimeout(timeoutRef.current); } timeoutRef.current = setTimeout(() => { searchLocations(value); }, 300); }; const handleLocationClick = (location) => { setQuery(location.name); setShowResults(false); onLocationSelect(location); }; const clearSearch = () => { setQuery(""); setResults([]); setShowResults(false); onLocationSelect(null); }; return ( <div ref={searchRef} className={`relative ${className}`}> <div className="relative"> <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"> {loading ? ( <Loader className="h-5 w-5 text-gray-400 animate-spin" /> ) : ( <Search className="h-5 w-5 text-gray-400" /> )} </div> <input type="text" value={query} onChange={handleInputChange} onFocus={() => { if (results.length > 0) setShowResults(true); }} placeholder={placeholder} className="block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none" /> {query && ( <button onClick={clearSearch} className="absolute inset-y-0 right-0 pr-3 flex items-center" > <X className="h-5 w-5 text-gray-400 hover:text-gray-600" /> </button> )} </div> {/* Search Results */} {showResults && results.length > 0 && ( <div className="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto"> {results.map((result, index) => ( <button key={`${result.id}-${index}`} onClick={() => handleLocationClick(result)} className="w-full flex items-start px-4 py-3 hover:bg-gray-50 transition-colors text-left border-b border-gray-100 last:border-b-0" > <MapPin className="w-4 h-4 text-gray-400 mt-1 mr-3 flex-shrink-0" /> <div className="flex-1 min-w-0"> <p className="text-sm font-medium text-gray-900 truncate"> {result.name} </p> {result.city && ( <p className="text-xs text-gray-500">{result.city}, UAE</p> )} </div> </button> ))} </div> )} {/* No Results */} {showResults && results.length === 0 && query.length >= 2 && !loading && ( <div className="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg p-4"> <p className="text-sm text-gray-500 text-center"> No locations found for "{query}" </p> </div> )} </div> ); }; export default GeocodingSearch;
```

# borrowmycarfrontend\src\components\LocationPicker.jsx

```jsx
import React, { useState, useRef, useEffect } from "react"; import mapboxgl from "mapbox-gl"; import MapboxGeocoder from "@mapbox/mapbox-gl-geocoder"; import { MapPin, Navigation, Search, X } from "lucide-react"; import { MAPBOX_CONFIG } from "../config/mapbox"; import { mapboxService } from "../utils/mapboxUtils"; import "mapbox-gl/dist/mapbox-gl.css"; import "@mapbox/mapbox-gl-geocoder/dist/mapbox-gl-geocoder.css"; const LocationPicker = ({ onLocationSelect, initialLocation = null, placeholder = "Search for a location in UAE...", showCurrentLocation = true, className = "", }) => { const mapContainer = useRef(null); const map = useRef(null); const marker = useRef(null); const geocoder = useRef(null); const [isLoading, setIsLoading] = useState(false); const [selectedLocation, setSelectedLocation] = useState(initialLocation); const [showMap, setShowMap] = useState(false); const [currentLocation, setCurrentLocation] = useState(null); // Initialize map useEffect(() => { if (!showMap || !mapContainer.current) return; mapboxgl.accessToken = MAPBOX_CONFIG.accessToken; map.current = new mapboxgl.Map({ container: mapContainer.current, style: MAPBOX_CONFIG.style, center: initialLocation?.coordinates || MAPBOX_CONFIG.center, zoom: MAPBOX_CONFIG.zoom, maxBounds: MAPBOX_CONFIG.uae.bounds, }); // Add navigation controls map.current.addControl(new mapboxgl.NavigationControl(), "top-right"); // Initialize geocoder geocoder.current = new MapboxGeocoder({ accessToken: mapboxgl.accessToken, mapboxgl: mapboxgl, countries: "ae", bbox: MAPBOX_CONFIG.uae.bounds.flat(), placeholder: "Search UAE locations...", proximity: MAPBOX_CONFIG.center, }); map.current.addControl(geocoder.current, "top-left"); // Handle geocoder results geocoder.current.on("result", (e) => { const { result } = e; const location = { name: result.place_name, coordinates: result.center, address: result.properties.address || "", city: mapboxService.extractCity(result.context), }; setSelectedLocation(location); onLocationSelect(location); addMarker(result.center); }); // Handle map clicks map.current.on("click", async (e) => { const { lng, lat } = e.lngLat; setIsLoading(true); const reverseResult = await mapboxService.reverseGeocode(lng, lat); if (reverseResult.success) { setSelectedLocation(reverseResult.result); onLocationSelect(reverseResult.result); addMarker([lng, lat]); } setIsLoading(false); }); // Add initial marker if location provided if (initialLocation?.coordinates) { addMarker(initialLocation.coordinates); } return () => { if (map.current) { map.current.remove(); } }; }, [showMap]); const addMarker = (coordinates) => { if (marker.current) { marker.current.remove(); } marker.current = new mapboxgl.Marker({ color: "#16a34a", draggable: true, }) .setLngLat(coordinates) .addTo(map.current); // Handle marker drag marker.current.on("dragend", async () => { const lngLat = marker.current.getLngLat(); setIsLoading(true); const reverseResult = await mapboxService.reverseGeocode( lngLat.lng, lngLat.lat ); if (reverseResult.success) { setSelectedLocation(reverseResult.result); onLocationSelect(reverseResult.result); } setIsLoading(false); }); }; const getCurrentLocation = () => { setIsLoading(true); navigator.geolocation.getCurrentPosition( async (position) => { const { longitude, latitude } = position.coords; setCurrentLocation([longitude, latitude]); const reverseResult = await mapboxService.reverseGeocode( longitude, latitude ); if (reverseResult.success) { setSelectedLocation(reverseResult.result); onLocationSelect(reverseResult.result); if (map.current) { map.current.flyTo({ center: [longitude, latitude], zoom: 15, }); addMarker([longitude, latitude]); } } setIsLoading(false); }, (error) => { console.error("Geolocation error:", error); setIsLoading(false); alert("Unable to get your current location. Please select manually."); }, { enableHighAccuracy: true, timeout: 10000, maximumAge: 300000, } ); }; const clearSelection = () => { setSelectedLocation(null); onLocationSelect(null); if (marker.current) { marker.current.remove(); marker.current = null; } if (geocoder.current) { geocoder.current.clear(); } }; return ( <div className={`space-y-4 ${className}`}> {/* Location Display */} <div className="relative"> <div className="flex items-center space-x-2 p-3 border border-gray-300 rounded-lg bg-white"> <MapPin className="w-5 h-5 text-gray-400" /> <div className="flex-1"> {selectedLocation ? ( <div> <p className="font-medium text-gray-900"> {selectedLocation.name} </p> {selectedLocation.city && ( <p className="text-sm text-gray-600"> {selectedLocation.city}, UAE </p> )} </div> ) : ( <p className="text-gray-500">{placeholder}</p> )} </div> <div className="flex items-center space-x-2"> {showCurrentLocation && ( <button type="button" onClick={getCurrentLocation} disabled={isLoading} className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors disabled:opacity-50" title="Use current location" > <Navigation className="w-4 h-4" /> </button> )} <button type="button" onClick={() => setShowMap(!showMap)} className="p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors" title="Open map" > <Search className="w-4 h-4" /> </button> {selectedLocation && ( <button type="button" onClick={clearSelection} className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors" title="Clear selection" > <X className="w-4 h-4" /> </button> )} </div> </div> {isLoading && ( <div className="absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 rounded-lg"> <div className="animate-spin w-5 h-5 border-2 border-green-500 border-t-transparent rounded-full"></div> </div> )} </div> {/* Map Container */} {showMap && ( <div className="relative"> <div ref={mapContainer} className="h-96 w-full rounded-lg border border-gray-300" /> <button onClick={() => setShowMap(false)} className="absolute top-2 right-2 bg-white hover:bg-gray-50 border border-gray-300 p-2 rounded-lg shadow-lg transition-colors" > <X className="w-4 h-4" /> </button> <div className="absolute bottom-2 left-2 bg-white p-2 rounded-lg shadow-lg text-xs text-gray-600"> Click on the map or drag the marker to select a location </div> </div> )} {/* Quick Location Buttons */} <div className="flex flex-wrap gap-2"> {MAPBOX_CONFIG.uae.cities.map((city) => ( <button key={city.name} type="button" onClick={async () => { setIsLoading(true); const reverseResult = await mapboxService.reverseGeocode( city.coordinates[0], city.coordinates[1] ); if (reverseResult.success) { setSelectedLocation({ ...reverseResult.result, name: city.name, city: city.name, }); onLocationSelect({ ...reverseResult.result, name: city.name, city: city.name, }); if (map.current && showMap) { map.current.flyTo({ center: city.coordinates, zoom: 12, }); addMarker(city.coordinates); } } setIsLoading(false); }} className="px-3 py-1 text-xs bg-gray-100 hover:bg-green-100 text-gray-700 hover:text-green-700 rounded-full transition-colors" > {city.name} </button> ))} </div> </div> ); }; export default LocationPicker;
```

# borrowmycarfrontend\src\components\Mapbox\BaseMap.jsx

```jsx

```

# borrowmycarfrontend\src\components\Mapbox\CarLocationMap.jsx

```jsx

```

# borrowmycarfrontend\src\components\MapSearchView.jsx

```jsx
import React, { useState, useRef, useEffect } from "react"; import mapboxgl from "mapbox-gl"; import { Search, Filter, List, Map as MapIcon, Car, DollarSign, } from "lucide-react"; import { MAPBOX_CONFIG } from "../../../config/mapbox"; import { mapboxService } from "../../../utils/mapboxUtils"; import API from "../api"; const MapSearchView = () => { const mapContainer = useRef(null); const map = useRef(null); const [cars, setCars] = useState([]); const [filteredCars, setFilteredCars] = useState([]); const [loading, setLoading] = useState(false); const [viewMode, setViewMode] = useState("map"); // 'map' or 'list' const [filters, setFilters] = useState({ priceMin: "", priceMax: "", category: "", transmission: "", }); const [mapBounds, setMapBounds] = useState(null); const [selectedCar, setSelectedCar] = useState(null); const markersRef = useRef([]); useEffect(() => { initializeMap(); fetchCars(); }, []); useEffect(() => { if (cars.length > 0) { updateMapMarkers(); } }, [filteredCars]); const initializeMap = () => { if (!mapContainer.current) return; mapboxgl.accessToken = MAPBOX_CONFIG.accessToken; map.current = new mapboxgl.Map({ container: mapContainer.current, style: MAPBOX_CONFIG.style, center: MAPBOX_CONFIG.center, zoom: MAPBOX_CONFIG.zoom, maxBounds: MAPBOX_CONFIG.uae.bounds, }); map.current.addControl(new mapboxgl.NavigationControl(), "top-right"); // Listen for map movement to update search area map.current.on("moveend", () => { const bounds = map.current.getBounds(); setMapBounds(bounds); searchCarsInArea(bounds); }); map.current.on("load", () => { // Add clusters for better performance map.current.addSource("cars", { type: "geojson", data: { type: "FeatureCollection", features: [], }, cluster: true, clusterMaxZoom: 14, clusterRadius: 50, }); // Cluster circles map.current.addLayer({ id: "clusters", type: "circle", source: "cars", filter: ["has", "point_count"], paint: { "circle-color": [ "step", ["get", "point_count"], "#51bbd6", 10, "#f1f075", 30, "#f28cb1", ], "circle-radius": ["step", ["get", "point_count"], 20, 10, 30, 30, 40], }, }); // Cluster count labels map.current.addLayer({ id: "cluster-count", type: "symbol", source: "cars", filter: ["has", "point_count"], layout: { "text-field": "{point_count_abbreviated}", "text-font": ["DIN Offc Pro Medium", "Arial Unicode MS Bold"], "text-size": 12, }, }); // Individual car points map.current.addLayer({ id: "unclustered-point", type: "circle", source: "cars", filter: ["!", ["has", "point_count"]], paint: { "circle-color": "#16a34a", "circle-radius": 8, "circle-stroke-width": 2, "circle-stroke-color": "#fff", }, }); // Click events map.current.on("click", "clusters", (e) => { const features = map.current.queryRenderedFeatures(e.point, { layers: ["clusters"], }); const clusterId = features[0].properties.cluster_id; map.current .getSource("cars") .getClusterExpansionZoom(clusterId, (err, zoom) => { if (err) return; map.current.easeTo({ center: features[0].geometry.coordinates, zoom: zoom, }); }); }); map.current.on("click", "unclustered-point", (e) => { const car = e.features[0].properties; setSelectedCar(JSON.parse(car.carData)); // Show popup new mapboxgl.Popup() .setLngLat(e.lngLat) .setHTML(createCarPopupHTML(JSON.parse(car.carData))) .addTo(map.current); }); // Change cursor on hover map.current.on("mouseenter", "clusters", () => { map.current.getCanvas().style.cursor = "pointer"; }); map.current.on("mouseleave", "clusters", () => { map.current.getCanvas().style.cursor = ""; }); }); }; const fetchCars = async () => { setLoading(true); try { const response = await API.get("/cars"); if (response.data.success) { const carsWithLocation = response.data.data.cars.filter( (car) => car.location && car.location.coordinates ); setCars(carsWithLocation); setFilteredCars(carsWithLocation); } } catch (error) { console.error("Error fetching cars:", error); } finally { setLoading(false); } }; const searchCarsInArea = async (bounds) => { // Filter cars that are within the current map bounds const carsInBounds = cars.filter((car) => { const [lng, lat] = car.location.coordinates; return bounds.contains([lng, lat]); }); setFilteredCars(carsInBounds); }; const updateMapMarkers = () => { if (!map.current) return; const features = filteredCars.map((car) => ({ type: "Feature", properties: { carId: car._id, carData: JSON.stringify(car), }, geometry: { type: "Point", coordinates: car.location.coordinates, }, })); map.current.getSource("cars").setData({ type: "FeatureCollection", features, }); }; const createCarPopupHTML = (car) => { return ` <div class="p-3 min-w-[200px]"> <img src="${car.images[0]}" alt="${car.title}" class="w-full h-24 object-cover rounded mb-2"> <h3 class="font-semibold text-sm mb-1">${car.title}</h3> <div class="flex justify-between items-center mb-2"> <span class="text-green-600 font-bold">AED ${car.price}/day</span> <span class="text-xs text-gray-500">${car.city}</span> </div> <button onclick="window.location.href='/cars/${car._id}'" class="w-full bg-green-600 text-white py-1 px-2 rounded text-xs hover:bg-green-700" > View Details </button> </div> `; }; const applyFilters = () => { let filtered = cars; if (filters.priceMin) { filtered = filtered.filter( (car) => car.price >= parseFloat(filters.priceMin) ); } if (filters.priceMax) { filtered = filtered.filter( (car) => car.price <= parseFloat(filters.priceMax) ); } if (filters.transmission) { filtered = filtered.filter( (car) => car.transmission === filters.transmission ); } setFilteredCars(filtered); }; return ( <div className="h-screen flex flex-col"> {/* Header */} <div className="bg-white border-b border-gray-200 p-4"> <div className="flex items-center justify-between"> <h1 className="text-2xl font-bold text-gray-900"> Find Cars Near You </h1> <div className="flex items-center space-x-4"> {/* View Toggle */} <div className="flex bg-gray-100 rounded-lg p-1"> <button onClick={() => setViewMode("map")} className={`px-3 py-1 rounded-md text-sm font-medium transition-colors ${ viewMode === "map" ? "bg-white text-green-600 shadow-sm" : "text-gray-600 hover:text-gray-900" }`} > <MapIcon className="w-4 h-4 mr-1 inline" /> Map </button> <button onClick={() => setViewMode("list")} className={`px-3 py-1 rounded-md text-sm font-medium transition-colors ${ viewMode === "list" ? "bg-white text-green-600 shadow-sm" : "text-gray-600 hover:text-gray-900" }`} > <List className="w-4 h-4 mr-1 inline" /> List </button> </div> {/* Results Count */} <span className="text-sm text-gray-600"> {filteredCars.length} cars found </span> </div> </div> {/* Filters */} <div className="mt-4 flex flex-wrap gap-4"> <div className="flex items-center space-x-2"> <DollarSign className="w-4 h-4 text-gray-400" /> <input type="number" placeholder="Min Price" value={filters.priceMin} onChange={(e) => setFilters({ ...filters, priceMin: e.target.value }) } className="w-24 px-2 py-1 border border-gray-300 rounded text-sm" /> <span className="text-gray-400">-</span> <input type="number" placeholder="Max Price" value={filters.priceMax} onChange={(e) => setFilters({ ...filters, priceMax: e.target.value }) } className="w-24 px-2 py-1 border border-gray-300 rounded text-sm" /> </div> <select value={filters.transmission} onChange={(e) => setFilters({ ...filters, transmission: e.target.value }) } className="px-3 py-1 border border-gray-300 rounded text-sm" > <option value="">All Transmissions</option> <option value="Automatic">Automatic</option> <option value="Manual">Manual</option> </select> <button onClick={applyFilters} className="px-4 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700" > Apply Filters </button> </div> </div> {/* Content */} <div className="flex-1 flex"> {/* Map View */} {viewMode === "map" && ( <div className="flex-1 relative"> <div ref={mapContainer} className="w-full h-full" /> {loading && ( <div className="absolute top-4 left-4 bg-white rounded-lg shadow-lg p-3"> <div className="flex items-center space-x-2"> <div className="animate-spin w-4 h-4 border-2 border-green-500 border-t-transparent rounded-full"></div> <span className="text-sm">Loading cars...</span> </div> </div> )} {/* Search in this area button */} <button onClick={() => searchCarsInArea(map.current.getBounds())} className="absolute top-4 right-4 bg-white hover:bg-gray-50 border border-gray-300 px-4 py-2 rounded-lg shadow-lg text-sm font-medium transition-colors" > Search this area </button> </div> )} {/* List View */} {viewMode === "list" && ( <div className="flex-1 overflow-y-auto"> <div className="p-4"> <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"> {filteredCars.map((car) => ( <div key={car._id} className="bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-shadow" > <img src={car.images[0]} alt={car.title} className="w-full h-48 object-cover" /> <div className="p-4"> <h3 className="font-semibold text-gray-900 mb-1"> {car.title} </h3> <p className="text-sm text-gray-600 mb-2"> {car.location?.name} </p> <div className="flex justify-between items-center"> <span className="text-green-600 font-bold"> AED {car.price}/day </span> <button onClick={() => (window.location.href = `/cars/${car._id}`) } className="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition-colors" > View Details </button> </div> </div> </div> ))} </div> {filteredCars.length === 0 && !loading && ( <div className="text-center py-12"> <Car className="w-12 h-12 text-gray-400 mx-auto mb-4" /> <h3 className="text-lg font-medium text-gray-900 mb-2"> No cars found </h3> <p className="text-gray-600"> Try adjusting your filters or search in a different area. </p> </div> )} </div> </div> )} </div> </div> ); }; export default MapSearchView;
```

# borrowmycarfrontend\src\components\NearbyCars.jsx

```jsx
import React, { useState, useEffect } from "react"; import { MapPin, Navigation, Car } from "lucide-react"; import { mapboxService } from "../utils/mapboxUtils"; import API from "../api"; const NearbyCars = ({ userLocation, radius = 10, excludeCarId = null, limit = 6, className = "", }) => { const [nearbyCars, setNearbyCars] = useState([]); const [loading, setLoading] = useState(false); useEffect(() => { if (userLocation) { fetchNearbyCars(); } }, [userLocation, radius]); const fetchNearbyCars = async () => { setLoading(true); try { const response = await API.get("/cars", { params: { location: userLocation.coordinates.join(","), radius: radius, limit: limit, exclude: excludeCarId, }, }); if (response.data.success) { const carsWithDistance = await Promise.all( response.data.data.cars.map(async (car) => { if (car.location && car.location.coordinates) { const distance = mapboxService.calculateDistance( userLocation.coordinates, car.location.coordinates ); return { ...car, distance: distance.toFixed(1) }; } return car; }) ); // Sort by distance carsWithDistance.sort( (a, b) => parseFloat(a.distance) - parseFloat(b.distance) ); setNearbyCars(carsWithDistance); } } catch (error) { console.error("Error fetching nearby cars:", error); } finally { setLoading(false); } }; if (!userLocation) { return null; } return ( <div className={`space-y-4 ${className}`}> <div className="flex items-center justify-between"> <h3 className="text-lg font-semibold text-gray-900">Cars Near You</h3> <span className="text-sm text-gray-500">Within {radius} km</span> </div> {loading ? ( <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"> {[...Array(3)].map((_, i) => ( <div key={i} className="animate-pulse"> <div className="bg-gray-200 h-40 rounded-lg mb-2"></div> <div className="bg-gray-200 h-4 rounded mb-1"></div> <div className="bg-gray-200 h-4 rounded w-2/3"></div> </div> ))} </div> ) : nearbyCars.length > 0 ? ( <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"> {nearbyCars.map((car) => ( <div key={car._id} className="bg-white border border-gray-200 rounded-lg overflow-hidden hover:shadow-md transition-shadow" > <div className="relative"> <img src={car.images?.[0] || "/placeholder-car.jpg"} alt={car.title} className="w-full h-40 object-cover" /> <div className="absolute top-2 right-2 bg-white bg-opacity-90 px-2 py-1 rounded-full text-xs font-medium flex items-center"> <Navigation className="w-3 h-3 mr-1" /> {car.distance} km </div> </div> <div className="p-3"> <h4 className="font-medium text-gray-900 mb-1 line-clamp-1"> {car.title} </h4> <div className="flex items-center text-sm text-gray-600 mb-2"> <MapPin className="w-3 h-3 mr-1" /> <span className="line-clamp-1">{car.location?.name}</span> </div> <div className="flex items-center justify-between"> <span className="text-green-600 font-semibold"> AED {car.price}/day </span> <button onClick={() => (window.location.href = `/cars/${car._id}`)} className="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition-colors" > View </button> </div> </div> </div> ))} </div> ) : ( <div className="text-center py-8"> <Car className="w-12 h-12 text-gray-400 mx-auto mb-3" /> <p className="text-gray-600">No cars found within {radius} km</p> <button onClick={() => fetchNearbyCars()} className="mt-2 text-green-600 hover:text-green-700 text-sm font-medium" > Expand search area </button> </div> )} </div> ); }; export default NearbyCars;
```

# borrowmycarfrontend\src\components\PaymentForm.jsx

```jsx
// src/components/PaymentForm.jsx - Fixed to work with your backend import { useState, useEffect } from "react"; import { Elements, CardElement, useStripe, useElements, } from "@stripe/react-stripe-js"; import { usePayment } from "../context/PaymentContext"; import { useNavigate } from "react-router-dom"; import { CreditCard, Lock, AlertCircle, CheckCircle, Shield, } from "lucide-react"; const CARD_ELEMENT_OPTIONS = { style: { base: { fontSize: "16px", color: "#424770", fontFamily: '"Helvetica Neue", Helvetica, sans-serif', fontSmoothing: "antialiased", "::placeholder": { color: "#aab7c4", }, }, invalid: { color: "#9e2146", iconColor: "#9e2146", }, }, hidePostalCode: true, }; const CheckoutForm = ({ booking, onSuccess, onError }) => { const stripe = useStripe(); const elements = useElements(); const { createPaymentIntent, confirmPayment, paymentLoading, paymentError, clearError, } = usePayment(); const [processing, setProcessing] = useState(false); const [clientSecret, setClientSecret] = useState(""); const [paymentIntentId, setPaymentIntentId] = useState(""); const [cardComplete, setCardComplete] = useState(false); const [cardError, setCardError] = useState(""); useEffect(() => { // Create payment intent when component mounts const initPayment = async () => { try { clearError(); const result = await createPaymentIntent(booking._id); setClientSecret(result.data.clientSecret); setPaymentIntentId(result.data.paymentIntentId); } catch (error) { onError(error.message); } }; if (booking._id) { initPayment(); } }, [booking._id]); const handleCardChange = (event) => { setCardComplete(event.complete); setCardError(event.error ? event.error.message : ""); }; const handleSubmit = async (event) => { event.preventDefault(); if (!stripe || !elements || !clientSecret) { onError("Payment system not ready. Please try again."); return; } if (!cardComplete) { setCardError("Please complete your card details"); return; } setProcessing(true); clearError(); const card = elements.getElement(CardElement); try { // Confirm payment with Stripe const { error, paymentIntent } = await stripe.confirmCardPayment( clientSecret, { payment_method: { card: card, billing_details: { name: booking.renter?.name || booking.renterName || "Customer", email: booking.renter?.email || booking.renterEmail, }, }, } ); if (error) { console.error("Payment failed:", error); onError(error.message); } else if (paymentIntent.status === "succeeded") { console.log("Payment succeeded:", paymentIntent); // Confirm payment on backend try { await confirmPayment(paymentIntent.id, booking._id); onSuccess({ paymentIntent, booking: booking, }); } catch (confirmError) { console.error("Backend confirmation failed:", confirmError); onError( "Payment successful but booking confirmation failed. Please contact support." ); } } } catch (error) { console.error("Payment error:", error); onError("An unexpected error occurred. Please try again."); } finally { setProcessing(false); } }; return ( <form onSubmit={handleSubmit} className="space-y-6"> {/* Booking Summary */} <div className="bg-gray-50 p-4 rounded-lg border"> <h3 className="font-medium text-gray-900 mb-3 flex items-center"> <CheckCircle className="w-5 h-5 text-green-500 mr-2" /> Booking Summary </h3> <div className="space-y-2 text-sm"> <div className="flex justify-between"> <span className="text-gray-600"> Car Rental ({booking.totalDays} day {booking.totalDays !== 1 ? "s" : ""}) </span> <span className="text-gray-900"> AED {booking.totalAmount?.toFixed(2)} </span> </div> {booking.securityDeposit > 0 && ( <div className="flex justify-between"> <span className="text-gray-600">Security Deposit</span> <span className="text-gray-900"> AED {booking.securityDeposit.toFixed(2)} </span> </div> )} <div className="border-t border-gray-200 pt-2 flex justify-between font-semibold"> <span className="text-gray-900">Total Amount</span> <span className="text-green-600 text-lg"> AED {booking.totalPayable?.toFixed(2)} </span> </div> </div> </div> {/* Card Details */} <div className="space-y-4"> <div> <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center"> <CreditCard className="w-4 h-4 mr-2" /> Card Details </label> <div className="border border-gray-300 rounded-lg p-4 bg-white focus-within:ring-2 focus-within:ring-green-500 focus-within:border-transparent transition-all"> <CardElement options={CARD_ELEMENT_OPTIONS} onChange={handleCardChange} /> </div> {cardError && ( <p className="text-red-600 text-sm mt-1 flex items-center"> <AlertCircle className="w-4 h-4 mr-1" /> {cardError} </p> )} </div> {/* Security Notice */} <div className="flex items-center text-sm text-gray-600 bg-blue-50 p-3 rounded-lg"> <Shield className="w-4 h-4 mr-2 text-blue-600" /> <span>Your payment is secure and encrypted with 256-bit SSL</span> </div> </div> {/* Error Display */} {(paymentError || onError) && ( <div className="bg-red-50 border border-red-200 rounded-lg p-4 flex items-start"> <AlertCircle className="w-5 h-5 text-red-600 mr-3 mt-0.5 flex-shrink-0" /> <div> <h4 className="text-sm font-medium text-red-800">Payment Error</h4> <p className="text-sm text-red-700 mt-1">{paymentError}</p> </div> </div> )} {/* Processing State */} {processing && ( <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-center"> <div className="animate-spin w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full mr-3"></div> <span className="text-blue-800">Processing your payment...</span> </div> )} {/* Submit Button */} <button type="submit" disabled={!stripe || processing || paymentLoading || !cardComplete} className="w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-semibold py-4 px-6 rounded-lg transition-all duration-200 flex items-center justify-center shadow-lg hover:shadow-xl" > {processing || paymentLoading ? ( <> <div className="animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full mr-3"></div> Processing Payment... </> ) : ( <> <Lock className="w-5 h-5 mr-2" /> Pay AED {booking.totalPayable?.toFixed(2)} </> )} </button> {/* Payment Security */} <div className="text-center"> <div className="flex items-center justify-center space-x-4 text-xs text-gray-500"> <span>🔒 SSL Secured</span> <span>•</span> <span>💳 PCI Compliant</span> <span>•</span> <span>🛡️ Stripe Protected</span> </div> </div> {/* Test Card Info - Only show in development */} {import.meta.env.DEV && ( <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4"> <h4 className="text-sm font-medium text-yellow-800 mb-2"> 🧪 Test Mode - Use Test Cards </h4> <div className="text-xs text-yellow-700 space-y-1"> <div className="grid grid-cols-2 gap-4"> <div> <p className="font-medium">✅ Successful Payment:</p> <p className="font-mono">4242 4242 4242 4242</p> </div> <div> <p className="font-medium">❌ Declined Payment:</p> <p className="font-mono">4000 0000 0000 0002</p> </div> </div> <div className="mt-2 pt-2 border-t border-yellow-300"> <p> <strong>Expiry:</strong> Any future date (e.g., 12/25) </p> <p> <strong>CVC:</strong> Any 3-digit number (e.g., 123) </p> </div> </div> </div> )} </form> ); }; const PaymentForm = ({ booking, onSuccess, onError }) => { const { stripePromise } = usePayment(); if (!booking) { return ( <div className="text-center py-8"> <AlertCircle className="w-12 h-12 text-red-400 mx-auto mb-4" /> <p className="text-red-600">No booking information found</p> </div> ); } return ( <Elements stripe={stripePromise}> <CheckoutForm booking={booking} onSuccess={onSuccess} onError={onError} /> </Elements> ); }; export default PaymentForm;
```

# borrowmycarfrontend\src\components\PaymentModal.jsx

```jsx
// src/components/PaymentModal.jsx - Updated with Payment Service Integration import { useState, useEffect } from "react"; import { X, CreditCard, Building, Smartphone, Lock, CheckCircle, AlertCircle, MapPin, Clock, Banknote, Wallet, } from "lucide-react"; import paymentService from "../assets/services/paymentService"; // Import your payment service const PaymentModal = ({ isOpen, onClose, bookingData, onPaymentSuccess, onPaymentError, }) => { const [paymentMethod, setPaymentMethod] = useState("stripe"); const [processing, setProcessing] = useState(false); const [cardForm, setCardForm] = useState({ cardNumber: "", expiryDate: "", cvv: "", cardholderName: "", saveCard: false, }); const [bankForm, setBankForm] = useState({ bank: "", accountNumber: "", routingNumber: "", }); const [digitalWalletForm, setDigitalWalletForm] = useState({ walletType: "apple_pay", phoneNumber: "", }); const [cashOnPickupForm, setCashOnPickupForm] = useState({ meetingLocation: "", meetingTime: "", notes: "", agreeToTerms: false, }); const [errors, setErrors] = useState({}); const [savedCards, setSavedCards] = useState([]); const [selectedSavedCard, setSelectedSavedCard] = useState(""); // UAE Banks for bank transfer const uaeBanks = [ "Emirates NBD", "First Abu Dhabi Bank (FAB)", "Abu Dhabi Commercial Bank (ADCB)", "Dubai Islamic Bank (DIB)", "Mashreq Bank", "Commercial Bank of Dubai (CBD)", "Union National Bank (UNB)", "Ajman Bank", "Bank of Sharjah", "Invest Bank", ]; // Digital Wallet Options const digitalWallets = [ { id: "apple_pay", name: "Apple Pay", icon: "🍎" }, { id: "google_pay", name: "Google Pay", icon: "🔵" }, { id: "samsung_pay", name: "Samsung Pay", icon: "📱" }, { id: "paypal", name: "PayPal", icon: "💙" }, { id: "careem_pay", name: "Careem Pay", icon: "🚗" }, { id: "beam_wallet", name: "Beam Wallet", icon: "💫" }, ]; // Payment Methods Configuration const paymentMethods = [ { id: "stripe", name: "Credit/Debit Card", icon: CreditCard, description: "Pay securely with Visa, Mastercard, or American Express", processing: "Instant", fees: "3.5% + AED 1.50", }, { id: "bank_transfer", name: "Bank Transfer", icon: Building, description: "Direct bank transfer from UAE banks", processing: "1-2 business days", fees: "Free", }, { id: "digital_wallet", name: "Digital Wallet", icon: Smartphone, description: "Apple Pay, Google Pay, PayPal and more", processing: "Instant", fees: "2.9% + AED 1.00", }, { id: "cash_on_pickup", name: "Cash on Pickup", icon: Banknote, description: "Pay cash when you collect the car", processing: "At pickup", fees: "Free", }, ]; useEffect(() => { if (isOpen) { fetchSavedCards(); } }, [isOpen]); const fetchSavedCards = async () => { try { const cards = await paymentService.getSavedPaymentMethods(); setSavedCards(cards); } catch (error) { console.error("Failed to fetch saved cards:", error); } }; // Format card number for display const formatCardNumber = (value) => { const v = value.replace(/\s+/g, "").replace(/[^0-9]/gi, ""); const matches = v.match(/\d{4,16}/g); const match = (matches && matches[0]) || ""; const parts = []; for (let i = 0, len = match.length; i < len; i += 4) { parts.push(match.substring(i, i + 4)); } return parts.length ? parts.join(" ") : v; }; // Format expiry date const formatExpiryDate = (value) => { const v = value.replace(/\s+/g, "").replace(/[^0-9]/gi, ""); if (v.length >= 2) { return v.substring(0, 2) + "/" + v.substring(2, 4); } return v; }; // Validation functions const validateStripeForm = () => { const newErrors = {}; if (selectedSavedCard) { if (!cardForm.cvv || cardForm.cvv.length < 3) { newErrors.cvv = "CVV is required"; } } else { const cardNumber = cardForm.cardNumber.replace(/\s/g, ""); if (!cardNumber || cardNumber.length < 13 || cardNumber.length > 19) { newErrors.cardNumber = "Valid card number is required"; } if (!cardForm.expiryDate || !/^\d{2}\/\d{2}$/.test(cardForm.expiryDate)) { newErrors.expiryDate = "Valid expiry date is required (MM/YY)"; } else { const [month, year] = cardForm.expiryDate.split("/"); const currentDate = new Date(); const expiryDate = new Date(2000 + parseInt(year), parseInt(month) - 1); if (expiryDate < currentDate) { newErrors.expiryDate = "Card has expired"; } } if (!cardForm.cvv || cardForm.cvv.length < 3) { newErrors.cvv = "Valid CVV is required"; } if (!cardForm.cardholderName.trim()) { newErrors.cardholderName = "Cardholder name is required"; } } setErrors(newErrors); return Object.keys(newErrors).length === 0; }; const validateBankForm = () => { const newErrors = {}; if (!bankForm.bank) { newErrors.bank = "Please select a bank"; } if (!bankForm.accountNumber) { newErrors.accountNumber = "Account number is required"; } setErrors(newErrors); return Object.keys(newErrors).length === 0; }; const validateDigitalWallet = () => { const newErrors = {}; if ( digitalWalletForm.walletType === "careem_pay" || digitalWalletForm.walletType === "beam_wallet" ) { if (!digitalWalletForm.phoneNumber) { newErrors.phoneNumber = "Phone number is required"; } } setErrors(newErrors); return Object.keys(newErrors).length === 0; }; const validateCashOnPickup = () => { const newErrors = {}; if (!cashOnPickupForm.meetingLocation.trim()) { newErrors.meetingLocation = "Meeting location is required"; } if (!cashOnPickupForm.meetingTime) { newErrors.meetingTime = "Meeting time is required"; } if (!cashOnPickupForm.agreeToTerms) { newErrors.agreeToTerms = "You must agree to the terms"; } setErrors(newErrors); return Object.keys(newErrors).length === 0; }; const handleCardInputChange = (field, value) => { let formattedValue = value; if (field === "cardNumber") { formattedValue = formatCardNumber(value); } else if (field === "expiryDate") { formattedValue = formatExpiryDate(value); } else if (field === "cvv") { formattedValue = value.replace(/[^0-9]/g, "").substring(0, 4); } setCardForm((prev) => ({ ...prev, [field]: formattedValue })); if (errors[field]) { setErrors((prev) => ({ ...prev, [field]: "" })); } }; const processPayment = async () => { setProcessing(true); try { let paymentData = { ...bookingData, paymentMethod: paymentMethod, amount: bookingData.totalAmount, currency: "AED", }; let isValid = false; // Validate and add payment method specific data switch (paymentMethod) { case "stripe": isValid = validateStripeForm(); if (isValid) { paymentData.cardDetails = selectedSavedCard ? { savedCardId: selectedSavedCard, cvv: cardForm.cvv } : cardForm; } break; case "bank_transfer": isValid = validateBankForm(); if (isValid) { paymentData.bankDetails = bankForm; } break; case "digital_wallet": isValid = validateDigitalWallet(); if (isValid) { paymentData.walletDetails = digitalWalletForm; } break; case "cash_on_pickup": isValid = validateCashOnPickup(); if (isValid) { paymentData.cashDetails = cashOnPickupForm; } break; } if (!isValid) { setProcessing(false); return; } // Process payment using the payment service const result = await paymentService.processPayment(paymentData); if (result.success) { onPaymentSuccess?.(result); onClose(); } else { throw new Error(result.message || "Payment failed"); } } catch (error) { console.error("Payment error:", error); onPaymentError?.(error.message || "Payment failed. Please try again."); } finally { setProcessing(false); } }; if (!isOpen) return null; // Calculate fees based on payment method const calculateFees = () => { const baseAmount = bookingData?.totalAmount || 0; let fee = 0; switch (paymentMethod) { case "stripe": fee = Math.round(baseAmount * 0.035 + 1.5); break; case "digital_wallet": fee = Math.round(baseAmount * 0.029 + 1.0); break; default: fee = 0; } return fee; }; const paymentFee = calculateFees(); const finalAmount = (bookingData?.totalAmount || 0) + paymentFee; return ( <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"> <div className="bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"> {/* Header */} <div className="flex items-center justify-between p-6 border-b border-gray-200"> <div> <h2 className="text-2xl font-bold text-gray-900"> Complete Payment </h2> <p className="text-gray-600 mt-1"> Secure your booking for {bookingData?.carTitle} </p> </div> <button onClick={onClose} disabled={processing} className="text-gray-400 hover:text-gray-600 transition-colors disabled:opacity-50" > <X className="w-6 h-6" /> </button> </div> <div className="flex flex-col lg:flex-row"> {/* Left Side - Payment Methods */} <div className="lg:w-2/3 p-6 border-r border-gray-200"> <h3 className="text-lg font-semibold text-gray-900 mb-4"> Choose Payment Method </h3> {/* Payment Method Selection */} <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"> {paymentMethods.map((method) => ( <button key={method.id} onClick={() => setPaymentMethod(method.id)} className={`p-4 border-2 rounded-xl transition-all text-left ${ paymentMethod === method.id ? "border-green-500 bg-green-50" : "border-gray-200 hover:border-gray-300" }`} > <div className="flex items-center space-x-3 mb-2"> <method.icon className={`w-5 h-5 ${ paymentMethod === method.id ? "text-green-600" : "text-gray-600" }`} /> <span className="font-medium text-gray-900"> {method.name} </span> </div> <p className="text-sm text-gray-600 mb-2"> {method.description} </p> <div className="flex justify-between text-xs text-gray-500"> <span>Processing: {method.processing}</span> <span>Fees: {method.fees}</span> </div> </button> ))} </div> {/* Payment Form Based on Selected Method */} <div className="space-y-4"> {/* Stripe Payment Form */} {paymentMethod === "stripe" && ( <div className="space-y-4"> <h4 className="font-medium text-gray-900"> Card Information </h4> {/* Saved Cards */} {savedCards.length > 0 && ( <div className="space-y-2"> <label className="block text-sm font-medium text-gray-700"> Saved Cards </label> <select value={selectedSavedCard} onChange={(e) => setSelectedSavedCard(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" > <option value="">Use new card</option> {savedCards.map((card) => ( <option key={card.id} value={card.id}> **** **** **** {card.last4} ({card.brand}) </option> ))} </select> </div> )} {/* New Card Form */} {!selectedSavedCard && ( <> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Card Number </label> <input type="text" value={cardForm.cardNumber} onChange={(e) => handleCardInputChange("cardNumber", e.target.value) } placeholder="1234 5678 9012 3456" className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.cardNumber ? "border-red-500" : "border-gray-300" }`} /> {errors.cardNumber && ( <p className="text-red-500 text-xs mt-1"> {errors.cardNumber} </p> )} </div> <div className="grid grid-cols-2 gap-4"> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Expiry Date </label> <input type="text" value={cardForm.expiryDate} onChange={(e) => handleCardInputChange( "expiryDate", e.target.value ) } placeholder="MM/YY" className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.expiryDate ? "border-red-500" : "border-gray-300" }`} /> {errors.expiryDate && ( <p className="text-red-500 text-xs mt-1"> {errors.expiryDate} </p> )} </div> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> CVV </label> <input type="text" value={cardForm.cvv} onChange={(e) => handleCardInputChange("cvv", e.target.value) } placeholder="123" className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.cvv ? "border-red-500" : "border-gray-300" }`} /> {errors.cvv && ( <p className="text-red-500 text-xs mt-1"> {errors.cvv} </p> )} </div> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Cardholder Name </label> <input type="text" value={cardForm.cardholderName} onChange={(e) => handleCardInputChange( "cardholderName", e.target.value ) } placeholder="John Doe" className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.cardholderName ? "border-red-500" : "border-gray-300" }`} /> {errors.cardholderName && ( <p className="text-red-500 text-xs mt-1"> {errors.cardholderName} </p> )} </div> <div className="flex items-center"> <input type="checkbox" id="saveCard" checked={cardForm.saveCard} onChange={(e) => setCardForm((prev) => ({ ...prev, saveCard: e.target.checked, })) } className="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500" /> <label htmlFor="saveCard" className="ml-2 text-sm text-gray-700" > Save this card for future payments </label> </div> </> )} {/* CVV for saved cards */} {selectedSavedCard && ( <div> <label className="block text-sm font-medium text-gray-700 mb-1"> CVV for saved card </label> <input type="text" value={cardForm.cvv} onChange={(e) => handleCardInputChange("cvv", e.target.value) } placeholder="123" className={`w-full max-w-xs px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.cvv ? "border-red-500" : "border-gray-300" }`} /> {errors.cvv && ( <p className="text-red-500 text-xs mt-1"> {errors.cvv} </p> )} </div> )} </div> )} {/* Bank Transfer Form */} {paymentMethod === "bank_transfer" && ( <div className="space-y-4"> <h4 className="font-medium text-gray-900"> Bank Transfer Details </h4> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Select Bank </label> <select value={bankForm.bank} onChange={(e) => setBankForm((prev) => ({ ...prev, bank: e.target.value, })) } className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.bank ? "border-red-500" : "border-gray-300" }`} > <option value="">Choose your bank</option> {uaeBanks.map((bank) => ( <option key={bank} value={bank}> {bank} </option> ))} </select> {errors.bank && ( <p className="text-red-500 text-xs mt-1">{errors.bank}</p> )} </div> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Account Number </label> <input type="text" value={bankForm.accountNumber} onChange={(e) => setBankForm((prev) => ({ ...prev, accountNumber: e.target.value, })) } placeholder="Enter your account number" className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.accountNumber ? "border-red-500" : "border-gray-300" }`} /> {errors.accountNumber && ( <p className="text-red-500 text-xs mt-1"> {errors.accountNumber} </p> )} </div> <div className="bg-blue-50 p-4 rounded-lg"> <p className="text-blue-800 text-sm"> <strong>Note:</strong> After clicking "Complete Payment", you'll receive bank transfer instructions via email. Your booking will be confirmed once the transfer is completed. </p> </div> </div> )} {/* Digital Wallet Form */} {paymentMethod === "digital_wallet" && ( <div className="space-y-4"> <h4 className="font-medium text-gray-900">Digital Wallet</h4> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Select Wallet </label> <div className="grid grid-cols-2 gap-3"> {digitalWallets.map((wallet) => ( <button key={wallet.id} type="button" onClick={() => setDigitalWalletForm((prev) => ({ ...prev, walletType: wallet.id, })) } className={`p-3 border-2 rounded-lg transition-all ${ digitalWalletForm.walletType === wallet.id ? "border-green-500 bg-green-50" : "border-gray-200 hover:border-gray-300" }`} > <div className="text-center"> <span className="text-2xl mb-1 block"> {wallet.icon} </span> <span className="text-sm font-medium"> {wallet.name} </span> </div> </button> ))} </div> </div> {(digitalWalletForm.walletType === "careem_pay" || digitalWalletForm.walletType === "beam_wallet") && ( <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Phone Number </label> <input type="text" value={digitalWalletForm.phoneNumber} onChange={(e) => setDigitalWalletForm((prev) => ({ ...prev, phoneNumber: e.target.value, })) } placeholder="+971 50 123 4567" className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.phoneNumber ? "border-red-500" : "border-gray-300" }`} /> {errors.phoneNumber && ( <p className="text-red-500 text-xs mt-1"> {errors.phoneNumber} </p> )} </div> )} </div> )} {/* Cash on Pickup Form */} {paymentMethod === "cash_on_pickup" && ( <div className="space-y-4"> <h4 className="font-medium text-gray-900"> Cash Payment Details </h4> <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4"> <div className="flex items-start"> <Banknote className="w-5 h-5 text-yellow-600 mt-0.5 mr-2" /> <div> <h5 className="font-medium text-yellow-800 mb-1"> Cash Payment Instructions </h5> <p className="text-yellow-700 text-sm"> You'll pay cash directly to the car owner when you pick up the vehicle. Please bring the exact amount in AED. </p> </div> </div> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Meeting Location <span className="text-red-500">*</span> </label> <div className="relative"> <MapPin className="absolute left-3 top-3 w-4 h-4 text-gray-400" /> <input type="text" value={cashOnPickupForm.meetingLocation} onChange={(e) => setCashOnPickupForm((prev) => ({ ...prev, meetingLocation: e.target.value, })) } placeholder="Enter pickup location (e.g., Dubai Mall Parking)" className={`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.meetingLocation ? "border-red-500" : "border-gray-300" }`} /> </div> {errors.meetingLocation && ( <p className="text-red-500 text-xs mt-1"> {errors.meetingLocation} </p> )} </div> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Preferred Meeting Time{" "} <span className="text-red-500">*</span> </label> <div className="relative"> <Clock className="absolute left-3 top-3 w-4 h-4 text-gray-400" /> <input type="datetime-local" value={cashOnPickupForm.meetingTime} onChange={(e) => setCashOnPickupForm((prev) => ({ ...prev, meetingTime: e.target.value, })) } min={new Date().toISOString().slice(0, 16)} className={`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${ errors.meetingTime ? "border-red-500" : "border-gray-300" }`} /> </div> {errors.meetingTime && ( <p className="text-red-500 text-xs mt-1"> {errors.meetingTime} </p> )} </div> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Additional Notes </label> <textarea value={cashOnPickupForm.notes} onChange={(e) => setCashOnPickupForm((prev) => ({ ...prev, notes: e.target.value, })) } placeholder="Any special instructions for the meeting..." rows="3" className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" /> </div> <div className="flex items-start"> <input type="checkbox" id="agreeToTerms" checked={cashOnPickupForm.agreeToTerms} onChange={(e) => setCashOnPickupForm((prev) => ({ ...prev, agreeToTerms: e.target.checked, })) } className={`w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mt-1 ${ errors.agreeToTerms ? "border-red-500" : "" }`} /> <label htmlFor="agreeToTerms" className="ml-2 text-sm text-gray-700" > I agree to meet at the specified time and location, and understand that I need to bring the exact amount in cash (AED {bookingData?.totalAmount}). </label> </div> {errors.agreeToTerms && ( <p className="text-red-500 text-xs mt-1"> {errors.agreeToTerms} </p> )} <div className="bg-gray-50 p-4 rounded-lg"> <h5 className="font-medium text-gray-900 mb-2"> Important Reminders: </h5> <ul className="text-sm text-gray-600 space-y-1"> <li> • Bring exact change: AED {bookingData?.totalAmount} </li> <li>• Bring your Emirates ID and driving license</li> <li>• Inspect the vehicle before taking possession</li> <li> • The car owner will contact you to confirm meeting details </li> </ul> </div> </div> )} </div> </div> {/* Right Side - Booking Summary */} <div className="lg:w-1/3 p-6 bg-gray-50"> <h3 className="text-lg font-semibold text-gray-900 mb-4"> Booking Summary </h3> {/* Car Details */} <div className="bg-white rounded-lg p-4 mb-4"> <div className="flex items-center space-x-3 mb-3"> <img src={bookingData?.carImage || "/placeholder-car.jpg"} alt={bookingData?.carTitle} className="w-16 h-12 object-cover rounded-lg" /> <div> <h4 className="font-medium text-gray-900"> {bookingData?.carTitle} </h4> <p className="text-sm text-gray-600"> {bookingData?.carLocation} </p> </div> </div> <div className="space-y-2 text-sm"> <div className="flex justify-between"> <span className="text-gray-600">Pickup Date:</span> <span className="font-medium"> {new Date(bookingData?.startDate).toLocaleDateString()} </span> </div> <div className="flex justify-between"> <span className="text-gray-600">Return Date:</span> <span className="font-medium"> {new Date(bookingData?.endDate).toLocaleDateString()} </span> </div> <div className="flex justify-between"> <span className="text-gray-600">Duration:</span> <span className="font-medium"> {bookingData?.numberOfDays} day {bookingData?.numberOfDays !== 1 ? "s" : ""} </span> </div> </div> </div> {/* Price Breakdown */} <div className="bg-white rounded-lg p-4 mb-4"> <h4 className="font-medium text-gray-900 mb-3"> Price Breakdown </h4> <div className="space-y-2 text-sm"> <div className="flex justify-between"> <span className="text-gray-600">Daily Rate:</span> <span>AED {bookingData?.dailyRate}</span> </div> <div className="flex justify-between"> <span className="text-gray-600">Duration:</span> <span> {bookingData?.numberOfDays} day {bookingData?.numberOfDays !== 1 ? "s" : ""} </span> </div> <div className="flex justify-between"> <span className="text-gray-600">Subtotal:</span> <span>AED {bookingData?.subtotal}</span> </div> <div className="flex justify-between"> <span className="text-gray-600">Service Fee:</span> <span>AED {bookingData?.serviceFee || 0}</span> </div> <div className="flex justify-between"> <span className="text-gray-600">Insurance:</span> <span>AED {bookingData?.insurance || 0}</span> </div> {/* Payment Method Fees */} {paymentFee > 0 && ( <div className="flex justify-between text-orange-600"> <span>Payment Processing:</span> <span>AED {paymentFee.toFixed(2)}</span> </div> )} <hr className="border-gray-200" /> <div className="flex justify-between font-semibold text-lg"> <span>Total:</span> <span className="text-green-600"> AED {finalAmount.toFixed(2)} </span> </div> </div> </div> {/* Security Features */} <div className="bg-white rounded-lg p-4 mb-6"> <h4 className="font-medium text-gray-900 mb-3 flex items-center"> <Lock className="w-4 h-4 mr-2 text-green-600" /> Secure Payment </h4> <div className="space-y-2 text-sm text-gray-600"> <div className="flex items-center"> <CheckCircle className="w-4 h-4 mr-2 text-green-500" /> <span>256-bit SSL encryption</span> </div> <div className="flex items-center"> <CheckCircle className="w-4 h-4 mr-2 text-green-500" /> <span>PCI DSS compliant</span> </div> <div className="flex items-center"> <CheckCircle className="w-4 h-4 mr-2 text-green-500" /> <span>Fraud protection</span> </div> <div className="flex items-center"> <CheckCircle className="w-4 h-4 mr-2 text-green-500" /> <span>Instant confirmation</span> </div> </div> </div> {/* Action Buttons */} <div className="space-y-3"> <button onClick={processPayment} disabled={processing} className="w-full bg-green-600 hover:bg-green-700 disabled:bg-green-400 disabled:cursor-not-allowed text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center" > {processing ? ( <> <div className="animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full mr-2"></div> Processing... </> ) : ( <> {paymentMethod === "cash_on_pickup" ? ( <> <Banknote className="w-5 h-5 mr-2" /> Confirm Cash Payment </> ) : paymentMethod === "bank_transfer" ? ( <> <Building className="w-5 h-5 mr-2" /> Complete Bank Transfer </> ) : ( <> <Lock className="w-5 h-5 mr-2" /> Pay AED {finalAmount.toFixed(2)} </> )} </> )} </button> <button onClick={onClose} disabled={processing} className="w-full border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 font-medium py-3 px-6 rounded-lg transition-colors" > Cancel </button> </div> {/* Additional Info */} <div className="mt-4 p-3 bg-blue-50 rounded-lg"> <p className="text-xs text-blue-800"> {paymentMethod === "cash_on_pickup" ? ( <> <strong>Cash Payment:</strong> You'll pay directly to the car owner at pickup. Make sure to bring exact change and inspect the vehicle before payment. </> ) : paymentMethod === "bank_transfer" ? ( <> <strong>Bank Transfer:</strong> Your booking will be confirmed once we receive your bank transfer. You'll receive detailed instructions via email. </> ) : ( <> <strong>Instant Booking:</strong> Your payment is secure and your booking will be confirmed immediately after successful payment. </> )} </p> </div> </div> </div> </div> </div> ); }; export default PaymentModal;
```

# borrowmycarfrontend\src\components\PhoneInput.jsx

```jsx
// src/components/PhoneInput.jsx - Create this new component file import { useState } from "react"; const PhoneInput = ({ value, onChange, error, placeholder = "0501234567", required = false, className = "", }) => { const [focused, setFocused] = useState(false); const formatPhoneDisplay = (phone) => { // Remove all non-digit characters const digits = phone.replace(/\D/g, ""); // Format as XXX XXX XXXX for display if (digits.length >= 10) { return `${digits.slice(0, 3)} ${digits.slice(3, 6)} ${digits.slice( 6, 10 )}`; } else if (digits.length >= 6) { return `${digits.slice(0, 3)} ${digits.slice(3, 6)} ${digits.slice(6)}`; } else if (digits.length >= 3) { return `${digits.slice(0, 3)} ${digits.slice(3)}`; } return digits; }; const handleInputChange = (e) => { const input = e.target.value; // Remove all non-digit characters const digits = input.replace(/\D/g, ""); // Limit to 10 digits (including leading 0) let formattedValue = digits.slice(0, 10); // Ensure it starts with 0 for UAE local format if (formattedValue.length > 0 && !formattedValue.startsWith("0")) { formattedValue = "0" + formattedValue.slice(0, 9); } onChange(formattedValue); }; const getDisplayValue = () => { if (!value) return ""; // During focus, show unformatted for easier editing if (focused) { return value; } // When not focused, show formatted for better readability return formatPhoneDisplay(value); }; const validatePhone = (phone) => { const digits = phone.replace(/\D/g, ""); // UAE mobile numbers start with 05X and are 10 digits total const validPatterns = [ /^05[0-9]{8}$/, // 0501234567 - UAE mobile format /^04[0-9]{7}$/, // 041234567 - UAE landline format (Dubai) /^02[0-9]{7}$/, // 021234567 - UAE landline format (Abu Dhabi) /^03[0-9]{7}$/, // 031234567 - UAE landline format (Northern Emirates) /^06[0-9]{7}$/, // 061234567 - UAE landline format (Al Ain) /^07[0-9]{7}$/, // 071234567 - UAE landline format (Other) /^09[0-9]{7}$/, // 091234567 - UAE landline format (Other) ]; return validPatterns.some((pattern) => pattern.test(digits)); }; const isValid = value ? validatePhone(value) : true; return ( <div className="space-y-1"> <div className="relative"> <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"> <span className="text-gray-500 text-sm">🇦🇪 +971</span> </div> <input type="text" value={getDisplayValue()} onChange={handleInputChange} onFocus={() => setFocused(true)} onBlur={() => setFocused(false)} placeholder={placeholder} required={required} className={` w-full pl-20 pr-4 py-3 border rounded-lg text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition-colors ${error ? "border-red-500 bg-red-50" : "border-gray-300"} ${!isValid && value ? "border-orange-400 bg-orange-50" : ""} ${className} `} /> {value && isValid && ( <div className="absolute inset-y-0 right-0 pr-3 flex items-center"> <span className="text-green-500 text-sm">✓</span> </div> )} </div> {/* Helper text */} <div className="text-xs space-y-1"> {error && <p className="text-red-600">{error}</p>} {!error && value && !isValid && ( <p className="text-orange-600"> Please enter a valid UAE phone number </p> )} {!error && !value && ( <p className="text-gray-500"> Enter your UAE phone number (e.g., 0501234567) </p> )} </div> {/* Format examples */} {focused && !value && ( <div className="text-xs text-gray-400 space-y-1"> <p className="font-medium">Accepted formats:</p> <ul className="space-y-0.5 ml-2"> <li>• Mobile: 0501234567, 0551234567</li> <li>• Landline: 043001234, 026001234</li> </ul> </div> )} </div> ); }; export default PhoneInput;
```

# borrowmycarfrontend\src\components\ProfilePictureManager.jsx

```jsx
// src/components/ProfilePictureManager.jsx import { useState, useRef } from "react"; import { Camera, Trash2, Upload, X, User } from "lucide-react"; import API from "../api"; const ProfilePictureManager = ({ user, onUpdateSuccess, onError, size = "lg", editable = true, showRemoveOption = true, }) => { const [uploading, setUploading] = useState(false); const [removing, setRemoving] = useState(false); const [previewUrl, setPreviewUrl] = useState(null); const [showModal, setShowModal] = useState(false); const fileInputRef = useRef(null); // Size configurations const sizeConfig = { sm: { container: "w-16 h-16", image: "w-16 h-16", icon: "w-6 h-6", uploadButton: "w-5 h-5", modalImage: "w-32 h-32", }, md: { container: "w-24 h-24", image: "w-24 h-24", icon: "w-8 h-8", uploadButton: "w-6 h-6", modalImage: "w-48 h-48", }, lg: { container: "w-32 h-32", image: "w-32 h-32", icon: "w-12 h-12", uploadButton: "w-7 h-7", modalImage: "w-64 h-64", }, xl: { container: "w-48 h-48", image: "w-48 h-48", icon: "w-16 h-16", uploadButton: "w-8 h-8", modalImage: "w-80 h-80", }, }; const config = sizeConfig[size] || sizeConfig.lg; const handleFileSelect = (event) => { const file = event.target.files[0]; if (!file) return; // Validate file type const allowedTypes = ["image/jpeg", "image/jpg", "image/png", "image/webp"]; if (!allowedTypes.includes(file.type)) { onError?.("Please select a valid image file (JPEG, PNG, or WebP)"); return; } // Validate file size (5MB max) const maxSize = 5 * 1024 * 1024; // 5MB if (file.size > maxSize) { onError?.("Image size must be less than 5MB"); return; } // Create preview const reader = new FileReader(); reader.onload = (e) => { setPreviewUrl(e.target.result); setShowModal(true); }; reader.readAsDataURL(file); }; const handleUpload = async () => { if (!fileInputRef.current?.files[0]) return; setUploading(true); try { const formData = new FormData(); formData.append("profileImage", fileInputRef.current.files[0]); const response = await API.put("/auth/profile-picture", formData, { headers: { "Content-Type": "multipart/form-data", }, }); if (response.data.success) { onUpdateSuccess?.(response.data.data.user); setShowModal(false); setPreviewUrl(null); if (fileInputRef.current) { fileInputRef.current.value = ""; } } } catch (error) { console.error("Profile picture upload error:", error); onError?.( error.response?.data?.message || "Failed to upload profile picture" ); } finally { setUploading(false); } }; const handleRemove = async () => { if (!user?.profileImage) return; const confirmRemove = window.confirm( "Are you sure you want to remove your profile picture?" ); if (!confirmRemove) return; setRemoving(true); try { const response = await API.delete("/auth/profile-picture"); if (response.data.success) { onUpdateSuccess?.(response.data.data.user); } } catch (error) { console.error("Profile picture removal error:", error); onError?.( error.response?.data?.message || "Failed to remove profile picture" ); } finally { setRemoving(false); } }; const cancelUpload = () => { setShowModal(false); setPreviewUrl(null); if (fileInputRef.current) { fileInputRef.current.value = ""; } }; return ( <> {/* Profile Picture Display */} <div className="relative group"> <div className={`${config.container} relative rounded-full overflow-hidden border-4 border-white shadow-lg bg-gray-100 flex items-center justify-center`} > {user?.profileImage ? ( <img src={user.profileImage} alt={`${user.name}'s profile`} className={`${config.image} object-cover`} onError={(e) => { e.target.src = `https://ui-avatars.com/api/?name=${encodeURIComponent( user.name || "User" )}&background=10b981&color=ffffff&size=200`; }} /> ) : ( <div className="flex items-center justify-center w-full h-full bg-gradient-to-br from-gray-200 to-gray-300"> <User className={`${config.icon} text-gray-500`} /> </div> )} {/* Upload/Edit Overlay */} {editable && ( <div className="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all duration-200 flex items-center justify-center"> <div className="opacity-0 group-hover:opacity-100 transition-opacity duration-200"> <button onClick={() => fileInputRef.current?.click()} disabled={uploading || removing} className="bg-white bg-opacity-90 hover:bg-opacity-100 rounded-full p-2 transition-all duration-200 disabled:opacity-50" title="Change profile picture" > <Camera className={`${config.uploadButton} text-gray-700`} /> </button> </div> </div> )} </div> {/* Remove Button */} {editable && showRemoveOption && user?.profileImage && ( <button onClick={handleRemove} disabled={removing || uploading} className="absolute -top-2 -right-2 bg-red-500 hover:bg-red-600 text-white rounded-full p-1.5 shadow-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="Remove profile picture" > {removing ? ( <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" /> ) : ( <Trash2 className="w-4 h-4" /> )} </button> )} </div> {/* Hidden File Input */} <input ref={fileInputRef} type="file" accept="image/jpeg,image/jpg,image/png,image/webp" onChange={handleFileSelect} className="hidden" disabled={uploading || removing} /> {/* Upload Confirmation Modal */} {showModal && ( <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"> <div className="bg-white rounded-2xl shadow-xl max-w-md w-full p-6"> <div className="flex items-center justify-between mb-4"> <h3 className="text-lg font-semibold text-gray-900"> Update Profile Picture </h3> <button onClick={cancelUpload} disabled={uploading} className="text-gray-400 hover:text-gray-600 transition-colors disabled:opacity-50" > <X className="w-6 h-6" /> </button> </div> {/* Preview */} <div className="flex justify-center mb-6"> <div className={`${config.modalImage} relative rounded-full overflow-hidden border-4 border-gray-200`} > {previewUrl && ( <img src={previewUrl} alt="Preview" className="w-full h-full object-cover" /> )} </div> </div> {/* File Info */} {fileInputRef.current?.files[0] && ( <div className="bg-gray-50 rounded-lg p-3 mb-4"> <div className="text-sm text-gray-600"> <p className="font-medium"> {fileInputRef.current.files[0].name} </p> <p> {(fileInputRef.current.files[0].size / 1024 / 1024).toFixed( 2 )}{" "} MB </p> </div> </div> )} {/* Action Buttons */} <div className="flex space-x-3"> <button onClick={cancelUpload} disabled={uploading} className="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50" > Cancel </button> <button onClick={handleUpload} disabled={uploading} className="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center" > {uploading ? ( <> <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2" /> Uploading... </> ) : ( <> <Upload className="w-4 h-4 mr-2" /> Upload </> )} </button> </div> </div> </div> )} </> ); }; export default ProfilePictureManager;
```

# borrowmycarfrontend\src\components\ProtectedRoute.jsx

```jsx
// Create src/components/ProtectedRoute.jsx import { useAuth } from "../context/AuthProvider"; import { Navigate, useLocation } from "react-router-dom"; const ProtectedRoute = ({ children, requiredRole = null, requireApproval = false, }) => { const { isAuthenticated, user, loading } = useAuth(); const location = useLocation(); if (loading) { return ( <div className="min-h-screen flex items-center justify-center"> <div className="animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full"></div> </div> ); } if (!isAuthenticated) { return <Navigate to="/login" state={{ from: location }} replace />; } if (requiredRole && user.role !== requiredRole) { return <Navigate to="/" replace />; } if (requireApproval && !user.isApproved) { return ( <div className="min-h-screen flex items-center justify-center"> <div className="text-center p-8"> <div className="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4"> <span className="text-2xl">⏳</span> </div> <h2 className="text-xl font-semibold text-gray-900 mb-2"> Account Pending Approval </h2> <p className="text-gray-600"> Your account is being reviewed. You'll receive an email once approved. </p> </div> </div> ); } return children; }; export default ProtectedRoute;
```

# borrowmycarfrontend\src\components\RouteToCarModal.jsx

```jsx
import React, { useState, useRef, useEffect } from "react"; import mapboxgl from "mapbox-gl"; import { X, Navigation, Phone, Clock, MapPin } from "lucide-react"; import { MAPBOX_CONFIG } from "../config/mapbox"; import { mapboxService } from "../utils/mapboxUtils"; const RouteToCarModal = ({ isOpen, onClose, car, userLocation }) => { const mapContainer = useRef(null); const map = useRef(null); const [routeData, setRouteData] = useState(null); const [loading, setLoading] = useState(false); useEffect(() => { if (isOpen && userLocation && car?.location) { initializeMap(); getRoute(); } }, [isOpen, userLocation, car]); const initializeMap = () => { if (!mapContainer.current) return; mapboxgl.accessToken = MAPBOX_CONFIG.accessToken; map.current = new mapboxgl.Map({ container: mapContainer.current, style: MAPBOX_CONFIG.style, center: userLocation.coordinates, zoom: 12, }); // Add markers new mapboxgl.Marker({ color: "#3b82f6" }) .setLngLat(userLocation.coordinates) .setPopup(new mapboxgl.Popup().setHTML("<div>Your Location</div>")) .addTo(map.current); new mapboxgl.Marker({ color: "#16a34a" }) .setLngLat(car.location.coordinates) .setPopup(new mapboxgl.Popup().setHTML(`<div>${car.title}</div>`)) .addTo(map.current); // Fit bounds to show both locations const bounds = new mapboxgl.LngLatBounds() .extend(userLocation.coordinates) .extend(car.location.coordinates); map.current.fitBounds(bounds, { padding: 50 }); }; const getRoute = async () => { setLoading(true); try { const route = await mapboxService.getDirections( userLocation.coordinates, car.location.coordinates ); if (route.success) { setRouteData(route.route); // Add route to map map.current.on("load", () => { map.current.addSource("route", { type: "geojson", data: { type: "Feature", properties: {}, geometry: route.route.geometry, }, }); map.current.addLayer({ id: "route", type: "line", source: "route", layout: { "line-join": "round", "line-cap": "round", }, paint: { "line-color": "#16a34a", "line-width": 4, "line-opacity": 0.8, }, }); }); } } catch (error) { console.error("Error getting route:", error); } finally { setLoading(false); } }; const openInGoogleMaps = () => { const url = `https://www.google.com/maps/dir/${userLocation.coordinates[1]},${userLocation.coordinates[0]}/${car.location.coordinates[1]},${car.location.coordinates[0]}`; window.open(url, "_blank"); }; const openInAppleMaps = () => { const url = `http://maps.apple.com/?saddr=${userLocation.coordinates[1]},${userLocation.coordinates[0]}&daddr=${car.location.coordinates[1]},${car.location.coordinates[0]}`; window.open(url, "_blank"); }; if (!isOpen) return null; return ( <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"> <div className="bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden"> {/* Header */} <div className="flex items-center justify-between p-6 border-b border-gray-200"> <div> <h2 className="text-xl font-bold text-gray-900">Route to Car</h2> <p className="text-gray-600">{car.title}</p> </div> <button onClick={onClose} className="text-gray-400 hover:text-gray-600 transition-colors" > <X className="w-6 h-6" /> </button> </div> <div className="flex flex-col lg:flex-row"> {/* Map */} <div className="lg:w-2/3 h-96 lg:h-[500px]"> <div ref={mapContainer} className="w-full h-full" /> </div> {/* Route Info */} <div className="lg:w-1/3 p-6 bg-gray-50"> {loading ? ( <div className="flex items-center justify-center h-32"> <div className="animate-spin w-8 h-8 border-2 border-green-500 border-t-transparent rounded-full"></div> </div> ) : routeData ? ( <div className="space-y-6"> {/* Route Summary */} <div className="bg-white rounded-lg p-4"> <h3 className="font-semibold text-gray-900 mb-3"> Route Summary </h3> <div className="space-y-2"> <div className="flex items-center justify-between"> <span className="text-gray-600">Distance:</span> <span className="font-medium"> {(routeData.distance / 1000).toFixed(1)} km </span> </div> <div className="flex items-center justify-between"> <span className="text-gray-600">Duration:</span> <span className="font-medium"> {Math.round(routeData.duration / 60)} min </span> </div> </div> </div> {/* Car Info */} <div className="bg-white rounded-lg p-4"> <h3 className="font-semibold text-gray-900 mb-3"> Destination </h3> <div className="flex items-start space-x-3"> <img src={car.images?.[0]} alt={car.title} className="w-16 h-12 object-cover rounded" /> <div className="flex-1"> <h4 className="font-medium text-gray-900">{car.title}</h4> <div className="flex items-center text-sm text-gray-600 mt-1"> <MapPin className="w-3 h-3 mr-1" /> <span>{car.location.name}</span> </div> <p className="text-green-600 font-semibold mt-1"> AED {car.price}/day </p> </div> </div> </div> {/* Owner Contact */} {car.owner && ( <div className="bg-white rounded-lg p-4"> <h3 className="font-semibold text-gray-900 mb-3"> Owner Contact </h3> <div className="space-y-2"> <p className="font-medium">{car.owner.name}</p> {car.owner.phone && ( <a href={`tel:${car.owner.phone}`} className="flex items-center text-blue-600 hover:text-blue-700" > <Phone className="w-4 h-4 mr-2" /> {car.owner.phone} </a> )} </div> </div> )} {/* Navigation Apps */} <div className="space-y-3"> <h3 className="font-semibold text-gray-900"> Open in Navigation App </h3> <button onClick={openInGoogleMaps} className="w-full flex items-center justify-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors" > <Navigation className="w-4 h-4" /> <span>Google Maps</span> </button> <button onClick={openInAppleMaps} className="w-full flex items-center justify-center space-x-2 bg-gray-800 hover:bg-gray-900 text-white py-3 px-4 rounded-lg transition-colors" > <Navigation className="w-4 h-4" /> <span>Apple Maps</span> </button> </div> {/* Directions Steps */} {routeData.steps && routeData.steps.length > 0 && ( <div className="bg-white rounded-lg p-4 max-h-60 overflow-y-auto"> <h3 className="font-semibold text-gray-900 mb-3"> Turn-by-turn Directions </h3> <div className="space-y-2"> {routeData.steps.slice(0, 8).map((step, index) => ( <div key={index} className="flex items-start space-x-2 text-sm" > <span className="bg-green-100 text-green-800 rounded-full w-5 h-5 flex items-center justify-center text-xs font-medium"> {index + 1} </span> <span className="text-gray-700"> {step.maneuver.instruction} </span> </div> ))} {routeData.steps.length > 8 && ( <p className="text-xs text-gray-500 mt-2"> ... and {routeData.steps.length - 8} more steps </p> )} </div> </div> )} </div> ) : ( <div className="text-center py-8"> <p className="text-gray-600">Unable to calculate route</p> </div> )} </div> </div> </div> </div> ); }; export default RouteToCarModal;
```

# borrowmycarfrontend\src\context\AuthContext.jsx

```jsx
// src/context/AuthProvider.jsx - COMPLETE FIX import { createContext, useContext, useReducer, useEffect } from "react"; import API from "../api"; const AuthContext = createContext(); const authReducer = (state, action) => { switch (action.type) { case "LOGIN_START": return { ...state, loading: true, error: null }; case "LOGIN_SUCCESS": return { ...state, loading: false, isAuthenticated: true, user: action.payload.user, token: action.payload.token, error: null, }; case "LOGIN_FAILURE": return { ...state, loading: false, error: action.payload, isAuthenticated: false, user: null, token: null, }; case "LOGOUT": return { ...state, isAuthenticated: false, user: null, token: null, error: null, }; case "CLEAR_ERROR": return { ...state, error: null }; case "SET_LOADING": return { ...state, loading: action.payload }; case "UPDATE_USER": return { ...state, user: action.payload }; default: return state; } }; const initialState = { isAuthenticated: false, user: null, token: localStorage.getItem("token"), loading: true, error: null, }; export const AuthProvider = ({ children }) => { const [state, dispatch] = useReducer(authReducer, initialState); // Check if user is logged in on app start useEffect(() => { const token = localStorage.getItem("token"); if (token) { getCurrentUser(); } else { dispatch({ type: "SET_LOADING", payload: false }); } }, []); const getCurrentUser = async () => { try { dispatch({ type: "SET_LOADING", payload: true }); const res = await API.get("/auth/profile"); console.log("Get current user response:", res.data); // Handle different response formats let user = null; if (res.data.data?.user) { user = res.data.data.user; } else if (res.data.user) { user = res.data.user; } else if (res.data.data && !res.data.data.user) { user = res.data.data; } if (user) { dispatch({ type: "LOGIN_SUCCESS", payload: { user, token: localStorage.getItem("token"), }, }); } else { throw new Error("No user data received"); } } catch (error) { console.error("Get current user error:", error); // Clear invalid tokens localStorage.removeItem("token"); localStorage.removeItem("user"); dispatch({ type: "LOGOUT" }); } finally { dispatch({ type: "SET_LOADING", payload: false }); } }; const login = async (credentials) => { dispatch({ type: "LOGIN_START" }); try { console.log("Login attempt with:", { email: credentials.email }); const res = await API.post("/auth/login", { email: credentials.email.trim(), password: credentials.password, }); console.log("Login response:", res.data); // Robust handling of different response formats let token = null; let user = null; // Try different response structures if (res.data.token && res.data.user) { // Direct format: { token, user } token = res.data.token; user = res.data.user; } else if (res.data.data?.token && res.data.data?.user) { // Nested format: { data: { token, user } } token = res.data.data.token; user = res.data.data.user; } else if (res.data.success && res.data.token) { // Success format: { success: true, token, user } token = res.data.token; user = res.data.user; } else if (res.data.accessToken) { // Alternative token field token = res.data.accessToken; user = res.data.user || res.data.data?.user; } if (token && user) { // Store authentication data localStorage.setItem("token", token); localStorage.setItem("user", JSON.stringify(user)); dispatch({ type: "LOGIN_SUCCESS", payload: { user, token }, }); return { success: true, user }; } else { console.error("Invalid login response format:", res.data); throw new Error("Invalid response format - missing token or user data"); } } catch (error) { console.error("Login error:", error); const message = error.response?.data?.message || error.response?.data?.error || error.message || "Login failed. Please check your credentials."; dispatch({ type: "LOGIN_FAILURE", payload: message }); return { success: false, error: message }; } }; const signup = async (userData) => { dispatch({ type: "LOGIN_START" }); try { const formData = new FormData(); // Append form fields (exclude confirmPassword and files) Object.keys(userData).forEach((key) => { if ( key !== "confirmPassword" && key !== "files" && typeof userData[key] !== "object" ) { formData.append(key, userData[key]); } }); // Append files if they exist if (userData.files) { Object.keys(userData.files).forEach((key) => { if (userData.files[key]) { formData.append(key, userData.files[key]); } }); } console.log("Signup attempt..."); const res = await API.post("/auth/signup", formData, { headers: { "Content-Type": "multipart/form-data", }, }); console.log("Signup response:", res.data); // Handle signup response (same robust logic as login) let token = null; let user = null; if (res.data.token && res.data.user) { token = res.data.token; user = res.data.user; } else if (res.data.data?.token && res.data.data?.user) { token = res.data.data.token; user = res.data.data.user; } else if (res.data.success) { token = res.data.token; user = res.data.user || res.data.data?.user; } if (token && user) { localStorage.setItem("token", token); localStorage.setItem("user", JSON.stringify(user)); dispatch({ type: "LOGIN_SUCCESS", payload: { user, token }, }); return { success: true, user }; } else { // Signup successful but no immediate login (approval required) dispatch({ type: "SET_LOADING", payload: false }); return { success: true, requiresApproval: true }; } } catch (error) { console.error("Signup error:", error); const message = error.response?.data?.message || error.response?.data?.error || error.message || "Registration failed. Please try again."; dispatch({ type: "LOGIN_FAILURE", payload: message }); return { success: false, error: message }; } }; const logout = () => { // Clear local storage localStorage.removeItem("token"); localStorage.removeItem("user"); // Clear state dispatch({ type: "LOGOUT" }); // Optional: Call logout endpoint try { API.post("/auth/logout").catch(() => { // Ignore logout endpoint errors }); } catch (error) { // Ignore errors } }; const clearError = () => { dispatch({ type: "CLEAR_ERROR" }); }; const updateUser = (userData) => { // Update user in state dispatch({ type: "UPDATE_USER", payload: userData }); // Update localStorage localStorage.setItem("user", JSON.stringify(userData)); }; const value = { ...state, login, signup, logout, clearError, getCurrentUser, updateUser, }; return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>; }; export const useAuth = () => { const context = useContext(AuthContext); if (!context) { throw new Error("useAuth must be used within an AuthProvider"); } return context; }; export default AuthProvider;
```

# borrowmycarfrontend\src\context\AuthProvider.jsx

```jsx
// src/context/AuthProvider.jsx - FIXED with better error handling import { createContext, useContext, useReducer, useEffect } from "react"; import API from "../api"; const AuthContext = createContext(); const authReducer = (state, action) => { switch (action.type) { case "LOGIN_START": return { ...state, loading: true, error: null }; case "LOGIN_SUCCESS": return { ...state, loading: false, isAuthenticated: true, user: action.payload.user, token: action.payload.token, error: null, }; case "LOGIN_FAILURE": return { ...state, loading: false, error: action.payload, isAuthenticated: false, user: null, token: null, }; case "LOGOUT": return { ...state, isAuthenticated: false, user: null, token: null, error: null, loading: false, }; case "CLEAR_ERROR": return { ...state, error: null }; case "SET_LOADING": return { ...state, loading: action.payload }; case "UPDATE_USER": return { ...state, user: action.payload }; default: return state; } }; const initialState = { isAuthenticated: false, user: null, token: localStorage.getItem("token"), loading: true, error: null, }; export const AuthProvider = ({ children }) => { const [state, dispatch] = useReducer(authReducer, initialState); // Check if user is logged in on app start useEffect(() => { const token = localStorage.getItem("token"); if (token) { getCurrentUser(); } else { dispatch({ type: "SET_LOADING", payload: false }); } }, []); const getCurrentUser = async () => { try { dispatch({ type: "SET_LOADING", payload: true }); const res = await API.get("/auth/profile"); console.log("Get current user response:", res.data); // Handle different response formats robustly let user = null; if (res.data.data?.user) { user = res.data.data.user; } else if (res.data.user) { user = res.data.user; } else if (res.data.data && !res.data.data.user) { user = res.data.data; } if (user) { dispatch({ type: "LOGIN_SUCCESS", payload: { user, token: localStorage.getItem("token"), }, }); } else { throw new Error("No user data received"); } } catch (error) { console.error("Get current user error:", error); // Clear invalid tokens localStorage.removeItem("token"); localStorage.removeItem("user"); dispatch({ type: "LOGOUT" }); } finally { dispatch({ type: "SET_LOADING", payload: false }); } }; const login = async (credentials) => { dispatch({ type: "LOGIN_START" }); try { console.log("Login attempt with:", { email: credentials.email }); const res = await API.post("/auth/login", { email: credentials.email.trim(), password: credentials.password, }); console.log("Login response:", res.data); // FIXED: Robust handling of different response formats let token = null; let user = null; // Try different response structures if (res.data.token && res.data.user) { // Direct format: { token, user } token = res.data.token; user = res.data.user; } else if (res.data.data?.token && res.data.data?.user) { // Nested format: { data: { token, user } } token = res.data.data.token; user = res.data.data.user; } else if (res.data.success && res.data.token) { // Success format: { success: true, token, user } token = res.data.token; user = res.data.user; } else if (res.data.accessToken) { // Alternative token field token = res.data.accessToken; user = res.data.user || res.data.data?.user; } if (token && user) { // Store authentication data localStorage.setItem("token", token); localStorage.setItem("user", JSON.stringify(user)); dispatch({ type: "LOGIN_SUCCESS", payload: { user, token }, }); return { success: true, user }; } else { console.error("Invalid login response format:", res.data); throw new Error("Invalid response format - missing token or user data"); } } catch (error) { console.error("Login error:", error); const message = error.response?.data?.message || error.response?.data?.error || error.message || "Login failed. Please check your credentials."; dispatch({ type: "LOGIN_FAILURE", payload: message }); return { success: false, error: message }; } }; const signup = async (userData) => { dispatch({ type: "LOGIN_START" }); try { const formData = new FormData(); // Append form fields (exclude confirmPassword and files) Object.keys(userData).forEach((key) => { if ( key !== "confirmPassword" && key !== "files" && typeof userData[key] !== "object" ) { formData.append(key, userData[key]); } }); // Append files if they exist if (userData.files) { Object.keys(userData.files).forEach((key) => { if (userData.files[key]) { formData.append(key, userData.files[key]); } }); } console.log("Signup attempt..."); const res = await API.post("/auth/signup", formData, { headers: { "Content-Type": "multipart/form-data", }, }); console.log("Signup response:", res.data); // Handle signup response (same robust logic as login) let token = null; let user = null; if (res.data.token && res.data.user) { token = res.data.token; user = res.data.user; } else if (res.data.data?.token && res.data.data?.user) { token = res.data.data.token; user = res.data.data.user; } else if (res.data.success) { token = res.data.token; user = res.data.user || res.data.data?.user; } if (token && user) { localStorage.setItem("token", token); localStorage.setItem("user", JSON.stringify(user)); dispatch({ type: "LOGIN_SUCCESS", payload: { user, token }, }); return { success: true, user }; } else { // Signup successful but no immediate login (approval required) dispatch({ type: "SET_LOADING", payload: false }); return { success: true, requiresApproval: true, message: res.data.message || "Account created successfully. Awaiting admin approval.", }; } } catch (error) { console.error("Signup error:", error); const message = error.response?.data?.message || error.response?.data?.error || error.message || "Registration failed. Please try again."; dispatch({ type: "LOGIN_FAILURE", payload: message }); return { success: false, error: message }; } }; const logout = () => { // Clear local storage localStorage.removeItem("token"); localStorage.removeItem("user"); // Clear state dispatch({ type: "LOGOUT" }); // Optional: Call logout endpoint try { API.post("/auth/logout").catch(() => { // Ignore logout endpoint errors }); } catch (error) { // Ignore errors } }; const clearError = () => { dispatch({ type: "CLEAR_ERROR" }); }; const updateUser = (userData) => { // Update user in state dispatch({ type: "UPDATE_USER", payload: userData }); // Update localStorage localStorage.setItem("user", JSON.stringify(userData)); }; const value = { ...state, login, signup, logout, clearError, getCurrentUser, updateUser, }; return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>; }; export const useAuth = () => { const context = useContext(AuthContext); if (!context) { throw new Error("useAuth must be used within an AuthProvider"); } return context; }; export default AuthProvider;
```

# borrowmycarfrontend\src\context\PaymentContext.jsx

```jsx
// src/context/PaymentContext.jsx - Fixed to work with your backend import { createContext, useContext, useState } from "react"; import { loadStripe } from "@stripe/stripe-js"; import API from "../api"; const stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLISHABLE_KEY); const PaymentContext = createContext(); export const PaymentProvider = ({ children }) => { const [paymentLoading, setPaymentLoading] = useState(false); const [paymentError, setPaymentError] = useState(null); const createPaymentIntent = async (bookingId) => { setPaymentLoading(true); setPaymentError(null); try { const response = await API.post("/payments/create-intent", { bookingId }); return response.data; } catch (error) { const errorMessage = error.response?.data?.message || "Payment failed"; setPaymentError(errorMessage); throw new Error(errorMessage); } finally { setPaymentLoading(false); } }; const confirmPayment = async (paymentIntentId, bookingId) => { try { const response = await API.post("/payments/confirm", { paymentIntentId, bookingId, }); return response.data; } catch (error) { const errorMessage = error.response?.data?.message || "Payment confirmation failed"; setPaymentError(errorMessage); throw new Error(errorMessage); } }; const getPaymentHistory = async () => { try { const response = await API.get("/payments/history"); return response.data; } catch (error) { const errorMessage = error.response?.data?.message || "Failed to fetch payment history"; setPaymentError(errorMessage); throw new Error(errorMessage); } }; const clearError = () => { setPaymentError(null); }; return ( <PaymentContext.Provider value={{ stripePromise, paymentLoading, paymentError, createPaymentIntent, confirmPayment, getPaymentHistory, setPaymentError, clearError, }} > {children} </PaymentContext.Provider> ); }; export const usePayment = () => { const context = useContext(PaymentContext); if (!context) { throw new Error("usePayment must be used within PaymentProvider"); } return context; };
```

# borrowmycarfrontend\src\context\StripeProvider.jsx

```jsx
// src/context/StripeProvider.jsx import { loadStripe } from "@stripe/stripe-js"; import { Elements } from "@stripe/react-stripe-js"; // Load Stripe with your publishable key const stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLISHABLE_KEY); const StripeProvider = ({ children }) => { const options = { // Stripe appearance customization appearance: { theme: "stripe", variables: { colorPrimary: "#16a34a", // Green-600 to match your theme colorBackground: "#ffffff", colorText: "#374151", colorDanger: "#dc2626", fontFamily: "system-ui, sans-serif", borderRadius: "8px", }, }, // Enable payment methods loader: "auto", }; return ( <Elements stripe={stripePromise} options={options}> {children} </Elements> ); }; export default StripeProvider;
```

# borrowmycarfrontend\src\Footer.jsx

```jsx
import Logo from "./assets/BorrowMyCar.png"; const Footer = () => { const currentYear = new Date().getFullYear(); const footerLinks = { company: [ { name: "About Us", href: "/about" }, { name: "How It Works", href: "/how-it-works" }, { name: "Our Story", href: "/story" }, { name: "Careers", href: "/careers" }, { name: "Contact Us", href: "/contact" }, ], services: [ { name: "Browse Cars", href: "/browse" }, { name: "List Your Car", href: "/list-car" }, { name: "My Bookings", href: "/my-bookings" }, { name: "My Listings", href: "/my-listings" }, { name: "Help Center", href: "/help" }, ], legal: [ { name: "Terms of Service", href: "/terms" }, { name: "Privacy Policy", href: "/privacy" }, { name: "Rental Agreement", href: "/rental-agreement" }, { name: "Insurance Policy", href: "/insurance" }, { name: "Refund Policy", href: "/refunds" }, ], social: [ { name: "Facebook", href: "https://facebook.com/borrowmycar", icon: ( <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"> <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" /> </svg> ), }, { name: "Instagram", href: "https://instagram.com/borrowmycar", icon: ( <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"> <path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 6.62 5.367 11.987 11.988 11.987 6.62 0 11.987-5.367 11.987-11.987C24.014 5.367 18.637.001 12.017.001zM8.449 16.988c-1.297 0-2.448-.49-3.328-1.297C4.243 14.894 3.752 13.743 3.752 12.446c0-1.297.49-2.448 1.369-3.328.879-.879 2.031-1.369 3.328-1.369 1.297 0 2.448.49 3.328 1.369.879.879 1.369 2.031 1.369 3.328 0 1.297-.49 2.448-1.369 3.328-.88.807-2.031 1.297-3.328 1.297z" /> </svg> ), }, { name: "Twitter", href: "https://twitter.com/borrowmycar", icon: ( <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"> <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z" /> </svg> ), }, { name: "LinkedIn", href: "https://linkedin.com/company/borrowmycar", icon: ( <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"> <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" /> </svg> ), }, ], }; const handleScrollToTop = () => { window.scrollTo({ top: 0, behavior: "smooth", }); }; return ( <footer className="w-full bg-white border-t border-gray-200"> {/* Main Footer Content */} <div className="max-w-7xl mx-auto px-4 py-12"> <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-8"> {/* Brand Section */} <div className="lg:col-span-2 space-y-4"> <a href="/" className="inline-block"> <img src={Logo} alt="BorrowMyCar Logo" className="h-12 w-auto hover:opacity-80 transition-opacity" /> </a> <h3 className="text-lg font-semibold text-gray-900"> Your Trusted Car Rental Platform </h3> <p className="text-sm text-gray-600 leading-relaxed max-w-md"> BorrowMyCar connects car owners and renters across the UAE, providing a secure, convenient, and affordable car sharing experience. Join thousands of satisfied users today. </p> {/* Social Media Links */} <div className="flex space-x-4 pt-2"> {footerLinks.social.map((social) => ( <a key={social.name} href={social.href} target="_blank" rel="noopener noreferrer" className="text-gray-400 hover:text-green-600 transition-colors duration-200" aria-label={`Follow us on ${social.name}`} > {social.icon} </a> ))} </div> </div> {/* Company Links */} <div className="space-y-4"> <h3 className="text-sm font-semibold text-gray-900 uppercase tracking-wider"> Company </h3> <ul className="space-y-3"> {footerLinks.company.map((link) => ( <li key={link.name}> <a href={link.href} className="text-sm text-gray-600 hover:text-green-600 transition-colors duration-200" > {link.name} </a> </li> ))} </ul> </div> {/* Services Links */} <div className="space-y-4"> <h3 className="text-sm font-semibold text-gray-900 uppercase tracking-wider"> Services </h3> <ul className="space-y-3"> {footerLinks.services.map((link) => ( <li key={link.name}> <a href={link.href} className="text-sm text-gray-600 hover:text-green-600 transition-colors duration-200" > {link.name} </a> </li> ))} </ul> </div> {/* Legal Links */} <div className="space-y-4"> <h3 className="text-sm font-semibold text-gray-900 uppercase tracking-wider"> Legal </h3> <ul className="space-y-3"> {footerLinks.legal.map((link) => ( <li key={link.name}> <a href={link.href} className="text-sm text-gray-600 hover:text-green-600 transition-colors duration-200" > {link.name} </a> </li> ))} </ul> </div> </div> {/* Newsletter Subscription */} <div className="mt-12 pt-8 border-t border-gray-200"> <div className="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0"> <div className="max-w-md"> <h4 className="text-sm font-semibold text-gray-900 mb-2"> Stay Updated </h4> <p className="text-sm text-gray-600"> Get the latest updates on new features, promotions, and car listings. </p> </div> <div className="flex flex-col sm:flex-row gap-3 max-w-md w-full md:w-auto"> <input type="email" placeholder="Enter your email" className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition-colors text-sm" /> <button className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium transition-colors text-sm whitespace-nowrap"> Subscribe </button> </div> </div> </div> {/* Back to Top Button */} <div className="mt-8 flex justify-center"> <button onClick={handleScrollToTop} className="flex items-center cursor-pointer gap-2 bg-gray-100 hover:bg-green-600 hover:text-white text-gray-700 px-6 py-3 rounded-lg font-medium transition-colors duration-200 group" aria-label="Scroll to top" > <span>Back to Top</span> <svg className="w-4 h-4 transform group-hover:-translate-y-1 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 10l7-7m0 0l7 7m-7-7v18" /> </svg> </button> </div> </div> {/* Bottom Bar */} <div className="bg-gray-50 border-t border-gray-200"> <div className="max-w-7xl mx-auto px-4 py-6"> <div className="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0"> <div className="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-6"> <p className="text-sm text-gray-600"> &copy; {currentYear} BorrowMyCar. All rights reserved. </p> <div className="flex items-center space-x-4 text-xs text-gray-500"> <a href="/terms" className="hover:text-green-600 transition-colors" > Terms </a> <span>•</span> <a href="/privacy" className="hover:text-green-600 transition-colors" > Privacy </a> <span>•</span> <a href="/cookies" className="hover:text-green-600 transition-colors" > Cookies </a> </div> </div> <div className="flex items-center space-x-2 text-sm text-gray-600"> <span>Made with</span> <span className="text-red-500 animate-pulse">❤️</span> <span>in UAE</span> </div> </div> </div> </div> </footer> ); }; export default Footer;
```

# borrowmycarfrontend\src\global.css

```css
@import "tailwindcss"; .input { @apply px-4 py-2 rounded-xl border-2 border-gray-300 focus:outline-none focus:bg-gray-50 focus:ring-2 focus:ring-green-500; } .accent-color { @apply text-green-500; } p { font-size: 1rem; line-height: 1.6; } .mapboxgl-popup-content { padding: 8px !important; border-radius: 8px !important; } .mapboxgl-popup-tip { border-top-color: white !important; } .mapboxgl-ctrl-group { border-radius: 8px !important; overflow: hidden; } .mapboxgl-marker { cursor: pointer; } /* Geocoder customizations */ .mapboxgl-ctrl-geocoder { min-width: 300px !important; } .mapboxgl-ctrl-geocoder input { font-size: 14px !important; }
```

# borrowmycarfrontend\src\hooks\useLocationSearch.js

```js
import { useState, useCallback } from "react"; import { mapboxService } from "../utils/mapboxUtils"; import API from "../api"; export const useLocationSearch = () => { const [loading, setLoading] = useState(false); const [results, setResults] = useState([]); const [error, setError] = useState(null); const searchNearLocation = useCallback( async (location, radius = 10, filters = {}) => { setLoading(true); setError(null); try { const params = { location: location.coordinates.join(","), radius: radius, ...filters, }; const response = await API.get("/cars", { params }); if (response.data.success) { // Calculate distances for each car const carsWithDistance = await Promise.all( response.data.data.cars.map(async (car) => { if (car.location && car.location.coordinates) { const distance = mapboxService.calculateDistance( location.coordinates, car.location.coordinates ); return { ...car, distance: distance.toFixed(1) }; } return car; }) ); // Sort by distance carsWithDistance.sort( (a, b) => parseFloat(a.distance) - parseFloat(b.distance) ); setResults(carsWithDistance); } } catch (err) { setError(err.message); setResults([]); } finally { setLoading(false); } }, [] ); const searchInBounds = useCallback(async (bounds, filters = {}) => { setLoading(true); setError(null); try { const params = { bounds: [ bounds.getSouthWest().lng, bounds.getSouthWest().lat, bounds.getNorthEast().lng, bounds.getNorthEast().lat, ].join(","), ...filters, }; const response = await API.get("/cars", { params }); if (response.data.success) { setResults(response.data.data.cars); } } catch (err) { setError(err.message); setResults([]); } finally { setLoading(false); } }, []); const clearResults = useCallback(() => { setResults([]); setError(null); }, []); return { loading, results, error, searchNearLocation, searchInBounds, clearResults, }; };
```

# borrowmycarfrontend\src\HowItWorks.jsx

```jsx
import { useState } from "react"; import { Link } from "react-router-dom"; import { Helmet } from "react-helmet"; import { Search, Car, Calendar, Shield, CreditCard, Key, CheckCircle, Users, Clock, MapPin, Star, ArrowRight, Phone, MessageCircle, AlertTriangle, Award, Smartphone, } from "lucide-react"; const HowItWorks = () => { const [activeTab, setActiveTab] = useState("renter"); const renterSteps = [ { step: 1, icon: Search, title: "Browse & Search", description: "Search thousands of verified cars across the UAE", details: [ "Filter by location, price, car type, and availability", "View detailed photos, specifications, and owner ratings", "Read reviews from previous renters", "Compare prices and features instantly", ], image: "🔍", }, { step: 2, icon: Calendar, title: "Book Your Ride", description: "Select dates and confirm your booking instantly", details: [ "Choose your rental dates and duration", "See instant pricing with no hidden fees", "Secure booking with instant confirmation", "Flexible cancellation options available", ], image: "📅", }, { step: 3, icon: CreditCard, title: "Secure Payment", description: "Pay safely with our encrypted payment system", details: [ "Multiple payment options: Credit card, debit card, digital wallets", "Bank-level security with SSL encryption", "Hold deposit released after safe return", "Transparent pricing with detailed breakdown", ], image: "💳", }, { step: 4, icon: Key, title: "Pick Up & Drive", description: "Meet the owner and start your journey", details: [ "Meet at agreed location with flexible timing", "Quick vehicle inspection with owner", "Receive keys and vehicle documents", "24/7 support throughout your rental", ], image: "🔑", }, ]; const ownerSteps = [ { step: 1, icon: Car, title: "List Your Car", description: "Create your car listing in minutes", details: [ "Upload high-quality photos of your vehicle", "Set your availability and pricing", "Add detailed description and features", "Verification process ensures quality listings", ], image: "🚗", }, { step: 2, icon: Users, title: "Get Verified", description: "Complete verification for trusted listings", details: [ "Submit required documents (Emirates ID, License)", "Vehicle inspection and documentation", "Background check and identity verification", "Approved listings get priority visibility", ], image: "✅", }, { step: 3, icon: Calendar, title: "Receive Bookings", description: "Accept or decline booking requests", details: [ "Instant notifications for new bookings", "Review renter profiles and ratings", "Accept bookings with one click", "Set automatic approval for verified renters", ], image: "📱", }, { step: 4, icon: CreditCard, title: "Earn Money", description: "Get paid automatically after each rental", details: [ "Automatic payment processing", "Competitive earning potential", "Weekly payouts to your bank account", "Detailed earnings reports and analytics", ], image: "💰", }, ]; const features = [ { icon: Shield, title: "Insurance Coverage", description: "Comprehensive insurance protection for all rentals", benefits: [ "Third-party liability coverage", "Collision damage protection", "Theft protection included", "24/7 roadside assistance", ], }, { icon: CheckCircle, title: "Verified Community", description: "All users undergo thorough verification", benefits: [ "ID and license verification", "Background checks for owners", "Rating system for accountability", "Trusted community of 50,000+ users", ], }, { icon: Clock, title: "24/7 Support", description: "Round-the-clock customer assistance", benefits: [ "Instant chat support", "Emergency helpline", "Multilingual support team", "Quick resolution guarantee", ], }, { icon: Smartphone, title: "Easy-to-Use Platform", description: "Intuitive interface designed for everyone", benefits: [ "Mobile-responsive design", "One-click booking process", "Real-time notifications", "Seamless user experience", ], }, ]; const faqs = [ { question: "What documents do I need to rent a car?", answer: "You need a valid UAE driving license, Emirates ID or passport, and a credit card for security deposit. International visitors need an International Driving Permit along with their home country license.", }, { question: "How does the insurance work?", answer: "All rentals include comprehensive insurance coverage including third-party liability, collision damage, and theft protection. There's a security deposit that covers any deductibles, which is released after safe return of the vehicle.", }, { question: "Can I extend my rental period?", answer: "Yes, you can extend your rental if the car is available. Simply contact the owner through our platform or reach out to customer support. Additional charges will apply based on the daily rate.", }, { question: "What happens if the car breaks down?", answer: "All rentals include 24/7 roadside assistance. Contact our emergency helpline and we'll arrange immediate help. If the issue is due to mechanical failure, we'll provide a replacement vehicle or full refund.", }, { question: "How much can I earn as a car owner?", answer: "Earnings vary based on your car type, location, and availability. On average, owners earn AED 100-300 per day. Popular cars in Dubai and Abu Dhabi tend to have higher demand and better earning potential.", }, { question: "Is my car protected when rented out?", answer: "Yes, comprehensive insurance covers your vehicle during rentals. All renters are verified and rated. You can set your own approval criteria and decline bookings if needed.", }, ]; const stats = [ { number: "50,000+", label: "Happy Users", icon: "👥" }, { number: "5,000+", label: "Available Cars", icon: "🚗" }, { number: "7", label: "Emirates Covered", icon: "🇦🇪" }, { number: "4.8/5", label: "Average Rating", icon: "⭐" }, ]; return ( <> <Helmet> <title>How It Works - BorrowMyCar | UAE Car Rental Platform</title> <meta name="description" content="Learn how BorrowMyCar works for renters and car owners. Simple steps to rent a car or earn money by listing your vehicle in the UAE." /> </Helmet> <div className="min-h-screen bg-white"> {/* Hero Section */} <div className="bg-gradient-to-br from-green-50 to-emerald-100 py-16 lg:py-24"> <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"> <div className="text-center space-y-6"> <h1 className="text-4xl lg:text-6xl font-bold text-gray-900"> How <span className="text-green-600">BorrowMyCar</span> Works </h1> <p className="text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed"> Whether you want to rent a car or earn money with your vehicle, our platform makes it simple, safe, and secure. </p> {/* Stats */} <div className="grid grid-cols-2 lg:grid-cols-4 gap-8 mt-12"> {stats.map((stat, index) => ( <div key={index} className="text-center"> <div className="text-4xl mb-2">{stat.icon}</div> <div className="text-2xl lg:text-3xl font-bold text-gray-900"> {stat.number} </div> <div className="text-gray-600">{stat.label}</div> </div> ))} </div> </div> </div> </div> {/* Tab Navigation */} <div className="border-b border-gray-200 bg-white sticky top-0 z-10"> <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"> <div className="flex justify-center"> <nav className="flex space-x-8"> {[ { id: "renter", label: "For Renters", icon: "🚗" }, { id: "owner", label: "For Car Owners", icon: "💰" }, ].map((tab) => ( <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`py-4 px-6 border-b-2 font-medium text-sm transition-colors ${ activeTab === tab.id ? "border-green-500 text-green-600" : "border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" }`} > <span className="mr-2">{tab.icon}</span> {tab.label} </button> ))} </nav> </div> </div> </div> {/* Steps Section */} <div className="py-16 lg:py-24"> <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"> <div className="text-center mb-16"> <h2 className="text-3xl lg:text-4xl font-bold text-gray-900 mb-4"> {activeTab === "renter" ? "Rent a Car in 4 Easy Steps" : "Start Earning with Your Car"} </h2> <p className="text-xl text-gray-600 max-w-2xl mx-auto"> {activeTab === "renter" ? "Get behind the wheel of your perfect car in minutes" : "Turn your parked car into a money-making asset"} </p> </div> <div className="space-y-16"> {(activeTab === "renter" ? renterSteps : ownerSteps).map( (step, index) => ( <div key={step.step} className={`flex flex-col lg:flex-row items-center gap-12 ${ index % 2 === 1 ? "lg:flex-row-reverse" : "" }`} > {/* Content */} <div className="flex-1 space-y-6"> <div className="flex items-center space-x-4"> <div className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center"> <step.icon className="h-6 w-6 text-green-600" /> </div> <div className="w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center font-bold"> {step.step} </div> </div> <div> <h3 className="text-2xl lg:text-3xl font-bold text-gray-900 mb-3"> {step.title} </h3> <p className="text-lg text-gray-600 mb-6"> {step.description} </p> <ul className="space-y-3"> {step.details.map((detail, idx) => ( <li key={idx} className="flex items-start space-x-3" > <CheckCircle className="h-5 w-5 text-green-500 flex-shrink-0 mt-0.5" /> <span className="text-gray-700">{detail}</span> </li> ))} </ul> </div> </div> {/* Visual */} <div className="flex-1 flex justify-center"> <div className="w-64 h-64 bg-gradient-to-br from-green-100 to-emerald-200 rounded-2xl flex items-center justify-center text-8xl shadow-lg"> {step.image} </div> </div> </div> ) )} </div> {/* CTA */} <div className="text-center mt-16"> <Link to={activeTab === "renter" ? "/browse" : "/signup"} className="inline-flex items-center px-8 py-4 border border-transparent text-lg font-medium rounded-lg text-white bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 transition-all duration-200 shadow-lg hover:shadow-xl" > {activeTab === "renter" ? "Start Browsing Cars" : "List Your Car Now"} <ArrowRight className="ml-2 h-5 w-5" /> </Link> </div> </div> </div> {/* Features Section */} <div className="bg-gray-50 py-16 lg:py-24"> <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"> <div className="text-center mb-16"> <h2 className="text-3xl lg:text-4xl font-bold text-gray-900 mb-4"> Why Choose BorrowMyCar? </h2> <p className="text-xl text-gray-600 max-w-2xl mx-auto"> We provide the safest, most convenient car sharing experience in the UAE </p> </div> <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8"> {features.map((feature, index) => ( <div key={index} className="bg-white rounded-2xl p-8 shadow-sm hover:shadow-md transition-shadow" > <div className="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center mb-6"> <feature.icon className="h-6 w-6 text-green-600" /> </div> <h3 className="text-xl font-bold text-gray-900 mb-3"> {feature.title} </h3> <p className="text-gray-600 mb-4">{feature.description}</p> <ul className="space-y-2"> {feature.benefits.map((benefit, idx) => ( <li key={idx} className="flex items-start space-x-2 text-sm text-gray-700" > <CheckCircle className="h-4 w-4 text-green-500 flex-shrink-0 mt-0.5" /> <span>{benefit}</span> </li> ))} </ul> </div> ))} </div> </div> </div> {/* FAQ Section */} <div className="py-16 lg:py-24"> <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8"> <div className="text-center mb-16"> <h2 className="text-3xl lg:text-4xl font-bold text-gray-900 mb-4"> Frequently Asked Questions </h2> <p className="text-xl text-gray-600"> Get answers to common questions about our platform </p> </div> <div className="space-y-6"> {faqs.map((faq, index) => ( <div key={index} className="bg-white border border-gray-200 rounded-xl p-6 hover:shadow-sm transition-shadow" > <h3 className="text-lg font-semibold text-gray-900 mb-3"> {faq.question} </h3> <p className="text-gray-700 leading-relaxed">{faq.answer}</p> </div> ))} </div> </div> </div> {/* Contact Section */} <div className="bg-gradient-to-r from-green-600 to-emerald-600 py-16"> <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center"> <h2 className="text-3xl lg:text-4xl font-bold text-white mb-4"> Still Have Questions? </h2> <p className="text-xl text-green-100 mb-8 max-w-2xl mx-auto"> Our support team is here to help you 24/7. Get in touch and we'll respond within minutes. </p> <div className="flex flex-col sm:flex-row gap-4 justify-center items-center"> <a href="tel:+971800266669" className="inline-flex items-center px-6 py-3 border-2 border-white text-white hover:bg-white hover:text-green-600 rounded-lg font-medium transition-colors" > <Phone className="h-5 w-5 mr-2" /> Call +971 800 BORROW </a> <a href="mailto:support@borrowmycar.ae" className="inline-flex items-center px-6 py-3 bg-white text-green-600 hover:bg-gray-100 rounded-lg font-medium transition-colors" > <MessageCircle className="h-5 w-5 mr-2" /> Email Support </a> </div> </div> </div> {/* Final CTA */} <div className="bg-white py-16"> <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center"> <h2 className="text-3xl lg:text-4xl font-bold text-gray-900 mb-6"> Ready to Get Started? </h2> <p className="text-xl text-gray-600 mb-8"> Join thousands of satisfied users across the UAE </p> <div className="flex flex-col sm:flex-row gap-4 justify-center"> <Link to="/browse" className="inline-flex items-center justify-center px-8 py-4 border border-transparent text-lg font-medium rounded-lg text-white bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 transition-all duration-200" > Browse Cars <Search className="ml-2 h-5 w-5" /> </Link> <Link to="/signup" className="inline-flex items-center justify-center px-8 py-4 border-2 border-green-600 text-lg font-medium rounded-lg text-green-600 bg-white hover:bg-green-50 transition-colors" > List Your Car <Car className="ml-2 h-5 w-5" /> </Link> </div> </div> </div> </div> </> ); }; export default HowItWorks;
```

# borrowmycarfrontend\src\index.jsx

```jsx
// src/index.jsx - Fixed Router v7 Implementation import { StrictMode } from "react"; import { createRoot } from "react-dom/client"; import { createBrowserRouter, RouterProvider, Outlet, Navigate, } from "react-router-dom"; import App from "./App.jsx"; import BrowseCars from "./BrowseCars.jsx"; import Login from "./Login.jsx"; import Signup from "./Signup.jsx"; import CarDetails from "./CarDetails.jsx"; import Checkout from "./pages/Checkout.jsx"; import BookingSuccess from "./pages/BookingSuccess.jsx"; import ListCar from "./ListCar.jsx"; import HowItWorks from "./HowItWorks.jsx"; import MyBookings from "./MyBookings.jsx"; import Settings from "./Settings.jsx"; import Profile from "./Profile.jsx"; import NotFound from "./NotFound.jsx"; import Navbar from "./Navbar.jsx"; import Footer from "./Footer.jsx"; import ProtectedRoute from "./components/ProtectedRoute.jsx"; import { AuthProvider } from "./context/AuthProvider.jsx"; import { PaymentProvider } from "./context/PaymentContext.jsx"; import "./global.css"; // Main Layout Component const Layout = () => ( <> <Navbar /> <main className="min-h-screen"> <Outlet /> </main> <Footer /> </> ); // Auth Layout (no navbar/footer for login/signup) const AuthLayout = () => ( <main className="min-h-screen"> <Outlet /> </main> ); // Define routes with React Router v7 syntax const router = createBrowserRouter([ { path: "/", element: <Layout />, errorElement: <NotFound />, children: [ { index: true, element: <App />, }, { path: "browse", element: <BrowseCars />, }, { path: "how-it-works", element: <HowItWorks />, }, { path: "cars/:id", element: <CarDetails />, }, { path: "checkout/:carId", element: ( <ProtectedRoute requiredRole="renter"> <Checkout /> </ProtectedRoute> ), }, { path: "booking-success", element: ( <ProtectedRoute> <BookingSuccess /> </ProtectedRoute> ), }, { path: "profile", element: ( <ProtectedRoute> <Profile /> </ProtectedRoute> ), }, { path: "list-car", element: ( <ProtectedRoute requiredRole="owner" requireApproval={true}> <ListCar /> </ProtectedRoute> ), }, { path: "my-bookings", element: ( <ProtectedRoute> <MyBookings /> </ProtectedRoute> ), }, { path: "settings", element: ( <ProtectedRoute> <Settings /> </ProtectedRoute> ), }, ], }, { path: "/auth", element: <AuthLayout />, children: [ { path: "login", element: <Login />, }, { path: "signup", element: <Signup />, }, ], }, // Compatibility routes { path: "/login", element: <Navigate to="/auth/login" replace />, }, { path: "/signup", element: <Navigate to="/auth/signup" replace />, }, { path: "*", element: <NotFound />, }, ]); createRoot(document.getElementById("root")).render( <StrictMode> <AuthProvider> <PaymentProvider> <RouterProvider router={router} /> </PaymentProvider> </AuthProvider> </StrictMode> );
```

# borrowmycarfrontend\src\ListCar.jsx

```jsx
import { useState, useEffect } from "react"; import API from "../src/api"; import { useNavigate } from "react-router-dom"; const ListCar = () => { const [form, setForm] = useState({ title: "", description: "", city: "", pricePerDay: "", availabilityFrom: "", availabilityTo: "", }); const [images, setImages] = useState([]); const [error, setError] = useState(""); const [loading, setLoading] = useState(false); const [fileInputKey, setFileInputKey] = useState(Date.now()); // Add key to reset file input const [showSuggestions, setShowSuggestions] = useState(false); const [filteredSuggestions, setFilteredSuggestions] = useState([]); const [showCitySuggestions, setShowCitySuggestions] = useState(false); const [filteredCities, setFilteredCities] = useState([]); const navigate = useNavigate(); // UAE Cities database const uaeCities = [ // Major Emirates and Cities "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", // Dubai Areas/Districts "Dubai Marina", "Downtown Dubai", "Jumeirah", "Deira", "Bur Dubai", "Al Barsha", "Dubai Investment Park", "Dubai Silicon Oasis", "Dubai South", "Al Nahda Dubai", "Jumeirah Lake Towers", "Business Bay", "DIFC", "Dubai Hills", "Al Qusais", "Al Mizhar", "International City", "Discovery Gardens", "Dubai Sports City", // Abu Dhabi Areas "Abu Dhabi City", "Al Ain", "Al Ruwais", "Khalifa City", "Al Shamkha", "Yas Island", "Saadiyat Island", "Al Reef", "Al Rahba", "Masdar City", "Mohammed Bin Zayed City", "Al Falah", "Al Mushrif", "Tourist Club Area", // Sharjah Areas "Sharjah City", "Al Nahda Sharjah", "Al Qasimia", "Al Majaz", "Al Khan", "Al Taawun", "Al Suyoh", "Muwaileh", "University City Sharjah", // Northern Emirates "Al Dhaid", "Kalba", "Dibba Al Fujairah", "Khor Fakkan", "Masafi", "Hatta", "Liwa Oasis", "Ghayathi", "Madinat Zayed", "Sila", // Other Notable Areas "Jebel Ali", "Al Ain City", "Sohar", "Dibba Al Hisn", "Al Hamriyah", "Emirates Hills", "Arabian Ranches", "Motor City", "Al Warqa", "Mirdif", ]; // Car name suggestions database const carSuggestions = [ // Toyota "Toyota Camry 2024", "Toyota Corolla 2023", "Toyota RAV4 2024", "Toyota Highlander 2023", "Toyota Prius 2024", "Toyota Land Cruiser 2023", "Toyota Avalon 2023", "Toyota Sienna 2024", // Honda "Honda Civic 2024", "Honda Accord 2023", "Honda CR-V 2024", "Honda Pilot 2023", "Honda Fit 2023", "Honda HR-V 2024", "Honda Passport 2023", "Honda Ridgeline 2024", // BMW "BMW 3 Series 2024", "BMW 5 Series 2023", "BMW X3 2024", "BMW X5 2023", "BMW i4 2024", "BMW X1 2023", "BMW 7 Series 2024", "BMW X7 2023", // Mercedes-Benz "Mercedes-Benz C-Class 2024", "Mercedes-Benz E-Class 2023", "Mercedes-Benz GLE 2024", "Mercedes-Benz A-Class 2023", "Mercedes-Benz S-Class 2024", "Mercedes-Benz GLC 2023", // Audi "Audi A4 2024", "Audi A6 2023", "Audi Q5 2024", "Audi Q7 2023", "Audi A3 2024", "Audi Q3 2023", "Audi A8 2024", "Audi e-tron 2023", // Nissan "Nissan Altima 2024", "Nissan Sentra 2023", "Nissan Rogue 2024", "Nissan Pathfinder 2023", "Nissan Leaf 2024", "Nissan Murano 2023", "Nissan Armada 2024", "Nissan Kicks 2023", // Hyundai "Hyundai Elantra 2024", "Hyundai Sonata 2023", "Hyundai Tucson 2024", "Hyundai Santa Fe 2023", "Hyundai Ioniq 5 2024", "Hyundai Kona 2023", "Hyundai Palisade 2024", "Hyundai Venue 2023", // Kia "Kia Forte 2024", "Kia Optima 2023", "Kia Sportage 2024", "Kia Sorento 2023", "Kia EV6 2024", "Kia Soul 2023", "Kia Telluride 2024", "Kia Rio 2023", // Ford "Ford Mustang 2024", "Ford F-150 2023", "Ford Explorer 2024", "Ford Escape 2023", "Ford Bronco 2024", "Ford Edge 2023", "Ford Expedition 2024", "Ford Fusion 2023", // Chevrolet "Chevrolet Malibu 2024", "Chevrolet Equinox 2023", "Chevrolet Traverse 2024", "Chevrolet Silverado 2023", "Chevrolet Bolt 2024", "Chevrolet Tahoe 2023", "Chevrolet Suburban 2024", "Chevrolet Camaro 2023", // Luxury & Sports "Porsche 911 2024", "Porsche Cayenne 2023", "Jaguar F-PACE 2024", "Land Rover Discovery 2023", "Lexus RX 2024", "Lexus ES 2023", "Infiniti Q50 2024", "Acura MDX 2023", "Tesla Model 3 2024", "Tesla Model Y 2023", "Tesla Model S 2024", "Tesla Model X 2023", // Popular UAE Models "Mitsubishi Pajero 2024", "Toyota Prado 2023", "Nissan Patrol 2024", "Ford Raptor 2023", "Range Rover Evoque 2024", "Jeep Grand Cherokee 2023", "Volkswagen Tiguan 2024", "Mazda CX-5 2023", ]; const handleChange = (e) => { const { name, value } = e.target; setForm({ ...form, [name]: value }); // Handle car title suggestions if (name === "title") { if (value.length > 0) { const filtered = carSuggestions .filter((suggestion) => suggestion.toLowerCase().includes(value.toLowerCase()) ) .slice(0, 8); // Limit to 8 suggestions setFilteredSuggestions(filtered); setShowSuggestions(filtered.length > 0); } else { setShowSuggestions(false); setFilteredSuggestions([]); } } // Handle city suggestions if (name === "city") { if (value.length > 0) { const filtered = uaeCities .filter((city) => city.toLowerCase().includes(value.toLowerCase())) .slice(0, 10); // Limit to 10 city suggestions setFilteredCities(filtered); setShowCitySuggestions(filtered.length > 0); } else { setShowCitySuggestions(false); setFilteredCities([]); } } }; const handleSuggestionClick = (suggestion) => { setForm({ ...form, title: suggestion }); setShowSuggestions(false); setFilteredSuggestions([]); }; const handleCityClick = (city) => { setForm({ ...form, city: city }); setShowCitySuggestions(false); setFilteredCities([]); }; // Close suggestions when clicking outside useEffect(() => { const handleClickOutside = (event) => { if (!event.target.closest(".suggestion-container")) { setShowSuggestions(false); } if (!event.target.closest(".city-suggestion-container")) { setShowCitySuggestions(false); } }; document.addEventListener("mousedown", handleClickOutside); return () => { document.removeEventListener("mousedown", handleClickOutside); }; }, []); const handleFileChange = (e) => { const files = Array.from(e.target.files); setImages(files); }; const removeImage = (indexToRemove) => { const updatedImages = images.filter((_, index) => index !== indexToRemove); setImages(updatedImages); // Reset the file input to clear the displayed filename setFileInputKey(Date.now()); }; const validateForm = () => { const { title, description, city, pricePerDay, availabilityFrom, availabilityTo, } = form; if (!title.trim() || !description.trim() || !city.trim()) { setError("All text fields are required"); return false; } if (parseFloat(pricePerDay) <= 0) { setError("Price per day must be greater than 0"); return false; } const fromDate = new Date(availabilityFrom); const toDate = new Date(availabilityTo); const today = new Date(); today.setHours(0, 0, 0, 0); if (fromDate < today) { setError("Availability start date cannot be in the past"); return false; } if (toDate <= fromDate) { setError("End date must be after start date"); return false; } if (images.length === 0) { setError("Please upload at least one image"); return false; } // Validate image files const validTypes = ["image/jpeg", "image/png", "image/jpg"]; const maxSize = 5 * 1024 * 1024; // 5MB for (let file of images) { if (!validTypes.includes(file.type)) { setError("Only JPEG, PNG images are allowed"); return false; } if (file.size > maxSize) { setError("Each image must be less than 5MB"); return false; } } return true; }; const handleSubmit = async (e) => { e.preventDefault(); setError(""); if (!validateForm()) { return; } setLoading(true); try { const formData = new FormData(); // Append form fields Object.keys(form).forEach((key) => { formData.append(key, form[key]); }); // Append images images.forEach((image, index) => { formData.append(`images`, image); }); const response = await API.post("/cars", formData, { headers: { "Content-Type": "multipart/form-data", }, }); // Reset form on success setForm({ title: "", description: "", city: "", pricePerDay: "", availabilityFrom: "", availabilityTo: "", }); setImages([]); setFileInputKey(Date.now()); // Reset file input navigate("/browse", { state: { message: "Car listed successfully!" }, }); } catch (err) { console.error("Error listing car:", err); setError( err.response?.data?.message || "Failed to list car. Please check your connection and try again." ); } finally { setLoading(false); } }; return ( <div className="max-w-3xl mx-auto p-6 bg-white rounded-lg shadow-lg"> <h1 className="text-3xl font-bold text-gray-800 mb-6">List Your Car</h1> <form onSubmit={handleSubmit} className="space-y-6"> {/* Title with Suggestions */} <div className="suggestion-container relative"> <label className="block text-sm font-medium text-gray-700 mb-2"> Car Title * </label> <input type="text" name="title" value={form.title} placeholder="Start typing... e.g., Toyota Camry" onChange={handleChange} onFocus={() => { if (form.title.length > 0 && filteredSuggestions.length > 0) { setShowSuggestions(true); } }} required className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors" autoComplete="off" /> {/* Suggestions Dropdown */} {showSuggestions && filteredSuggestions.length > 0 && ( <div className="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto"> {filteredSuggestions.map((suggestion, index) => ( <button key={index} type="button" onClick={() => handleSuggestionClick(suggestion)} className="w-full text-left px-4 py-3 hover:bg-green-50 focus:bg-green-50 focus:outline-none border-b border-gray-100 last:border-b-0 transition-colors" > <span className="text-gray-900 font-medium"> {suggestion.split(" ").slice(0, -1).join(" ")} </span> <span className="text-gray-500 ml-2"> {suggestion.split(" ").slice(-1)[0]} </span> </button> ))} {/* Show popular suggestions hint */} <div className="px-4 py-2 bg-gray-50 text-xs text-gray-600 border-t"> 💡 Popular car models in UAE </div> </div> )} </div> {/* Description */} <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Description * </label> <textarea name="description" value={form.description} placeholder="Describe your car's features, condition, and any special notes..." onChange={handleChange} required rows="4" className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors resize-vertical" /> </div> {/* City and Price */} <div className="grid grid-cols-1 md:grid-cols-2 gap-4"> <div className="city-suggestion-container relative"> <label className="block text-sm font-medium text-gray-700 mb-2"> City * </label> <input type="text" name="city" value={form.city} placeholder="Start typing... e.g., Dubai" onChange={handleChange} onFocus={() => { if (form.city.length > 0 && filteredCities.length > 0) { setShowCitySuggestions(true); } }} required className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors" autoComplete="off" /> {/* City Suggestions Dropdown */} {showCitySuggestions && filteredCities.length > 0 && ( <div className="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto"> {filteredCities.map((city, index) => { const isMainEmirate = [ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", ].includes(city); return ( <button key={index} type="button" onClick={() => handleCityClick(city)} className="w-full text-left px-4 py-3 hover:bg-green-50 focus:bg-green-50 focus:outline-none border-b border-gray-100 last:border-b-0 transition-colors flex items-center justify-between" > <span className={`${ isMainEmirate ? "font-semibold text-gray-900" : "text-gray-700" }`} > {city} </span> {isMainEmirate && ( <span className="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full"> Emirate </span> )} </button> ); })} {/* Show UAE locations hint */} <div className="px-4 py-2 bg-gray-50 text-xs text-gray-600 border-t"> 🇦🇪 UAE Cities & Emirates </div> </div> )} </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Price Per Day (AED) * </label> <input type="number" name="pricePerDay" value={form.pricePerDay} placeholder="150" min="1" step="0.01" onChange={handleChange} required className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors" /> </div> </div> {/* Availability Dates */} <div className="grid grid-cols-1 md:grid-cols-2 gap-4"> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Available From * </label> <input type="date" name="availabilityFrom" value={form.availabilityFrom} onChange={handleChange} required min={new Date().toISOString().split("T")[0]} className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors" /> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Available Until * </label> <input type="date" name="availabilityTo" value={form.availabilityTo} onChange={handleChange} required min={ form.availabilityFrom || new Date().toISOString().split("T")[0] } className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors" /> </div> </div> {/* Image Upload */} <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Car Images * (Max 5MB each, JPEG/PNG only) </label> <input key={fileInputKey} // Add key prop to force re-render and reset type="file" name="images" accept="image/jpeg,image/png,image/jpg" multiple onChange={handleFileChange} className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-green-50 file:text-green-700 hover:file:bg-green-100" /> {/* Image Previews */} {images.length > 0 && ( <div className="mt-4"> <p className="text-sm text-gray-600 mb-3"> {images.length} image(s) selected </p> <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"> {images.map((image, index) => ( <div key={index} className="relative group"> <div className="aspect-square bg-gray-100 rounded-lg overflow-hidden border border-gray-200"> <img src={URL.createObjectURL(image)} alt={`Preview ${index + 1}`} className="w-full h-full object-cover" onLoad={() => URL.revokeObjectURL(image)} /> </div> {/* Remove Button */} <button type="button" onClick={() => removeImage(index)} className="absolute -top-2 -right-2 bg-red-500 hover:bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold shadow-lg transition-colors opacity-0 group-hover:opacity-100" title="Remove image" > × </button> {/* Image Info */} <div className="mt-2"> <p className="text-xs text-gray-500 truncate"> {image.name} </p> <p className="text-xs text-gray-400"> {(image.size / 1024 / 1024).toFixed(1)} MB </p> </div> </div> ))} </div> {/* Upload Tips */} <div className="mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"> <p className="text-sm text-blue-800"> 💡 <strong>Photo Tips:</strong> Include exterior, interior, dashboard, and engine photos for better visibility </p> </div> </div> )} </div> {/* Error Message */} {error && ( <div className="bg-red-50 border border-red-200 rounded-lg p-4"> <p className="text-red-600 text-sm font-medium">{error}</p> </div> )} {/* Submit Button */} <button type="submit" disabled={loading} className="w-full bg-green-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors" > {loading ? ( <span className="flex items-center justify-center"> <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" > <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" ></circle> <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" ></path> </svg> Uploading... </span> ) : ( "List Car" )} </button> </form> </div> ); }; export default ListCar;
```

# borrowmycarfrontend\src\Login.jsx

```jsx
import { useState } from "react"; import { Link, useNavigate } from "react-router-dom"; import API from "./api"; import Logo from "./assets/BorrowMyCar.png"; import { Helmet } from "react-helmet"; const Login = () => { const [form, setForm] = useState({ email: "", password: "" }); const [isLoading, setIsLoading] = useState(false); const [error, setError] = useState(""); const navigate = useNavigate(); const handleChange = (e) => { setForm({ ...form, [e.target.name]: e.target.value }); if (error) setError(""); // Clear error when user starts typing }; const handleSubmit = async (e) => { e.preventDefault(); // Basic validation if (!form.email || !form.password) { setError("Please fill in all fields"); return; } setIsLoading(true); setError(""); try { console.log("Attempting login with:", { email: form.email }); const response = await API.post("/auth/login", { email: form.email.trim(), password: form.password, }); console.log("Login response:", response.data); // FIXED: Handle both response structures let token = null; let userData = null; // Try to get token from multiple possible locations if (response.data.token) { token = response.data.token; userData = response.data.user; } else if (response.data.data && response.data.data.token) { token = response.data.data.token; userData = response.data.data.user; } if (token) { // Store token and user data localStorage.setItem("token", token); if (userData) { localStorage.setItem("user", JSON.stringify(userData)); console.log("User data stored:", userData); } console.log("Login successful, token stored"); // Redirect to homepage or dashboard navigate("/", { replace: true }); } else { console.error("No token in response:", response.data); setError( "Login successful but no authentication token received. Please try again." ); } } catch (err) { console.error("Login error:", err); // Handle different error types if (err.response) { // Server responded with error status const message = err.response.data?.message || err.response.data?.error || `Login failed (${err.response.status})`; setError(message); } else if (err.request) { // Network error setError("Network error. Please check your connection and try again."); } else { // Other error setError("An unexpected error occurred. Please try again."); } } finally { setIsLoading(false); } }; return ( <> <Helmet> <title>Login - BorrowMyCar</title> </Helmet> <div className="min-h-screen bg-gray-50 flex flex-col lg:flex-row"> {/* Left Side - Form */} <div className="flex-1 flex items-center justify-center p-4 sm:p-6 lg:p-8"> <div className="w-full max-w-md space-y-8"> {/* Header */} <div> <div className="mx-auto h-20 sm:h-24 w-48 sm:w-64 flex items-center justify-center"> <img src={Logo} alt="BorrowMyCar Logo" className="h-full w-full object-contain" /> </div> <div className="space-y-2 text-center"> <h1 className="text-2xl sm:text-3xl font-bold text-gray-900"> Welcome Back </h1> <p className="text-sm sm:text-base text-gray-600"> Sign in to your{" "} <span className="font-semibold text-green-500"> BorrowMyCar </span>{" "} account </p> </div> </div> {/* Form */} <form onSubmit={handleSubmit} className="space-y-6"> <div className="space-y-4"> {/* Email Input */} <div> <label htmlFor="email" className="sr-only"> Email address </label> <input id="email" name="email" type="email" value={form.email} onChange={handleChange} placeholder="Email address" required autoComplete="email" className="input w-full text-sm sm:text-base" /> </div> {/* Password Input */} <div> <label htmlFor="password" className="sr-only"> Password </label> <input id="password" name="password" type="password" value={form.password} onChange={handleChange} placeholder="Password" required autoComplete="current-password" className="input w-full text-sm sm:text-base" /> </div> </div> {/* Error Message */} {error && ( <div className="text-red-600 text-sm text-center bg-red-50 border border-red-200 rounded-lg p-3"> {error} </div> )} {/* Remember Me & Forgot Password */} <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 text-sm"> <label className="flex items-center cursor-pointer"> <input type="checkbox" className="w-4 h-4 text-green-500 border-gray-300 rounded focus:ring-green-500 focus:ring-2" /> <span className="ml-2 text-gray-700">Remember me</span> </label> <Link to="/forgot-password" className="accent-color hover:text-green-700 hover:underline transition-colors duration-200" > Forgot your password? </Link> </div> {/* Submit Button */} <button type="submit" disabled={isLoading} className="w-full bg-green-500 hover:bg-green-600 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 text-sm sm:text-base focus:ring-2 focus:ring-green-500 focus:ring-offset-2" > {isLoading ? ( <div className="flex items-center justify-center"> <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" > <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" ></circle> <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" ></path> </svg> Signing in... </div> ) : ( "Sign In" )} </button> {/* Sign Up Link */} <p className="text-center text-sm text-gray-600"> Don't have an account?{" "} <Link to="/signup" className="font-semibold accent-color hover:text-green-700 hover:underline transition-colors duration-200" > Sign up here </Link> </p> </form> </div> </div> {/* Right Side - Welcome Section */} <div className="hidden lg:flex lg:flex-1 lg:items-center lg:justify-center bg-gradient-to-br from-green-50 to-emerald-100 p-8"> <div className="text-center max-w-md space-y-6"> <div className="relative"> <div className="mx-auto w-64 h-48 bg-gradient-to-r from-green-400 to-emerald-500 rounded-2xl shadow-lg flex items-center justify-center"> <div className="text-white text-6xl">🚗</div> </div> </div> <div className="space-y-3"> <h2 className="text-2xl xl:text-3xl font-bold text-gray-800"> Welcome Back! 👋 </h2> <p className="text-gray-600 text-lg"> Ready to hit the road again? </p> <p className="text-sm text-gray-500"> Access your bookings, browse available cars, and manage your rentals. </p> </div> </div> </div> {/* Mobile Welcome Section */} <div className="lg:hidden bg-gradient-to-r from-green-50 to-emerald-50 p-6 text-center border-t"> <div className="flex items-center justify-center space-x-4"> <div className="w-16 h-16 bg-gradient-to-r from-green-400 to-emerald-500 rounded-lg flex items-center justify-center text-2xl"> 🚗 </div> <div className="text-left"> <p className="font-semibold text-gray-800">Ready to drive?</p> <p className="text-sm text-gray-600"> Your next adventure awaits </p> </div> </div> </div> </div> </> ); }; export default Login;
```

# borrowmycarfrontend\src\MyBookings.jsx

```jsx
import { useState, useEffect } from "react"; import { useLocation } from "react-router-dom"; import { Helmet } from "react-helmet"; import { Calendar, Car, Clock, MapPin, Phone, Mail, CheckCircle, XCircle, AlertCircle, Eye, MessageCircle, } from "lucide-react"; import API from "./api"; const MyBookings = () => { const [user, setUser] = useState(null); const [bookings, setBookings] = useState([]); const [loading, setLoading] = useState(true); const [error, setError] = useState(""); const [activeTab, setActiveTab] = useState("all"); const [updateLoading, setUpdateLoading] = useState(""); const [message, setMessage] = useState({ type: "", text: "" }); const location = useLocation(); useEffect(() => { // Get user info from token const token = localStorage.getItem("token"); if (token) { try { const payload = JSON.parse(atob(token.split(".")[1])); setUser(payload); } catch { setUser(null); } } fetchBookings(); // Show success message if coming from booking if (location.state?.message) { setMessage({ type: "success", text: location.state.message }); setTimeout(() => setMessage({ type: "", text: "" }), 5000); } }, [location.state]); const fetchBookings = async () => { try { setLoading(true); setError(""); // Get user role to determine endpoint const token = localStorage.getItem("token"); let userRole = "renter"; if (token) { try { const payload = JSON.parse(atob(token.split(".")[1])); userRole = payload.role; } catch { userRole = "renter"; } } const endpoint = userRole === "owner" ? "/bookings/owner" : "/bookings/me"; console.log("Fetching bookings from:", endpoint); const response = await API.get(endpoint); console.log("Bookings response:", response.data); // Handle different response structures let bookingsData = []; if (response.data.data?.bookings) { bookingsData = response.data.data.bookings; } else if (response.data.bookings) { bookingsData = response.data.bookings; } else if (Array.isArray(response.data.data)) { bookingsData = response.data.data; } else if (Array.isArray(response.data)) { bookingsData = response.data; } setBookings(bookingsData); } catch (err) { console.error("Booking fetch error:", err); setError( err.response?.data?.message || "Failed to fetch bookings. Please try again." ); } finally { setLoading(false); } }; const handleStatusUpdate = async (bookingId, newStatus) => { try { setUpdateLoading(bookingId); const response = await API.put(`/bookings/${bookingId}`, { status: newStatus, }); console.log("Status update response:", response.data); // Refresh bookings await fetchBookings(); setMessage({ type: "success", text: `Booking ${newStatus} successfully`, }); setTimeout(() => setMessage({ type: "", text: "" }), 3000); } catch (err) { console.error("Status update error:", err); setMessage({ type: "error", text: err.response?.data?.message || "Failed to update booking status", }); setTimeout(() => setMessage({ type: "", text: "" }), 5000); } finally { setUpdateLoading(""); } }; const getStatusColor = (status) => { const colors = { pending: "bg-yellow-100 text-yellow-800 border-yellow-200", approved: "bg-blue-100 text-blue-800 border-blue-200", confirmed: "bg-green-100 text-green-800 border-green-200", active: "bg-purple-100 text-purple-800 border-purple-200", completed: "bg-gray-100 text-gray-800 border-gray-200", cancelled: "bg-red-100 text-red-800 border-red-200", rejected: "bg-red-100 text-red-800 border-red-200", }; return colors[status] || "bg-gray-100 text-gray-800 border-gray-200"; }; const getStatusIcon = (status) => { switch (status) { case "pending": return <Clock className="w-4 h-4" />; case "approved": case "confirmed": return <CheckCircle className="w-4 h-4" />; case "cancelled": case "rejected": return <XCircle className="w-4 h-4" />; default: return <AlertCircle className="w-4 h-4" />; } }; const filterBookings = (status) => { if (status === "all") return bookings; if (status === "active") { return bookings.filter((b) => ["pending", "approved", "confirmed", "active"].includes(b.status) ); } return bookings.filter((b) => b.status === status); }; const filteredBookings = filterBookings(activeTab); // Calculate total earnings for owners const calculateEarnings = () => { if (user?.role !== "owner") return 0; return bookings .filter((b) => ["completed"].includes(b.status)) .reduce( (total, booking) => total + (booking.totalCost || booking.totalPayable || 0), 0 ); }; const tabs = [ { id: "all", label: "All Bookings" }, { id: "active", label: "Active" }, { id: "pending", label: "Pending" }, { id: "completed", label: "Completed" }, { id: "cancelled", label: "Cancelled" }, ]; if (loading) { return ( <> <Helmet> <title>My Bookings - BorrowMyCar</title> </Helmet> <div className="max-w-7xl mx-auto px-4 py-8"> <div className="animate-pulse space-y-4"> <div className="h-8 bg-gray-200 rounded w-1/4"></div> <div className="space-y-3"> {Array.from({ length: 3 }).map((_, i) => ( <div key={i} className="h-32 bg-gray-200 rounded"></div> ))} </div> </div> </div> </> ); } return ( <> <Helmet> <title> {user?.role === "owner" ? "Booking Requests" : "My Bookings"} - BorrowMyCar </title> </Helmet> <div className="max-w-7xl mx-auto px-4 py-8"> {/* Header */} <div className="mb-8"> <h1 className="text-3xl font-bold text-gray-900 mb-2"> {user?.role === "owner" ? "Booking Requests" : "My Bookings"} </h1> <p className="text-gray-600"> {user?.role === "owner" ? "Manage booking requests for your vehicles" : "Track your car rental history and active bookings"} </p> {/* Owner Earnings Summary */} {user?.role === "owner" && bookings.length > 0 && ( <div className="mt-4 bg-green-50 border border-green-200 rounded-lg p-4"> <div className="flex items-center justify-between"> <div> <h3 className="font-medium text-green-900">Total Earnings</h3> <p className="text-2xl font-bold text-green-600"> AED {calculateEarnings().toLocaleString()} </p> </div> <div className="text-green-600"> <Car className="w-8 h-8" /> </div> </div> </div> )} </div> {/* Message Display */} {message.text && ( <div className={`mb-6 p-4 rounded-lg flex items-center border ${ message.type === "error" ? "bg-red-50 border-red-200 text-red-700" : "bg-green-50 border-green-200 text-green-700" }`} > {message.type === "error" ? ( <XCircle className="w-5 h-5 mr-2" /> ) : ( <CheckCircle className="w-5 h-5 mr-2" /> )} {message.text} </div> )} {/* Tabs */} <div className="border-b border-gray-200 mb-6"> <nav className="-mb-px flex space-x-8 overflow-x-auto"> {tabs.map((tab) => ( <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`py-2 px-1 border-b-2 font-medium text-sm transition-colors whitespace-nowrap ${ activeTab === tab.id ? "border-green-500 text-green-600" : "border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" }`} > {tab.label} <span className="ml-2 bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs"> {filterBookings(tab.id).length} </span> </button> ))} </nav> </div> {/* Error State */} {error && ( <div className="bg-red-50 border border-red-200 rounded-lg p-6 text-center mb-6"> <XCircle className="mx-auto h-12 w-12 text-red-400 mb-4" /> <h3 className="text-lg font-medium text-red-800 mb-2"> Error Loading Bookings </h3> <p className="text-red-600 mb-4">{error}</p> <button onClick={fetchBookings} className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors" > Try Again </button> </div> )} {/* Bookings List */} {filteredBookings.length === 0 && !error ? ( <div className="text-center py-12"> <div className="w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center"> <Calendar className="w-12 h-12 text-gray-400" /> </div> <h3 className="text-lg font-medium text-gray-900 mb-2"> No bookings found </h3> <p className="text-gray-600 mb-4"> {activeTab === "all" ? user?.role === "owner" ? "You haven't received any booking requests yet." : "You haven't made any bookings yet." : `No ${activeTab} bookings found.`} </p> {user?.role === "renter" && ( <button onClick={() => (window.location.href = "/browse")} className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors" > Browse Cars </button> )} </div> ) : ( <div className="space-y-6"> {filteredBookings.map((booking) => ( <div key={booking._id} className="bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-shadow" > {/* Main Content */} <div className="p-6"> <div className="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4"> {/* Car Info */} <div className="flex items-start gap-4 flex-1"> {/* Car Image */} <div className="flex-shrink-0"> <img src={ booking.car?.images?.[0] || "https://via.placeholder.com/120x80?text=Car" } alt={booking.car?.title || "Car"} className="w-20 h-16 sm:w-24 sm:h-18 object-cover rounded-lg border border-gray-200" onError={(e) => { e.target.src = "https://via.placeholder.com/120x80?text=Car"; }} /> </div> {/* Booking Details */} <div className="flex-1 min-w-0"> <div className="flex items-start justify-between mb-2"> <h3 className="font-semibold text-gray-900 text-lg truncate"> {booking.car?.title || "Car Details Not Available"} </h3> <div className="flex items-center ml-4"> <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${getStatusColor( booking.status )}`} > {getStatusIcon(booking.status)} <span className="ml-1 capitalize"> {booking.status} </span> </span> </div> </div> {/* Booking Info Grid */} <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 text-sm text-gray-600 mb-3"> <div className="flex items-center gap-1"> <Calendar className="w-4 h-4" /> <span> {new Date(booking.startDate).toLocaleDateString()}{" "} - {new Date(booking.endDate).toLocaleDateString()} </span> </div> <div className="flex items-center gap-1"> <Clock className="w-4 h-4" /> <span> {booking.numberOfDays || booking.totalDays || 1}{" "} day {(booking.numberOfDays || booking.totalDays || 1) !== 1 ? "s" : ""} </span> </div> <div className="flex items-center gap-1"> <span className="text-green-600 font-medium"> AED{" "} {booking.totalCost || booking.totalPayable || 0} </span> </div> {booking.car?.city && ( <div className="flex items-center gap-1"> <MapPin className="w-4 h-4" /> <span>{booking.car.city}</span> </div> )} </div> {/* Renter/Owner Info */} {user?.role === "owner" && booking.renter && ( <div className="bg-gray-50 rounded-lg p-3 mb-3"> <h4 className="font-medium text-gray-900 mb-2"> Renter Information </h4> <div className="flex items-center gap-4 text-sm"> <div className="flex items-center gap-1"> <span className="font-medium"> {booking.renter.name} </span> </div> {booking.renter.phone && ( <div className="flex items-center gap-1"> <Phone className="w-3 h-3" /> <span>{booking.renter.phone}</span> </div> )} {booking.renter.email && ( <div className="flex items-center gap-1"> <Mail className="w-3 h-3" /> <span>{booking.renter.email}</span> </div> )} </div> </div> )} {user?.role === "renter" && booking.car?.owner && ( <div className="bg-gray-50 rounded-lg p-3 mb-3"> <h4 className="font-medium text-gray-900 mb-2"> Car Owner </h4> <div className="flex items-center gap-4 text-sm"> <div className="flex items-center gap-1"> <span className="font-medium"> {booking.car.owner.name} </span> </div> {booking.car.owner.phone && ( <div className="flex items-center gap-1"> <Phone className="w-3 h-3" /> <span>{booking.car.owner.phone}</span> </div> )} </div> </div> )} {/* Notes */} {(booking.renterNotes || booking.ownerNotes) && ( <div className="bg-blue-50 rounded-lg p-3"> <h4 className="font-medium text-blue-900 mb-1"> Notes </h4> <p className="text-blue-800 text-sm"> {booking.renterNotes || booking.ownerNotes} </p> </div> )} </div> </div> {/* Action Buttons */} <div className="flex flex-col sm:flex-row lg:flex-col gap-2 lg:min-w-[120px]"> {/* Owner Actions */} {user?.role === "owner" && booking.status === "pending" && ( <> <button onClick={() => handleStatusUpdate(booking._id, "approved") } disabled={updateLoading === booking._id} className="px-3 py-1.5 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center" > {updateLoading === booking._id ? ( <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" /> ) : ( <> <CheckCircle className="w-3 h-3 mr-1" /> Approve </> )} </button> <button onClick={() => handleStatusUpdate(booking._id, "rejected") } disabled={updateLoading === booking._id} className="px-3 py-1.5 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center" > {updateLoading === booking._id ? ( <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" /> ) : ( <> <XCircle className="w-3 h-3 mr-1" /> Reject </> )} </button> </> )} {/* Mark as completed for active bookings */} {user?.role === "owner" && booking.status === "active" && ( <button onClick={() => handleStatusUpdate(booking._id, "completed") } disabled={updateLoading === booking._id} className="px-3 py-1.5 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center" > {updateLoading === booking._id ? ( <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" /> ) : ( <> <CheckCircle className="w-3 h-3 mr-1" /> Complete </> )} </button> )} {/* Renter Actions */} {user?.role === "renter" && ["pending", "approved"].includes(booking.status) && ( <button onClick={() => handleStatusUpdate(booking._id, "cancelled") } disabled={updateLoading === booking._id} className="px-3 py-1.5 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center" > {updateLoading === booking._id ? ( <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" /> ) : ( <> <XCircle className="w-3 h-3 mr-1" /> Cancel </> )} </button> )} {/* View Details Button */} <button onClick={() => (window.location.href = `/cars/${booking.car?._id}`) } className="px-3 py-1.5 bg-gray-100 text-gray-700 text-sm rounded hover:bg-gray-200 transition-colors flex items-center justify-center" > <Eye className="w-3 h-3 mr-1" /> View Car </button> {/* Contact Button */} <button onClick={() => (window.location.href = `/messages?booking=${booking._id}`) } className="px-3 py-1.5 bg-blue-100 text-blue-700 text-sm rounded hover:bg-blue-200 transition-colors flex items-center justify-center" > <MessageCircle className="w-3 h-3 mr-1" /> Message </button> </div> </div> </div> {/* Additional Details - Expandable */} <div className="border-t border-gray-100 px-6 py-3 bg-gray-50"> <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600"> <div> <span className="font-medium">Booking ID:</span> <span className="ml-1 font-mono text-xs"> {booking._id} </span> </div> <div> <span className="font-medium">Created:</span> <span className="ml-1"> {new Date(booking.createdAt).toLocaleDateString()} </span> </div> <div> <span className="font-medium">Payment:</span> <span className="ml-1 capitalize"> {booking.paymentMethod || "Pending"} </span> </div> </div> </div> </div> ))} </div> )} {/* Load More / Pagination */} {filteredBookings.length > 0 && ( <div className="text-center mt-8"> <p className="text-gray-600 text-sm"> Showing {filteredBookings.length} of {bookings.length} total bookings </p> </div> )} </div> </> ); }; export default MyBookings;
```

# borrowmycarfrontend\src\Navbar.jsx

```jsx
import React, { useState, useEffect, useRef } from "react"; import { useNavigate, useLocation, Link } from "react-router-dom"; import { Menu, X, Bell, MessageCircle, Car, Calendar, Settings, LogOut, User, Shield, BarChart3, Plus, Search, MapPin, ChevronDown, Home, HelpCircle, } from "lucide-react"; import API from "./api"; const Navbar = () => { const [isMenuOpen, setIsMenuOpen] = useState(false); const [isProfileOpen, setIsProfileOpen] = useState(false); const [isSearchOpen, setIsSearchOpen] = useState(false); const [scrolled, setScrolled] = useState(false); const [user, setUser] = useState(null); const [loading, setLoading] = useState(true); const [notifications, setNotifications] = useState([]); const [searchQuery, setSearchQuery] = useState(""); const [searchResults, setSearchResults] = useState([]); const [searchLoading, setSearchLoading] = useState(false); const navigate = useNavigate(); const location = useLocation(); const profileRef = useRef(null); const searchRef = useRef(null); // Get current user on component mount useEffect(() => { const getCurrentUser = async () => { const token = localStorage.getItem("token"); if (token) { try { const response = await API.get("/auth/profile"); setUser(response.data.data.user); fetchNotifications(); } catch (error) { console.error("Failed to get user profile:", error); // Token might be invalid, remove it localStorage.removeItem("token"); } } setLoading(false); }; getCurrentUser(); }, []); // Fetch notifications for authenticated users const fetchNotifications = async () => { try { // Replace with actual notifications endpoint when available // const response = await API.get('/notifications'); // setNotifications(response.data.data.notifications); // Mock notifications for now setNotifications([ { id: 1, type: "booking", message: "New booking request received", unread: true, }, { id: 2, type: "message", message: "You have a new message", unread: true, }, { id: 3, type: "system", message: "Your car listing was approved", unread: false, }, ]); } catch (error) { console.error("Failed to fetch notifications:", error); } }; // Handle scroll effect useEffect(() => { const handleScroll = () => { setScrolled(window.scrollY > 10); }; window.addEventListener("scroll", handleScroll); return () => window.removeEventListener("scroll", handleScroll); }, []); // Close dropdowns when clicking outside useEffect(() => { const handleClickOutside = (event) => { if (profileRef.current && !profileRef.current.contains(event.target)) { setIsProfileOpen(false); } if (searchRef.current && !searchRef.current.contains(event.target)) { setIsSearchOpen(false); setSearchQuery(""); setSearchResults([]); } }; document.addEventListener("mousedown", handleClickOutside); return () => document.removeEventListener("mousedown", handleClickOutside); }, []); // Close mobile menu when route changes useEffect(() => { setIsMenuOpen(false); }, [location.pathname]); // Search functionality useEffect(() => { const searchCars = async () => { if (searchQuery.trim().length < 2) { setSearchResults([]); return; } setSearchLoading(true); try { const response = await API.get( `/cars?search=${encodeURIComponent(searchQuery)}&limit=5` ); setSearchResults(response.data.data.cars || []); } catch (error) { console.error("Search failed:", error); setSearchResults([]); } finally { setSearchLoading(false); } }; const debounceTimer = setTimeout(searchCars, 300); return () => clearTimeout(debounceTimer); }, [searchQuery]); // Navigation items based on user role const getNavItems = () => { if (!user) { return [ { label: "Browse Cars", path: "/", icon: Car }, { label: "How It Works", path: "/how-it-works", icon: HelpCircle }, ]; } const baseItems = [ { label: "Home", path: "/", icon: Home }, { label: "Browse Cars", path: "/browse", icon: Car }, ]; if (user.role === "admin") { return [ ...baseItems, { label: "Dashboard", path: "/admin", icon: BarChart3 }, { label: "Users", path: "/admin/users", icon: User }, { label: "Car Approvals", path: "/admin/cars", icon: Shield }, ]; } if (user.role === "owner") { return [ ...baseItems, { label: "My Cars", path: "/my-cars", icon: Car }, { label: "My Bookings", path: "/my-bookings", icon: Calendar }, { label: "Messages", path: "/messages", icon: MessageCircle, badge: getUnreadMessagesCount(), }, ]; } // Default renter return [ ...baseItems, { label: "My Bookings", path: "/my-bookings", icon: Calendar }, { label: "Messages", path: "/messages", icon: MessageCircle, badge: getUnreadMessagesCount(), }, ]; }; const getUnreadMessagesCount = () => { return notifications.filter((n) => n.type === "message" && n.unread).length; }; const getUnreadNotificationsCount = () => { return notifications.filter((n) => n.unread).length; }; const navItems = getNavItems(); const profileMenuItems = [ { label: "View Profile", path: "/profile", icon: User }, { label: "Account Settings", path: "/settings", icon: Settings }, ...(user?.role === "owner" ? [{ label: "Earnings", path: "/earnings", icon: BarChart3 }] : []), { label: "Support", path: "/support", icon: MessageCircle }, ]; const handleLogout = async () => { try { // Call logout endpoint if available // await API.post('/auth/logout'); localStorage.removeItem("token"); setUser(null); setNotifications([]); setIsProfileOpen(false); navigate("/"); } catch (error) { console.error("Logout failed:", error); // Force logout even if API call fails localStorage.removeItem("token"); setUser(null); navigate("/"); } }; const handleSearchResultClick = (car) => { navigate(`/cars/${car._id}`); setIsSearchOpen(false); setSearchQuery(""); setSearchResults([]); }; const handleSearchSubmit = (e) => { e.preventDefault(); if (searchQuery.trim()) { navigate(`/browse?search=${encodeURIComponent(searchQuery.trim())}`); setIsSearchOpen(false); setSearchQuery(""); setSearchResults([]); } }; const isActivePath = (path) => { if (path === "/" && location.pathname === "/") return true; if (path !== "/" && location.pathname.startsWith(path)) return true; return false; }; const toggleMenu = () => setIsMenuOpen(!isMenuOpen); const toggleProfile = () => setIsProfileOpen(!isProfileOpen); if (loading) { return ( <nav className="sticky top-0 z-50 bg-white border-b border-gray-100"> <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"> <div className="flex justify-between items-center h-16"> <div className="flex-shrink-0"> <div className="flex items-center"> <div className="w-10 h-10 bg-gray-200 rounded-xl mr-3 animate-pulse"></div> <div className="hidden sm:block"> <div className="w-32 h-5 bg-gray-200 rounded animate-pulse"></div> </div> </div> </div> <div className="hidden lg:flex space-x-4"> <div className="w-20 h-8 bg-gray-200 rounded animate-pulse"></div> <div className="w-20 h-8 bg-gray-200 rounded animate-pulse"></div> </div> <div className="flex items-center space-x-3"> <div className="w-8 h-8 bg-gray-200 rounded-full animate-pulse"></div> </div> </div> </div> </nav> ); } return ( <nav className={`sticky top-0 z-50 bg-white border-b transition-all duration-300 ${ scrolled ? "shadow-lg border-gray-200" : "border-gray-100" }`} > <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"> <div className="flex justify-between items-center h-16"> {/* Logo */} <div className="flex-shrink-0"> <Link to="/" className="flex items-center group"> <div className="flex items-center justify-center w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl mr-3 group-hover:shadow-lg transition-all duration-200"> <Car className="h-6 w-6 text-white" /> </div> <div className="hidden sm:block"> <span className="font-bold text-xl text-gray-900"> BorrowMyCar </span> <div className="text-xs text-gray-500 -mt-1"> UAE Car Rental </div> </div> </Link> </div> {/* Search Bar (Desktop) */} <div className="hidden lg:flex flex-1 max-w-lg mx-8" ref={searchRef}> <form onSubmit={handleSearchSubmit} className="relative w-full"> <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"> <Search className="h-5 w-5 text-gray-400" /> </div> <input type="text" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} placeholder="Search cars by make, model, or location..." className="block w-full pl-10 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition-colors" onFocus={() => setIsSearchOpen(true)} /> <div className="absolute inset-y-0 right-0 pr-3 flex items-center"> <MapPin className="h-4 w-4 text-gray-400" /> </div> {/* Search Dropdown */} {isSearchOpen && ( <div className="absolute top-full left-0 right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-96 overflow-y-auto"> {searchLoading ? ( <div className="p-4 text-center"> <div className="animate-spin w-6 h-6 border-2 border-green-500 border-t-transparent rounded-full mx-auto"></div> <div className="text-sm text-gray-500 mt-2"> Searching... </div> </div> ) : searchResults.length > 0 ? ( <div className="py-2"> <div className="text-xs text-gray-500 px-4 py-2 font-medium"> Search Results </div> {searchResults.map((car) => ( <button key={car._id} onClick={() => handleSearchResultClick(car)} className="w-full flex items-center px-4 py-3 hover:bg-gray-50 transition-colors text-left" > <img src={car.images?.[0] || "/placeholder-car.jpg"} alt={car.title} className="w-12 h-8 object-cover rounded mr-3" /> <div className="flex-1 min-w-0"> <div className="text-sm font-medium text-gray-900 truncate"> {car.title} </div> <div className="text-xs text-gray-500"> {car.city} • AED {car.price}/day </div> </div> </button> ))} {searchQuery.trim() && ( <button onClick={handleSearchSubmit} className="w-full flex items-center px-4 py-3 border-t border-gray-100 hover:bg-gray-50 transition-colors text-left" > <Search className="h-4 w-4 text-gray-400 mr-3" /> <span className="text-sm text-gray-700"> See all results for "{searchQuery}" </span> </button> )} </div> ) : searchQuery.trim().length > 1 ? ( <div className="p-4 text-center text-sm text-gray-500"> No cars found for "{searchQuery}" </div> ) : ( <div className="p-4"> <div className="text-sm text-gray-600 mb-3"> Popular Searches </div> <div className="space-y-2"> {[ "BMW 3 Series Dubai", "Toyota Camry Abu Dhabi", "Mercedes C-Class Sharjah", ].map((search, index) => ( <button key={index} onClick={() => { setSearchQuery(search); handleSearchSubmit({ preventDefault: () => {} }); }} className="flex items-center w-full text-left px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors" > <Search className="h-4 w-4 text-gray-400 mr-3" /> <span className="text-sm text-gray-700"> {search} </span> </button> ))} </div> </div> )} </div> )} </form> </div> {/* Desktop Navigation */} <div className="hidden lg:flex items-center space-x-6"> {navItems.map((item) => ( <Link key={item.label} to={item.path} className={`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all relative group ${ isActivePath(item.path) ? "text-green-600 bg-green-50" : "text-gray-700 hover:text-green-600 hover:bg-green-50" }`} > {item.icon && <item.icon className="h-4 w-4 mr-2" />} {item.label} {item.badge > 0 && ( <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse"> {item.badge} </span> )} </Link> ))} </div> {/* Auth Buttons / Profile */} <div className="flex items-center space-x-4"> {!user ? ( <> <Link to="/login" className="text-gray-700 hover:text-green-600 px-3 py-2 rounded-lg text-sm font-medium transition-colors" > Sign In </Link> <Link to="/signup" className="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 shadow-md hover:shadow-lg" > Get Started </Link> </> ) : ( <div className="flex items-center space-x-3"> {/* Quick Action Button (for owners) */} {user.role === "owner" && user.isApproved && ( <Link to="/list-car" className="hidden md:flex items-center bg-green-50 hover:bg-green-100 text-green-700 px-3 py-2 rounded-lg text-sm font-medium transition-colors border border-green-200" > <Plus className="h-4 w-4 mr-1" /> List Car </Link> )} {/* Notifications */} <button onClick={() => navigate("/notifications")} className="relative p-2 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors" > <Bell className="h-5 w-5" /> {getUnreadNotificationsCount() > 0 && ( <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse"> {getUnreadNotificationsCount()} </span> )} </button> <div className="relative" ref={profileRef}> <button onClick={toggleProfile} className="flex items-center space-x-3 text-gray-700 hover:text-green-600 p-1 rounded-lg focus:outline-none transition-colors" > <div className="flex items-center space-x-2"> {/* Enhanced Profile Picture */} <div className="relative"> <img className="h-8 w-8 rounded-full object-cover ring-2 ring-white shadow-sm" src={ user.profileImage || `https://ui-avatars.com/api/?name=${encodeURIComponent( user.name || "User" )}&background=10b981&color=ffffff&size=64` } alt="Profile" onError={(e) => { // Fallback to UI Avatars if image fails to load e.target.src = `https://ui-avatars.com/api/?name=${encodeURIComponent( user.name || "User" )}&background=10b981&color=ffffff&size=64`; }} /> {/* Online Status Indicator */} <div className="absolute bottom-0 right-0 h-2.5 w-2.5 bg-green-400 border-2 border-white rounded-full"></div> </div> <div className="hidden md:block text-left"> <div className="text-sm font-medium">{user.name}</div> <div className="text-xs text-gray-500 capitalize"> {user.role} </div> </div> <ChevronDown className={`h-4 w-4 transition-transform duration-200 ${ isProfileOpen ? "rotate-180" : "" }`} /> </div> </button> {/* Profile Dropdown Menu */} {isProfileOpen && ( <div className="absolute right-0 mt-3 w-64 bg-white rounded-xl shadow-lg border border-gray-200 py-2 z-50"> {/* User Info */} <div className="px-4 py-3 border-b border-gray-100"> <div className="flex items-center space-x-3"> <img className="h-10 w-10 rounded-full object-cover" src={ user.profileImage || `https://ui-avatars.com/api/?name=${encodeURIComponent( user.name || "User" )}&background=10b981&color=ffffff&size=80` } alt="Profile" onError={(e) => { e.target.src = `https://ui-avatars.com/api/?name=${encodeURIComponent( user.name || "User" )}&background=10b981&color=ffffff&size=80`; }} /> <div> <div className="font-medium text-gray-900"> {user.name} </div> <div className="text-sm text-gray-500"> {user.email} </div> <div className="flex items-center space-x-2 mt-1"> <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${ user.isApproved ? "bg-green-100 text-green-800" : "bg-yellow-100 text-yellow-800" }`} > {user.isApproved ? "Verified" : "Pending"} </span> <span className="text-xs text-gray-500 capitalize"> {user.role} </span> </div> </div> </div> </div> {/* Menu Items */} <div className="py-2"> {profileMenuItems.map((item) => ( <Link key={item.label} to={item.path} className="w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:text-gray-900 hover:bg-gray-50 transition-colors" onClick={() => setIsProfileOpen(false)} > <item.icon className="h-4 w-4 mr-3" /> {item.label} </Link> ))} {/* Logout Button */} <button onClick={handleLogout} className="w-full flex items-center px-4 py-2 text-sm text-red-600 hover:text-red-700 hover:bg-red-50 transition-colors" > <LogOut className="h-4 w-4 mr-3" /> Logout </button> </div> </div> )} </div> </div> )} {/* Mobile Menu Button */} <button onClick={toggleMenu} className="lg:hidden p-2 rounded-lg text-gray-600 hover:text-green-600 hover:bg-green-50 focus:outline-none transition-colors" > {isMenuOpen ? ( <X className="h-6 w-6" /> ) : ( <Menu className="h-6 w-6" /> )} </button> </div> </div> </div> {/* Mobile Menu */} {isMenuOpen && ( <div className="lg:hidden bg-white border-t border-gray-200"> {/* Mobile Search */} <div className="px-4 py-3 border-b border-gray-100"> <form onSubmit={handleSearchSubmit} className="relative"> <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"> <Search className="h-5 w-5 text-gray-400" /> </div> <input type="text" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} placeholder="Search cars..." className="block w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none" /> </form> </div> {/* Mobile Navigation Items */} <div className="px-4 py-3 space-y-1"> {navItems.map((item) => ( <Link key={item.label} to={item.path} className={`flex items-center w-full px-3 py-3 rounded-lg text-base font-medium transition-colors relative ${ isActivePath(item.path) ? "text-green-600 bg-green-50" : "text-gray-700 hover:text-green-600 hover:bg-green-50" }`} > {item.icon && <item.icon className="h-5 w-5 mr-3" />} {item.label} {item.badge > 0 && ( <span className="ml-auto bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center"> {item.badge} </span> )} </Link> ))} {!user && ( <> <Link to="/login" className="flex items-center w-full text-gray-700 hover:text-green-600 hover:bg-green-50 px-3 py-3 rounded-lg text-base font-medium transition-colors" > Sign In </Link> <Link to="/signup" className="flex items-center w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white px-3 py-3 rounded-lg text-base font-medium transition-colors" > Get Started </Link> </> )} {user?.role === "owner" && user?.isApproved && ( <Link to="/list-car" className="flex items-center w-full bg-green-50 text-green-700 hover:bg-green-100 px-3 py-3 rounded-lg text-base font-medium transition-colors border border-green-200" > <Plus className="h-5 w-5 mr-3" /> List New Car </Link> )} </div> </div> )} {/* Overlay for dropdowns */} {(isProfileOpen || isSearchOpen) && ( <div className="fixed inset-0 z-40" onClick={() => { setIsProfileOpen(false); setIsSearchOpen(false); }} /> )} </nav> ); }; export default Navbar;
```

# borrowmycarfrontend\src\NotFound.jsx

```jsx
import { useEffect, useState } from 'react'; import { Link, useNavigate } from 'react-router-dom'; const NotFound = () => { const navigate = useNavigate(); const [secondsLeft, setSecondsLeft] = useState(3); // Initial countdown value useEffect(() => { // Set up the interval to decrement the countdown every second const interval = setInterval(() => { setSecondsLeft((prev) => prev - 1); }, 1000); // Set up the timeout to navigate after the countdown completes const timeout = setTimeout(() => { navigate('/'); }, secondsLeft * 1000); // Cleanup function to clear the interval and timeout when the component unmounts return () => { clearInterval(interval); clearTimeout(timeout); }; }, [navigate, secondsLeft]); return ( <div className="m-auto flex justify-center items-center h-screen"> <div className="flex flex-col items-center justify-center h-full"> <h1 className="text-4xl font-bold mb-4"> <span className="text-green-600">404 </span>Page Not Found </h1> <p className="text-lg mb-4">The page you are looking for does not exist.</p> <p className="text-sm text-gray-500 mb-8"> Redirecting to home in {secondsLeft} second{secondsLeft !== 1 ? 's' : ''}... </p> <Link to="/" className="bg-green-600 text-white p-4 hover:bg-green-700"> Go back to Home </Link> </div> </div> ); }; export default NotFound;
```

# borrowmycarfrontend\src\pages\BookingSuccess.jsx

```jsx
// src/pages/BookingSuccess.jsx - Complete booking success page import { useEffect, useState } from "react"; import { useNavigate, useLocation, Link } from "react-router-dom"; import { Helmet } from "react-helmet"; import { CheckCircle, Calendar, Car, MapPin, Download, Mail, Phone, Clock, CreditCard, Star, Share2, MessageCircle, ArrowRight, Home, FileText, Shield, AlertCircle, Info, } from "lucide-react"; const BookingSuccess = () => { const navigate = useNavigate(); const location = useLocation(); const [countdown, setCountdown] = useState(15); const [showDetails, setShowDetails] = useState(false); const { paymentIntent, booking, car } = location.state || {}; // Auto-redirect after countdown useEffect(() => { if (!paymentIntent || !booking) { navigate("/my-bookings", { replace: true }); return; } const timer = setInterval(() => { setCountdown((prev) => { if (prev <= 1) { navigate("/my-bookings"); return 0; } return prev - 1; }); }, 1000); return () => clearInterval(timer); }, [navigate, paymentIntent, booking]); const handleDownloadReceipt = () => { const receiptData = { bookingReference: booking?._id?.slice(-8).toUpperCase() || "UNKNOWN", paymentId: paymentIntent?.id?.slice(-8).toUpperCase(), carTitle: car?.title, carCity: car?.city, bookingDates: { start: booking?.startDate, end: booking?.endDate, duration: booking?.totalDays, }, payment: { amount: paymentIntent?.amount ? (paymentIntent.amount / 100).toFixed(2) : "0.00", currency: paymentIntent?.currency?.toUpperCase() || "AED", method: "Credit Card", status: "Paid", }, timestamp: new Date().toISOString(), customerInfo: { name: booking?.renter?.name || "Customer", email: booking?.renter?.email || "N/A", }, }; const dataStr = JSON.stringify(receiptData, null, 2); const dataBlob = new Blob([dataStr], { type: "application/json" }); const url = URL.createObjectURL(dataBlob); const link = document.createElement("a"); link.href = url; link.download = `BorrowMyCar_Receipt_${receiptData.bookingReference}.json`; document.body.appendChild(link); link.click(); document.body.removeChild(link); URL.revokeObjectURL(url); }; const handleShare = () => { const shareData = { title: "Car Booking Confirmed - BorrowMyCar", text: `I just booked ${car?.title} through BorrowMyCar! 🚗`, url: window.location.origin, }; if (navigator.share) { navigator.share(shareData); } else { navigator.clipboard.writeText(`${shareData.text} ${shareData.url}`); alert("Booking details copied to clipboard!"); } }; if (!paymentIntent || !booking) { return ( <> <Helmet> <title>Booking Not Found - BorrowMyCar</title> </Helmet> <div className="max-w-4xl mx-auto p-6"> <div className="text-center py-12"> <AlertCircle className="w-16 h-16 text-red-400 mx-auto mb-6" /> <h1 className="text-2xl font-bold text-gray-900 mb-4"> Booking Information Not Found </h1> <p className="text-gray-600 mb-6"> We couldn't find your booking details. Please check your email for confirmation or view your bookings. </p> <div className="flex flex-col sm:flex-row gap-4 justify-center"> <Link to="/my-bookings" className="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors" > View My Bookings </Link> <Link to="/browse" className="border border-gray-300 hover:bg-gray-50 text-gray-700 px-6 py-3 rounded-lg font-medium transition-colors" > Browse Cars </Link> </div> </div> </div> </> ); } return ( <> <Helmet> <title>Booking Confirmed - BorrowMyCar</title> <meta name="description" content="Your car booking has been successfully confirmed!" /> </Helmet> <div className="min-h-screen bg-gradient-to-br from-green-50 to-emerald-50"> <div className="max-w-4xl mx-auto p-6"> {/* Success Animation Header */} <div className="text-center mb-8 pt-8"> <div className="relative"> <div className="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse"> <CheckCircle className="w-16 h-16 text-green-600 animate-bounce" /> </div> {/* Confetti effect */} <div className="absolute inset-0 pointer-events-none"> {[...Array(6)].map((_, i) => ( <div key={i} className={`absolute w-3 h-3 bg-green-400 rounded-full animate-ping`} style={{ left: `${20 + i * 15}%`, top: `${30 + (i % 2) * 20}%`, animationDelay: `${i * 0.2}s`, animationDuration: "1.5s", }} /> ))} </div> </div> <h1 className="text-4xl font-bold text-gray-900 mb-4"> 🎉 Booking Confirmed! </h1> <p className="text-xl text-gray-600 max-w-2xl mx-auto"> Great news! Your car rental has been successfully booked and payment confirmed. Get ready for an amazing driving experience! </p> </div> {/* Main Booking Card */} <div className="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100"> {/* Header with booking reference */} <div className="bg-gradient-to-r from-green-600 to-emerald-600 px-8 py-6 text-white"> <div className="flex flex-col md:flex-row md:items-center md:justify-between"> <div> <h2 className="text-2xl font-bold mb-2">Booking Reference</h2> <p className="text-green-100 font-mono text-lg"> #{booking._id?.slice(-8).toUpperCase() || "UNKNOWN"} </p> </div> <div className="mt-4 md:mt-0 text-right"> <p className="text-green-100 text-sm">Payment Confirmed</p> <p className="text-white font-mono"> {paymentIntent.id?.slice(-8).toUpperCase()} </p> </div> </div> </div> <div className="p-8"> {/* Car Information */} <div className="mb-8"> <h3 className="text-xl font-semibold text-gray-900 mb-4 flex items-center"> <Car className="w-6 h-6 mr-3 text-green-600" /> Your Rental Vehicle </h3> <div className="flex flex-col md:flex-row items-start space-y-4 md:space-y-0 md:space-x-6 bg-gray-50 p-6 rounded-xl"> <img src={car?.images?.[0] || "/placeholder-car.jpg"} alt={car?.title} className="w-full md:w-32 h-24 object-cover rounded-lg" /> <div className="flex-1"> <h4 className="text-xl font-semibold text-gray-900"> {car?.title} </h4> <div className="flex items-center text-gray-600 mt-2"> <MapPin className="w-4 h-4 mr-2" /> <span>{car?.city}, UAE</span> </div> <div className="flex items-center space-x-4 mt-3"> <div className="flex items-center text-yellow-500"> <Star className="w-4 h-4 mr-1" /> <span className="text-sm text-gray-700"> 4.9 rating </span> </div> <div className="flex items-center text-green-600"> <Shield className="w-4 h-4 mr-1" /> <span className="text-sm text-gray-700"> Fully insured </span> </div> </div> </div> <div className="text-right"> <div className="text-2xl font-bold text-green-600"> AED {car?.price}/day </div> <div className="text-sm text-gray-500">Per day rate</div> </div> </div> </div> {/* Booking Timeline */} <div className="mb-8"> <h3 className="text-xl font-semibold text-gray-900 mb-4 flex items-center"> <Calendar className="w-6 h-6 mr-3 text-green-600" /> Rental Timeline </h3> <div className="grid md:grid-cols-2 gap-6"> <div className="bg-blue-50 border border-blue-200 rounded-xl p-6"> <div className="flex items-center text-blue-700 mb-3"> <Calendar className="w-5 h-5 mr-2" /> <span className="font-semibold">Pickup Details</span> </div> <p className="text-lg font-bold text-gray-900 mb-1"> {new Date(booking.startDate).toLocaleDateString("en-US", { weekday: "long", year: "numeric", month: "long", day: "numeric", })} </p> <div className="flex items-center text-gray-600"> <Clock className="w-4 h-4 mr-2" /> <span>10:00 AM (Default time)</span> </div> <p className="text-sm text-blue-600 mt-2"> 📍 Pickup location will be confirmed by owner </p> </div> <div className="bg-orange-50 border border-orange-200 rounded-xl p-6"> <div className="flex items-center text-orange-700 mb-3"> <Calendar className="w-5 h-5 mr-2" /> <span className="font-semibold">Return Details</span> </div> <p className="text-lg font-bold text-gray-900 mb-1"> {new Date(booking.endDate).toLocaleDateString("en-US", { weekday: "long", year: "numeric", month: "long", day: "numeric", })} </p> <div className="flex items-center text-gray-600"> <Clock className="w-4 h-4 mr-2" /> <span>10:00 AM (Default time)</span> </div> <p className="text-sm text-orange-600 mt-2"> 🔄 Return to same pickup location </p> </div> </div> <div className="mt-4 text-center"> <div className="inline-flex items-center bg-green-100 text-green-800 px-4 py-2 rounded-full"> <Clock className="w-4 h-4 mr-2" /> <span className="font-medium"> Total Duration: {booking.totalDays} day {booking.totalDays !== 1 ? "s" : ""} </span> </div> </div> </div> {/* Payment Summary */} <div className="mb-8"> <h3 className="text-xl font-semibold text-gray-900 mb-4 flex items-center"> <CreditCard className="w-6 h-6 mr-3 text-green-600" /> Payment Summary </h3> <div className="bg-gray-50 rounded-xl p-6"> <div className="space-y-3"> <div className="flex justify-between text-sm"> <span className="text-gray-600"> Rental fee ({booking.totalDays} day {booking.totalDays !== 1 ? "s" : ""}) </span> <span className="text-gray-900"> AED {((paymentIntent.amount / 100) * 0.95).toFixed(2)} </span> </div> <div className="flex justify-between text-sm"> <span className="text-gray-600">Service fee (5%)</span> <span className="text-gray-900"> AED {((paymentIntent.amount / 100) * 0.05).toFixed(2)} </span> </div> <hr className="border-gray-200" /> <div className="flex justify-between items-center"> <span className="text-lg font-semibold text-gray-900"> Total Paid </span> <span className="text-2xl font-bold text-green-600"> AED {(paymentIntent.amount / 100).toFixed(2)} </span> </div> <div className="text-xs text-gray-500"> Payment method: Credit Card ending in **** </div> </div> </div> </div> {/* Next Steps */} <div className="mb-8"> <h3 className="text-xl font-semibold text-gray-900 mb-4 flex items-center"> <Info className="w-6 h-6 mr-3 text-green-600" /> What Happens Next? </h3> <div className="grid md:grid-cols-3 gap-4"> <div className="bg-blue-50 border border-blue-200 rounded-lg p-4"> <div className="flex items-center mb-3"> <div className="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold text-sm mr-3"> 1 </div> <Mail className="w-5 h-5 text-blue-600" /> </div> <h4 className="font-semibold text-blue-900 mb-2"> Email Confirmation </h4> <p className="text-sm text-blue-700"> Booking confirmation sent to your email with all details </p> </div> <div className="bg-green-50 border border-green-200 rounded-lg p-4"> <div className="flex items-center mb-3"> <div className="w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center font-bold text-sm mr-3"> 2 </div> <Phone className="w-5 h-5 text-green-600" /> </div> <h4 className="font-semibold text-green-900 mb-2"> Owner Contact </h4> <p className="text-sm text-green-700"> Car owner will contact you 24-48 hours before pickup </p> </div> <div className="bg-purple-50 border border-purple-200 rounded-lg p-4"> <div className="flex items-center mb-3"> <div className="w-8 h-8 bg-purple-600 text-white rounded-full flex items-center justify-center font-bold text-sm mr-3"> 3 </div> <Car className="w-5 h-5 text-purple-600" /> </div> <h4 className="font-semibold text-purple-900 mb-2"> Pickup Day </h4> <p className="text-sm text-purple-700"> Bring your driving license and Emirates ID for pickup </p> </div> </div> </div> {/* Action Buttons */} <div className="flex flex-col sm:flex-row gap-4"> <button onClick={handleDownloadReceipt} className="flex items-center justify-center px-6 py-3 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition-colors" > <Download className="w-5 h-5 mr-2" /> Download Receipt </button> <button onClick={handleShare} className="flex items-center justify-center px-6 py-3 border border-green-600 text-green-600 rounded-lg hover:bg-green-50 transition-colors" > <Share2 className="w-5 h-5 mr-2" /> Share Booking </button> <Link to="/my-bookings" className="flex items-center justify-center px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors" > <FileText className="w-5 h-5 mr-2" /> View All Bookings </Link> <Link to="/browse" className="flex items-center justify-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors" > <Car className="w-5 h-5 mr-2" /> Browse More Cars </Link> </div> {/* Auto redirect notice */} <div className="mt-8 text-center text-sm text-gray-500 bg-gray-50 p-4 rounded-lg"> <p> 🕒 You will be automatically redirected to your bookings in{" "} <span className="font-semibold text-green-600"> {countdown} </span>{" "} seconds </p> <button onClick={() => navigate("/my-bookings")} className="text-green-600 hover:text-green-700 underline ml-2" > Go now </button>{" "} or{" "} <Link to="/" className="text-blue-600 hover:text-blue-700 underline" > return home </Link> </div> </div> </div> {/* Important Reminders */} <div className="mt-8 bg-yellow-50 border border-yellow-200 rounded-xl p-6"> <h3 className="font-semibold text-yellow-800 mb-4 flex items-center"> <AlertCircle className="w-5 h-5 mr-2" /> Important Reminders </h3> <div className="grid md:grid-cols-2 gap-4 text-sm text-yellow-800"> <div className="space-y-2"> <p>• Arrive on time for pickup to avoid delays</p> <p>• Bring valid driving license and Emirates ID</p> <p>• Inspect the car thoroughly before driving</p> </div> <div className="space-y-2"> <p>• Return with sufficient fuel as received</p> <p>• Report any issues immediately to owner</p> <p>• Follow UAE traffic rules and regulations</p> </div> </div> <div className="mt-4 pt-4 border-t border-yellow-200"> <p className="text-sm text-yellow-700"> <strong>Need help?</strong> Contact our 24/7 support team at{" "} <a href="tel:+971800266669" className="font-semibold underline"> +971 800 BORROW </a>{" "} or{" "} <a href="mailto:support@borrowmycar.ae" className="font-semibold underline" > support@borrowmycar.ae </a> </p> </div> </div> {/* Social Proof */} <div className="mt-8 text-center"> <p className="text-gray-600 mb-4"> Join thousands of satisfied customers who trust BorrowMyCar </p> <div className="flex items-center justify-center space-x-1"> {[...Array(5)].map((_, i) => ( <Star key={i} className="w-5 h-5 text-yellow-400 fill-current" /> ))} <span className="ml-2 text-gray-700 font-medium"> 4.9/5 from 12,000+ reviews </span> </div> </div> </div> </div> </> ); }; export default BookingSuccess;
```

# borrowmycarfrontend\src\pages\Checkout.jsx

```jsx
// src/pages/Checkout.jsx - Fixed to work with your backend import { useState, useEffect } from "react"; import { useParams, useNavigate, useLocation } from "react-router-dom"; import { Helmet } from "react-helmet"; import { ArrowLeft, Calendar, Car, MapPin, Clock, Shield, AlertCircle, } from "lucide-react"; import PaymentForm from "../components/PaymentForm"; import API from "../api"; const Checkout = () => { const { carId } = useParams(); const navigate = useNavigate(); const location = useLocation(); const [car, setCar] = useState(null); const [booking, setBooking] = useState(null); const [loading, setLoading] = useState(true); const [error, setError] = useState(""); const [paymentError, setPaymentError] = useState(""); useEffect(() => { const initializeCheckout = async () => { try { // Get booking data from location state or localStorage const bookingData = location.state?.bookingData || JSON.parse(localStorage.getItem(`booking_${carId}`) || "{}"); if (!bookingData.startDate || !bookingData.endDate) { navigate(`/cars/${carId}`, { state: { error: "Please select dates before proceeding to checkout.", }, }); return; } // Fetch car details const carResponse = await API.get(`/cars/${carId}`); setCar(carResponse.data.data.car); // Create booking on backend const bookingResponse = await API.post("/bookings", { carId: carId, startDate: bookingData.startDate, endDate: bookingData.endDate, totalDays: bookingData.numberOfDays, totalAmount: bookingData.subtotal, serviceFee: bookingData.serviceFee, totalPayable: bookingData.totalCost, }); setBooking(bookingResponse.data.data.booking); } catch (err) { console.error("Checkout initialization error:", err); setError( err.response?.data?.message || "Failed to initialize checkout" ); } finally { setLoading(false); } }; initializeCheckout(); }, [carId, location.state, navigate]); const handlePaymentSuccess = async (paymentResult) => { try { // Clear saved booking data localStorage.removeItem(`booking_${carId}`); // Navigate to success page navigate("/booking-success", { state: { paymentIntent: paymentResult.paymentIntent, booking: paymentResult.booking, car, }, replace: true, }); } catch (err) { console.error("Post-payment error:", err); setPaymentError( "Payment successful but navigation failed. Please check your bookings." ); } }; const handlePaymentError = (error) => { console.error("Payment error:", error); setPaymentError(error); }; const handleBackToCarDetails = () => { const bookingData = location.state?.bookingData; navigate(`/cars/${carId}`, { state: { bookingData }, }); }; if (loading) { return ( <> <Helmet> <title>Loading Checkout - BorrowMyCar</title> </Helmet> <div className="max-w-4xl mx-auto p-6"> <div className="animate-pulse space-y-6"> <div className="h-8 bg-gray-200 rounded w-1/4"></div> <div className="grid md:grid-cols-2 gap-8"> <div className="space-y-4"> <div className="h-6 bg-gray-200 rounded w-3/4"></div> <div className="h-40 bg-gray-200 rounded"></div> </div> <div className="space-y-4"> <div className="h-6 bg-gray-200 rounded w-1/2"></div> <div className="h-60 bg-gray-200 rounded"></div> </div> </div> </div> </div> </> ); } if (error || !car || !booking) { return ( <> <Helmet> <title>Checkout Error - BorrowMyCar</title> </Helmet> <div className="max-w-4xl mx-auto p-6"> <div className="bg-red-50 border border-red-200 rounded-lg p-6 text-center"> <AlertCircle className="w-12 h-12 text-red-400 mx-auto mb-4" /> <div className="text-red-600 text-lg font-medium mb-4"> {error || "Booking information not found"} </div> <div className="space-x-4"> <button onClick={() => navigate("/browse")} className="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg transition-colors" > Browse Cars </button> <button onClick={handleBackToCarDetails} className="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg transition-colors" > Back to Car </button> </div> </div> </div> </> ); } return ( <> <Helmet> <title>Checkout - {car.title} | BorrowMyCar</title> </Helmet> <div className="max-w-6xl mx-auto p-6"> {/* Header */} <div className="mb-8"> <button onClick={handleBackToCarDetails} className="flex items-center text-green-600 hover:text-green-800 mb-4 transition-colors" > <ArrowLeft className="w-5 h-5 mr-2" /> Back to Car Details </button> <h1 className="text-3xl font-bold text-gray-900"> Complete Your Booking </h1> <p className="text-gray-600 mt-2"> Review your booking details and complete payment </p> </div> <div className="grid lg:grid-cols-3 gap-8"> {/* Left Column - Booking Summary */} <div className="lg:col-span-2 space-y-6"> {/* Car Information */} <div className="bg-white border border-gray-200 rounded-xl p-6"> <h2 className="text-xl font-semibold text-gray-900 mb-4 flex items-center"> <Car className="w-6 h-6 mr-2" /> Your Vehicle </h2> <div className="flex space-x-4"> <img src={car.images?.[0] || "/placeholder-car.jpg"} alt={car.title} className="w-24 h-20 object-cover rounded-lg" /> <div className="flex-1"> <h3 className="font-semibold text-gray-900">{car.title}</h3> <div className="flex items-center text-gray-600 mt-1"> <MapPin className="w-4 h-4 mr-1" /> <span>{car.city}</span> </div> <div className="text-green-600 font-semibold mt-2"> AED {car.price}/day </div> </div> </div> </div> {/* Booking Details */} <div className="bg-white border border-gray-200 rounded-xl p-6"> <h2 className="text-xl font-semibold text-gray-900 mb-4 flex items-center"> <Calendar className="w-6 h-6 mr-2" /> Booking Details </h2> <div className="grid md:grid-cols-2 gap-6"> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Pickup Date & Time </label> <div className="flex items-center text-gray-900"> <Calendar className="w-4 h-4 mr-2 text-gray-400" /> <span> {new Date(booking.startDate).toLocaleDateString()} </span> </div> <div className="flex items-center text-gray-600 mt-1"> <Clock className="w-4 h-4 mr-2 text-gray-400" /> <span>10:00 AM (Default pickup time)</span> </div> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-1"> Return Date & Time </label> <div className="flex items-center text-gray-900"> <Calendar className="w-4 h-4 mr-2 text-gray-400" /> <span> {new Date(booking.endDate).toLocaleDateString()} </span> </div> <div className="flex items-center text-gray-600 mt-1"> <Clock className="w-4 h-4 mr-2 text-gray-400" /> <span>10:00 AM (Default return time)</span> </div> </div> </div> <div className="mt-4 pt-4 border-t border-gray-200"> <div className="flex items-center justify-between"> <span className="text-gray-600">Total Duration</span> <span className="font-semibold text-gray-900"> {booking.totalDays} day{booking.totalDays !== 1 ? "s" : ""} </span> </div> </div> </div> {/* Payment Error Display */} {paymentError && ( <div className="bg-red-50 border border-red-200 rounded-xl p-6"> <div className="flex items-start"> <AlertCircle className="w-6 h-6 text-red-600 mr-3 mt-1" /> <div> <h3 className="text-lg font-medium text-red-800 mb-2"> Payment Error </h3> <p className="text-red-700">{paymentError}</p> </div> </div> </div> )} {/* Payment Form */} <div className="bg-white border border-gray-200 rounded-xl p-6"> <h2 className="text-xl font-semibold text-gray-900 mb-6"> Payment Information </h2> <PaymentForm booking={booking} onSuccess={handlePaymentSuccess} onError={handlePaymentError} /> </div> </div> {/* Right Column - Price Breakdown */} <div className="lg:col-span-1"> <div className="bg-white border border-gray-200 rounded-xl p-6 sticky top-6"> <h3 className="text-lg font-semibold text-gray-900 mb-4"> Price Breakdown </h3> <div className="space-y-3"> <div className="flex justify-between"> <span className="text-gray-600"> AED {car.price} × {booking.totalDays} day {booking.totalDays !== 1 ? "s" : ""} </span> <span className="text-gray-900"> AED {booking.totalAmount?.toFixed(2)} </span> </div> {booking.serviceFee > 0 && ( <div className="flex justify-between"> <span className="text-gray-600">Service fee</span> <span className="text-gray-900"> AED {booking.serviceFee?.toFixed(2)} </span> </div> )} {booking.securityDeposit > 0 && ( <div className="flex justify-between"> <span className="text-gray-600">Security deposit</span> <span className="text-gray-900"> AED {booking.securityDeposit?.toFixed(2)} </span> </div> )} <hr className="border-gray-200" /> <div className="flex justify-between items-center"> <span className="text-lg font-semibold text-gray-900"> Total </span> <span className="text-lg font-bold text-green-600"> AED {booking.totalPayable?.toFixed(2)} </span> </div> </div> {/* Security Badges */} <div className="mt-6 pt-6 border-t border-gray-200"> <div className="flex items-center text-sm text-gray-600 mb-3"> <Shield className="w-4 h-4 mr-2" /> <span>Secure payment powered by Stripe</span> </div> <div className="grid grid-cols-4 gap-2 opacity-60"> <div className="bg-gray-100 rounded p-2 text-xs text-center font-medium"> VISA </div> <div className="bg-gray-100 rounded p-2 text-xs text-center font-medium"> MC </div> <div className="bg-gray-100 rounded p-2 text-xs text-center font-medium"> AMEX </div> <div className="bg-gray-100 rounded p-2 text-xs text-center font-medium"> 3DS </div> </div> </div> {/* Cancellation Policy */} <div className="mt-6 pt-6 border-t border-gray-200"> <h4 className="font-medium text-gray-900 mb-2"> Cancellation Policy </h4> <div className="text-sm text-gray-600 space-y-1"> <p>• Free cancellation up to 24 hours before pickup</p> <p>• 50% refund within 24 hours of pickup</p> <p>• No refund after pickup time</p> </div> </div> </div> </div> </div> </div> </> ); }; export default Checkout;
```

# borrowmycarfrontend\src\PaymentSuccess.jsx

```jsx
// src/PaymentSuccess.jsx import { useEffect, useState } from "react"; import { useNavigate, useSearchParams, Link } from "react-router-dom"; import { CheckCircle, Car, Calendar, Download, ArrowRight, Phone, Mail, MessageCircle, } from "lucide-react"; import { Helmet } from "react-helmet"; import API from "./api"; const PaymentSuccess = () => { const [searchParams] = useSearchParams(); const navigate = useNavigate(); const [loading, setLoading] = useState(true); const [booking, setBooking] = useState(null); const [error, setError] = useState(""); useEffect(() => { const verifyPayment = async () => { try { const paymentIntentId = searchParams.get("payment_intent"); const paymentIntentClientSecret = searchParams.get( "payment_intent_client_secret" ); if (!paymentIntentId) { setError("Payment verification failed - missing payment intent"); return; } // Verify payment with backend const response = await API.post("/payments/verify", { paymentIntentId, paymentIntentClientSecret, }); if (response.data.success) { setBooking(response.data.booking); } else { setError("Payment verification failed"); } } catch (err) { console.error("Payment verification error:", err); setError("Failed to verify payment"); } finally { setLoading(false); } }; verifyPayment(); }, [searchParams]); const downloadReceipt = async () => { try { const response = await API.get(`/bookings/${booking._id}/receipt`, { responseType: "blob", }); const url = window.URL.createObjectURL(new Blob([response.data])); const link = document.createElement("a"); link.href = url; link.setAttribute("download", `receipt-${booking._id}.pdf`); document.body.appendChild(link); link.click(); link.remove(); } catch (err) { console.error("Failed to download receipt:", err); } }; if (loading) { return ( <> <Helmet> <title>Verifying Payment - BorrowMyCar</title> </Helmet> <div className="min-h-screen flex items-center justify-center"> <div className="text-center"> <div className="animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"></div> <p className="text-gray-600">Verifying your payment...</p> </div> </div> </> ); } if (error) { return ( <> <Helmet> <title>Payment Error - BorrowMyCar</title> </Helmet> <div className="min-h-screen flex items-center justify-center"> <div className="max-w-md mx-auto bg-white rounded-xl shadow-sm border border-red-200 p-8 text-center"> <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"> <span className="text-red-600 text-2xl">❌</span> </div> <h2 className="text-xl font-semibold text-gray-900 mb-2"> Payment Verification Failed </h2> <p className="text-gray-600 mb-6">{error}</p> <div className="space-y-3"> <Link to="/my-bookings" className="block w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors" > Check My Bookings </Link> <Link to="/browse" className="block w-full border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors" > Continue Browsing </Link> </div> </div> </div> </> ); } return ( <> <Helmet> <title>Payment Successful - BorrowMyCar</title> </Helmet> <div className="min-h-screen bg-gray-50 py-12"> <div className="max-w-3xl mx-auto px-4"> {/* Success Header */} <div className="text-center mb-8"> <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6"> <CheckCircle className="w-10 h-10 text-green-600" /> </div> <h1 className="text-3xl font-bold text-gray-900 mb-2"> Payment Successful! </h1> <p className="text-lg text-gray-600"> Your car booking has been confirmed </p> </div> {booking && ( <> {/* Booking Details Card */} <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden mb-8"> <div className="bg-green-50 px-6 py-4 border-b border-green-100"> <h2 className="text-lg font-semibold text-green-900"> Booking Confirmation </h2> <p className="text-sm text-green-700"> Booking ID: #{booking._id} </p> </div> <div className="p-6"> {/* Car Information */} <div className="flex items-start space-x-4 mb-6"> <img src={booking.car?.images?.[0] || "/placeholder-car.jpg"} alt={booking.car?.title} className="w-24 h-18 object-cover rounded-lg" /> <div className="flex-1"> <h3 className="text-xl font-semibold text-gray-900 mb-1"> {booking.car?.title} </h3> <p className="text-gray-600 mb-2">{booking.car?.city}</p> <div className="flex items-center text-sm text-gray-500"> <Car className="w-4 h-4 mr-1" /> <span>{booking.car?.transmission || "Automatic"}</span> <span className="mx-2">•</span> <span>{booking.car?.fuelType || "Petrol"}</span> </div> </div> </div> {/* Booking Details Grid */} <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"> <div className="space-y-4"> <div> <h4 className="font-medium text-gray-900 mb-2"> Rental Period </h4> <div className="space-y-2 text-sm"> <div className="flex items-center"> <Calendar className="w-4 h-4 mr-2 text-gray-400" /> <span className="text-gray-600">Start:</span> <span className="ml-2 font-medium"> {new Date(booking.startDate).toLocaleDateString( "en-US", { weekday: "long", year: "numeric", month: "long", day: "numeric", } )} </span> </div> <div className="flex items-center"> <Calendar className="w-4 h-4 mr-2 text-gray-400" /> <span className="text-gray-600">End:</span> <span className="ml-2 font-medium"> {new Date(booking.endDate).toLocaleDateString( "en-US", { weekday: "long", year: "numeric", month: "long", day: "numeric", } )} </span> </div> <div className="flex items-center"> <span className="text-gray-600">Duration:</span> <span className="ml-2 font-medium"> {booking.numberOfDays} day {booking.numberOfDays > 1 ? "s" : ""} </span> </div> </div> </div> </div> <div className="space-y-4"> <div> <h4 className="font-medium text-gray-900 mb-2"> Payment Summary </h4> <div className="bg-gray-50 rounded-lg p-4 space-y-2"> <div className="flex justify-between text-sm"> <span>Daily Rate</span> <span> AED{" "} {booking.car?.pricePerDay || booking.car?.price} </span> </div> <div className="flex justify-between text-sm"> <span>Duration</span> <span> {booking.numberOfDays} day {booking.numberOfDays > 1 ? "s" : ""} </span> </div> <div className="border-t border-gray-200 pt-2"> <div className="flex justify-between font-semibold"> <span>Total Paid</span> <span className="text-green-600"> AED {booking.totalCost} </span> </div> </div> </div> </div> </div> </div> {/* Contact Information */} <div className="bg-blue-50 rounded-lg p-4"> <h4 className="font-medium text-blue-900 mb-2"> Next Steps </h4> <ul className="text-sm text-blue-800 space-y-1"> <li> • You'll receive a confirmation email with pickup instructions </li> <li>• The car owner will contact you within 24 hours</li> <li>• Bring your driving license and ID for pickup</li> <li>• Contact support if you have any questions</li> </ul> </div> {/* Owner Contact Info (if available) */} {booking.owner && ( <div className="mt-6 bg-yellow-50 rounded-lg p-4"> <h4 className="font-medium text-yellow-900 mb-2"> Car Owner Contact </h4> <div className="space-y-2 text-sm"> <div className="flex items-center text-yellow-800"> <span className="font-medium">Name:</span> <span className="ml-2">{booking.owner.name}</span> </div> {booking.owner.phone && ( <div className="flex items-center text-yellow-800"> <Phone className="w-4 h-4 mr-1" /> <span>{booking.owner.phone}</span> </div> )} {booking.owner.email && ( <div className="flex items-center text-yellow-800"> <Mail className="w-4 h-4 mr-1" /> <span>{booking.owner.email}</span> </div> )} </div> </div> )} </div> </div> {/* Action Buttons */} <div className="space-y-4"> <div className="grid grid-cols-1 md:grid-cols-3 gap-4"> <button onClick={downloadReceipt} className="flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors" > <Download className="w-4 h-4 mr-2" /> Download Receipt </button> <Link to="/my-bookings" className="flex items-center justify-center px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors" > View My Bookings <ArrowRight className="w-4 h-4 ml-2" /> </Link> <Link to="/browse" className="flex items-center justify-center px-4 py-3 border border-green-600 text-green-600 rounded-lg hover:bg-green-50 transition-colors" > Book Another Car </Link> </div> </div> </> )} {/* Support Section */} <div className="mt-12 text-center"> <h3 className="text-lg font-medium text-gray-900 mb-2"> Need Help? </h3> <p className="text-gray-600 mb-4"> Our support team is available 24/7 to assist you </p> <div className="flex flex-col sm:flex-row gap-4 justify-center"> <a href="tel:+971800266669" className="inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors" > <Phone className="w-4 h-4 mr-2" /> Call Support </a> <a href="mailto:support@borrowmycar.ae" className="inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors" > <Mail className="w-4 h-4 mr-2" /> Email Support </a> <Link to="/help" className="inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors" > <MessageCircle className="w-4 h-4 mr-2" /> Help Center </Link> </div> </div> {/* Important Notes */} <div className="mt-8 bg-gray-100 rounded-lg p-6"> <h4 className="font-medium text-gray-900 mb-3"> Important Reminders </h4> <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700"> <div> <h5 className="font-medium mb-2">For Pickup:</h5> <ul className="space-y-1"> <li>• Valid UAE driving license</li> <li>• Emirates ID or passport</li> <li>• Copy of this booking confirmation</li> <li>• Arrive on time for pickup</li> </ul> </div> <div> <h5 className="font-medium mb-2">During Rental:</h5> <ul className="space-y-1"> <li>• Follow traffic rules and regulations</li> <li>• Keep fuel level as agreed</li> <li>• Report any issues immediately</li> <li>• Return on time to avoid penalties</li> </ul> </div> </div> </div> {/* Rating Prompt */} <div className="mt-8 bg-green-50 rounded-lg p-6 text-center"> <h4 className="font-medium text-green-900 mb-2"> 🌟 Help Others Choose the Right Car </h4> <p className="text-green-800 text-sm mb-4"> After your rental, please take a moment to rate your experience and help other renters make informed decisions. </p> <Link to="/rate-experience" className="inline-flex items-center bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors text-sm" > Rate Experience Later </Link> </div> </div> </div> </> ); }; export default PaymentSuccess;
```

# borrowmycarfrontend\src\Profile.jsx

```jsx
// src/Profile.jsx - User Profile Page import { useState, useEffect } from "react"; import { useNavigate, Link } from "react-router-dom"; import { Helmet } from "react-helmet"; import { User, Mail, Phone, MapPin, Calendar, Shield, Settings, Edit3, Car, Star, Clock, } from "lucide-react"; import API from "./api"; import ProfilePictureManager from "./components/ProfilePictureManager"; const Profile = () => { const [user, setUser] = useState(null); const [loading, setLoading] = useState(true); const [error, setError] = useState(""); const [message, setMessage] = useState({ type: "", text: "" }); const navigate = useNavigate(); useEffect(() => { fetchUserProfile(); }, []); const fetchUserProfile = async () => { try { const response = await API.get("/auth/profile"); setUser(response.data.data.user); } catch (err) { if (err.response?.status === 401) { navigate("/login"); } else { setError("Failed to load profile"); } } finally { setLoading(false); } }; const handleProfilePictureUpdate = (updatedUser) => { setUser(updatedUser); setMessage({ type: "success", text: "Profile picture updated successfully", }); setTimeout(() => setMessage({ type: "", text: "" }), 3000); }; const handleProfilePictureError = (error) => { setMessage({ type: "error", text: error }); setTimeout(() => setMessage({ type: "", text: "" }), 5000); }; if (loading) { return ( <div className="max-w-4xl mx-auto p-6"> <div className="animate-pulse"> <div className="flex items-center space-x-6 mb-8"> <div className="w-32 h-32 bg-gray-200 rounded-full"></div> <div className="space-y-3"> <div className="h-8 bg-gray-200 rounded w-48"></div> <div className="h-4 bg-gray-200 rounded w-32"></div> <div className="h-4 bg-gray-200 rounded w-40"></div> </div> </div> <div className="space-y-4"> <div className="h-4 bg-gray-200 rounded w-3/4"></div> <div className="h-4 bg-gray-200 rounded w-1/2"></div> <div className="h-4 bg-gray-200 rounded w-2/3"></div> </div> </div> </div> ); } if (error) { return ( <div className="max-w-4xl mx-auto p-6"> <div className="bg-red-50 border border-red-200 rounded-lg p-6 text-center"> <div className="text-red-600 text-lg font-medium mb-2">{error}</div> <button onClick={() => navigate("/")} className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors" > Go to Home </button> </div> </div> ); } return ( <> <Helmet> <title>{user?.name} - Profile | BorrowMyCar</title> </Helmet> <div className="max-w-4xl mx-auto p-6"> {/* Message Display */} {message.text && ( <div className={`mb-6 p-4 rounded-lg flex items-center ${ message.type === "error" ? "bg-red-50 border border-red-200 text-red-700" : "bg-green-50 border border-green-200 text-green-700" }`} > {message.text} </div> )} {/* Profile Header */} <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"> {/* Cover Background */} <div className="h-32 bg-gradient-to-r from-green-400 to-emerald-500"></div> {/* Profile Content */} <div className="relative px-6 pb-6"> {/* Profile Picture */} <div className="absolute -top-16 left-6"> <ProfilePictureManager user={user} onUpdateSuccess={handleProfilePictureUpdate} onError={handleProfilePictureError} size="xl" /> </div> {/* Actions */} <div className="flex justify-end pt-4"> <Link to="/settings" className="inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition-colors" > <Settings className="w-4 h-4 mr-2" /> Edit Profile </Link> </div> {/* User Info */} <div className="mt-12 space-y-4"> <div> <h1 className="text-3xl font-bold text-gray-900"> {user.name} </h1> <div className="flex items-center space-x-4 mt-2"> <span className="text-gray-600 capitalize text-lg"> {user.role} </span> <div className="flex items-center space-x-2"> <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${ user.isApproved ? "bg-green-100 text-green-800" : "bg-yellow-100 text-yellow-800" }`} > <Shield className="w-3 h-3 mr-1" /> {user.isApproved ? "Verified Account" : "Pending Verification"} </span> </div> </div> </div> {/* Contact Information */} <div className="grid grid-cols-1 md:grid-cols-2 gap-6"> <div className="space-y-4"> <h3 className="text-lg font-semibold text-gray-900"> Contact Information </h3> <div className="space-y-3"> <div className="flex items-center text-gray-600"> <Mail className="w-5 h-5 mr-3 text-gray-400" /> <span>{user.email}</span> </div> <div className="flex items-center text-gray-600"> <Phone className="w-5 h-5 mr-3 text-gray-400" /> <span>{user.phone}</span> </div> {user.preferredCity && ( <div className="flex items-center text-gray-600"> <MapPin className="w-5 h-5 mr-3 text-gray-400" /> <span>{user.preferredCity}, UAE</span> </div> )} </div> </div> <div className="space-y-4"> <h3 className="text-lg font-semibold text-gray-900"> Account Details </h3> <div className="space-y-3"> <div className="flex items-center text-gray-600"> <Calendar className="w-5 h-5 mr-3 text-gray-400" /> <span> Joined{" "} {new Date(user.createdAt).toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric", })} </span> </div> {user.lastLoginAt && ( <div className="flex items-center text-gray-600"> <Clock className="w-5 h-5 mr-3 text-gray-400" /> <span> Last active{" "} {new Date(user.lastLoginAt).toLocaleDateString( "en-US", { year: "numeric", month: "short", day: "numeric", } )} </span> </div> )} </div> </div> </div> </div> </div> </div> {/* Quick Actions */} <div className="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6"> {/* My Bookings */} <Link to="/my-bookings" className="bg-white border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow" > <div className="flex items-center"> <div className="flex-shrink-0"> <Calendar className="w-8 h-8 text-blue-600" /> </div> <div className="ml-4"> <h3 className="text-lg font-medium text-gray-900"> My Bookings </h3> <p className="text-sm text-gray-600"> View and manage your car rentals </p> </div> </div> </Link> {/* Browse Cars or My Cars */} <Link to={user.role === "owner" ? "/my-cars" : "/browse"} className="bg-white border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow" > <div className="flex items-center"> <div className="flex-shrink-0"> <Car className="w-8 h-8 text-green-600" /> </div> <div className="ml-4"> <h3 className="text-lg font-medium text-gray-900"> {user.role === "owner" ? "My Cars" : "Browse Cars"} </h3> <p className="text-sm text-gray-600"> {user.role === "owner" ? "Manage your car listings" : "Find cars to rent"} </p> </div> </div> </Link> {/* Settings */} <Link to="/settings" className="bg-white border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow" > <div className="flex items-center"> <div className="flex-shrink-0"> <Settings className="w-8 h-8 text-gray-600" /> </div> <div className="ml-4"> <h3 className="text-lg font-medium text-gray-900">Settings</h3> <p className="text-sm text-gray-600"> Manage your account preferences </p> </div> </div> </Link> </div> {/* Additional Information */} {user.role === "owner" && ( <div className="mt-8 bg-white border border-gray-200 rounded-xl p-6"> <h3 className="text-lg font-semibold text-gray-900 mb-4"> Car Owner Information </h3> <div className="grid grid-cols-1 md:grid-cols-3 gap-6"> <div className="text-center"> <div className="text-2xl font-bold text-gray-900">0</div> <div className="text-sm text-gray-600">Active Listings</div> </div> <div className="text-center"> <div className="text-2xl font-bold text-gray-900">0</div> <div className="text-sm text-gray-600">Total Bookings</div> </div> <div className="text-center"> <div className="flex items-center justify-center"> <Star className="w-5 h-5 text-yellow-400 mr-1" /> <span className="text-2xl font-bold text-gray-900">5.0</span> </div> <div className="text-sm text-gray-600">Average Rating</div> </div> </div> <div className="mt-6 pt-6 border-t border-gray-200"> <Link to="/list-car" className="w-full bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors text-center block" > List a New Car </Link> </div> </div> )} {/* Security Notice */} {!user.isApproved && ( <div className="mt-8 bg-yellow-50 border border-yellow-200 rounded-xl p-6"> <div className="flex items-start"> <Shield className="w-6 h-6 text-yellow-600 mt-1 mr-3" /> <div> <h3 className="font-medium text-yellow-800 mb-2"> Account Verification Pending </h3> <p className="text-yellow-700 text-sm"> Your account is currently under review. Once approved, you'll have full access to all features. This process typically takes 24-48 hours. </p> </div> </div> </div> )} </div> </> ); }; export default Profile;
```

# borrowmycarfrontend\src\SeedData.jsx

```jsx
import mongoose from "mongoose"; import bcrypt from "bcryptjs"; import { User } from "../models/User.js"; import Car from "../models/Car.js"; import dotenv from "dotenv"; dotenv.config(); const seedDatabase = async () => { try { await mongoose.connect(process.env.MONGO_URI); // Clear existing data await User.deleteMany({}); await Car.deleteMany({}); // Create test users const testOwner = await User.create({ name: "Ahmed Al-Mansouri", email: "ahmed@test.com", phone: "+971501234567", password: "password123", role: "owner", isApproved: true, preferredCity: "Dubai", drivingLicenseUrl: "https://via.placeholder.com/400x300", }); const testRenter = await User.create({ name: "Sarah Johnson", email: "sarah@test.com", phone: "+971509876543", password: "password123", role: "renter", isApproved: true, preferredCity: "Dubai", drivingLicenseUrl: "https://via.placeholder.com/400x300", }); // Create test cars await Car.create({ owner: testOwner._id, title: "Toyota Camry 2023 - Luxury Sedan", description: "Premium Toyota Camry with leather seats, GPS navigation, and excellent fuel economy.", city: "Dubai", price: 180, availabilityFrom: new Date(), availabilityTo: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000), make: "Toyota", model: "Camry", year: 2023, color: "Pearl White", plateNumber: "A12345", transmission: "Automatic", fuelType: "Petrol", mileage: 15000, seatingCapacity: 5, specifications: "GCC Specs", features: [ "GPS Navigation", "Bluetooth", "Leather Seats", "Backup Camera", ], images: [ "https://via.placeholder.com/800x600/2563eb/ffffff?text=Toyota+Camry+1", "https://via.placeholder.com/800x600/1d4ed8/ffffff?text=Toyota+Camry+2", "https://via.placeholder.com/800x600/1e40af/ffffff?text=Toyota+Camry+3", ], status: "active", }); console.log("✅ Database seeded successfully"); process.exit(0); } catch (error) { console.error("❌ Error seeding database:", error); process.exit(1); } }; seedDatabase();
```

# borrowmycarfrontend\src\Settings.jsx

```jsx
// src/Settings.jsx - Enhanced with Profile Picture Management import { useState, useEffect } from "react"; import { useNavigate } from "react-router-dom"; import { Helmet } from "react-helmet"; import { Shield, Bell, Eye, EyeOff, Lock, Mail, Phone, Trash2, Save, AlertCircle, CheckCircle, Key, Database, Download, UserX, User, Edit3, } from "lucide-react"; import API from "./api"; import ProfilePictureManager from "./components/ProfilePictureManager"; const Settings = () => { const [user, setUser] = useState(null); const [loading, setLoading] = useState(true); const [activeTab, setActiveTab] = useState("profile"); const [updateLoading, setUpdateLoading] = useState(false); const [message, setMessage] = useState({ type: "", text: "" }); // Profile form state const [profileForm, setProfileForm] = useState({ name: "", preferredCity: "", }); // Security settings const [passwordForm, setPasswordForm] = useState({ currentPassword: "", newPassword: "", confirmPassword: "", }); const [showPasswords, setShowPasswords] = useState({ current: false, new: false, confirm: false, }); // Notification settings const [notifications, setNotifications] = useState({ emailBookings: true, emailPromotions: false, smsBookings: true, smsReminders: true, pushNotifications: true, }); // Privacy settings const [privacy, setPrivacy] = useState({ profileVisibility: "public", showPhone: false, showEmail: false, allowMessages: true, }); const navigate = useNavigate(); useEffect(() => { fetchUserData(); }, []); const fetchUserData = async () => { try { const response = await API.get("/auth/profile"); const userData = response.data.data.user; setUser(userData); // Initialize profile form setProfileForm({ name: userData.name || "", preferredCity: userData.preferredCity || "", }); // Load user preferences (mock data for now) // In real app, these would come from the API } catch (err) { if (err.response?.status === 401) { navigate("/login"); } else { setMessage({ type: "error", text: "Failed to load user data", }); } } finally { setLoading(false); } }; const showMessage = (type, text) => { setMessage({ type, text }); setTimeout(() => setMessage({ type: "", text: "" }), 5000); }; const handleProfileUpdate = async (e) => { e.preventDefault(); setUpdateLoading(true); try { const response = await API.patch("/auth/profile", profileForm); if (response.data.success) { setUser(response.data.data.user); showMessage("success", "Profile updated successfully"); } } catch (err) { showMessage( "error", err.response?.data?.message || "Failed to update profile" ); } finally { setUpdateLoading(false); } }; const handleProfilePictureUpdate = (updatedUser) => { setUser(updatedUser); showMessage("success", "Profile picture updated successfully"); }; const handleProfilePictureError = (error) => { showMessage("error", error); }; const handlePasswordUpdate = async (e) => { e.preventDefault(); if (passwordForm.newPassword !== passwordForm.confirmPassword) { showMessage("error", "New passwords do not match"); return; } if (passwordForm.newPassword.length < 6) { showMessage("error", "Password must be at least 6 characters long"); return; } setUpdateLoading(true); try { await API.patch("/auth/change-password", { currentPassword: passwordForm.currentPassword, newPassword: passwordForm.newPassword, }); setPasswordForm({ currentPassword: "", newPassword: "", confirmPassword: "", }); showMessage("success", "Password updated successfully"); } catch (err) { showMessage( "error", err.response?.data?.message || "Failed to update password" ); } finally { setUpdateLoading(false); } }; const handleNotificationUpdate = async () => { setUpdateLoading(true); try { await API.patch("/auth/preferences", { notifications }); showMessage("success", "Notification preferences updated"); } catch (err) { showMessage("error", "Failed to update notification preferences"); } finally { setUpdateLoading(false); } }; const handlePrivacyUpdate = async () => { setUpdateLoading(true); try { await API.patch("/auth/preferences", { privacy }); showMessage("success", "Privacy settings updated"); } catch (err) { showMessage("error", "Failed to update privacy settings"); } finally { setUpdateLoading(false); } }; const handleDataExport = async () => { setUpdateLoading(true); try { const response = await API.get("/auth/export-data", { responseType: "blob", }); const url = window.URL.createObjectURL(new Blob([response.data])); const link = document.createElement("a"); link.href = url; link.setAttribute("download", "borrowmycar-data.json"); document.body.appendChild(link); link.click(); link.remove(); showMessage( "success", "Data export started. Download will begin shortly." ); } catch (err) { showMessage("error", "Failed to export data"); } finally { setUpdateLoading(false); } }; const handleAccountDeletion = async () => { const confirmDelete = window.confirm( "Are you sure you want to delete your account? This action cannot be undone." ); if (!confirmDelete) return; const finalConfirm = window.confirm( "This will permanently delete all your data, bookings, and car listings. Type 'DELETE' to confirm." ); if (!finalConfirm) return; setUpdateLoading(true); try { await API.delete("/auth/account"); localStorage.removeItem("token"); localStorage.removeItem("user"); navigate("/", { replace: true }); } catch (err) { showMessage("error", "Failed to delete account"); } finally { setUpdateLoading(false); } }; const tabs = [ { id: "profile", label: "Profile", icon: User }, { id: "security", label: "Security", icon: Shield }, { id: "notifications", label: "Notifications", icon: Bell }, { id: "privacy", label: "Privacy", icon: Eye }, { id: "data", label: "Data & Account", icon: Database }, ]; if (loading) { return ( <div className="max-w-4xl mx-auto p-6"> <div className="animate-pulse"> <div className="h-8 bg-gray-200 rounded w-1/4 mb-6"></div> <div className="bg-white rounded-xl shadow-sm p-6"> <div className="space-y-4"> <div className="h-4 bg-gray-200 rounded w-3/4"></div> <div className="h-4 bg-gray-200 rounded w-1/2"></div> <div className="h-4 bg-gray-200 rounded w-2/3"></div> </div> </div> </div> </div> ); } return ( <> <Helmet> <title>Account Settings - BorrowMyCar</title> </Helmet> <div className="max-w-4xl mx-auto p-6"> {/* Header */} <div className="mb-6"> <h1 className="text-3xl font-bold text-gray-900">Account Settings</h1> <p className="text-gray-600 mt-2"> Manage your account preferences and security settings </p> </div> {/* Message Display */} {message.text && ( <div className={`mb-6 p-4 rounded-lg flex items-center ${ message.type === "error" ? "bg-red-50 border border-red-200 text-red-700" : "bg-green-50 border border-green-200 text-green-700" }`} > {message.type === "error" ? ( <AlertCircle className="w-5 h-5 mr-2" /> ) : ( <CheckCircle className="w-5 h-5 mr-2" /> )} {message.text} </div> )} <div className="bg-white rounded-xl shadow-sm"> {/* Tab Navigation */} <div className="border-b border-gray-200"> <nav className="flex space-x-8 px-6"> {tabs.map((tab) => ( <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex items-center py-4 px-1 border-b-2 font-medium text-sm transition-colors ${ activeTab === tab.id ? "border-green-500 text-green-600" : "border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" }`} > <tab.icon className="w-4 h-4 mr-2" /> {tab.label} </button> ))} </nav> </div> {/* Tab Content */} <div className="p-6"> {/* Profile Tab */} {activeTab === "profile" && ( <div className="space-y-6"> <div> <h2 className="text-xl font-semibold text-gray-900 mb-4"> Profile Information </h2> <div className="flex flex-col lg:flex-row lg:items-start lg:space-x-8 space-y-6 lg:space-y-0"> {/* Profile Picture Section */} <div className="flex flex-col items-center space-y-4"> <ProfilePictureManager user={user} onUpdateSuccess={handleProfilePictureUpdate} onError={handleProfilePictureError} size="xl" /> <div className="text-center"> <h3 className="font-medium text-gray-900"> {user.name} </h3> <p className="text-sm text-gray-500 capitalize"> {user.role} </p> <div className="flex items-center justify-center mt-2"> <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${ user.isApproved ? "bg-green-100 text-green-800" : "bg-yellow-100 text-yellow-800" }`} > {user.isApproved ? "Verified" : "Pending"} </span> </div> </div> </div> {/* Profile Form */} <div className="flex-1"> <form onSubmit={handleProfileUpdate} className="space-y-4" > <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Full Name </label> <input type="text" value={profileForm.name} onChange={(e) => setProfileForm({ ...profileForm, name: e.target.value, }) } className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required /> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Email Address </label> <input type="email" value={user.email} disabled className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500 cursor-not-allowed" /> <p className="text-xs text-gray-500 mt-1"> Email cannot be changed for security reasons </p> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Phone Number </label> <input type="text" value={user.phone} disabled className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500 cursor-not-allowed" /> <p className="text-xs text-gray-500 mt-1"> Phone number cannot be changed for security reasons </p> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Preferred City </label> <select value={profileForm.preferredCity} onChange={(e) => setProfileForm({ ...profileForm, preferredCity: e.target.value, }) } className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" > <option value="">Select a city</option> {[ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", ].map((city) => ( <option key={city} value={city}> {city} </option> ))} </select> </div> <button type="submit" disabled={updateLoading} className="flex items-center bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white px-6 py-2 rounded-lg transition-colors" > {updateLoading ? ( <> <div className="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div> Updating... </> ) : ( <> <Save className="w-4 h-4 mr-2" /> Update Profile </> )} </button> </form> </div> </div> </div> </div> )} {/* Security Tab */} {activeTab === "security" && ( <div className="space-y-6"> <div> <h2 className="text-xl font-semibold text-gray-900 mb-4"> Password & Security </h2> <form onSubmit={handlePasswordUpdate} className="space-y-4"> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Current Password </label> <div className="relative"> <input type={showPasswords.current ? "text" : "password"} value={passwordForm.currentPassword} onChange={(e) => setPasswordForm({ ...passwordForm, currentPassword: e.target.value, }) } className="w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required /> <button type="button" onClick={() => setShowPasswords({ ...showPasswords, current: !showPasswords.current, }) } className="absolute inset-y-0 right-0 pr-3 flex items-center" > {showPasswords.current ? ( <EyeOff className="w-5 h-5 text-gray-400" /> ) : ( <Eye className="w-5 h-5 text-gray-400" /> )} </button> </div> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> New Password </label> <div className="relative"> <input type={showPasswords.new ? "text" : "password"} value={passwordForm.newPassword} onChange={(e) => setPasswordForm({ ...passwordForm, newPassword: e.target.value, }) } className="w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required minLength={6} /> <button type="button" onClick={() => setShowPasswords({ ...showPasswords, new: !showPasswords.new, }) } className="absolute inset-y-0 right-0 pr-3 flex items-center" > {showPasswords.new ? ( <EyeOff className="w-5 h-5 text-gray-400" /> ) : ( <Eye className="w-5 h-5 text-gray-400" /> )} </button> </div> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Confirm New Password </label> <div className="relative"> <input type={showPasswords.confirm ? "text" : "password"} value={passwordForm.confirmPassword} onChange={(e) => setPasswordForm({ ...passwordForm, confirmPassword: e.target.value, }) } className="w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required /> <button type="button" onClick={() => setShowPasswords({ ...showPasswords, confirm: !showPasswords.confirm, }) } className="absolute inset-y-0 right-0 pr-3 flex items-center" > {showPasswords.confirm ? ( <EyeOff className="w-5 h-5 text-gray-400" /> ) : ( <Eye className="w-5 h-5 text-gray-400" /> )} </button> </div> </div> <button type="submit" disabled={updateLoading} className="flex items-center bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white px-6 py-2 rounded-lg transition-colors" > {updateLoading ? ( <> <div className="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div> Updating... </> ) : ( <> <Lock className="w-4 h-4 mr-2" /> Update Password </> )} </button> </form> </div> {/* Two-Factor Authentication */} <div className="border-t pt-6"> <h3 className="text-lg font-medium text-gray-900 mb-4"> Two-Factor Authentication </h3> <div className="bg-gray-50 p-4 rounded-lg"> <div className="flex items-center justify-between"> <div> <p className="font-medium text-gray-900"> SMS Authentication </p> <p className="text-sm text-gray-600"> Add an extra layer of security to your account </p> </div> <button className="bg-gray-200 text-gray-600 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors"> Enable </button> </div> </div> </div> </div> )} {/* Notifications Tab */} {activeTab === "notifications" && ( <div className="space-y-6"> <div> <h2 className="text-xl font-semibold text-gray-900 mb-4"> Notification Preferences </h2> <div className="space-y-4"> {/* Email Notifications */} <div> <h3 className="text-lg font-medium text-gray-900 mb-3"> Email Notifications </h3> <div className="space-y-3"> <div className="flex items-center justify-between"> <div> <p className="font-medium text-gray-900"> Booking Updates </p> <p className="text-sm text-gray-600"> Get notified about booking confirmations, cancellations, and changes </p> </div> <label className="relative inline-flex items-center cursor-pointer"> <input type="checkbox" checked={notifications.emailBookings} onChange={(e) => setNotifications({ ...notifications, emailBookings: e.target.checked, }) } className="sr-only peer" /> <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div> </label> </div> <div className="flex items-center justify-between"> <div> <p className="font-medium text-gray-900"> Promotions & Offers </p> <p className="text-sm text-gray-600"> Receive emails about special deals and promotions </p> </div> <label className="relative inline-flex items-center cursor-pointer"> <input type="checkbox" checked={notifications.emailPromotions} onChange={(e) => setNotifications({ ...notifications, emailPromotions: e.target.checked, }) } className="sr-only peer" /> <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div> </label> </div> </div> </div> {/* SMS Notifications */} <div className="border-t pt-4"> <h3 className="text-lg font-medium text-gray-900 mb-3"> SMS Notifications </h3> <div className="space-y-3"> <div className="flex items-center justify-between"> <div> <p className="font-medium text-gray-900"> Booking Alerts </p> <p className="text-sm text-gray-600"> Important booking updates via SMS </p> </div> <label className="relative inline-flex items-center cursor-pointer"> <input type="checkbox" checked={notifications.smsBookings} onChange={(e) => setNotifications({ ...notifications, smsBookings: e.target.checked, }) } className="sr-only peer" /> <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div> </label> </div> <div className="flex items-center justify-between"> <div> <p className="font-medium text-gray-900"> Pickup Reminders </p> <p className="text-sm text-gray-600"> Reminders about upcoming car pickups </p> </div> <label className="relative inline-flex items-center cursor-pointer"> <input type="checkbox" checked={notifications.smsReminders} onChange={(e) => setNotifications({ ...notifications, smsReminders: e.target.checked, }) } className="sr-only peer" /> <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div> </label> </div> </div> </div> <div className="pt-4"> <button onClick={handleNotificationUpdate} disabled={updateLoading} className="flex items-center bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white px-6 py-2 rounded-lg transition-colors" > {updateLoading ? ( <> <div className="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div> Saving... </> ) : ( <> <Save className="w-4 h-4 mr-2" /> Save Preferences </> )} </button> </div> </div> </div> </div> )} {/* Privacy Tab */} {activeTab === "privacy" && ( <div className="space-y-6"> <div> <h2 className="text-xl font-semibold text-gray-900 mb-4"> Privacy Settings </h2> <div className="space-y-4"> <div> <h3 className="text-lg font-medium text-gray-900 mb-3"> Profile Visibility </h3> <div className="space-y-3"> <div className="flex items-center"> <input type="radio" id="public" name="profileVisibility" value="public" checked={privacy.profileVisibility === "public"} onChange={(e) => setPrivacy({ ...privacy, profileVisibility: e.target.value, }) } className="w-4 h-4 text-green-600 border-gray-300 focus:ring-green-500" /> <label htmlFor="public" className="ml-3"> <span className="font-medium text-gray-900"> Public </span> <p className="text-sm text-gray-600"> Your profile is visible to all users </p> </label> </div> <div className="flex items-center"> <input type="radio" id="private" name="profileVisibility" value="private" checked={privacy.profileVisibility === "private"} onChange={(e) => setPrivacy({ ...privacy, profileVisibility: e.target.value, }) } className="w-4 h-4 text-green-600 border-gray-300 focus:ring-green-500" /> <label htmlFor="private" className="ml-3"> <span className="font-medium text-gray-900"> Private </span> <p className="text-sm text-gray-600"> Only you can see your full profile details </p> </label> </div> </div> </div> <div className="border-t pt-4"> <h3 className="text-lg font-medium text-gray-900 mb-3"> Contact Information </h3> <div className="space-y-3"> <div className="flex items-center justify-between"> <div> <p className="font-medium text-gray-900"> Show Phone Number </p> <p className="text-sm text-gray-600"> Allow other users to see your phone number </p> </div> <label className="relative inline-flex items-center cursor-pointer"> <input type="checkbox" checked={privacy.showPhone} onChange={(e) => setPrivacy({ ...privacy, showPhone: e.target.checked, }) } className="sr-only peer" /> <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div> </label> </div> <div className="flex items-center justify-between"> <div> <p className="font-medium text-gray-900"> Show Email Address </p> <p className="text-sm text-gray-600"> Allow other users to see your email address </p> </div> <label className="relative inline-flex items-center cursor-pointer"> <input type="checkbox" checked={privacy.showEmail} onChange={(e) => setPrivacy({ ...privacy, showEmail: e.target.checked, }) } className="sr-only peer" /> <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div> </label> </div> <div className="flex items-center justify-between"> <div> <p className="font-medium text-gray-900"> Allow Messages </p> <p className="text-sm text-gray-600"> Let other users send you messages through the platform </p> </div> <label className="relative inline-flex items-center cursor-pointer"> <input type="checkbox" checked={privacy.allowMessages} onChange={(e) => setPrivacy({ ...privacy, allowMessages: e.target.checked, }) } className="sr-only peer" /> <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div> </label> </div> </div> </div> <div className="pt-4"> <button onClick={handlePrivacyUpdate} disabled={updateLoading} className="flex items-center bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white px-6 py-2 rounded-lg transition-colors" > {updateLoading ? ( <> <div className="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div> Saving... </> ) : ( <> <Save className="w-4 h-4 mr-2" /> Save Settings </> )} </button> </div> </div> </div> </div> )} {/* Data & Account Tab */} {activeTab === "data" && ( <div className="space-y-6"> <div> <h2 className="text-xl font-semibold text-gray-900 mb-4"> Data & Account Management </h2> <div className="space-y-6"> {/* Data Export */} <div className="bg-blue-50 p-4 rounded-lg"> <div className="flex items-start"> <Download className="w-6 h-6 text-blue-600 mt-1 mr-3" /> <div className="flex-1"> <h3 className="font-medium text-blue-900 mb-2"> Export Your Data </h3> <p className="text-blue-800 mb-4"> Download a copy of all your personal data, including profile information, bookings, and car listings. </p> <button onClick={handleDataExport} disabled={updateLoading} className="bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-4 py-2 rounded-lg transition-colors" > {updateLoading ? "Preparing..." : "Download Data"} </button> </div> </div> </div> {/* Account Deletion */} <div className="bg-red-50 p-4 rounded-lg"> <div className="flex items-start"> <UserX className="w-6 h-6 text-red-600 mt-1 mr-3" /> <div className="flex-1"> <h3 className="font-medium text-red-900 mb-2"> Delete Account </h3> <p className="text-red-800 mb-4"> Permanently delete your account and all associated data. This action cannot be undone. </p> <div className="space-y-2 text-sm text-red-700 mb-4"> <p>• All your bookings will be cancelled</p> <p>• Your car listings will be removed</p> <p> • Your profile and data will be permanently deleted </p> <p> • You will lose access to all account features </p> </div> <button onClick={handleAccountDeletion} disabled={updateLoading} className="bg-red-600 hover:bg-red-700 disabled:bg-red-400 text-white px-4 py-2 rounded-lg transition-colors flex items-center" > <Trash2 className="w-4 h-4 mr-2" /> {updateLoading ? "Deleting..." : "Delete Account"} </button> </div> </div> </div> </div> </div> </div> )} </div> </div> </div> </> ); }; export default Settings;
```

# borrowmycarfrontend\src\Signup.jsx

```jsx
// src/Signup.jsx - Updated with UAE Phone Input import { useState, useEffect } from "react"; import { Link, useNavigate } from "react-router-dom"; import API from "./api"; import PhoneInput from "./components/PhoneInput"; const Signup = () => { const [form, setForm] = useState({ name: "", email: "", phone: "", password: "", confirmPassword: "", role: "renter", preferredCity: "Dubai", }); const [files, setFiles] = useState({ drivingLicense: null, emiratesId: null, visa: null, passport: null, profileImage: null, }); const [step, setStep] = useState(1); const [isLoading, setIsLoading] = useState(false); const [errors, setErrors] = useState({}); const [passwordStrength, setPasswordStrength] = useState(0); const [showPassword, setShowPassword] = useState(false); const navigate = useNavigate(); const uaeCities = [ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", ]; const calculatePasswordStrength = (password) => { let strength = 0; if (password.length >= 8) strength += 1; if (/[A-Z]/.test(password)) strength += 1; if (/[a-z]/.test(password)) strength += 1; if (/[0-9]/.test(password)) strength += 1; if (/[^A-Za-z0-9]/.test(password)) strength += 1; return strength; }; const getPasswordStrengthText = () => { switch (passwordStrength) { case 0: case 1: return { text: "Very Weak", color: "text-red-500", bg: "bg-red-500" }; case 2: return { text: "Weak", color: "text-orange-500", bg: "bg-orange-500" }; case 3: return { text: "Fair", color: "text-yellow-500", bg: "bg-yellow-500" }; case 4: return { text: "Good", color: "text-green-500", bg: "bg-green-500" }; case 5: return { text: "Strong", color: "text-green-600", bg: "bg-green-600" }; default: return { text: "", color: "", bg: "" }; } }; const handleChange = (e) => { const { name, value } = e.target; setForm({ ...form, [name]: value }); // Clear specific error when user starts typing if (errors[name]) { setErrors({ ...errors, [name]: "" }); } // Check password strength if (name === "password") { setPasswordStrength(calculatePasswordStrength(value)); } }; // Special handler for phone input const handlePhoneChange = (phoneValue) => { setForm({ ...form, phone: phoneValue }); // Clear phone error when user starts typing if (errors.phone) { setErrors({ ...errors, phone: "" }); } }; const handleFileChange = (e) => { const { name, files: selectedFiles } = e.target; const file = selectedFiles[0]; if (file) { // Validate file size (5MB max) if (file.size > 5 * 1024 * 1024) { setErrors({ ...errors, [name]: "File size must be less than 5MB" }); return; } // Validate file type const allowedTypes = [ "image/jpeg", "image/jpg", "image/png", "image/webp", ]; if (!allowedTypes.includes(file.type)) { setErrors({ ...errors, [name]: "Only JPEG, PNG, and WebP files are allowed", }); return; } setFiles({ ...files, [name]: file }); setErrors({ ...errors, [name]: "" }); } }; const validateStep1 = () => { const newErrors = {}; if (!form.name.trim() || form.name.length < 2) { newErrors.name = "Name must be at least 2 characters"; } if (!form.email.trim() || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(form.email)) { newErrors.email = "Please enter a valid email address"; } // Validate UAE phone number if (!form.phone.trim()) { newErrors.phone = "Phone number is required"; } else { const phoneDigits = form.phone.replace(/\D/g, ""); // UAE mobile: 0501234567 (10 digits starting with 05) // UAE landline: 043001234 (9 digits starting with 04/02/03/06/07/09) const validMobile = /^05[0-9]{8}$/.test(phoneDigits); const validLandline = /^0[2-4679][0-9]{7}$/.test(phoneDigits); if (!validMobile && !validLandline) { newErrors.phone = "Please enter a valid UAE phone number (e.g., 0501234567)"; } } if (!form.password || form.password.length < 6) { newErrors.password = "Password must be at least 6 characters"; } if (form.password !== form.confirmPassword) { newErrors.confirmPassword = "Passwords do not match"; } setErrors(newErrors); return Object.keys(newErrors).length === 0; }; const validateStep2 = () => { const newErrors = {}; if (!files.drivingLicense) { newErrors.drivingLicense = "Driving license is required"; } setErrors(newErrors); return Object.keys(newErrors).length === 0; }; const handleNext = () => { if (step === 1 && validateStep1()) { setStep(2); } else if (step === 2 && validateStep2()) { setStep(3); } }; const handleBack = () => { setStep(step - 1); }; const handleSubmit = async (e) => { e.preventDefault(); if (!validateStep1() || !validateStep2()) { return; } setIsLoading(true); setErrors({}); try { const formData = new FormData(); // Append form data (exclude confirmPassword) Object.keys(form).forEach((key) => { if (key !== "confirmPassword") { formData.append(key, form[key]); } }); // Append files Object.keys(files).forEach((key) => { if (files[key]) { formData.append(key, files[key]); } }); console.log("Submitting registration..."); const response = await API.post("/auth/signup", formData, { headers: { "Content-Type": "multipart/form-data", }, }); console.log("Registration response:", response.data); // Registration successful setStep(4); // Success step } catch (error) { console.error("Registration error:", error); if (error.response) { // Server responded with error status const message = error.response.data?.message || error.response.data?.error || "Registration failed"; setErrors({ submit: message }); } else if (error.request) { // Network error setErrors({ submit: "Network error. Please check your connection and try again.", }); } else { // Other error setErrors({ submit: "An unexpected error occurred. Please try again.", }); } } finally { setIsLoading(false); } }; const strengthText = getPasswordStrengthText(); // Step 1: Basic Information const renderStep1 = () => ( <div className="space-y-6"> <div className="text-center space-y-2"> <h2 className="text-2xl font-bold text-gray-900"> Create Your Account </h2> <p className="text-gray-600">Let's start with your basic information</p> </div> <div className="space-y-4"> {/* Name */} <div> <label htmlFor="name" className="block text-sm font-medium text-gray-700 mb-1" > Full Name * </label> <input id="name" name="name" type="text" value={form.name} onChange={handleChange} placeholder="Enter your full name" className={`w-full px-3 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 ${ errors.name ? "border-red-500" : "border-gray-300" }`} /> {errors.name && ( <p className="text-red-500 text-xs mt-1">{errors.name}</p> )} </div> {/* Email */} <div> <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-1" > Email Address * </label> <input id="email" name="email" type="email" value={form.email} onChange={handleChange} placeholder="your.email@example.com" className={`w-full px-3 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 ${ errors.email ? "border-red-500" : "border-gray-300" }`} /> {errors.email && ( <p className="text-red-500 text-xs mt-1">{errors.email}</p> )} </div> {/* Phone - Using the new PhoneInput component */} <div> <label htmlFor="phone" className="block text-sm font-medium text-gray-700 mb-1" > UAE Phone Number * </label> <PhoneInput value={form.phone} onChange={handlePhoneChange} error={errors.phone} placeholder="0501234567" required={true} /> </div> {/* Role */} <div> <label htmlFor="role" className="block text-sm font-medium text-gray-700 mb-1" > I want to * </label> <select id="role" name="role" value={form.role} onChange={handleChange} className="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-green-500 focus:border-green-500" > <option value="renter">Rent cars from others</option> <option value="owner">List my car for rent</option> </select> </div> {/* Preferred City */} <div> <label htmlFor="preferredCity" className="block text-sm font-medium text-gray-700 mb-1" > Preferred City * </label> <select id="preferredCity" name="preferredCity" value={form.preferredCity} onChange={handleChange} className="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-green-500 focus:border-green-500" > {uaeCities.map((city) => ( <option key={city} value={city}> {city} </option> ))} </select> </div> {/* Password */} <div> <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-1" > Password * </label> <div className="relative"> <input id="password" name="password" type={showPassword ? "text" : "password"} value={form.password} onChange={handleChange} placeholder="Create a strong password" className={`w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 ${ errors.password ? "border-red-500" : "border-gray-300" }`} /> <button type="button" className="absolute inset-y-0 right-0 pr-3 flex items-center" onClick={() => setShowPassword(!showPassword)} > {showPassword ? "👁️" : "👁️‍🗨️"} </button> </div> {/* Password Strength Indicator */} {form.password && ( <div className="mt-2 space-y-2"> <div className="flex space-x-1"> {[1, 2, 3, 4, 5].map((level) => ( <div key={level} className={`h-2 flex-1 rounded ${ level <= passwordStrength ? strengthText.bg : "bg-gray-200" }`} /> ))} </div> <p className={`text-xs ${strengthText.color}`}> Password strength: {strengthText.text} </p> </div> )} {errors.password && ( <p className="text-red-500 text-xs mt-1">{errors.password}</p> )} </div> {/* Confirm Password */} <div> <label htmlFor="confirmPassword" className="block text-sm font-medium text-gray-700 mb-1" > Confirm Password * </label> <input id="confirmPassword" name="confirmPassword" type="password" value={form.confirmPassword} onChange={handleChange} placeholder="Repeat your password" className={`w-full px-3 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 ${ errors.confirmPassword ? "border-red-500" : "border-gray-300" }`} /> {/* Password Match Indicator */} {form.confirmPassword && ( <div className="mt-1"> {form.password === form.confirmPassword ? ( <p className="text-xs text-green-600">✓ Passwords match</p> ) : ( <p className="text-xs text-red-600">✗ Passwords do not match</p> )} </div> )} {errors.confirmPassword && ( <p className="text-red-500 text-xs mt-1"> {errors.confirmPassword} </p> )} </div> </div> </div> ); // Step 2: Document Upload const renderStep2 = () => ( <div className="space-y-6"> <div className="text-center space-y-2"> <h2 className="text-2xl font-bold text-gray-900">Upload Documents</h2> <p className="text-gray-600"> We need to verify your identity for safety </p> </div> <div className="space-y-4"> {/* Driving License - Required */} <div> <label className="block text-sm font-medium text-gray-700 mb-2"> UAE Driving License *{" "} <span className="text-green-600 text-xs ml-1">(Required)</span> </label> <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-green-500 transition-colors"> <input type="file" name="drivingLicense" accept="image/*" onChange={handleFileChange} className="hidden" id="drivingLicense" /> <label htmlFor="drivingLicense" className="cursor-pointer"> {files.drivingLicense ? ( <div className="text-green-600"> <p className="font-medium">✓ {files.drivingLicense.name}</p> <p className="text-xs">Click to change</p> </div> ) : ( <div className="text-gray-500"> <p className="font-medium">📄 Upload Driving License</p> <p className="text-xs">Click to select file</p> </div> )} </label> </div> {errors.drivingLicense && ( <p className="text-red-500 text-xs mt-1">{errors.drivingLicense}</p> )} </div> {/* Emirates ID - Optional */} <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Emirates ID{" "} <span className="text-gray-500 text-xs ml-1">(Optional)</span> </label> <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-green-500 transition-colors"> <input type="file" name="emiratesId" accept="image/*" onChange={handleFileChange} className="hidden" id="emiratesId" /> <label htmlFor="emiratesId" className="cursor-pointer"> {files.emiratesId ? ( <div className="text-green-600"> <p className="font-medium">✓ {files.emiratesId.name}</p> <p className="text-xs">Click to change</p> </div> ) : ( <div className="text-gray-500"> <p className="font-medium">🆔 Upload Emirates ID</p> <p className="text-xs">Click to select file</p> </div> )} </label> </div> </div> {/* Profile Image - Optional */} // src/Signup.jsx - Enhanced Profile Picture Upload Section // Replace the profile image section in renderStep2() with this enhanced version: {/* Profile Image - Enhanced */} <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Profile Photo{" "} <span className="text-gray-500 text-xs ml-1">(Optional)</span> </label> {/* Profile Picture Preview and Upload */} <div className="flex items-center space-x-4"> {/* Preview */} <div className="relative"> <div className="w-20 h-20 rounded-full overflow-hidden border-4 border-gray-200 bg-gray-100 flex items-center justify-center"> {files.profileImage ? ( <img src={URL.createObjectURL(files.profileImage)} alt="Profile preview" className="w-full h-full object-cover" onLoad={() => URL.revokeObjectURL(files.profileImage)} /> ) : ( <div className="flex items-center justify-center w-full h-full bg-gradient-to-br from-gray-200 to-gray-300"> <svg className="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /> </svg> </div> )} </div> {/* Remove button for preview */} {files.profileImage && ( <button type="button" onClick={() => setFiles({ ...files, profileImage: null })} className="absolute -top-1 -right-1 bg-red-500 hover:bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold shadow-lg transition-colors" title="Remove image" > × </button> )} </div> {/* Upload Area */} <div className="flex-1"> <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-green-500 transition-colors"> <input type="file" name="profileImage" accept="image/*" onChange={handleFileChange} className="hidden" id="profileImage" /> <label htmlFor="profileImage" className="cursor-pointer"> {files.profileImage ? ( <div className="text-green-600"> <p className="font-medium">✓ {files.profileImage.name}</p> <p className="text-xs">Click to change</p> </div> ) : ( <div className="text-gray-500"> <svg className="w-8 h-8 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" /> </svg> <p className="font-medium">Upload Profile Photo</p> <p className="text-xs">PNG, JPG, WebP up to 5MB</p> </div> )} </label> </div> {/* Profile Image Error */} {errors.profileImage && ( <p className="text-red-500 text-xs mt-1"> {errors.profileImage} </p> )} </div> </div> <div className="mt-2 text-xs text-gray-500"> 💡 <strong>Tip:</strong> A clear profile photo helps build trust with other users </div> </div> </div> <div className="bg-blue-50 border border-blue-200 rounded-lg p-4"> <div className="flex items-start"> <div className="flex-shrink-0"> <span className="text-blue-500 text-lg">ℹ️</span> </div> <div className="ml-3"> <h3 className="text-sm font-medium text-blue-800"> Document Guidelines </h3> <div className="mt-2 text-sm text-blue-700"> <ul className="list-disc space-y-1 ml-4"> <li>All files must be less than 5MB</li> <li>Accepted formats: JPEG, PNG, WebP</li> <li>Ensure documents are clear and readable</li> <li>Your information will be kept secure and private</li> </ul> </div> </div> </div> </div> </div> ); // Step 3: Review and Submit const renderStep3 = () => ( <div className="space-y-6"> <div className="text-center space-y-2"> <h2 className="text-2xl font-bold text-gray-900"> Review Your Information </h2> <p className="text-gray-600"> Please review your details before submitting </p> </div> <div className="bg-gray-50 rounded-lg p-6 space-y-4"> <div> <h3 className="font-medium text-gray-900 mb-3"> Personal Information </h3> <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"> <div> <span className="text-gray-500">Name:</span> <span className="ml-2 font-medium">{form.name}</span> </div> <div> <span className="text-gray-500">Email:</span> <span className="ml-2 font-medium">{form.email}</span> </div> <div> <span className="text-gray-500">Phone:</span> <span className="ml-2 font-medium"> 🇦🇪 +971{form.phone.replace(/^0/, "")} </span> </div> <div> <span className="text-gray-500">Role:</span> <span className="ml-2 font-medium capitalize">{form.role}</span> </div> <div> <span className="text-gray-500">Preferred City:</span> <span className="ml-2 font-medium">{form.preferredCity}</span> </div> </div> </div> <hr className="border-gray-200" /> <div> <h3 className="font-medium text-gray-900 mb-3">Uploaded Documents</h3> <div className="space-y-2 text-sm"> <div className="flex items-center"> <span className="text-green-600">✓</span> <span className="ml-2"> Driving License: {files.drivingLicense?.name} </span> </div> {files.emiratesId && ( <div className="flex items-center"> <span className="text-green-600">✓</span> <span className="ml-2"> Emirates ID: {files.emiratesId.name} </span> </div> )} {files.profileImage && ( <div className="flex items-center"> <span className="text-green-600">✓</span> <span className="ml-2"> Profile Photo: {files.profileImage.name} </span> </div> )} </div> </div> </div> <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4"> <div className="flex items-start"> <div className="flex-shrink-0"> <span className="text-yellow-500 text-lg">⚠️</span> </div> <div className="ml-3"> <h3 className="text-sm font-medium text-yellow-800"> Account Approval Required </h3> <p className="mt-1 text-sm text-yellow-700"> Your account will be reviewed by our team within 24-48 hours. You'll receive an email notification once approved. </p> </div> </div> </div> {errors.submit && ( <div className="text-red-600 text-sm text-center bg-red-50 border border-red-200 rounded-lg p-3"> {errors.submit} </div> )} </div> ); // Step 4: Success const renderStep4 = () => ( <div className="text-center space-y-6"> <div className="mx-auto w-24 h-24 bg-green-100 rounded-full flex items-center justify-center"> <span className="text-green-600 text-4xl">✓</span> </div> <div className="space-y-2"> <h2 className="text-2xl font-bold text-gray-900"> Registration Successful! </h2> <p className="text-gray-600"> Welcome to BorrowMyCar! Your account has been created successfully. </p> </div> <div className="bg-blue-50 border border-blue-200 rounded-lg p-4"> <h3 className="font-medium text-blue-900 mb-2">What's Next?</h3> <div className="text-sm text-blue-800 space-y-1"> <p>📧 Check your email for verification instructions</p> <p>⏱️ Our team will review your documents within 24-48 hours</p> <p>🎉 You'll receive approval notification via email</p> </div> </div> <div className="space-y-3"> <Link to="/login" className="w-full inline-flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors" > Sign In to Your Account </Link> <Link to="/" className="w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors" > Return to Homepage </Link> </div> </div> ); return ( <div className="min-h-screen bg-gray-50 flex flex-col lg:flex-row"> {/* Left Side - Progress & Branding */} <div className="lg:flex-1 lg:max-w-md bg-gradient-to-br from-green-50 to-emerald-100 p-8"> <div className="max-w-md mx-auto space-y-8"> {/* Logo */} <div className="text-center"> <div className="mx-auto w-16 h-16 bg-gradient-to-r from-green-400 to-emerald-500 rounded-xl shadow-lg flex items-center justify-center text-2xl"> 🚗 </div> <h1 className="mt-4 text-2xl font-bold text-gray-900"> BorrowMyCar </h1> <p className="text-gray-600">Your trusted car sharing platform</p> </div> {/* Progress Indicator */} {step < 4 && ( <div className="space-y-4"> <h3 className="font-medium text-gray-900"> Registration Progress </h3> <div className="space-y-3"> {[ { step: 1, label: "Basic Information", icon: "👤" }, { step: 2, label: "Document Upload", icon: "📄" }, { step: 3, label: "Review & Submit", icon: "✅" }, ].map((item) => ( <div key={item.step} className="flex items-center space-x-3"> <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm ${ step >= item.step ? "bg-green-500 text-white" : step === item.step - 1 ? "bg-green-100 text-green-600 border-2 border-green-500" : "bg-gray-200 text-gray-500" }`} > {step > item.step ? "✓" : item.step} </div> <div className="flex-1"> <p className={`text-sm font-medium ${ step >= item.step ? "text-green-600" : "text-gray-500" }`} > {item.label} </p> </div> <span className="text-lg">{item.icon}</span> </div> ))} </div> </div> )} {/* Features */} <div className="space-y-3"> <h3 className="font-medium text-gray-900">Why Choose Us?</h3> <div className="space-y-2 text-sm text-gray-600"> <div className="flex items-center space-x-2"> <span className="text-green-500">✓</span> <span>24/7 customer support</span> </div> <div className="flex items-center space-x-2"> <span className="text-green-500">✓</span> <span>Flexible rental periods</span> </div> <div className="flex items-center space-x-2"> <span className="text-green-500">✓</span> <span>Secure payment processing</span> </div> </div> </div> </div> </div> {/* Right Side - Form */} <div className="flex-1 flex items-center justify-center p-4 sm:p-6 lg:p-8"> <div className="w-full max-w-md space-y-8"> {/* Form Container */} <form onSubmit={handleSubmit} className="space-y-6"> {step === 1 && renderStep1()} {step === 2 && renderStep2()} {step === 3 && renderStep3()} {step === 4 && renderStep4()} {/* Navigation Buttons */} {step < 4 && ( <div className="flex space-x-4"> {step > 1 && ( <button type="button" onClick={handleBack} className="flex-1 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors" > Back </button> )} {step < 3 ? ( <button type="button" onClick={handleNext} className="flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors" > Next Step </button> ) : ( <button type="submit" disabled={isLoading} className="flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors" > {isLoading ? ( <span className="flex items-center justify-center"> <svg className="animate-spin -ml-1 mr-3 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" > <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" ></circle> <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" ></path> </svg> Creating Account... </span> ) : ( "Create Account" )} </button> )} </div> )} </form> {/* Login Link */} {step < 4 && ( <p className="text-center text-sm text-gray-600"> Already have an account?{" "} <Link to="/login" className="font-medium text-green-600 hover:text-green-500 hover:underline transition-colors" > Sign in here </Link> </p> )} </div> </div> </div> ); }; export default Signup;
```

# borrowmycarfrontend\vite.config.js

```js
import { defineConfig } from 'vite' import react from '@vitejs/plugin-react' import tailwindcss from '@tailwindcss/vite' // https://vite.dev/config/ export default defineConfig({ plugins: [tailwindcss(),react()], })
```

# config\db.js

```js
// config/db.js (Enhanced) import mongoose from "mongoose"; import dotenv from "dotenv"; dotenv.config(); // Enhanced MongoDB connection with better error handling and options export const connectDB = async () => { try { // Connection options for better performance and reliability const options = { dbName: "borrowmycar", maxPoolSize: 10, // Maintain up to 10 socket connections serverSelectionTimeoutMS: 5000, // Keep trying to send operations for 5 seconds socketTimeoutMS: 45000, // Close sockets after 45 seconds of inactivity // Removed deprecated options: bufferMaxEntries, bufferCommands }; const conn = await mongoose.connect(process.env.MONGO_URI, options); console.log(`✅ MongoDB Connected: ${conn.connection.host}`); console.log(`📊 Database: ${conn.connection.name}`); // Handle connection events mongoose.connection.on("error", (error) => { console.error("❌ MongoDB connection error:", error); }); mongoose.connection.on("disconnected", () => { console.log("⚠️ MongoDB disconnected"); }); mongoose.connection.on("reconnected", () => { console.log("✅ MongoDB reconnected"); }); // Graceful shutdown process.on("SIGINT", async () => { try { await mongoose.connection.close(); console.log("📴 MongoDB connection closed through app termination"); process.exit(0); } catch (error) { console.error("❌ Error during MongoDB disconnection:", error); process.exit(1); } }); } catch (error) { console.error("❌ MongoDB connection error:", error.message); // Exit process with failure process.exit(1); } }; // Health check function export const checkDBHealth = async () => { try { const state = mongoose.connection.readyState; const states = { 0: "disconnected", 1: "connected", 2: "connecting", 3: "disconnecting", }; return { status: states[state], host: mongoose.connection.host, name: mongoose.connection.name, port: mongoose.connection.port, }; } catch (error) { return { status: "error", error: error.message, }; } };
```

# config\mapbox.js

```js
// borrowmycarfrontend/src/config/mapbox.js - COMPLETE MAPBOX CONFIGURATION import mapboxgl from "mapbox-gl"; // Get Mapbox access token from environment variables const MAPBOX_TOKEN = import.meta.env.VITE_MAPBOX_ACCESS_TOKEN; // Validate token exists if (!MAPBOX_TOKEN) { console.warn( "⚠️ Mapbox access token not found. Please set VITE_MAPBOX_ACCESS_TOKEN in your .env file" ); console.log( "Example: VITE_MAPBOX_ACCESS_TOKEN=pk.eyJ1IjoieW91cnVzZXJuYW1lIiwiYSI6InlvdXJhY2Nlc3N0b2tlbiJ9..." ); } // Set the access token globally for Mapbox GL JS if (MAPBOX_TOKEN) { mapboxgl.accessToken = MAPBOX_TOKEN; } // UAE geographic bounds [Southwest, Northeast] export const UAE_BOUNDS = [ [51.5795, 22.4969], // Southwest coordinates [lng, lat] [56.3968, 26.0693], // Northeast coordinates [lng, lat] ]; // UAE center coordinates (Dubai) export const UAE_CENTER = [55.2708, 25.2048]; // [lng, lat] // Major UAE cities with coordinates export const UAE_CITIES = [ { name: "Dubai", coordinates: [55.2708, 25.2048] }, { name: "Abu Dhabi", coordinates: [54.3773, 24.4539] }, { name: "Sharjah", coordinates: [55.3881, 25.3573] }, { name: "Ajman", coordinates: [55.5136, 25.4052] }, { name: "Fujairah", coordinates: [56.3269, 25.1288] }, { name: "Ras Al Khaimah", coordinates: [55.9432, 25.7895] }, { name: "Umm Al Quwain", coordinates: [55.7558, 25.5641] }, { name: "Al Ain", coordinates: [55.7581, 24.2075] }, // Additional popular areas { name: "Dubai Marina", coordinates: [55.1406, 25.0805] }, { name: "Downtown Dubai", coordinates: [55.2744, 25.1972] }, { name: "Jumeirah", coordinates: [55.2324, 25.2285] }, { name: "Business Bay", coordinates: [55.2736, 25.1898] }, { name: "DIFC", coordinates: [55.2708, 25.2137] }, { name: "Dubai South", coordinates: [55.1644, 24.8958] }, { name: "JLT", coordinates: [55.1441, 25.0693] }, ]; // Available map styles export const MAP_STYLES = { streets: "mapbox://styles/mapbox/streets-v12", outdoors: "mapbox://styles/mapbox/outdoors-v12", light: "mapbox://styles/mapbox/light-v11", dark: "mapbox://styles/mapbox/dark-v11", satellite: "mapbox://styles/mapbox/satellite-v9", "satellite-streets": "mapbox://styles/mapbox/satellite-streets-v12", navigation: "mapbox://styles/mapbox/navigation-day-v1", "navigation-night": "mapbox://styles/mapbox/navigation-night-v1", }; // Main Mapbox configuration object export const MAPBOX_CONFIG = { // Access token accessToken: MAPBOX_TOKEN, // Default map settings style: MAP_STYLES.streets, center: UAE_CENTER, zoom: 10, minZoom: 6, maxZoom: 18, // UAE-specific bounds and cities uae: { bounds: UAE_BOUNDS, center: UAE_CENTER, cities: UAE_CITIES, }, // Map control settings controls: { navigation: true, fullscreen: true, geolocate: true, scale: true, }, // Clustering settings for multiple markers clustering: { enabled: true, maxZoom: 14, radius: 50, clusterProperties: { sum: ["+", ["get", "point_count"]], }, }, // Popup settings popup: { closeButton: true, closeOnClick: false, closeOnMove: false, offset: [0, -10], className: "custom-popup", }, // Marker settings marker: { color: "#16a34a", // Green color matching your brand size: "medium", draggable: false, }, // Geocoding settings geocoding: { country: "ae", bbox: [...UAE_BOUNDS[0], ...UAE_BOUNDS[1]], types: "address,poi,place", language: "en", limit: 5, }, // Directions settings directions: { profile: "driving", // driving, walking, cycling alternatives: true, steps: true, geometries: "geojson", annotations: ["duration", "distance"], }, // Animation settings animation: { duration: 1000, easing: "easeInOutCubic", }, }; // Geocoding configuration for search export const GEOCODING_CONFIG = { accessToken: MAPBOX_TOKEN, country: "ae", bbox: [...UAE_BOUNDS[0], ...UAE_BOUNDS[1]], types: "address,poi,place", language: "en", proximity: UAE_CENTER, autocomplete: true, fuzzyMatch: true, routing: false, }; // Map themes for different contexts export const MAP_THEMES = { default: { style: MAP_STYLES.streets, zoom: 10, pitch: 0, bearing: 0, }, satellite: { style: MAP_STYLES["satellite-streets"], zoom: 12, pitch: 45, bearing: 0, }, navigation: { style: MAP_STYLES.navigation, zoom: 15, pitch: 60, bearing: 0, }, dark: { style: MAP_STYLES.dark, zoom: 10, pitch: 0, bearing: 0, }, }; // Car marker icon configurations export const CAR_MARKER_CONFIGS = { available: { color: "#16a34a", // Green symbol: "car", size: "large", }, booked: { color: "#dc2626", // Red symbol: "car", size: "large", }, pending: { color: "#f59e0b", // Yellow/Orange symbol: "car", size: "large", }, }; // User location marker configuration export const USER_MARKER_CONFIG = { color: "#3b82f6", // Blue symbol: "marker", size: "large", pulsing: true, }; // Utility function to validate configuration export const validateMapboxConfig = () => { const issues = []; if (!MAPBOX_TOKEN) { issues.push("Missing Mapbox access token (VITE_MAPBOX_ACCESS_TOKEN)"); } if (!mapboxgl.supported()) { issues.push("WebGL is not supported in this browser"); } return { valid: issues.length === 0, issues, token: MAPBOX_TOKEN ? "✓ Present" : "✗ Missing", webgl: mapboxgl.supported() ? "✓ Supported" : "✗ Not supported", }; }; // Utility function to get map style by name export const getMapStyle = (styleName) => { return MAP_STYLES[styleName] || MAP_STYLES.streets; }; // Utility function to get UAE city by name export const getUAECity = (cityName) => { return UAE_CITIES.find( (city) => city.name.toLowerCase() === cityName.toLowerCase() ); }; // Export the Mapbox token for external use export { MAPBOX_TOKEN }; // Export mapboxgl instance export default mapboxgl;
```

# config\stripe.js

```js
// src/config/stripe.js import { loadStripe } from "@stripe/stripe-js"; // Test publishable key (replace with your actual test key) const stripePublishableKey = import.meta.env.VITE_STRIPE_PUBLISHABLE_KEY || "pk_test_51..."; // Initialize Stripe export const stripePromise = loadStripe(stripePublishableKey); // Stripe configuration export const stripeConfig = { mode: import.meta.env.VITE_STRIPE_MODE || "test", // 'test' or 'live' currency: "aed", // UAE Dirham country: "AE", // UAE country code }; // Payment method configuration for UAE export const paymentMethods = { card: { style: { base: { fontSize: "16px", color: "#424770", "::placeholder": { color: "#aab7c4", }, }, invalid: { color: "#9e2146", }, }, }, }; // Format amount for Stripe (convert AED to fils - 1 AED = 100 fils) export const formatAmountForStripe = (amount) => { return Math.round(amount * 100); }; // Format amount for display export const formatAmountForDisplay = (amount) => { return (amount / 100).toFixed(2); }; // Validate Stripe environment export const validateStripeConfig = () => { if (!stripePublishableKey || stripePublishableKey === "pk_test_51...") { console.error("⚠️ Stripe publishable key not configured properly"); return false; } return true; };
```

# controllers\authController.js

```js
// controllers/authController.js - FIXED with consistent response format import jwt from "jsonwebtoken"; import bcrypt from "bcryptjs"; import { User } from "../models/User.js"; import { uploadImagesToCloud, deleteImagesFromCloud, } from "../utils/cloudUploader.js"; import { formatUAEPhone, validateUAEPhone } from "../utils/phoneUtils.js"; // Enhanced async error handler const handleAsyncErrorLocal = (fn) => { return (req, res, next) => { Promise.resolve(fn(req, res, next)).catch(next); }; }; // Token generator const generateToken = (user) => { return jwt.sign( { id: user._id, role: user.role, isApproved: user.isApproved, email: user.email, name: user.name, }, process.env.JWT_SECRET, { expiresIn: "7d" } ); }; // FIXED: Consistent response helper const sendTokenResponse = (user, statusCode, res, message = "Success") => { const token = generateToken(user); const userData = { id: user._id, name: user.name, email: user.email, phone: user.phone, role: user.role, isApproved: user.isApproved, profileImage: user.profileImage, preferredCity: user.preferredCity, createdAt: user.createdAt, lastLoginAt: user.lastLoginAt, }; // CONSISTENT response format for all auth endpoints res.status(statusCode).json({ success: true, message, token, // Frontend expects this at root level user: userData, // Frontend expects this at root level data: { token, user: userData, }, }); }; // Enhanced data sanitizer const sanitizeUserData = (data) => { const sanitized = {}; if (data.name) sanitized.name = data.name.toString().trim(); if (data.email) sanitized.email = data.email.toString().toLowerCase().trim(); if (data.phone) sanitized.phone = data.phone.toString().trim(); if (data.password) sanitized.password = data.password.toString(); if (data.role) sanitized.role = data.role.toString().trim(); if (data.preferredCity) sanitized.preferredCity = data.preferredCity.toString().trim(); return sanitized; }; // FIXED validation function const validateUserData = (data, isSignup = false) => { const errors = []; if (isSignup) { // Name validation if (!data.name || data.name.length < 2) { errors.push("Name must be at least 2 characters long"); } // Email validation if (!data.email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(data.email)) { errors.push("Please provide a valid email address"); } // FIXED: Phone validation if (!data.phone) { errors.push("Phone number is required"); } else if (!validateUAEPhone(data.phone)) { errors.push("Please provide a valid UAE phone number (e.g., 0501234567)"); } // Password validation if (!data.password || data.password.length < 6) { errors.push("Password must be at least 6 characters long"); } // Role validation if (data.role && !["renter", "owner"].includes(data.role)) { errors.push("Role must be either 'renter' or 'owner'"); } } return { isValid: errors.length === 0, errors, }; }; // FIXED SIGNUP CONTROLLER export const signup = handleAsyncErrorLocal(async (req, res) => { console.log("=== SIGNUP DEBUG ==="); console.log("Request body:", req.body); console.log( "Request files:", req.files ? Object.keys(req.files) : "No files" ); // Sanitize input data const userData = sanitizeUserData(req.body); console.log("Sanitized data:", { ...userData, password: "[HIDDEN]" }); const { name, email, phone, password, role = "renter", preferredCity, } = userData; // Validate data const validationResult = validateUserData(userData, true); if (!validationResult.isValid) { console.log("Validation errors:", validationResult.errors); return res.status(400).json({ success: false, message: "Validation failed", errors: validationResult.errors, code: "VALIDATION_ERROR", }); } // Format phone number const formattedPhone = formatUAEPhone(phone); console.log("Phone formatting:", { original: phone, formatted: formattedPhone, }); // Check if user already exists const existingUser = await User.findOne({ $or: [{ email }, { phone: formattedPhone }], }); if (existingUser) { return res.status(400).json({ success: false, message: existingUser.email === email ? "Email already registered" : "Phone number already registered", code: "USER_EXISTS", }); } // Handle document uploads let documentUrls = {}; if (req.files) { try { // Validate required documents if (!req.files.drivingLicense) { return res.status(400).json({ success: false, message: "Driving license is required", code: "MISSING_DOCUMENTS", }); } // Upload documents if (req.files.drivingLicense) { const [drivingLicenseUrl] = await uploadImagesToCloud( req.files.drivingLicense ); documentUrls.drivingLicenseUrl = drivingLicenseUrl; } if (req.files.emiratesId) { const [emiratesIdUrl] = await uploadImagesToCloud(req.files.emiratesId); documentUrls.emiratesIdUrl = emiratesIdUrl; } if (req.files.visa) { const [visaUrl] = await uploadImagesToCloud(req.files.visa); documentUrls.visaUrl = visaUrl; } if (req.files.passport) { const [passportUrl] = await uploadImagesToCloud(req.files.passport); documentUrls.passportUrl = passportUrl; } if (req.files.profileImage) { const [profileImageUrl] = await uploadImagesToCloud( req.files.profileImage ); documentUrls.profileImage = profileImageUrl; } } catch (uploadError) { console.error("Document upload error:", uploadError); return res.status(500).json({ success: false, message: "Failed to upload documents. Please try again.", code: "UPLOAD_FAILED", }); } } // Create user const userCreateData = { name, email, phone: formattedPhone, password, role, preferredCity, ...documentUrls, isApproved: false, }; const user = await User.create(userCreateData); console.log("User created successfully:", user._id); // Send consistent response sendTokenResponse( user, 201, res, "Account created successfully. Awaiting admin approval." ); }); // FIXED LOGIN CONTROLLER export const login = handleAsyncErrorLocal(async (req, res) => { const { email, password } = req.body; console.log("Login attempt for:", email); // Input validation if (!email || !password) { return res.status(400).json({ success: false, message: "Please provide email and password", code: "MISSING_CREDENTIALS", }); } try { // Find user and include password const user = await User.findOne({ email }).select("+password"); if (!user) { return res.status(401).json({ success: false, message: "Invalid email or password", code: "INVALID_CREDENTIALS", }); } // Check password const isPasswordValid = await user.matchPassword(password); if (!isPasswordValid) { return res.status(401).json({ success: false, message: "Invalid email or password", code: "INVALID_CREDENTIALS", }); } // Update last login user.lastLoginAt = new Date(); await user.save({ validateBeforeSave: false }); console.log("Login successful for:", email); // Send consistent response sendTokenResponse(user, 200, res, "Login successful"); } catch (error) { console.error("Login error:", error); res.status(500).json({ success: false, message: "Internal server error", code: "INTERNAL_ERROR", }); } }); // GET USER PROFILE - FIXED export const getProfile = handleAsyncErrorLocal(async (req, res) => { try { const user = await User.findById(req.user.id).select("-password"); if (!user) { return res.status(404).json({ success: false, message: "User not found", code: "USER_NOT_FOUND", }); } res.json({ success: true, data: { user: { id: user._id, name: user.name, email: user.email, phone: user.phone, role: user.role, isApproved: user.isApproved, profileImage: user.profileImage, preferredCity: user.preferredCity, createdAt: user.createdAt, lastLoginAt: user.lastLoginAt, }, }, }); } catch (error) { console.error("Get profile error:", error); res.status(500).json({ success: false, message: "Failed to fetch profile", code: "INTERNAL_ERROR", }); } }); // UPDATE USER PROFILE - FIXED export const updateProfile = handleAsyncErrorLocal(async (req, res) => { try { const userId = req.user.id; const updates = sanitizeUserData(req.body); // Remove sensitive fields delete updates.password; delete updates.email; delete updates.role; delete updates.isApproved; // Validate updates if (updates.name && updates.name.length < 2) { return res.status(400).json({ success: false, message: "Name must be at least 2 characters long", code: "INVALID_NAME", }); } // Handle profile image upload if (req.file) { try { const user = await User.findById(userId); // Delete old profile image if (user.profileImage) { await deleteImagesFromCloud([user.profileImage]).catch(console.error); } // Upload new profile image const [profileImageUrl] = await uploadImagesToCloud([req.file]); updates.profileImage = profileImageUrl; } catch (uploadError) { console.error("Profile image upload error:", uploadError); return res.status(500).json({ success: false, message: "Failed to upload profile image", code: "UPLOAD_FAILED", }); } } const updatedUser = await User.findByIdAndUpdate(userId, updates, { new: true, runValidators: true, }).select("-password"); if (!updatedUser) { return res.status(404).json({ success: false, message: "User not found", code: "USER_NOT_FOUND", }); } res.json({ success: true, message: "Profile updated successfully", data: { user: { id: updatedUser._id, name: updatedUser.name, email: updatedUser.email, phone: updatedUser.phone, role: updatedUser.role, isApproved: updatedUser.isApproved, profileImage: updatedUser.profileImage, preferredCity: updatedUser.preferredCity, }, }, }); } catch (error) { console.error("Update profile error:", error); res.status(500).json({ success: false, message: "Failed to update profile", code: "INTERNAL_ERROR", }); } }); // NEW: UPDATE PROFILE PICTURE ONLY export const updateProfilePicture = handleAsyncErrorLocal(async (req, res) => { try { const userId = req.user.id; if (!req.file) { return res.status(400).json({ success: false, message: "Profile image file is required", code: "NO_FILE_PROVIDED", }); } const user = await User.findById(userId); if (!user) { return res.status(404).json({ success: false, message: "User not found", code: "USER_NOT_FOUND", }); } // Delete old profile image if (user.profileImage) { await deleteImagesFromCloud([user.profileImage]).catch(console.error); } // Upload new profile image const [profileImageUrl] = await uploadImagesToCloud([req.file]); // Update user user.profileImage = profileImageUrl; await user.save(); res.json({ success: true, message: "Profile picture updated successfully", data: { profileImage: profileImageUrl, user: { id: user._id, name: user.name, email: user.email, phone: user.phone, role: user.role, isApproved: user.isApproved, profileImage: user.profileImage, preferredCity: user.preferredCity, }, }, }); } catch (error) { console.error("Update profile picture error:", error); res.status(500).json({ success: false, message: "Failed to update profile picture", code: "INTERNAL_ERROR", }); } }); // REMOVE PROFILE PICTURE export const removeProfilePicture = handleAsyncErrorLocal(async (req, res) => { try { const userId = req.user.id; const user = await User.findById(userId); if (!user) { return res.status(404).json({ success: false, message: "User not found", code: "USER_NOT_FOUND", }); } if (!user.profileImage) { return res.status(400).json({ success: false, message: "No profile picture to remove", code: "NO_PROFILE_PICTURE", }); } // Delete from cloud storage await deleteImagesFromCloud([user.profileImage]).catch(console.error); // Remove from user document user.profileImage = null; await user.save(); res.json({ success: true, message: "Profile picture removed successfully", data: { user: { id: user._id, name: user.name, email: user.email, phone: user.phone, role: user.role, isApproved: user.isApproved, profileImage: null, preferredCity: user.preferredCity, }, }, }); } catch (error) { console.error("Remove profile picture error:", error); res.status(500).json({ success: false, message: "Failed to remove profile picture", code: "INTERNAL_ERROR", }); } }); // CHANGE PASSWORD export const changePassword = handleAsyncErrorLocal(async (req, res) => { try { const { currentPassword, newPassword } = req.body; if (!currentPassword || !newPassword) { return res.status(400).json({ success: false, message: "Current password and new password are required", code: "MISSING_FIELDS", }); } if (newPassword.length < 6) { return res.status(400).json({ success: false, message: "New password must be at least 6 characters long", code: "INVALID_PASSWORD", }); } const user = await User.findById(req.user.id).select("+password"); const isPasswordValid = await user.matchPassword(currentPassword); if (!isPasswordValid) { return res.status(400).json({ success: false, message: "Current password is incorrect", code: "INVALID_CURRENT_PASSWORD", }); } user.password = newPassword; await user.save(); res.json({ success: true, message: "Password updated successfully", }); } catch (error) { console.error("Change password error:", error); res.status(500).json({ success: false, message: "Failed to change password", code: "INTERNAL_ERROR", }); } }); // UPDATE USER PREFERENCES export const updatePreferences = handleAsyncErrorLocal(async (req, res) => { try { const userId = req.user.id; const { notifications, privacy } = req.body; const updates = {}; if (notifications) { updates.notificationPreferences = { emailBookings: Boolean(notifications.emailBookings), emailPromotions: Boolean(notifications.emailPromotions), smsBookings: Boolean(notifications.smsBookings), smsReminders: Boolean(notifications.smsReminders), pushNotifications: Boolean(notifications.pushNotifications), }; } if (privacy) { updates.privacySettings = { profileVisibility: privacy.profileVisibility || "public", showPhone: Boolean(privacy.showPhone), showEmail: Boolean(privacy.showEmail), allowMessages: Boolean(privacy.allowMessages), }; } const updatedUser = await User.findByIdAndUpdate(userId, updates, { new: true, runValidators: true, }).select("-password"); res.json({ success: true, message: "Preferences updated successfully", data: { user: { id: updatedUser._id, name: updatedUser.name, email: updatedUser.email, notificationPreferences: updatedUser.notificationPreferences, privacySettings: updatedUser.privacySettings, }, }, }); } catch (error) { console.error("Update preferences error:", error); res.status(500).json({ success: false, message: "Failed to update preferences", code: "INTERNAL_ERROR", }); } }); // EXPORT USER DATA export const exportUserData = handleAsyncErrorLocal(async (req, res) => { try { const userId = req.user.id; const user = await User.findById(userId).select("-password"); if (!user) { return res.status(404).json({ success: false, message: "User not found", code: "USER_NOT_FOUND", }); } const exportData = { exportDate: new Date().toISOString(), user: { id: user._id, name: user.name, email: user.email, phone: user.phone, role: user.role, preferredCity: user.preferredCity, createdAt: user.createdAt, lastLoginAt: user.lastLoginAt, }, }; res.setHeader("Content-Type", "application/json"); res.setHeader( "Content-Disposition", 'attachment; filename="borrowmycar-data.json"' ); res.json(exportData); } catch (error) { console.error("Export data error:", error); res.status(500).json({ success: false, message: "Failed to export data", code: "INTERNAL_ERROR", }); } }); // DELETE USER ACCOUNT export const deleteAccount = handleAsyncErrorLocal(async (req, res) => { try { const userId = req.user.id; const user = await User.findById(userId); if (!user) { return res.status(404).json({ success: false, message: "User not found", code: "USER_NOT_FOUND", }); } // Delete images from cloud storage const imagesToDelete = [ user.profileImage, user.drivingLicenseUrl, user.emiratesIdUrl, user.visaUrl, user.passportUrl, ].filter(Boolean); if (imagesToDelete.length > 0) { await deleteImagesFromCloud(imagesToDelete).catch(console.error); } // Soft delete user.deletedAt = new Date(); user.email = `deleted_${user._id}@borrowmycar.deleted`; user.phone = `deleted_${user._id}`; await user.save(); res.json({ success: true, message: "Account deleted successfully", }); } catch (error) { console.error("Delete account error:", error); res.status(500).json({ success: false, message: "Failed to delete account", code: "INTERNAL_ERROR", }); } }); // LOGOUT export const logout = handleAsyncErrorLocal(async (req, res) => { res.json({ success: true, message: "Logged out successfully", }); }); // Export alternative names for compatibility export const register = signup;
```

# controllers\bookingController.js

```js
// controllers/bookingController.js (Fixed Imports) import Booking from "../models/Booking.js"; // Default import import Car from "../models/Car.js"; // Default import // Simple async error handler (if you don't have it in utils) const handleAsyncError = (fn) => { return (req, res, next) => { Promise.resolve(fn(req, res, next)).catch(next); }; }; // Check for booking conflicts const checkBookingConflicts = async ( carId, startDate, endDate, excludeBookingId = null ) => { const filter = { car: carId, status: { $in: ["pending", "approved", "confirmed", "active"] }, $or: [ { startDate: { $lte: new Date(endDate) }, endDate: { $gte: new Date(startDate) }, }, ], }; if (excludeBookingId) { filter._id = { $ne: excludeBookingId }; } const conflictingBooking = await Booking.findOne(filter); return conflictingBooking; }; // Calculate booking pricing const calculateBookingPricing = ( car, startDate, endDate, deliveryRequested = false ) => { const start = new Date(startDate); const end = new Date(endDate); const totalDays = Math.ceil((end - start) / (1000 * 60 * 60 * 24)); const dailyRate = car.price; const totalAmount = dailyRate * totalDays; const securityDeposit = car.securityDeposit || 0; const deliveryFee = deliveryRequested ? car.deliveryFee || 0 : 0; const totalPayable = totalAmount + securityDeposit + deliveryFee; return { totalDays, dailyRate, totalAmount, securityDeposit, deliveryFee, totalPayable, }; }; // CREATE BOOKING export const createBooking = handleAsyncError(async (req, res) => { const user = req.user; const { carId, startDate, endDate, paymentMethod = "Cash", pickupLocation, returnLocation, deliveryRequested = false, deliveryAddress, renterNotes, } = req.body; // Basic validation if (!carId || !startDate || !endDate) { return res.status(400).json({ success: false, message: "Missing required fields: carId, startDate, endDate", }); } try { // Get car details const car = await Car.findById(carId); if (!car) { return res.status(404).json({ success: false, message: "Car not found", }); } // Calculate pricing const pricing = calculateBookingPricing( car, startDate, endDate, deliveryRequested ); // Create booking const booking = new Booking({ renter: user.id, car: carId, startDate: new Date(startDate), endDate: new Date(endDate), totalDays: pricing.totalDays, dailyRate: pricing.dailyRate, totalAmount: pricing.totalAmount, securityDeposit: pricing.securityDeposit, deliveryFee: pricing.deliveryFee, totalPayable: pricing.totalPayable, paymentMethod, pickupLocation: pickupLocation || "To be determined", returnLocation: returnLocation || "To be determined", deliveryRequested, deliveryAddress, renterNotes: renterNotes || "", }); const savedBooking = await booking.save(); res.status(201).json({ success: true, message: "Booking created successfully", data: { booking: savedBooking }, }); } catch (error) { console.error("Booking creation error:", error); res.status(500).json({ success: false, message: "Failed to create booking", error: error.message, }); } }); // GET MY BOOKINGS export const getMyBookings = handleAsyncError(async (req, res) => { try { const bookings = await Booking.find({ renter: req.user.id }) .populate("car", "title make model year price images") .sort({ createdAt: -1 }); res.json({ success: true, data: { bookings }, }); } catch (error) { res.status(500).json({ success: false, message: "Failed to fetch bookings", error: error.message, }); } }); // GET BOOKINGS FOR OWNER export const getBookingsForOwner = handleAsyncError(async (req, res) => { try { // Get all cars owned by the user const ownedCars = await Car.find({ owner: req.user.id }).select("_id"); const carIds = ownedCars.map((car) => car._id); const bookings = await Booking.find({ car: { $in: carIds } }) .populate("car", "title make model year price images") .populate("renter", "name email phone") .sort({ createdAt: -1 }); res.json({ success: true, data: { bookings }, }); } catch (error) { res.status(500).json({ success: false, message: "Failed to fetch owner bookings", error: error.message, }); } }); // UPDATE BOOKING STATUS export const updateBookingStatus = handleAsyncError(async (req, res) => { const { id } = req.params; const { status } = req.body; try { const booking = await Booking.findById(id).populate("car"); if (!booking) { return res.status(404).json({ success: false, message: "Booking not found", }); } // Simple authorization check const isOwner = booking.car.owner.toString() === req.user.id; const isRenter = booking.renter.toString() === req.user.id; if (!isOwner && !isRenter) { return res.status(403).json({ success: false, message: "Not authorized to update this booking", }); } // Update booking status booking.status = status; await booking.save(); res.json({ success: true, message: "Booking status updated successfully", data: { booking }, }); } catch (error) { res.status(500).json({ success: false, message: "Failed to update booking status", error: error.message, }); } }); // GET SINGLE BOOKING export const getBookingById = handleAsyncError(async (req, res) => { const { id } = req.params; try { const booking = await Booking.findById(id) .populate("car", "title make model year price images city") .populate("renter", "name email phone"); if (!booking) { return res.status(404).json({ success: false, message: "Booking not found", }); } res.json({ success: true, data: { booking }, }); } catch (error) { res.status(500).json({ success: false, message: "Failed to fetch booking", error: error.message, }); } }); // CANCEL BOOKING export const cancelBooking = handleAsyncError(async (req, res) => { const { id } = req.params; try { const booking = await Booking.findById(id); if (!booking) { return res.status(404).json({ success: false, message: "Booking not found", }); } booking.status = "cancelled"; await booking.save(); res.json({ success: true, message: "Booking cancelled successfully", data: { booking }, }); } catch (error) { res.status(500).json({ success: false, message: "Failed to cancel booking", error: error.message, }); } }); // ADD REVIEW export const addReview = handleAsyncError(async (req, res) => { const { id } = req.params; const { rating, comment } = req.body; try { const booking = await Booking.findById(id); if (!booking) { return res.status(404).json({ success: false, message: "Booking not found", }); } // Simple review logic - you can enhance this const reviewData = { rating: parseInt(rating), comment: comment || "", reviewedAt: new Date(), }; // Determine if this is renter or owner review const isRenter = booking.renter.toString() === req.user.id; if (isRenter) { booking.renterReview = reviewData; } else { booking.ownerReview = reviewData; } await booking.save(); res.json({ success: true, message: "Review added successfully", data: { booking }, }); } catch (error) { res.status(500).json({ success: false, message: "Failed to add review", error: error.message, }); } });
```

# controllers\carController.js

```js
// controllers/carController.js - FIXED with consistent price handling import Car from "../models/Car.js"; import Booking from "../models/Booking.js"; import { uploadImagesToCloud, deleteImagesFromCloud, } from "../utils/cloudUploader.js"; import { handleAsyncError } from "../utils/errorHandler.js"; // Enhanced car data sanitizer with FIXED field mapping const sanitizeCarData = (data) => { const sanitized = {}; // Basic fields if (data.title) sanitized.title = data.title.toString().trim(); if (data.description) sanitized.description = data.description.toString().trim(); if (data.city) sanitized.city = data.city.toString().trim(); if (data.make) sanitized.make = data.make.toString().trim(); if (data.model) sanitized.model = data.model.toString().trim(); if (data.color) sanitized.color = data.color.toString().trim(); if (data.plateNumber) sanitized.plateNumber = data.plateNumber.toString().toUpperCase().trim(); // CRITICAL FIX: Handle both pricePerDay (frontend) and price (backend) if (data.pricePerDay) { sanitized.price = parseFloat(data.pricePerDay); } else if (data.price) { sanitized.price = parseFloat(data.price); } // Numeric fields if (data.year) sanitized.year = parseInt(data.year); if (data.mileage) sanitized.mileage = parseInt(data.mileage); if (data.seatingCapacity) sanitized.seatingCapacity = parseInt(data.seatingCapacity); // Enum fields if (data.transmission) sanitized.transmission = data.transmission.toString().trim(); if (data.fuelType) sanitized.fuelType = data.fuelType.toString().trim(); if (data.specifications) sanitized.specifications = data.specifications.toString().trim(); // Array fields if (data.features) { sanitized.features = Array.isArray(data.features) ? data.features.map((f) => f.toString().trim()) : [data.features.toString().trim()]; } // Date fields if (data.availabilityFrom) sanitized.availabilityFrom = data.availabilityFrom; if (data.availabilityTo) sanitized.availabilityTo = data.availabilityTo; return sanitized; }; // CREATE CAR - FIXED export const createCar = handleAsyncError(async (req, res) => { const user = req.user; // Check if user is approved if (!user.isApproved) { return res.status(403).json({ success: false, message: "Your account must be approved before listing cars", code: "ACCOUNT_NOT_APPROVED", }); } // Role-based authorization if (user.role !== "owner") { return res.status(403).json({ success: false, message: "Access denied. Only car owners can list vehicles.", code: "INSUFFICIENT_PERMISSIONS", }); } // Extract and sanitize input data const carData = sanitizeCarData(req.body); console.log("Sanitized car data:", carData); // VALIDATION: Ensure price is set if (!carData.price || carData.price <= 0) { return res.status(400).json({ success: false, message: "Valid price per day is required", code: "INVALID_PRICE", }); } // Handle images upload - REQUIRE MINIMUM 3 IMAGES let imageUrls = []; if (req.files && req.files.length > 0) { if (req.files.length < 3) { return res.status(400).json({ success: false, message: "Minimum 3 images required", code: "INSUFFICIENT_IMAGES", }); } try { imageUrls = await uploadImagesToCloud(req.files); } catch (uploadError) { console.error("Image upload error:", uploadError); return res.status(500).json({ success: false, message: "Failed to upload images. Please try again.", code: "IMAGE_UPLOAD_FAILED", }); } } else { return res.status(400).json({ success: false, message: "Car images are required", code: "MISSING_IMAGES", }); } // Create car document const newCar = new Car({ ...carData, images: imageUrls, owner: user.id, status: "active", // Set to active instead of pending for demo }); const savedCar = await newCar.save(); await savedCar.populate("owner", "name email phone"); // Add pricePerDay for frontend compatibility const responseData = { ...savedCar.toObject(), pricePerDay: savedCar.price, }; res.status(201).json({ success: true, message: "Car listed successfully!", data: { car: responseData }, }); }); // GET CARS - FIXED to handle both price fields export const getCars = handleAsyncError(async (req, res) => { const { page = 1, limit = 12, city, priceMin, priceMax, makeModel, make, year, transmission, fuelType, seatingCapacity, features, deliveryAvailable, sortBy = "createdAt", sortOrder = "desc", search, } = req.query; console.log("GET Cars query params:", req.query); // Build filter object const filter = { status: "active" }; // City filter if (city) filter.city = city; // Price range filter if (priceMin || priceMax) { filter.price = {}; if (priceMin) filter.price.$gte = parseFloat(priceMin); if (priceMax) filter.price.$lte = parseFloat(priceMax); } // Car specifications if (make) filter.make = new RegExp(make, "i"); if (makeModel) { filter.$or = [ { make: new RegExp(makeModel, "i") }, { model: new RegExp(makeModel, "i") }, { title: new RegExp(makeModel, "i") }, ]; } if (year) filter.year = parseInt(year); if (transmission) filter.transmission = transmission; if (fuelType) filter.fuelType = fuelType; if (seatingCapacity) filter.seatingCapacity = parseInt(seatingCapacity); // Features filter if (features) { const featureArray = Array.isArray(features) ? features : [features]; filter.features = { $in: featureArray }; } // Search in title, description, make, and model if (search) { filter.$or = [ { title: new RegExp(search, "i") }, { description: new RegExp(search, "i") }, { make: new RegExp(search, "i") }, { model: new RegExp(search, "i") }, ]; } // Only show available cars filter.availabilityTo = { $gte: new Date() }; console.log("Cars filter:", filter); // Pagination const skip = (parseInt(page) - 1) * parseInt(limit); const sortOptions = {}; sortOptions[sortBy] = sortOrder === "desc" ? -1 : 1; // Execute query with LEAN for better performance const [cars, totalCount] = await Promise.all([ Car.find(filter) .populate("owner", "name email phone averageRating") .sort(sortOptions) .skip(skip) .limit(parseInt(limit)) .lean(), Car.countDocuments(filter), ]); console.log(`Found ${cars.length} cars out of ${totalCount} total`); // ADD pricePerDay field for frontend compatibility const enhancedCars = cars.map((car) => ({ ...car, pricePerDay: car.price, // Frontend expects this field })); const totalPages = Math.ceil(totalCount / parseInt(limit)); res.json({ success: true, data: { cars: enhancedCars, pagination: { currentPage: parseInt(page), totalPages, totalCount, hasNext: parseInt(page) < totalPages, hasPrev: parseInt(page) > 1, limit: parseInt(limit), }, }, }); }); // Get single car by ID - FIXED export const getCarById = handleAsyncError(async (req, res) => { const { id } = req.params; let car = await Car.findById(id) .populate( "owner", "name email phone profileImage averageRating totalBookings createdAt" ) .lean(); if (!car || car.status === "deleted") { return res.status(404).json({ success: false, message: "Car not found", code: "CAR_NOT_FOUND", }); } // Check if car is still available const today = new Date(); if (new Date(car.availabilityTo) < today) { return res.status(410).json({ success: false, message: "This car listing has expired", code: "LISTING_EXPIRED", }); } // CRITICAL FIX: Add pricePerDay for frontend compatibility car.pricePerDay = car.price; res.json({ success: true, data: { car }, }); }); // UPDATE CAR export const updateCar = handleAsyncError(async (req, res) => { const user = req.user; const { id } = req.params; // Find the car and check ownership const car = await Car.findById(id); if (!car) { return res.status(404).json({ success: false, message: "Car not found", code: "CAR_NOT_FOUND", }); } // Check ownership if (car.owner.toString() !== user.id) { return res.status(403).json({ success: false, message: "You can only update your own cars", code: "UNAUTHORIZED", }); } // Sanitize update data const updateData = sanitizeCarData(req.body); // Handle new images if provided if (req.files && req.files.length > 0) { try { // Delete old images if (car.images && car.images.length > 0) { await deleteImagesFromCloud(car.images).catch(console.error); } // Upload new images const newImageUrls = await uploadImagesToCloud(req.files); updateData.images = newImageUrls; } catch (uploadError) { return res.status(500).json({ success: false, message: "Failed to upload new images", code: "IMAGE_UPLOAD_FAILED", }); } } // Update the car const updatedCar = await Car.findByIdAndUpdate(id, updateData, { new: true, runValidators: true, }).populate("owner", "name email phone"); // Add pricePerDay for frontend compatibility const responseData = { ...updatedCar.toObject(), pricePerDay: updatedCar.price, }; res.json({ success: true, message: "Car updated successfully", data: { car: responseData }, }); }); // DELETE CAR (Soft delete) export const deleteCar = handleAsyncError(async (req, res) => { const user = req.user; const { id } = req.params; // Find the car and check ownership const car = await Car.findById(id); if (!car) { return res.status(404).json({ success: false, message: "Car not found", code: "CAR_NOT_FOUND", }); } // Check ownership if (car.owner.toString() !== user.id) { return res.status(403).json({ success: false, message: "You can only delete your own cars", code: "UNAUTHORIZED", }); } // Check for active bookings const activeBookings = await Booking.find({ car: id, status: { $in: ["pending", "approved", "confirmed", "active"] }, }); if (activeBookings.length > 0) { return res.status(400).json({ success: false, message: "Cannot delete car with active bookings", code: "ACTIVE_BOOKINGS_EXIST", }); } // Soft delete (mark as deleted) car.status = "deleted"; car.deletedAt = new Date(); await car.save(); // Optional: Delete images from cloud storage if (car.images && car.images.length > 0) { deleteImagesFromCloud(car.images).catch(console.error); } res.json({ success: true, message: "Car deleted successfully", }); }); // GET CARS BY OWNER export const getCarsByOwner = handleAsyncError(async (req, res) => { const { ownerId } = req.params; const { page = 1, limit = 12, status = "active", sortBy = "createdAt", sortOrder = "desc", } = req.query; // Build filter const filter = { owner: ownerId }; if (status !== "all") { filter.status = status; } // Pagination const skip = (parseInt(page) - 1) * parseInt(limit); const sortOptions = {}; sortOptions[sortBy] = sortOrder === "desc" ? -1 : 1; // Execute query const [cars, totalCount] = await Promise.all([ Car.find(filter) .populate("owner", "name email phone profileImage") .sort(sortOptions) .skip(skip) .limit(parseInt(limit)) .lean(), Car.countDocuments(filter), ]); // Add pricePerDay for frontend compatibility const enhancedCars = cars.map((car) => ({ ...car, pricePerDay: car.price, })); const totalPages = Math.ceil(totalCount / parseInt(limit)); res.json({ success: true, data: { cars: enhancedCars, pagination: { currentPage: parseInt(page), totalPages, totalCount, hasNext: parseInt(page) < totalPages, hasPrev: parseInt(page) > 1, limit: parseInt(limit), }, }, }); }); // GET MY CARS (for authenticated owner) export const getMyCars = handleAsyncError(async (req, res) => { const user = req.user; const { page = 1, limit = 12, status = "active", sortBy = "createdAt", sortOrder = "desc", } = req.query; // Build filter for current user's cars const filter = { owner: user.id }; if (status !== "all") { filter.status = status; } // Pagination const skip = (parseInt(page) - 1) * parseInt(limit); const sortOptions = {}; sortOptions[sortBy] = sortOrder === "desc" ? -1 : 1; // Execute query const [cars, totalCount] = await Promise.all([ Car.find(filter).sort(sortOptions).skip(skip).limit(parseInt(limit)).lean(), Car.countDocuments(filter), ]); // Add pricePerDay and booking stats const enhancedCars = await Promise.all( cars.map(async (car) => { // Get booking stats for each car const bookingStats = await Booking.aggregate([ { $match: { car: car._id } }, { $group: { _id: null, totalBookings: { $sum: 1 }, totalEarnings: { $sum: "$totalPayable" }, activeBookings: { $sum: { $cond: [ { $in: [ "$status", ["pending", "approved", "confirmed", "active"], ], }, 1, 0, ], }, }, }, }, ]); const stats = bookingStats[0] || { totalBookings: 0, totalEarnings: 0, activeBookings: 0, }; return { ...car, pricePerDay: car.price, bookingStats: stats, }; }) ); const totalPages = Math.ceil(totalCount / parseInt(limit)); res.json({ success: true, data: { cars: enhancedCars, pagination: { currentPage: parseInt(page), totalPages, totalCount, hasNext: parseInt(page) < totalPages, hasPrev: parseInt(page) > 1, limit: parseInt(limit), }, }, }); });
```

# controllers\paymentController.js

```js
// controllers/paymentController.js - ENHANCED with Multiple Payment Methods import Stripe from "stripe"; import Booking from "../models/Booking.js"; import Car from "../models/Car.js"; import { User } from "../models/User.js"; import { handleAsyncError } from "../utils/errorHandler.js"; import { sendNotificationEmail } from "../utils/emailService.js"; const stripe = new Stripe(process.env.STRIPE_SECRET_KEY); // Get Stripe Configuration for Frontend export const getStripeConfig = handleAsyncError(async (req, res) => { res.json({ success: true, data: { publishableKey: process.env.STRIPE_PUBLISHABLE_KEY, currency: "aed", country: "AE", }, }); }); // Create Payment Intent for Stripe export const createPaymentIntent = handleAsyncError(async (req, res) => { const { amount, currency = "aed", bookingId, metadata = {} } = req.body; const userId = req.user.id; try { // Validate booking if provided let booking = null; if (bookingId) { booking = await Booking.findById(bookingId) .populate("car", "title images owner") .populate("renter", "name email"); if (!booking) { return res.status(404).json({ success: false, message: "Booking not found", code: "BOOKING_NOT_FOUND", }); } if (booking.renter._id.toString() !== userId) { return res.status(403).json({ success: false, message: "Unauthorized to pay for this booking", code: "UNAUTHORIZED", }); } } // Create payment intent const paymentIntent = await stripe.paymentIntents.create({ amount: Math.round(amount * 100), // Convert AED to fils currency: currency.toLowerCase(), metadata: { bookingId: bookingId || "", userId: userId, carTitle: booking?.car?.title || "", ...metadata, }, description: booking ? `Car Rental: ${booking.car.title} for ${booking.totalDays} days` : "BorrowMyCar Payment", receipt_email: req.user.email, automatic_payment_methods: { enabled: true, }, }); // Update booking with payment intent if applicable if (booking) { booking.paymentIntentId = paymentIntent.id; booking.paymentStatus = "pending"; await booking.save(); } res.json({ success: true, data: { clientSecret: paymentIntent.client_secret, paymentIntentId: paymentIntent.id, amount: amount, currency: currency, }, }); } catch (error) { console.error("Payment Intent Error:", error); res.status(500).json({ success: false, message: "Failed to create payment intent", code: "PAYMENT_INTENT_FAILED", }); } }); // Process Multiple Payment Methods export const processPayment = handleAsyncError(async (req, res) => { const { paymentMethod, bookingId, amount, currency = "aed", cardDetails, bankDetails, walletDetails, cashDetails, } = req.body; const userId = req.user.id; try { // Get booking details const booking = await Booking.findById(bookingId) .populate("car", "title images owner price") .populate("renter", "name email phone"); if (!booking) { return res.status(404).json({ success: false, message: "Booking not found", code: "BOOKING_NOT_FOUND", }); } if (booking.renter._id.toString() !== userId) { return res.status(403).json({ success: false, message: "Unauthorized to pay for this booking", code: "UNAUTHORIZED", }); } let paymentResult = {}; switch (paymentMethod) { case "stripe": paymentResult = await processStripePayment({ booking, amount, currency, cardDetails, }); break; case "bank_transfer": paymentResult = await processBankTransfer({ booking, amount, currency, bankDetails, }); break; case "digital_wallet": paymentResult = await processDigitalWallet({ booking, amount, currency, walletDetails, }); break; case "cash_on_pickup": paymentResult = await processCashOnPickup({ booking, amount, currency, cashDetails, }); break; default: return res.status(400).json({ success: false, message: "Unsupported payment method", code: "UNSUPPORTED_PAYMENT_METHOD", }); } res.json({ success: true, data: paymentResult, }); } catch (error) { console.error("Payment processing error:", error); res.status(500).json({ success: false, message: error.message || "Payment processing failed", code: "PAYMENT_PROCESSING_FAILED", }); } }); // Stripe Payment Processing const processStripePayment = async ({ booking, amount, currency, cardDetails, }) => { try { const paymentIntent = await stripe.paymentIntents.create({ amount: Math.round(amount * 100), currency: currency.toLowerCase(), metadata: { bookingId: booking._id.toString(), carId: booking.car._id.toString(), renterId: booking.renter._id.toString(), }, description: `Car Rental: ${booking.car.title}`, receipt_email: booking.renter.email, }); // Update booking booking.paymentIntentId = paymentIntent.id; booking.paymentMethod = "stripe"; booking.paymentStatus = "pending"; await booking.save(); return { paymentId: paymentIntent.id, paymentMethod: "stripe", status: "pending", clientSecret: paymentIntent.client_secret, amount: amount, currency: currency, }; } catch (error) { throw new Error(`Stripe payment failed: ${error.message}`); } }; // Bank Transfer Processing const processBankTransfer = async ({ booking, amount, currency, bankDetails, }) => { try { const transferId = `BT_${Date.now()}_${Math.random() .toString(36) .substr(2, 9)}`; // Update booking booking.paymentMethod = "bank_transfer"; booking.paymentStatus = "pending"; booking.transactionId = transferId; booking.paymentDetails = { bank: bankDetails.bank, accountNumber: bankDetails.accountNumber.slice(-4), // Store only last 4 digits transferInstructions: generateBankTransferInstructions( amount, transferId ), }; await booking.save(); // Send email with bank transfer instructions await sendBankTransferInstructions(booking, transferId); return { paymentId: transferId, paymentMethod: "bank_transfer", status: "pending", instructions: generateBankTransferInstructions(amount, transferId), amount: amount, currency: currency, }; } catch (error) { throw new Error(`Bank transfer processing failed: ${error.message}`); } }; // Digital Wallet Processing const processDigitalWallet = async ({ booking, amount, currency, walletDetails, }) => { try { const walletId = `DW_${Date.now()}_${Math.random() .toString(36) .substr(2, 9)}`; // Update booking booking.paymentMethod = "digital_wallet"; booking.paymentStatus = "pending"; booking.transactionId = walletId; booking.paymentDetails = { walletType: walletDetails.walletType, phoneNumber: walletDetails.phoneNumber, }; await booking.save(); // Process different wallet types let instructions = ""; switch (walletDetails.walletType) { case "apple_pay": case "google_pay": case "samsung_pay": instructions = "Payment request sent to your device. Please complete payment on your phone."; break; case "paypal": instructions = "PayPal payment link sent to your email."; break; case "careem_pay": instructions = `Payment request sent to Careem Pay account: ${walletDetails.phoneNumber}`; break; case "beam_wallet": instructions = `Payment request sent to Beam Wallet: ${walletDetails.phoneNumber}`; break; default: instructions = "Digital wallet payment initiated."; } return { paymentId: walletId, paymentMethod: "digital_wallet", status: "pending", instructions: instructions, amount: amount, currency: currency, }; } catch (error) { throw new Error(`Digital wallet processing failed: ${error.message}`); } }; // Cash on Pickup Processing const processCashOnPickup = async ({ booking, amount, currency, cashDetails, }) => { try { const cashId = `CASH_${Date.now()}_${Math.random() .toString(36) .substr(2, 9)}`; // Update booking booking.paymentMethod = "cash_on_pickup"; booking.paymentStatus = "pending_pickup"; booking.transactionId = cashId; booking.paymentDetails = { meetingLocation: cashDetails.meetingLocation, meetingTime: cashDetails.meetingTime, notes: cashDetails.notes, amount: amount, }; await booking.save(); // Notify car owner about cash pickup arrangement await notifyOwnerCashPickup(booking); return { paymentId: cashId, paymentMethod: "cash_on_pickup", status: "pending_pickup", meetingDetails: { location: cashDetails.meetingLocation, time: cashDetails.meetingTime, notes: cashDetails.notes, amount: amount, currency: currency, }, }; } catch (error) { throw new Error(`Cash on pickup processing failed: ${error.message}`); } }; // Confirm Payment Success export const confirmPayment = handleAsyncError(async (req, res) => { const { paymentIntentId, bookingId } = req.body; try { // Verify payment with Stripe const paymentIntent = await stripe.paymentIntents.retrieve(paymentIntentId); if (paymentIntent.status !== "succeeded") { return res.status(400).json({ success: false, message: "Payment not completed", code: "PAYMENT_NOT_COMPLETED", }); } // Update booking const booking = await Booking.findById(bookingId); if (!booking) { return res.status(404).json({ success: false, message: "Booking not found", code: "BOOKING_NOT_FOUND", }); } booking.status = "confirmed"; booking.paymentStatus = "paid"; booking.transactionId = paymentIntent.id; booking.paidAt = new Date(); await booking.save(); // Send confirmation emails await sendPaymentConfirmation(booking); res.json({ success: true, message: "Payment confirmed successfully", data: { booking }, }); } catch (error) { console.error("Payment confirmation error:", error); res.status(500).json({ success: false, message: "Failed to confirm payment", code: "PAYMENT_CONFIRMATION_FAILED", }); } }); // Get Payment History export const getPaymentHistory = handleAsyncError(async (req, res) => { const userId = req.user.id; const { page = 1, limit = 10 } = req.query; const bookings = await Booking.find({ renter: userId, paymentStatus: { $in: ["paid", "failed", "refunded", "pending"] }, }) .populate("car", "title make model year images") .sort({ paidAt: -1, createdAt: -1 }) .limit(limit * 1) .skip((page - 1) * limit); const total = await Booking.countDocuments({ renter: userId, paymentStatus: { $in: ["paid", "failed", "refunded", "pending"] }, }); res.json({ success: true, data: { payments: bookings, pagination: { total, page: parseInt(page), pages: Math.ceil(total / limit), }, }, }); }); // Stripe Webhook Handler export const handleStripeWebhook = handleAsyncError(async (req, res) => { const sig = req.headers["stripe-signature"]; let event; try { event = stripe.webhooks.constructEvent( req.body, sig, process.env.STRIPE_WEBHOOK_SECRET ); } catch (err) { console.error("Webhook signature verification failed:", err.message); return res.status(400).send(`Webhook Error: ${err.message}`); } switch (event.type) { case "payment_intent.succeeded": await handlePaymentSuccess(event.data.object); break; case "payment_intent.payment_failed": await handlePaymentFailure(event.data.object); break; default: console.log(`Unhandled event type ${event.type}`); } res.json({ received: true }); }); // Handle Payment Success (Webhook) const handlePaymentSuccess = async (paymentIntent) => { try { const booking = await Booking.findOne({ paymentIntentId: paymentIntent.id, }).populate("car renter"); if (booking) { booking.status = "confirmed"; booking.paymentStatus = "paid"; booking.transactionId = paymentIntent.id; booking.paidAt = new Date(); await booking.save(); // Send confirmation notifications await sendPaymentConfirmation(booking); } } catch (error) { console.error("Error handling payment success:", error); } }; // Handle Payment Failure (Webhook) const handlePaymentFailure = async (paymentIntent) => { try { const booking = await Booking.findOne({ paymentIntentId: paymentIntent.id, }); if (booking) { booking.paymentStatus = "failed"; await booking.save(); } } catch (error) { console.error("Error handling payment failure:", error); } }; // Utility Functions const generateBankTransferInstructions = (amount, transferId) => { return { bankName: "Emirates NBD", accountName: "BorrowMyCar DMCC", accountNumber: "1234567890", iban: "AE07 0331 2345 6789 0123 456", swiftCode: "EBILAEAD", amount: `AED ${amount}`, reference: transferId, instructions: [ `Transfer exactly AED ${amount} to the above account`, `Use reference number: ${transferId}`, "Transfer must be completed within 24 hours", "Send transfer receipt to payments@borrowmycar.ae", ], }; }; const sendBankTransferInstructions = async (booking, transferId) => { // Implementation depends on your email service console.log(`Sending bank transfer instructions for booking ${booking._id}`); }; const notifyOwnerCashPickup = async (booking) => { // Implementation depends on your notification service console.log(`Notifying owner about cash pickup for booking ${booking._id}`); }; const sendPaymentConfirmation = async (booking) => { // Implementation depends on your email service console.log(`Sending payment confirmation for booking ${booking._id}`); };
```

# index.js

```js
// index.js - Fixed main server file import dotenv from "dotenv"; dotenv.config(); import express from "express"; import cors from "cors"; import { connectDB, checkDBHealth } from "./config/db.js"; import { globalErrorHandler } from "./utils/errorHandler.js"; import { generalLimiter } from "./utils/validators.js"; import { checkCloudinaryHealth } from "./utils/cloudinary.js"; // Routes import authRoutes from "./routes/authRoutes.js"; import carRoutes from "./routes/carRoutes.js"; import bookingRoutes from "./routes/bookingRoutes.js"; import paymentRoutes from "./routes/paymentRoutes.js"; const app = express(); // Connect to database try { await connectDB(); console.log("✅ Database connected"); } catch (err) { console.error("❌ Database connection failed:", err.message); process.exit(1); } // Enhanced CORS configuration const corsOptions = { origin: [ "http://localhost:3000", "http://localhost:5173", // Vite default "http://127.0.0.1:5173", process.env.FRONTEND_URL, "https://your-production-domain.com", // Add your production domain ].filter(Boolean), credentials: true, optionsSuccessStatus: 200, methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"], allowedHeaders: [ "Content-Type", "Authorization", "Origin", "X-Requested-With", "Accept", "stripe-signature", // For Stripe webhooks ], }; // Middlewares app.use(cors(corsOptions)); // Stripe webhook needs raw body app.use("/api/payments/webhook", express.raw({ type: "application/json" })); // Regular JSON parsing for other routes app.use(express.json({ limit: "10mb" })); app.use(express.urlencoded({ extended: true, limit: "10mb" })); // Security headers app.use((req, res, next) => { res.setHeader("X-Content-Type-Options", "nosniff"); res.setHeader("X-Frame-Options", "DENY"); res.setHeader("X-XSS-Protection", "1; mode=block"); next(); }); // Rate limiting app.use(generalLimiter); // API routes app.use("/api/auth", authRoutes); app.use("/api/cars", carRoutes); app.use("/api/bookings", bookingRoutes); app.use("/api/payments", paymentRoutes); // Health check endpoint app.get("/api/health", async (req, res) => { try { const [dbHealth, cloudinaryHealth] = await Promise.all([ checkDBHealth(), checkCloudinaryHealth(), ]); res.json({ success: true, message: "BorrowMyCar API is running", timestamp: new Date().toISOString(), services: { database: dbHealth, cloudinary: cloudinaryHealth, server: { status: "running", environment: process.env.NODE_ENV || "development", version: "1.0.0", }, }, }); } catch (error) { res.status(500).json({ success: false, message: "Health check failed", error: error.message, }); } }); // API info endpoint app.get("/api", (req, res) => { res.json({ success: true, message: "Welcome to BorrowMyCar API", version: "1.0.0", endpoints: { auth: "/api/auth", cars: "/api/cars", bookings: "/api/bookings", payments: "/api/payments", health: "/api/health", }, documentation: "https://api.borrowmycar.ae/docs", }); }); // Handle unknown routes app.use((req, res) => { res.status(404).json({ success: false, message: `Route ${req.originalUrl} not found`, code: "ROUTE_NOT_FOUND", }); }); // Global error handler app.use(globalErrorHandler); // Start server const PORT = process.env.PORT || 5000; const server = app.listen(PORT, () => { console.log(`🚀 Server running on port ${PORT}`); console.log(`🌍 Environment: ${process.env.NODE_ENV || "development"}`); console.log(`📝 API Info: http://localhost:${PORT}/api`); console.log(`💚 Health Check: http://localhost:${PORT}/api/health`); }); // Graceful shutdown process.on("SIGTERM", () => { console.log("👋 SIGTERM received. Shutting down..."); server.close(() => { console.log("💥 Server closed."); }); }); process.on("unhandledRejection", (err) => { console.error("💥 UNHANDLED PROMISE REJECTION!"); console.error(err); server.close(() => process.exit(1)); }); process.on("uncaughtException", (err) => { console.error("💥 UNCAUGHT EXCEPTION!"); console.error(err); process.exit(1); }); export default app;
```

# jsconfig.json

```json
{ "compilerOptions": { // Enable latest features "lib": ["ESNext", "DOM"], "target": "ESNext", "module": "ESNext", "moduleDetection": "force", "jsx": "react-jsx", "allowJs": true, // Bundler mode "moduleResolution": "bundler", "allowImportingTsExtensions": true, "verbatimModuleSyntax": true, "noEmit": true, // Best practices "strict": true, "skipLibCheck": true, "noFallthroughCasesInSwitch": true, // Some stricter flags (disabled by default) "noUnusedLocals": false, "noUnusedParameters": false, "noPropertyAccessFromIndexSignature": false } }
```

# middlewares\authMiddleware.js

```js
// middlewares/authMiddleware.js (Fixed Imports) import jwt from "jsonwebtoken"; import { User } from "../models/User.js"; // Fixed import import rateLimit from "express-rate-limit"; // Enhanced async error handler const handleAsyncError = (fn) => { return (req, res, next) => { Promise.resolve(fn(req, res, next)).catch(next); }; }; // Enhanced JWT protection middleware export const protect = handleAsyncError(async (req, res, next) => { let token; // Extract token from different sources if ( req.headers.authorization && req.headers.authorization.startsWith("Bearer") ) { token = req.headers.authorization.split(" ")[1]; } else if (req.cookies && req.cookies.jwt) { token = req.cookies.jwt; } // Check if token exists if (!token) { return res.status(401).json({ success: false, message: "Access denied. No token provided.", code: "NO_TOKEN_PROVIDED", }); } try { // Verify token const decoded = jwt.verify(token, process.env.JWT_SECRET); // Check if user still exists const user = await User.findById(decoded.id).select("-password"); if (!user) { return res.status(401).json({ success: false, message: "The user belonging to this token no longer exists.", code: "USER_NOT_FOUND", }); } // Check if user account is not deleted if (user.deletedAt) { return res.status(401).json({ success: false, message: "User account has been deactivated.", code: "ACCOUNT_DEACTIVATED", }); } // Add user to request object req.user = user; next(); } catch (error) { let message = "Invalid token"; let code = "INVALID_TOKEN"; if (error.name === "TokenExpiredError") { message = "Token has expired"; code = "TOKEN_EXPIRED"; } else if (error.name === "JsonWebTokenError") { message = "Invalid token format"; code = "MALFORMED_TOKEN"; } return res.status(401).json({ success: false, message, code, }); } }); // Role-based authorization middleware export const restrictTo = (...roles) => { return (req, res, next) => { if (!roles.includes(req.user.role)) { return res.status(403).json({ success: false, message: "You do not have permission to perform this action.", code: "INSUFFICIENT_PERMISSIONS", }); } next(); }; }; // Account approval requirement middleware export const requireApproval = (req, res, next) => { if (!req.user.isApproved) { return res.status(403).json({ success: false, message: "Your account must be approved by admin before performing this action.", code: "ACCOUNT_NOT_APPROVED", }); } next(); }; // Optional authentication - doesn't fail if no token export const optionalAuth = handleAsyncError(async (req, res, next) => { let token; if ( req.headers.authorization && req.headers.authorization.startsWith("Bearer") ) { token = req.headers.authorization.split(" ")[1]; } else if (req.cookies && req.cookies.jwt) { token = req.cookies.jwt; } if (token) { try { const decoded = jwt.verify(token, process.env.JWT_SECRET); const user = await User.findById(decoded.id).select("-password"); if (user && !user.deletedAt) { req.user = user; } } catch (error) { // Silently fail for optional auth console.log("Optional auth failed:", error.message); } } next(); }); // Auth rate limiter (stricter for login/signup) export const authLimiter = rateLimit({ windowMs: 15 * 60 * 1000, // 15 minutes max: 5, // Limit each IP to 5 auth requests per windowMs skipSuccessfulRequests: true, message: { success: false, message: "Too many authentication attempts, please try again later.", code: "AUTH_RATE_LIMIT_EXCEEDED", }, }); // Upload rate limiter export const uploadLimiter = rateLimit({ windowMs: 60 * 60 * 1000, // 1 hour max: 20, // Limit each IP to 20 uploads per hour message: { success: false, message: "Too many upload attempts, please try again later.", code: "UPLOAD_RATE_LIMIT_EXCEEDED", }, });
```

# middlewares\multer.js

```js
// middlewares/multer.js (Enhanced) import multer from "multer"; import path from "path"; import { storage } from "../utils/cloudinary.js"; // Enhanced file filter with comprehensive validation const fileFilter = (req, file, cb) => { // Allowed file types const allowedTypes = ["image/jpeg", "image/jpg", "image/png", "image/webp"]; // Check file type if (!allowedTypes.includes(file.mimetype)) { const error = new Error( "Invalid file type. Only JPEG, PNG, and WebP images are allowed." ); error.code = "INVALID_FILE_TYPE"; return cb(error, false); } // Check file extension as additional security const allowedExtensions = [".jpg", ".jpeg", ".png", ".webp"]; const fileExtension = path.extname(file.originalname).toLowerCase(); if (!allowedExtensions.includes(fileExtension)) { const error = new Error("Invalid file extension."); error.code = "INVALID_FILE_EXTENSION"; return cb(error, false); } cb(null, true); }; // Enhanced multer configuration const upload = multer({ storage, fileFilter, limits: { fileSize: 5 * 1024 * 1024, // 5MB per file files: 10, // Maximum 10 files per request }, }); // Different upload configurations for different use cases export const uploadCarImages = upload.array("images", 10); export const uploadUserDocuments = upload.fields([ { name: "drivingLicense", maxCount: 1 }, { name: "emiratesId", maxCount: 1 }, { name: "visa", maxCount: 1 }, { name: "passport", maxCount: 1 }, { name: "profileImage", maxCount: 1 }, ]); export const uploadProfileImage = upload.single("profileImage"); // Default export for backward compatibility export default upload;
```

# models\Booking.js

```js
// models/Booking.js - FIXED to remove duplicate indexes import mongoose from "mongoose"; const bookingSchema = new mongoose.Schema( { renter: { type: mongoose.Schema.Types.ObjectId, ref: "User", required: true, }, car: { type: mongoose.Schema.Types.ObjectId, ref: "Car", required: true, }, // Booking dates startDate: { type: Date, required: true }, endDate: { type: Date, required: true }, totalDays: { type: Number, required: true, min: 1 }, // Pricing dailyRate: { type: Number, required: true }, totalAmount: { type: Number, required: true }, securityDeposit: { type: Number, default: 0 }, deliveryFee: { type: Number, default: 0 }, totalPayable: { type: Number, required: true }, // totalAmount + securityDeposit + deliveryFee // Status tracking status: { type: String, enum: [ "pending", // Waiting owner approval "approved", // Owner approved, payment pending "confirmed", // Payment confirmed, booking active "active", // Car picked up, rental in progress "completed", // Car returned, booking finished "cancelled", // Cancelled by renter/owner "rejected", // Rejected by owner "expired", // Booking expired without approval ], default: "pending", }, // Payment details paymentMethod: { type: String, enum: ["Cash", "Card", "BankTransfer", "DigitalWallet"], required: true, default: "Cash", }, paymentStatus: { type: String, enum: ["pending", "paid", "failed", "refunded", "partial"], default: "pending", }, transactionId: { type: String }, // For card payments paymentIntentId: { type: String }, // For Stripe integration paidAt: { type: Date }, // When payment was completed // Pickup/Return details pickupLocation: { type: String, required: true }, returnLocation: { type: String, required: true }, pickupTime: { type: Date }, returnTime: { type: Date }, actualReturnTime: { type: Date }, // Delivery options deliveryRequested: { type: Boolean, default: false }, deliveryAddress: { type: String }, // Communication renterNotes: { type: String, maxlength: 500 }, ownerNotes: { type: String, maxlength: 500 }, adminNotes: { type: String, maxlength: 500 }, // Car condition tracking preRentalCondition: { type: String }, // Photos/notes before rental postRentalCondition: { type: String }, // Photos/notes after return damageReported: { type: Boolean, default: false }, damageDescription: { type: String }, // Cancellation cancellationReason: { type: String }, cancelledBy: { type: String, enum: ["renter", "owner", "admin", "system"], }, cancellationFee: { type: Number, default: 0 }, // Review system renterReview: { rating: { type: Number, min: 1, max: 5 }, comment: { type: String, maxlength: 500 }, reviewedAt: { type: Date }, }, ownerReview: { rating: { type: Number, min: 1, max: 5 }, comment: { type: String, maxlength: 500 }, reviewedAt: { type: Date }, }, // System tracking approvedAt: { type: Date }, confirmedAt: { type: Date }, completedAt: { type: Date }, expiresAt: { type: Date }, // Auto-expire pending bookings after 24h }, { timestamps: true, } ); // FIXED: Consolidated index definitions (no duplicates) bookingSchema.index({ renter: 1, status: 1 }); // Renter's bookings by status bookingSchema.index({ car: 1, status: 1 }); // Car bookings by status bookingSchema.index({ startDate: 1, endDate: 1 }); // Date range queries bookingSchema.index({ status: 1, expiresAt: 1 }); // For cleanup jobs bookingSchema.index({ status: 1 }); // General status queries bookingSchema.index({ paymentStatus: 1 }); // Payment status queries bookingSchema.index({ createdAt: -1 }); // Recent bookings first // Calculate total days before saving bookingSchema.pre("save", function () { if (this.isModified("startDate") || this.isModified("endDate")) { const diffTime = this.endDate - this.startDate; this.totalDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); if (this.totalDays < 1) { throw new Error("End date must be after start date"); } } // Calculate totalPayable if ( this.isModified("totalAmount") || this.isModified("securityDeposit") || this.isModified("deliveryFee") ) { this.totalPayable = (this.totalAmount || 0) + (this.securityDeposit || 0) + (this.deliveryFee || 0); } }); // Static method to find conflicting bookings bookingSchema.statics.findConflictingBookings = function ( carId, startDate, endDate, excludeBookingId = null ) { const filter = { car: carId, status: { $in: ["pending", "approved", "confirmed", "active"] }, $or: [ { startDate: { $lte: new Date(endDate) }, endDate: { $gte: new Date(startDate) }, }, ], }; if (excludeBookingId) { filter._id = { $ne: excludeBookingId }; } return this.findOne(filter); }; export const Booking = mongoose.model("Booking", bookingSchema); export default Booking;
```

# models\Car.js

```js
// models/Car.js - FIXED to remove duplicate indexes import mongoose from "mongoose"; const carSchema = new mongoose.Schema( { owner: { type: mongoose.Schema.Types.ObjectId, ref: "User", required: true, }, title: { type: String, required: [true, "Car title is required"], trim: true, maxlength: [100, "Title cannot exceed 100 characters"], }, description: { type: String, required: [true, "Car description is required"], maxlength: [1000, "Description cannot exceed 1000 characters"], }, city: { type: String, required: [true, "City is required"], enum: { values: [ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", ], message: "Please select a valid UAE city", }, }, // FIXED: Consistent pricing field price: { type: Number, required: [true, "Price per day is required"], min: [50, "Price cannot be less than AED 50 per day"], max: [5000, "Price cannot exceed AED 5000 per day"], }, // Availability dates availabilityFrom: { type: Date, required: [true, "Availability start date is required"], }, availabilityTo: { type: Date, required: [true, "Availability end date is required"], }, // Car specifications make: { type: String, required: [true, "Car make is required"], trim: true, }, model: { type: String, required: [true, "Car model is required"], trim: true, }, year: { type: Number, required: [true, "Car year is required"], min: [2010, "Car year cannot be before 2010"], max: [new Date().getFullYear() + 1, "Invalid car year"], }, color: { type: String, required: [true, "Car color is required"], trim: true, }, plateNumber: { type: String, required: [true, "Plate number is required"], uppercase: true, validate: { validator: function (v) { return /^[A-Z]{1,3}[0-9]{1,5}$/.test(v); }, message: "Please enter a valid UAE plate number (e.g., A12345)", }, }, transmission: { type: String, enum: { values: ["Automatic", "Manual", "CVT", "Semi-Automatic"], message: "Please select a valid transmission type", }, required: true, default: "Automatic", }, fuelType: { type: String, enum: { values: ["Petrol", "Diesel", "Electric", "Hybrid", "Plug-in Hybrid"], message: "Please select a valid fuel type", }, required: true, default: "Petrol", }, mileage: { type: Number, required: [true, "Mileage is required"], min: [0, "Mileage cannot be negative"], max: [500000, "Mileage seems too high"], }, seatingCapacity: { type: Number, required: [true, "Seating capacity is required"], min: [2, "Minimum 2 seats required"], max: [8, "Maximum 8 seats allowed"], }, specifications: { type: String, enum: { values: [ "GCC Specs", "US Specs", "Japanese Specs", "European Specs", "Canadian Specs", "Korean Specs", ], message: "Please select valid specifications", }, required: true, default: "GCC Specs", }, // Car features with VALID enum values features: [ { type: String, enum: { values: [ "GPS Navigation", "Bluetooth", "USB Charging", "Wireless Charging", "Sunroof", "Leather Seats", "Heated Seats", "Cooled Seats", "Backup Camera", "Parking Sensors", "Cruise Control", "Keyless Entry", "Push Start", "Auto AC", "Dual Zone AC", "Premium Sound System", ], message: "Invalid feature selected", }, }, ], // Images array - minimum 3 required images: { type: [String], required: [true, "Car images are required"], validate: { validator: function (v) { return v && v.length >= 3; }, message: "At least 3 images are required", }, }, // Additional settings isInstantApproval: { type: Boolean, default: true }, minimumRentalDays: { type: Number, default: 1, min: 1 }, maximumRentalDays: { type: Number, default: 30, min: 1 }, deliveryAvailable: { type: Boolean, default: false }, deliveryFee: { type: Number, default: 0, min: 0 }, securityDeposit: { type: Number, default: 500, min: 0 }, // Status tracking status: { type: String, enum: { values: ["active", "inactive", "deleted", "pending", "maintenance"], message: "Invalid status", }, default: "active", // Changed from pending to active for demo }, totalBookings: { type: Number, default: 0 }, averageRating: { type: Number, default: 0, min: 0, max: 5 }, // Admin fields adminNotes: String, rejectionReason: String, // Soft delete deletedAt: { type: Date, default: null }, }, { timestamps: true, } ); // FIXED: Consolidated index definitions (no duplicates) carSchema.index({ city: 1, status: 1 }); // Compound index for city + status queries carSchema.index({ price: 1 }); // Price range queries carSchema.index({ make: 1, model: 1 }); // Make + model searches carSchema.index({ availabilityFrom: 1, availabilityTo: 1 }); // Date range queries carSchema.index({ owner: 1 }); // Owner's cars carSchema.index({ status: 1 }); // Status queries carSchema.index({ title: "text", description: "text", make: "text", model: "text", }); // Text search index // Pre-save validation carSchema.pre("save", function (next) { // Validate date range if (this.availabilityTo <= this.availabilityFrom) { const error = new Error("Availability end date must be after start date"); return next(error); } next(); }); // Hide deleted cars in queries carSchema.pre(/^find/, function (next) { this.find({ deletedAt: null }); next(); }); // Virtual for frontend compatibility carSchema.virtual("pricePerDay").get(function () { return this.price; }); // Ensure virtual fields are serialized carSchema.set("toJSON", { virtuals: true }); carSchema.set("toObject", { virtuals: true }); export default mongoose.model("Car", carSchema);
```

# models\User.js

```js
// models/User.js - FIXED to remove duplicate indexes import mongoose from "mongoose"; import bcrypt from "bcryptjs"; import { formatUAEPhone, validateUAEPhone, displayUAEPhone, } from "../utils/phoneUtils.js"; const userSchema = new mongoose.Schema( { name: { type: String, required: true, trim: true, }, email: { type: String, required: true, unique: true, // REMOVED: index: true (this was causing duplicate) lowercase: true, trim: true, }, phone: { type: String, required: true, validate: { validator: function (v) { return validateUAEPhone(v); }, message: "Please enter a valid UAE phone number (e.g., 0501234567)", }, }, password: { type: String, required: true, minlength: 6, select: false, // Don't include password by default }, profileImage: { type: String, }, role: { type: String, enum: ["renter", "owner", "admin"], default: "renter", }, isApproved: { type: Boolean, default: false, }, // Document URLs drivingLicenseUrl: { type: String, required: true, }, emiratesIdUrl: { type: String, }, visaUrl: { type: String, }, passportUrl: { type: String, }, // User preferences preferredCity: { type: String, enum: [ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", ], }, // Notification preferences notificationPreferences: { emailBookings: { type: Boolean, default: true }, emailPromotions: { type: Boolean, default: false }, smsBookings: { type: Boolean, default: true }, smsReminders: { type: Boolean, default: true }, pushNotifications: { type: Boolean, default: true }, }, // Privacy settings privacySettings: { profileVisibility: { type: String, enum: ["public", "private"], default: "public", }, showPhone: { type: Boolean, default: false }, showEmail: { type: Boolean, default: false }, allowMessages: { type: Boolean, default: true }, }, // Account status isEmailVerified: { type: Boolean, default: false }, isPhoneVerified: { type: Boolean, default: false }, lastLoginAt: { type: Date }, // Soft delete deletedAt: { type: Date, default: null }, }, { timestamps: true, } ); // FIXED: Consolidated index definitions (no duplicates) userSchema.index({ email: 1 }); // Single email index userSchema.index({ phone: 1 }); // Phone index userSchema.index({ isApproved: 1, role: 1 }); // Compound index for queries userSchema.index({ role: 1 }); // Role index userSchema.index({ deletedAt: 1 }); // Soft delete index // Pre-save middleware to format phone number userSchema.pre("save", function (next) { if (this.isModified("phone")) { this.phone = formatUAEPhone(this.phone); } next(); }); // Hash password before saving userSchema.pre("save", async function (next) { // Only hash the password if it has been modified (or is new) if (!this.isModified("password")) return next(); try { // Hash password with cost of 12 this.password = await bcrypt.hash(this.password, 12); next(); } catch (error) { next(error); } }); // Instance method to check password userSchema.methods.matchPassword = async function (enteredPassword) { return await bcrypt.compare(enteredPassword, this.password); }; // Hide deleted users in queries userSchema.pre(/^find/, function (next) { // this points to the current query this.find({ deletedAt: null }); next(); }); // Virtual for displaying phone in local format userSchema.virtual("phoneDisplay").get(function () { return displayUAEPhone(this.phone); }); // Method to get public profile data userSchema.methods.getPublicProfile = function () { const publicData = { id: this._id, name: this.name, role: this.role, profileImage: this.profileImage, preferredCity: this.preferredCity, createdAt: this.createdAt, }; // Add contact info based on privacy settings if (this.privacySettings?.showEmail) { publicData.email = this.email; } if (this.privacySettings?.showPhone) { publicData.phone = this.phone; } return publicData; }; // Method to get full profile data (for owner) userSchema.methods.getPrivateProfile = function () { return { id: this._id, name: this.name, email: this.email, phone: this.phone, role: this.role, isApproved: this.isApproved, profileImage: this.profileImage, preferredCity: this.preferredCity, notificationPreferences: this.notificationPreferences, privacySettings: this.privacySettings, isEmailVerified: this.isEmailVerified, isPhoneVerified: this.isPhoneVerified, createdAt: this.createdAt, lastLoginAt: this.lastLoginAt, }; }; // Static method to find users with public profiles userSchema.statics.findPublicProfiles = function (query = {}) { return this.find({ ...query, deletedAt: null, "privacySettings.profileVisibility": "public", }); }; // Ensure virtual fields are serialized userSchema.set("toJSON", { virtuals: true }); userSchema.set("toObject", { virtuals: true }); // Create and export the model const User = mongoose.model("User", userSchema); // Export both named and default exports for compatibility export { User }; export default User;
```

# package.json

```json
{ "name": "borrowmycar-vibecoding", "version": "1.0.0", "type": "module", "description": "Car rental platform for UAE - Backend API", "main": "index.js", "scripts": { "start": "node index.js", "dev": "nodemon index.js", "dev:frontend": "cd borrowmycarfrontend && npm run dev", "dev:both": "concurrently \"npm run dev\" \"npm run dev:frontend\"", "seed": "node scripts/seedData.js", "setup": "npm install && cd borrowmycarfrontend && npm install", "build": "cd borrowmycarfrontend && npm run build", "build:backend": "echo 'Backend is already production ready'", "test": "echo \"Tests not implemented yet\" && exit 0", "test:watch": "echo \"Test watch not implemented yet\" && exit 0", "lint": "echo \"Linting not configured\" && exit 0", "clean": "rm -rf borrowmycarfrontend/dist && rm -rf borrowmycarfrontend/node_modules/.vite", "reset": "rm -rf node_modules && rm -rf borrowmycarfrontend/node_modules && npm install && cd borrowmycarfrontend && npm install", "cleanup:indexes": "node scripts/cleanupIndexes.js", "fix:warnings": "npm run cleanup:indexes", "fresh:start": "npm run cleanup:indexes && npm run seed && npm run dev:both", "prod": "NODE_ENV=production node index.js", "check": "node -e \"console.log('Node.js version:', process.version); console.log('Platform:', process.platform); console.log('Environment:', process.env.NODE_ENV || 'development');\"" }, "keywords": [ "car-rental", "uae", "booking", "nodejs", "express", "mongodb", "react" ], "author": "BorrowMyCar Team", "license": "MIT", "devDependencies": { "@types/bun": "latest", "nodemon": "^3.0.3", "concurrently": "^8.2.2" }, "dependencies": { "bcryptjs": "^3.0.2", "cloudinary": "^2.6.1", "cors": "^2.8.5", "dotenv": "^16.5.0", "express": "^5.1.0", "express-rate-limit": "^7.5.0", "express-validator": "^7.2.1", "jsonwebtoken": "^9.0.2", "mongoose": "^8.15.1", "morgan": "^1.10.0", "multer": "^2.0.0", "multer-storage-cloudinary": "^4.0.0", "socket.io": "^4.8.1", "stripe": "^18.2.1" }, "engines": { "node": ">=18.0.0", "npm": ">=8.0.0" }, "repository": { "type": "git", "url": "https://github.com/maafkarbai/borrowmycar-vibecoding.git" }, "bugs": { "url": "https://github.com/maafkarbai/borrowmycar-vibecoding/issues" }, "homepage": "https://github.com/maafkarbaiborrowmycar-vibecoding#readme" }
```

# README.md

```md
# borrowmycar-vibecoding To install dependencies: \`\`\`bash bun install \`\`\` To run: \`\`\`bash bun run index.js \`\`\` This project was created using `bun init` in bun v1.1.6. [Bun](https://bun.sh) is a fast all-in-one JavaScript runtime.
```

# routes\authRoutes.js

```js
// routes/authRoutes.js - Enhanced with Profile Picture Management import express from "express"; import { signup, login, getProfile, updateProfile, updateProfilePicture, // NEW removeProfilePicture, // NEW changePassword, updatePreferences, exportUserData, deleteAccount, logout, } from "../controllers/authController.js"; import { protect, authLimiter } from "../middlewares/authMiddleware.js"; import { uploadUserDocuments, uploadProfileImage, } from "../middlewares/multer.js"; import { validateSignup, validateLogin, handleValidationErrors, } from "../utils/validators.js"; import { body } from "express-validator"; const router = express.Router(); // Validation rules for profile updates const validateProfileUpdate = [ body("name") .optional() .trim() .isLength({ min: 2, max: 50 }) .withMessage("Name must be between 2 and 50 characters"), body("preferredCity") .optional() .isIn([ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", ]) .withMessage("Please select a valid UAE city"), ]; // Validation rules for preferences const validatePreferences = [ body("notifications.emailBookings") .optional() .isBoolean() .withMessage("Email bookings preference must be true or false"), body("notifications.emailPromotions") .optional() .isBoolean() .withMessage("Email promotions preference must be true or false"), body("notifications.smsBookings") .optional() .isBoolean() .withMessage("SMS bookings preference must be true or false"), body("notifications.smsReminders") .optional() .isBoolean() .withMessage("SMS reminders preference must be true or false"), body("notifications.pushNotifications") .optional() .isBoolean() .withMessage("Push notifications preference must be true or false"), body("privacy.profileVisibility") .optional() .isIn(["public", "private"]) .withMessage("Profile visibility must be public or private"), body("privacy.showPhone") .optional() .isBoolean() .withMessage("Show phone preference must be true or false"), body("privacy.showEmail") .optional() .isBoolean() .withMessage("Show email preference must be true or false"), body("privacy.allowMessages") .optional() .isBoolean() .withMessage("Allow messages preference must be true or false"), ]; // PUBLIC ROUTES (No authentication required) router.post( "/signup", authLimiter, uploadUserDocuments, validateSignup, handleValidationErrors, signup ); router.post( "/register", // Alternative endpoint name authLimiter, uploadUserDocuments, validateSignup, handleValidationErrors, signup ); router.post( "/login", authLimiter, validateLogin, handleValidationErrors, login ); // PROTECTED ROUTES (Authentication required) router.use(protect); // Apply protection to all routes below // Profile management router.get("/profile", getProfile); router.patch( "/profile", uploadProfileImage, // Handle single profile image upload validateProfileUpdate, handleValidationErrors, updateProfile ); // NEW: Profile picture specific routes router.put( "/profile-picture", uploadProfileImage, // Handle single profile image upload updateProfilePicture ); router.delete("/profile-picture", removeProfilePicture); // Security router.patch("/change-password", changePassword); // Preferences (notifications and privacy) router.patch( "/preferences", validatePreferences, handleValidationErrors, updatePreferences ); // Data management router.get("/export-data", exportUserData); router.delete("/account", deleteAccount); // Logout router.post("/logout", logout); export default router;
```

# routes\bookingRoutes.js

```js
// routes/bookingRoutes.js - FIXED VERSION import express from "express"; import { createBooking, getMyBookings, getBookingsForOwner, updateBookingStatus, getBookingById, cancelBooking, addReview, } from "../controllers/bookingController.js"; import { protect, restrictTo } from "../middlewares/authMiddleware.js"; import { validateCreateBooking, validateUpdateBookingStatus, validateAddReview, handleValidationErrors, } from "../utils/validators.js"; const router = express.Router(); // All routes require authentication router.use(protect); // POST /api/bookings - Create new booking (renters only) router.post( "/", restrictTo("renter"), validateCreateBooking, handleValidationErrors, createBooking ); // GET /api/bookings/me - Get my bookings (renter's bookings) router.get("/me", restrictTo("renter"), getMyBookings); // GET /api/bookings/owner - Get bookings for my cars (owner's received bookings) router.get("/owner", restrictTo("owner"), getBookingsForOwner); // GET /api/bookings/:id - Get single booking details router.get("/:id", getBookingById); // PUT /api/bookings/:id - Update booking status (owner can approve/reject, renter can cancel) router.put( "/:id", validateUpdateBookingStatus, handleValidationErrors, updateBookingStatus ); // PATCH /api/bookings/:id/cancel - Cancel booking router.patch("/:id/cancel", cancelBooking); // POST /api/bookings/:id/review - Add review to completed booking router.post( "/:id/review", validateAddReview, handleValidationErrors, addReview ); export default router;
```

# routes\carRoutes.js

```js
// routes/carRoutes.js (Updated with all routes) import express from "express"; import { createCar, getCars, getCarById, updateCar, deleteCar, getCarsByOwner, getMyCars, } from "../controllers/carController.js"; import { protect, restrictTo, requireApproval, optionalAuth, uploadLimiter, } from "../middlewares/authMiddleware.js"; import { uploadCarImages } from "../middlewares/multer.js"; import { body, validationResult } from "express-validator"; const router = express.Router(); // Car validation rules to match model fields const carValidationRules = [ body("title") .notEmpty() .withMessage("Title is required") .isLength({ min: 3, max: 100 }) .withMessage("Title must be between 3 and 100 characters"), body("description") .notEmpty() .withMessage("Description is required") .isLength({ min: 10, max: 1000 }) .withMessage("Description must be between 10 and 1000 characters"), body("city") .notEmpty() .withMessage("City is required") .isIn([ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", ]) .withMessage("Please select a valid UAE city"), // Handle both price and pricePerDay from frontend body("price") .optional() .isNumeric() .withMessage("Price must be a number") .isFloat({ min: 50, max: 5000 }) .withMessage("Price must be between AED 50 and AED 5000 per day"), body("pricePerDay") .optional() .isNumeric() .withMessage("Price per day must be a number") .isFloat({ min: 50, max: 5000 }) .withMessage("Price per day must be between AED 50 and AED 5000"), body("make") .notEmpty() .withMessage("Car make is required") .isLength({ min: 2 }) .withMessage("Car make must be at least 2 characters"), body("model").notEmpty().withMessage("Car model is required"), body("year") .isInt({ min: 2010, max: new Date().getFullYear() + 1 }) .withMessage("Car year must be between 2010 and current year"), body("color").notEmpty().withMessage("Car color is required"), body("plateNumber") .notEmpty() .withMessage("Plate number is required") .matches(/^[A-Z]{1,3}[0-9]{1,5}$/) .withMessage( "Please enter a valid UAE plate number (e.g., A12345, ABC123)" ), body("transmission") .isIn(["Automatic", "Manual", "CVT", "Semi-Automatic"]) .withMessage("Please select a valid transmission type"), body("fuelType") .isIn(["Petrol", "Diesel", "Electric", "Hybrid", "Plug-in Hybrid"]) .withMessage("Please select a valid fuel type"), body("mileage") .isInt({ min: 0, max: 500000 }) .withMessage("Mileage must be between 0 and 500,000 km"), body("seatingCapacity") .isInt({ min: 2, max: 8 }) .withMessage("Seating capacity must be between 2 and 8"), body("availabilityFrom") .isISO8601() .withMessage("Please provide a valid availability start date"), body("availabilityTo") .isISO8601() .withMessage("Please provide a valid availability end date"), ]; // Enhanced validation error handler const handleValidationErrors = (req, res, next) => { const errors = validationResult(req); if (!errors.isEmpty()) { const formattedErrors = errors.array().map((error) => ({ field: error.path || error.param, message: error.msg, value: error.value, })); return res.status(400).json({ success: false, message: "Validation failed", errors: formattedErrors, code: "VALIDATION_ERROR", }); } next(); }; // PUBLIC ROUTES // GET /api/cars - Get all cars with filtering router.get( "/", optionalAuth, // Optional authentication for personalized results getCars ); // GET /api/cars/:id - Get single car router.get("/:id", optionalAuth, getCarById); // GET /api/cars/owner/:ownerId - Get cars by specific owner router.get("/owner/:ownerId", getCarsByOwner); // PROTECTED ROUTES (Authentication required) router.use(protect); // Apply protection to all routes below // GET /api/cars/my/cars - Get current user's cars (Owner only) router.get("/my/cars", restrictTo("owner"), getMyCars); // POST /api/cars - Create new car (Owner only) router.post( "/", restrictTo("owner"), // Only owners can create cars requireApproval, // Account must be approved uploadLimiter, // Rate limiting for uploads uploadCarImages, // Handle file upload (up to 10 images) carValidationRules, // Validate input data handleValidationErrors, // Handle validation errors createCar // Create car controller ); // PUT /api/cars/:id - Update car (Owner only, own cars) router.put( "/:id", restrictTo("owner"), uploadCarImages, // Allow image updates (up to 10 images) carValidationRules, // Validate updated data handleValidationErrors, updateCar ); // PATCH /api/cars/:id - Partial update car (Owner only, own cars) router.patch( "/:id", restrictTo("owner"), uploadCarImages, // Allow image updates updateCar ); // DELETE /api/cars/:id - Delete car (Owner only, own cars) router.delete("/:id", restrictTo("owner"), deleteCar); export default router;
```

# routes\paymentRoutes.js

```js
import express from "express"; import { createPaymentIntent, confirmPayment, handleStripeWebhook, getPaymentHistory, } from "../controllers/paymentController.js"; import { protect, restrictTo } from "../middlewares/authMiddleware.js"; import { body } from "express-validator"; import { handleValidationErrors } from "../utils/validators.js"; const router = express.Router(); // Webhook route (no auth needed, but needs raw body) router.post( "/webhook", express.raw({ type: "application/json" }), handleStripeWebhook ); // All other routes require authentication router.use(protect); // Payment intent creation (renters only) router.post( "/create-intent", restrictTo("renter"), [body("bookingId").isMongoId().withMessage("Valid booking ID required")], handleValidationErrors, createPaymentIntent ); // Payment confirmation router.post( "/confirm", restrictTo("renter"), [ body("paymentIntentId") .notEmpty() .withMessage("Payment intent ID required"), body("bookingId").isMongoId().withMessage("Valid booking ID required"), ], handleValidationErrors, confirmPayment ); // Payment history router.get("/history", restrictTo("renter"), getPaymentHistory); export default router;
```

# scripts\cleanupIndexes.js

```js
// scripts/cleanupIndexes.js - Run this to clean up duplicate indexes import mongoose from "mongoose"; import dotenv from "dotenv"; dotenv.config(); const cleanupDuplicateIndexes = async () => { try { console.log("🧹 Starting index cleanup..."); // Connect to MongoDB await mongoose.connect(process.env.MONGO_URI, { dbName: "borrowmycar", }); console.log("✅ Connected to MongoDB"); const db = mongoose.connection.db; // Clean up User collection indexes console.log("\n📋 Cleaning User collection indexes..."); try { const userIndexes = await db.collection("users").indexes(); console.log( "Current User indexes:", userIndexes.map((i) => i.name) ); // Drop all indexes except _id_ await db.collection("users").dropIndexes(); console.log("✅ Dropped all User indexes"); // Recreate only necessary indexes await db.collection("users").createIndex({ email: 1 }, { unique: true }); await db.collection("users").createIndex({ phone: 1 }); await db.collection("users").createIndex({ isApproved: 1, role: 1 }); await db.collection("users").createIndex({ role: 1 }); await db.collection("users").createIndex({ deletedAt: 1 }); console.log("✅ Recreated User indexes without duplicates"); } catch (error) { console.log("⚠️ User collection might not exist yet:", error.message); } // Clean up Car collection indexes console.log("\n🚗 Cleaning Car collection indexes..."); try { const carIndexes = await db.collection("cars").indexes(); console.log( "Current Car indexes:", carIndexes.map((i) => i.name) ); // Drop all indexes except _id_ await db.collection("cars").dropIndexes(); console.log("✅ Dropped all Car indexes"); // Recreate only necessary indexes await db.collection("cars").createIndex({ city: 1, status: 1 }); await db.collection("cars").createIndex({ price: 1 }); await db.collection("cars").createIndex({ make: 1, model: 1 }); await db .collection("cars") .createIndex({ availabilityFrom: 1, availabilityTo: 1 }); await db.collection("cars").createIndex({ owner: 1 }); await db.collection("cars").createIndex({ status: 1 }); await db.collection("cars").createIndex({ title: "text", description: "text", make: "text", model: "text", }); console.log("✅ Recreated Car indexes without duplicates"); } catch (error) { console.log("⚠️ Car collection might not exist yet:", error.message); } // Clean up Booking collection indexes console.log("\n📅 Cleaning Booking collection indexes..."); try { const bookingIndexes = await db.collection("bookings").indexes(); console.log( "Current Booking indexes:", bookingIndexes.map((i) => i.name) ); // Drop all indexes except _id_ await db.collection("bookings").dropIndexes(); console.log("✅ Dropped all Booking indexes"); // Recreate only necessary indexes await db.collection("bookings").createIndex({ renter: 1, status: 1 }); await db.collection("bookings").createIndex({ car: 1, status: 1 }); await db.collection("bookings").createIndex({ startDate: 1, endDate: 1 }); await db.collection("bookings").createIndex({ status: 1, expiresAt: 1 }); await db.collection("bookings").createIndex({ status: 1 }); await db.collection("bookings").createIndex({ paymentStatus: 1 }); await db.collection("bookings").createIndex({ createdAt: -1 }); console.log("✅ Recreated Booking indexes without duplicates"); } catch (error) { console.log("⚠️ Booking collection might not exist yet:", error.message); } console.log("\n🎉 Index cleanup completed successfully!"); console.log("\n📋 Final index summary:"); // Show final indexes try { const collections = ["users", "cars", "bookings"]; for (const collName of collections) { try { const indexes = await db.collection(collName).indexes(); console.log( `\n${collName}:`, indexes.map((i) => i.name) ); } catch (err) { console.log(`\n${collName}: Collection doesn't exist yet`); } } } catch (error) { console.log("Could not show final summary:", error.message); } await mongoose.disconnect(); console.log("\n👋 Disconnected from MongoDB"); } catch (error) { console.error("❌ Error during index cleanup:", error); process.exit(1); } }; // Run the cleanup cleanupDuplicateIndexes() .then(() => { console.log("\n✅ Index cleanup script completed"); process.exit(0); }) .catch((error) => { console.error("❌ Script failed:", error); process.exit(1); });
```

# scripts\seedData.js

```js
// scripts/seedData.js - FIXED with valid enum features import mongoose from "mongoose"; import bcrypt from "bcryptjs"; import { User } from "../models/User.js"; import Car from "../models/Car.js"; import Booking from "../models/Booking.js"; import dotenv from "dotenv"; dotenv.config(); const seedDatabase = async () => { try { console.log("🌱 Starting database seeding..."); // Connect to MongoDB await mongoose.connect(process.env.MONGO_URI, { dbName: "borrowmycar", }); console.log("✅ Connected to MongoDB"); // Clear existing data await User.deleteMany({}); await Car.deleteMany({}); await Booking.deleteMany({}); console.log("🧹 Cleared existing data"); // Create admin user const admin = await User.create({ name: "Admin User", email: "admin@borrowmycar.ae", phone: "0501234567", // UAE local format password: "admin123", role: "admin", isApproved: true, preferredCity: "Dubai", drivingLicenseUrl: "https://via.placeholder.com/400x300?text=Admin+License", }); // Create test car owners const owner1 = await User.create({ name: "Ahmed Al-Mansouri", email: "ahmed@test.com", phone: "0502345678", // UAE local format password: "password123", role: "owner", isApproved: true, preferredCity: "Dubai", drivingLicenseUrl: "https://via.placeholder.com/400x300?text=Ahmed+License", }); const owner2 = await User.create({ name: "Fatima Al-Zahra", email: "fatima@test.com", phone: "0503456789", // UAE local format password: "password123", role: "owner", isApproved: true, preferredCity: "Abu Dhabi", drivingLicenseUrl: "https://via.placeholder.com/400x300?text=Fatima+License", }); // Create test renters const renter1 = await User.create({ name: "Sarah Johnson", email: "sarah@test.com", phone: "0504567890", // UAE local format password: "password123", role: "renter", isApproved: true, preferredCity: "Dubai", drivingLicenseUrl: "https://via.placeholder.com/400x300?text=Sarah+License", }); const renter2 = await User.create({ name: "Michael Chen", email: "michael@test.com", phone: "0505678901", // UAE local format password: "password123", role: "renter", isApproved: true, preferredCity: "Sharjah", drivingLicenseUrl: "https://via.placeholder.com/400x300?text=Michael+License", }); console.log("👥 Created test users"); // Valid features from Car model enum const validFeatures = [ "GPS Navigation", "Bluetooth", "USB Charging", "Wireless Charging", "Sunroof", "Leather Seats", "Heated Seats", "Cooled Seats", "Backup Camera", "Parking Sensors", "Cruise Control", "Keyless Entry", "Push Start", "Auto AC", "Dual Zone AC", "Premium Sound System", ]; // Create test cars with ONLY valid features const cars = []; // Ahmed's cars const car1 = await Car.create({ owner: owner1._id, title: "Toyota Camry 2023 - Luxury Sedan", description: "Premium Toyota Camry with leather seats, GPS navigation, and excellent fuel economy. Perfect for business trips or family outings.", city: "Dubai", price: 180, // Using 'price' field consistently availabilityFrom: new Date(), availabilityTo: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000), // 90 days make: "Toyota", model: "Camry", year: 2023, color: "Pearl White", plateNumber: "A12345", transmission: "Automatic", fuelType: "Petrol", mileage: 15000, seatingCapacity: 5, specifications: "GCC Specs", features: [ "GPS Navigation", "Bluetooth", "Leather Seats", "Backup Camera", ], images: [ "https://images.unsplash.com/photo-1621007947382-bb3c3994e3fb?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1550355291-bbee04a92027?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1494976888653-603eb4928b84?w=800&h=600&fit=crop", ], status: "active", }); const car2 = await Car.create({ owner: owner1._id, title: "BMW X3 2024 - Premium SUV", description: "Luxury SUV with premium sound system and spacious interior. Ideal for family adventures.", city: "Dubai", price: 320, availabilityFrom: new Date(), availabilityTo: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000), // 60 days make: "BMW", model: "X3", year: 2024, color: "Space Gray", plateNumber: "B67890", transmission: "Automatic", fuelType: "Petrol", mileage: 8000, seatingCapacity: 5, specifications: "GCC Specs", features: [ "GPS Navigation", "Sunroof", "Leather Seats", "Premium Sound System", ], images: [ "https://images.unsplash.com/photo-1555215695-3004980ad54e?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1549317661-bd32c8ce0db2?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1563720223185-11003d516935?w=800&h=600&fit=crop", ], status: "active", }); // Fatima's cars const car3 = await Car.create({ owner: owner2._id, title: "Honda Civic 2023 - Compact Sedan", description: "Fuel-efficient and reliable Honda Civic, perfect for city driving and daily commutes.", city: "Abu Dhabi", price: 150, availabilityFrom: new Date(), availabilityTo: new Date(Date.now() + 120 * 24 * 60 * 60 * 1000), // 120 days make: "Honda", model: "Civic", year: 2023, color: "Midnight Blue", plateNumber: "C11111", transmission: "Automatic", fuelType: "Petrol", mileage: 12000, seatingCapacity: 5, specifications: "GCC Specs", features: [ "Bluetooth", "USB Charging", "Backup Camera", "Cruise Control", ], images: [ "https://images.unsplash.com/photo-1606664515524-ed2f786a0bd6?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1583121274602-3e2820c69888?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1552519507-da3b142c6e3d?w=800&h=600&fit=crop", ], status: "active", }); const car4 = await Car.create({ owner: owner2._id, title: "Mercedes C-Class 2024 - Executive Sedan", description: "Elegant Mercedes C-Class with premium interior, advanced safety features, and smooth performance.", city: "Abu Dhabi", price: 280, availabilityFrom: new Date(), availabilityTo: new Date(Date.now() + 75 * 24 * 60 * 60 * 1000), // 75 days make: "Mercedes-Benz", model: "C-Class", year: 2024, color: "Obsidian Black", plateNumber: "D22222", transmission: "Automatic", fuelType: "Petrol", mileage: 5000, seatingCapacity: 5, specifications: "GCC Specs", features: [ "GPS Navigation", "Leather Seats", "Heated Seats", "Premium Sound System", ], images: [ "https://images.unsplash.com/photo-1618843479313-40f8afb4b4d8?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1606114737970-346c60ef1069?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1563694983011-6f4d90358083?w=800&h=600&fit=crop", ], status: "active", }); // Add more diverse cars for better testing const car5 = await Car.create({ owner: owner1._id, title: "Nissan Patrol 2023 - Family SUV", description: "Spacious family SUV perfect for desert trips and large groups. Comes with advanced safety features.", city: "Dubai", price: 250, availabilityFrom: new Date(), availabilityTo: new Date(Date.now() + 45 * 24 * 60 * 60 * 1000), // 45 days make: "Nissan", model: "Patrol", year: 2023, color: "Arctic White", plateNumber: "E33333", transmission: "Automatic", fuelType: "Petrol", mileage: 25000, seatingCapacity: 8, specifications: "GCC Specs", features: [ "GPS Navigation", "Premium Sound System", "Parking Sensors", "Auto AC", "Keyless Entry", ], images: [ "https://images.unsplash.com/photo-1544636331-e26879cd4d9b?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1519641471654-76ce0107ad1b?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1553440569-bcc63803a83d?w=800&h=600&fit=crop", ], status: "active", }); const car6 = await Car.create({ owner: owner2._id, title: "Hyundai Elantra 2022 - Economy Sedan", description: "Affordable and fuel-efficient sedan, perfect for daily commuting and city driving.", city: "Sharjah", price: 120, availabilityFrom: new Date(), availabilityTo: new Date(Date.now() + 100 * 24 * 60 * 60 * 1000), // 100 days make: "Hyundai", model: "Elantra", year: 2022, color: "Silver", plateNumber: "F44444", transmission: "Automatic", fuelType: "Petrol", mileage: 35000, seatingCapacity: 5, specifications: "GCC Specs", features: ["Bluetooth", "USB Charging", "Auto AC", "Cruise Control"], images: [ "https://images.unsplash.com/photo-1605559424843-9e4c228bf1c2?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1552519507-da3b142c6e3d?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1494976888653-603eb4928b84?w=800&h=600&fit=crop", ], status: "active", }); cars.push(car1, car2, car3, car4, car5, car6); console.log("🚗 Created test cars"); // Create some test bookings const booking1 = await Booking.create({ renter: renter1._id, car: car1._id, startDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), // 7 days from now endDate: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000), // 10 days from now totalDays: 3, dailyRate: 180, totalAmount: 540, totalPayable: 540, paymentMethod: "Card", pickupLocation: "Dubai Mall", returnLocation: "Dubai Mall", status: "pending", }); const booking2 = await Booking.create({ renter: renter2._id, car: car3._id, startDate: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000), // 14 days from now endDate: new Date(Date.now() + 17 * 24 * 60 * 60 * 1000), // 17 days from now totalDays: 3, dailyRate: 150, totalAmount: 450, totalPayable: 450, paymentMethod: "Cash", pickupLocation: "Abu Dhabi Airport", returnLocation: "Abu Dhabi Airport", status: "approved", }); const booking3 = await Booking.create({ renter: renter1._id, car: car5._id, startDate: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000), // 5 days ago endDate: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000), // 2 days ago totalDays: 3, dailyRate: 250, totalAmount: 750, totalPayable: 750, paymentMethod: "Card", pickupLocation: "Dubai Marina", returnLocation: "Dubai Marina", status: "completed", }); console.log("📅 Created test bookings"); console.log("\n✅ Database seeded successfully!"); console.log("\n📊 Summary:"); console.log(`👥 Users: 5 (1 admin, 2 owners, 2 renters)`); console.log(`🚗 Cars: ${cars.length}`); console.log(`📅 Bookings: 3`); console.log("\n🔑 Test Accounts:"); console.log("Admin: admin@borrowmycar.ae / admin123"); console.log("Owner 1: ahmed@test.com / password123 (Phone: 0502345678)"); console.log("Owner 2: fatima@test.com / password123 (Phone: 0503456789)"); console.log("Renter 1: sarah@test.com / password123 (Phone: 0504567890)"); console.log("Renter 2: michael@test.com / password123 (Phone: 0505678901)"); console.log("\n📱 Phone Format Examples:"); console.log("✓ Local format: 0501234567 (recommended)"); console.log("✓ With country code: +971501234567"); console.log("✓ International: 00971501234567"); console.log("\n🚗 Valid Car Features:"); console.log("✓ GPS Navigation, Bluetooth, USB Charging"); console.log("✓ Leather Seats, Sunroof, Backup Camera"); console.log("✓ Premium Sound System, Cruise Control"); console.log("✓ Keyless Entry, Push Start, Auto AC"); process.exit(0); } catch (error) { console.error("❌ Error seeding database:", error); process.exit(1); } }; // Run the seeding function seedDatabase();
```

# utils\BookingValidation.js

```js
// src/utils/BookingValidation.js - Validation utilities for booking forms export const validateBookingForm = (booking, car) => { const errors = {}; // Date validation if (!booking.startDate) { errors.startDate = "Start date is required"; } if (!booking.endDate) { errors.endDate = "End date is required"; } if (booking.startDate && booking.endDate) { const start = new Date(booking.startDate); const end = new Date(booking.endDate); const today = new Date(); today.setHours(0, 0, 0, 0); if (start < today) { errors.startDate = "Start date cannot be in the past"; } if (start >= end) { errors.endDate = "End date must be after start date"; } // Check car availability if (car) { const availableFrom = new Date(car.availabilityFrom); const availableTo = new Date(car.availabilityTo); if (start < availableFrom || end > availableTo) { errors.dates = `Selected dates must be between ${availableFrom.toLocaleDateString()} and ${availableTo.toLocaleDateString()}`; } } } // Location validation if (!booking.pickupLocation || !booking.pickupLocation.trim()) { errors.pickupLocation = "Pickup location is required"; } if (!booking.returnLocation || !booking.returnLocation.trim()) { errors.returnLocation = "Return location is required"; } // Payment method validation if (!booking.paymentMethod) { errors.paymentMethod = "Please select a payment method"; } // Validate payment method is one of the accepted values if ( booking.paymentMethod && ![ "credit_card", "debit_card", "card", "cash_on_delivery", "cash", "bank_transfer", "paypal", ].includes(booking.paymentMethod) ) { errors.paymentMethod = "Invalid payment method selected"; } return { isValid: Object.keys(errors).length === 0, errors, }; }; export const calculateBookingCost = (startDate, endDate, dailyRate) => { if (!startDate || !endDate || !dailyRate) { return { days: 0, totalCost: 0 }; } const start = new Date(startDate); const end = new Date(endDate); const diffTime = Math.abs(end - start); const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); if (diffDays <= 0) { return { days: 0, totalCost: 0 }; } return { days: diffDays, totalCost: diffDays * dailyRate, }; }; export const formatPaymentMethod = (method) => { const methods = { credit_card: "Credit Card", debit_card: "Debit Card", card: "Credit/Debit Card", cash_on_delivery: "Cash on Meet", cash: "Cash on Meet", bank_transfer: "Bank Transfer", paypal: "PayPal", }; return methods[method] || "Unknown"; }; export const getPaymentMethodIcon = (method) => { if (method === "cash_on_delivery" || method === "cash") { return "💵"; // Cash emoji } if (method === "paypal") { return "🅿️"; // PayPal emoji } if (method === "bank_transfer") { return "🏦"; // Bank emoji } return "💳"; // Card emoji }; // Validation for car listing form (bonus utility) export const validateCarListingForm = (form, images) => { const errors = {}; // Basic field validation if (!form.title || form.title.trim().length < 3) { errors.title = "Car title must be at least 3 characters"; } if (!form.description || form.description.trim().length < 10) { errors.description = "Description must be at least 10 characters"; } if (!form.city || form.city.trim().length < 2) { errors.city = "City is required"; } // Price validation const price = parseFloat(form.pricePerDay); if (!form.pricePerDay || isNaN(price) || price <= 0) { errors.pricePerDay = "Price per day must be greater than 0"; } if (price > 10000) { errors.pricePerDay = "Price per day seems too high (max AED 10,000)"; } // Date validation if (!form.availabilityFrom) { errors.availabilityFrom = "Start date is required"; } if (!form.availabilityTo) { errors.availabilityTo = "End date is required"; } if (form.availabilityFrom && form.availabilityTo) { const start = new Date(form.availabilityFrom); const end = new Date(form.availabilityTo); const today = new Date(); today.setHours(0, 0, 0, 0); if (start < today) { errors.availabilityFrom = "Start date cannot be in the past"; } if (start >= end) { errors.availabilityTo = "End date must be after start date"; } // Check for reasonable rental period (max 1 year) const diffTime = end - start; const diffDays = diffTime / (1000 * 60 * 60 * 24); if (diffDays > 365) { errors.availabilityTo = "Rental period cannot exceed 1 year"; } } // Image validation if (!images || images.length === 0) { errors.images = "At least one image is required"; } if (images && images.length > 10) { errors.images = "Maximum 10 images allowed"; } // Validate each image if (images && images.length > 0) { const validTypes = ["image/jpeg", "image/jpg", "image/png", "image/webp"]; const maxSize = 5 * 1024 * 1024; // 5MB for (let i = 0; i < images.length; i++) { const image = images[i]; if (!validTypes.includes(image.type)) { errors.images = `Image ${ i + 1 }: Only JPEG, PNG, and WebP files are allowed`; break; } if (image.size > maxSize) { errors.images = `Image ${i + 1}: File size must be less than 5MB`; break; } } } return { isValid: Object.keys(errors).length === 0, errors, }; }; // UAE cities validation export const validateUAECity = (city) => { const uaeCities = [ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", "Dubai Marina", "Downtown Dubai", "Jumeirah", "Deira", "Bur Dubai", "Al Barsha", "Dubai Investment Park", "Dubai Silicon Oasis", "Dubai South", "Al Nahda Dubai", "Jumeirah Lake Towers", "Business Bay", "DIFC", "Dubai Hills", "Al Qusais", "Al Mizhar", "International City", "Discovery Gardens", "Dubai Sports City", "Abu Dhabi City", "Al Ain", "Al Ruwais", "Khalifa City", "Al Shamkha", "Yas Island", "Saadiyat Island", "Al Reef", "Al Rahba", "Masdar City", "Mohammed Bin Zayed City", "Al Falah", "Al Mushrif", "Tourist Club Area", "Sharjah City", "Al Nahda Sharjah", "Al Qasimia", "Al Majaz", "Al Khan", "Al Taawun", "Al Suyoh", "Muwaileh", "University City Sharjah", ]; return uaeCities.includes(city); }; export default { validateBookingForm, calculateBookingCost, formatPaymentMethod, getPaymentMethodIcon, validateCarListingForm, validateUAECity, };
```

# utils\cloudinary.js

```js
// utils/cloudinary.js (Enhanced) import { v2 as cloudinary } from "cloudinary"; import { CloudinaryStorage } from "multer-storage-cloudinary"; import dotenv from "dotenv"; dotenv.config(); // Configure Cloudinary cloudinary.config({ cloud_name: process.env.CLOUDINARY_CLOUD_NAME, api_key: process.env.CLOUDINARY_API_KEY, api_secret: process.env.CLOUDINARY_API_SECRET, }); // Enhanced storage configuration with organized folders and transformations export const storage = new CloudinaryStorage({ cloudinary: cloudinary, params: async (req, file) => { // Determine folder based on file field and user role let folder = "borrowmycar/misc"; if (file.fieldname === "images") { folder = "borrowmycar/cars"; } else if ( ["drivingLicense", "emiratesId", "visa", "passport"].includes( file.fieldname ) ) { folder = "borrowmycar/documents"; } else if (file.fieldname === "profileImage") { folder = "borrowmycar/profiles"; } // Generate unique filename const uniqueSuffix = Date.now() + "-" + Math.round(Math.random() * 1e9); return { folder: folder, public_id: `${file.fieldname}-${uniqueSuffix}`, allowed_formats: ["jpg", "jpeg", "png", "webp"], transformation: [ { quality: "auto:good", fetch_format: "auto", }, ], // Add different transformations based on file type ...(file.fieldname === "profileImage" && { transformation: [ { width: 300, height: 300, crop: "fill", gravity: "face" }, { quality: "auto:good", fetch_format: "auto" }, ], }), ...(file.fieldname === "images" && { transformation: [ { width: 1200, height: 800, crop: "limit" }, { quality: "auto:good", fetch_format: "auto" }, ], }), }; }, }); // Health check for Cloudinary export const checkCloudinaryHealth = async () => { try { const result = await cloudinary.api.ping(); return { status: "connected", response: result, }; } catch (error) { return { status: "error", error: error.message, }; } }; export { cloudinary };
```

# utils\cloudUploader.js

```js
// utils/cloudUploader.js (Enhanced) import { v2 as cloudinary } from "cloudinary"; // Upload multiple images to Cloudinary export const uploadImagesToCloud = async (files) => { try { if (!files || files.length === 0) { throw new Error("No files provided for upload"); } // Handle both array of files and single file const fileArray = Array.isArray(files) ? files : [files]; const uploadPromises = fileArray.map(async (file) => { // Each file should already be uploaded by multer-storage-cloudinary // Just return the secure_url if (file.path) { return file.path; // This is the Cloudinary URL } // Fallback: manual upload if needed const result = await cloudinary.uploader.upload( file.path || file.buffer, { folder: "borrowmycar/uploads", quality: "auto:good", fetch_format: "auto", } ); return result.secure_url; }); const imageUrls = await Promise.all(uploadPromises); return imageUrls; } catch (error) { console.error("Cloudinary upload error:", error); throw new Error(`Image upload failed: ${error.message}`); } }; // Delete images from Cloudinary export const deleteImagesFromCloud = async (imageUrls) => { try { if (!imageUrls || imageUrls.length === 0) { return { success: true, message: "No images to delete" }; } // Handle both array and single URL const urlArray = Array.isArray(imageUrls) ? imageUrls : [imageUrls]; const deletePromises = urlArray.map(async (url) => { try { // Extract public_id from Cloudinary URL const publicId = extractPublicIdFromUrl(url); if (publicId) { const result = await cloudinary.uploader.destroy(publicId); return { url, publicId, result: result.result, success: result.result === "ok", }; } return { url, publicId: null, result: "invalid_url", success: false, }; } catch (error) { console.error(`Failed to delete image ${url}:`, error); return { url, error: error.message, success: false, }; } }); const results = await Promise.all(deletePromises); const successCount = results.filter((r) => r.success).length; const failureCount = results.length - successCount; return { success: failureCount === 0, total: results.length, successful: successCount, failed: failureCount, details: results, }; } catch (error) { console.error("Cloudinary deletion error:", error); throw new Error(`Image deletion failed: ${error.message}`); } }; // Extract public_id from Cloudinary URL const extractPublicIdFromUrl = (url) => { try { if (!url || typeof url !== "string") { return null; } // Handle Cloudinary URLs if (url.includes("cloudinary.com")) { // Extract everything after the last folder and before file extension const matches = url.match( /\/([^\/]+)\.(jpg|jpeg|png|gif|webp|bmp|tiff|svg)$/i ); if (matches) { // Get the full path including folders const pathMatch = url.match( /\/upload\/(?:v\d+\/)?(.+)\.(jpg|jpeg|png|gif|webp|bmp|tiff|svg)$/i ); return pathMatch ? pathMatch[1] : matches[1]; } } return null; } catch (error) { console.error("Error extracting public_id:", error); return null; } }; // Upload single file with specific transformations export const uploadSingleImage = async (file, options = {}) => { try { if (!file) { throw new Error("No file provided for upload"); } const uploadOptions = { folder: options.folder || "borrowmycar/uploads", quality: options.quality || "auto:good", fetch_format: "auto", ...options, }; // If file is already uploaded by multer-storage-cloudinary if (file.path) { return file.path; } // Manual upload const result = await cloudinary.uploader.upload( file.path || file.buffer, uploadOptions ); return result.secure_url; } catch (error) { console.error("Single image upload error:", error); throw new Error(`Image upload failed: ${error.message}`); } }; // Get image info from Cloudinary export const getImageInfo = async (publicId) => { try { const result = await cloudinary.api.resource(publicId, { image_metadata: true, colors: true, faces: true, }); return { success: true, data: { publicId: result.public_id, format: result.format, width: result.width, height: result.height, bytes: result.bytes, url: result.secure_url, createdAt: result.created_at, metadata: result.image_metadata, colors: result.colors, faces: result.faces, }, }; } catch (error) { console.error("Get image info error:", error); return { success: false, error: error.message, }; } }; // Optimize image URL with transformations export const optimizeImageUrl = (url, transformations = {}) => { try { if (!url || !url.includes("cloudinary.com")) { return url; } const { width, height, crop = "fill", quality = "auto:good", format = "auto", } = transformations; // Build transformation string let transformString = ""; if (width || height) { transformString += `w_${width || "auto"},h_${ height || "auto" },c_${crop}/`; } transformString += `q_${quality},f_${format}`; // Insert transformation into URL const transformedUrl = url.replace( "/upload/", `/upload/${transformString}/` ); return transformedUrl; } catch (error) { console.error("URL optimization error:", error); return url; // Return original URL on error } };
```

# utils\errorHandler.js

```js
// utils/errorHandler.js (Enhanced) // Custom error class export class AppError extends Error { constructor(message, statusCode, code = null) { super(message); this.statusCode = statusCode; this.status = `${statusCode}`.startsWith("4") ? "fail" : "error"; this.isOperational = true; this.code = code; Error.captureStackTrace(this, this.constructor); } } // Handle specific MongoDB errors const handleCastErrorDB = (err) => { const message = `Invalid ${err.path}: ${err.value}`; return new AppError(message, 400, "INVALID_ID"); }; const handleDuplicateFieldsDB = (err) => { const field = Object.keys(err.keyValue)[0]; const value = err.keyValue[field]; const message = `${ field.charAt(0).toUpperCase() + field.slice(1) } '${value}' already exists`; return new AppError(message, 400, "DUPLICATE_FIELD"); }; const handleValidationErrorDB = (err) => { const errors = Object.values(err.errors).map((el) => el.message); const message = `Invalid input data: ${errors.join(". ")}`; return new AppError(message, 400, "VALIDATION_ERROR"); }; const handleJWTError = () => new AppError("Invalid token. Please log in again!", 401, "INVALID_TOKEN"); const handleJWTExpiredError = () => new AppError( "Your token has expired! Please log in again.", 401, "TOKEN_EXPIRED" ); // Handle Multer errors const handleMulterError = (err) => { if (err.code === "LIMIT_FILE_SIZE") { return new AppError( "File size too large. Maximum 5MB allowed.", 400, "FILE_TOO_LARGE" ); } if (err.code === "LIMIT_FILE_COUNT") { return new AppError( "Too many files. Maximum 10 files allowed.", 400, "TOO_MANY_FILES" ); } if (err.code === "INVALID_FILE_TYPE") { return new AppError(err.message, 400, "INVALID_FILE_TYPE"); } return new AppError(err.message, 400, "FILE_UPLOAD_ERROR"); }; // Development error response const sendErrorDev = (err, res) => { res.status(err.statusCode).json({ success: false, error: err, message: err.message, code: err.code, stack: err.stack, }); }; // Production error response const sendErrorProd = (err, res) => { // Operational, trusted error: send message to client if (err.isOperational) { res.status(err.statusCode).json({ success: false, message: err.message, code: err.code, }); } else { // Programming or other unknown error: don't leak error details console.error("ERROR 💥:", err); res.status(500).json({ success: false, message: "Something went wrong!", code: "INTERNAL_SERVER_ERROR", }); } }; // Global error handling middleware export const globalErrorHandler = (err, req, res, next) => { err.statusCode = err.statusCode || 500; err.status = err.status || "error"; if (process.env.NODE_ENV === "development") { sendErrorDev(err, res); } else { let error = { ...err }; error.message = err.message; // Handle specific error types if (error.name === "CastError") error = handleCastErrorDB(error); if (error.code === 11000) error = handleDuplicateFieldsDB(error); if (error.name === "ValidationError") error = handleValidationErrorDB(error); if (error.name === "JsonWebTokenError") error = handleJWTError(); if (error.name === "TokenExpiredError") error = handleJWTExpiredError(); if (error.name === "MulterError" || error.code === "INVALID_FILE_TYPE") { error = handleMulterError(error); } sendErrorProd(error, res); } }; // Async error wrapper export const handleAsyncError = (fn) => { return (req, res, next) => { Promise.resolve(fn(req, res, next)).catch(next); }; };
```

# utils\locationUtils.js

```js
export const formatDistance = (distance) => { if (distance < 1) { return `${Math.round(distance * 1000)}m`; } return `${distance.toFixed(1)}km`; }; export const formatDuration = (minutes) => { if (minutes < 60) { return `${Math.round(minutes)}min`; } const hours = Math.floor(minutes / 60); const remainingMinutes = Math.round(minutes % 60); if (remainingMinutes === 0) { return `${hours}h`; } return `${hours}h ${remainingMinutes}min`; }; export const getCurrentPosition = () => { return new Promise((resolve, reject) => { if (!navigator.geolocation) { reject(new Error("Geolocation is not supported")); return; } navigator.geolocation.getCurrentPosition( (position) => { resolve({ coordinates: [position.coords.longitude, position.coords.latitude], accuracy: position.coords.accuracy, }); }, (error) => { reject(error); }, { enableHighAccuracy: true, timeout: 10000, maximumAge: 300000, // 5 minutes } ); }); }; export const isLocationInUAE = (coordinates) => { const [lng, lat] = coordinates; const uaeBounds = MAPBOX_CONFIG.uae.bounds; return ( lng >= uaeBounds[0][0] && lng <= uaeBounds[1][0] && lat >= uaeBounds[0][1] && lat <= uaeBounds[1][1] ); };
```

# utils\mapboxUtils.js

```js
// borrowmycarfrontend/src/utils/mapboxUtils.js - COMPLETE MAPBOX SERVICE import { MAPBOX_CONFIG } from "../config/mapbox"; export class MapboxService { constructor() { this.accessToken = MAPBOX_CONFIG.accessToken; this.baseUrl = "https://api.mapbox.com"; } // Geocoding: Convert address to coordinates async geocodeAddress(address) { try { if (!address || address.trim().length < 2) { return { success: false, error: "Address too short" }; } const response = await fetch( `${this.baseUrl}/geocoding/v5/mapbox.places/${encodeURIComponent( address )}.json?` + `access_token=${this.accessToken}&` + `country=AE&` + `bbox=${MAPBOX_CONFIG.uae.bounds.flat().join(",")}&` + `limit=5&` + `types=address,poi,place` ); if (!response.ok) { throw new Error(`Geocoding failed: ${response.status}`); } const data = await response.json(); return { success: true, results: data.features.map((feature) => ({ id: feature.id, name: feature.place_name, coordinates: feature.center, address: feature.properties?.address || "", city: this.extractCity(feature.context), bbox: feature.bbox, relevance: feature.relevance, })), }; } catch (error) { console.error("Geocoding error:", error); return { success: false, error: error.message }; } } // Reverse geocoding: Convert coordinates to address async reverseGeocode(longitude, latitude) { try { if (!longitude || !latitude) { return { success: false, error: "Invalid coordinates" }; } const response = await fetch( `${this.baseUrl}/geocoding/v5/mapbox.places/${longitude},${latitude}.json?` + `access_token=${this.accessToken}&` + `country=AE&` + `types=address,poi,place` ); if (!response.ok) { throw new Error(`Reverse geocoding failed: ${response.status}`); } const data = await response.json(); const feature = data.features[0]; if (feature) { return { success: true, result: { name: feature.place_name, address: feature.properties?.address || "", city: this.extractCity(feature.context), coordinates: feature.center, place_type: feature.place_type?.[0], }, }; } return { success: false, error: "No address found" }; } catch (error) { console.error("Reverse geocoding error:", error); return { success: false, error: error.message }; } } // Calculate distance between two points using Haversine formula calculateDistance(point1, point2) { if (!point1 || !point2 || point1.length !== 2 || point2.length !== 2) { return 0; } const [lon1, lat1] = point1; const [lon2, lat2] = point2; const R = 6371; // Earth's radius in kilometers const dLat = this.toRadians(lat2 - lat1); const dLon = this.toRadians(lon2 - lon1); const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(this.toRadians(lat1)) * Math.cos(this.toRadians(lat2)) * Math.sin(dLon / 2) * Math.sin(dLon / 2); const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)); return R * c; // Distance in kilometers } // Convert degrees to radians toRadians(degrees) { return degrees * (Math.PI / 180); } // Extract city from Mapbox context extractCity(context) { if (!context || !Array.isArray(context)) return ""; // Look for place, locality, or region const place = context.find( (item) => item.id.includes("place") || item.id.includes("locality") || item.id.includes("region") ); return place ? place.text : ""; } // Get directions between two points async getDirections(start, end, profile = "driving") { try { if (!start || !end || start.length !== 2 || end.length !== 2) { return { success: false, error: "Invalid coordinates" }; } const response = await fetch( `${this.baseUrl}/directions/v5/mapbox/${profile}/${start.join( "," )};${end.join(",")}?` + `access_token=${this.accessToken}&` + `geometries=geojson&` + `steps=true&` + `banner_instructions=true&` + `voice_instructions=true` ); if (!response.ok) { throw new Error(`Directions failed: ${response.status}`); } const data = await response.json(); if (data.routes && data.routes.length > 0) { const route = data.routes[0]; return { success: true, route: { geometry: route.geometry, distance: route.distance, // meters duration: route.duration, // seconds steps: route.legs[0]?.steps || [], summary: { distance: this.formatDistance(route.distance / 1000), // km duration: this.formatDuration(route.duration / 60), // minutes }, }, }; } return { success: false, error: "No route found" }; } catch (error) { console.error("Directions error:", error); return { success: false, error: error.message }; } } // Get matrix of distances/durations between multiple points async getMatrix(coordinates, profile = "driving") { try { if (!coordinates || coordinates.length < 2) { return { success: false, error: "Need at least 2 coordinates" }; } const coordString = coordinates.map((coord) => coord.join(",")).join(";"); const response = await fetch( `${this.baseUrl}/directions-matrix/v1/mapbox/${profile}/${coordString}?` + `access_token=${this.accessToken}&` + `annotations=distance,duration` ); if (!response.ok) { throw new Error(`Matrix failed: ${response.status}`); } const data = await response.json(); return { success: true, durations: data.durations, distances: data.distances, destinations: data.destinations, sources: data.sources, }; } catch (error) { console.error("Matrix error:", error); return { success: false, error: error.message }; } } // Check if coordinates are within UAE bounds isWithinUAE(coordinates) { if (!coordinates || coordinates.length !== 2) return false; const [lng, lat] = coordinates; const bounds = MAPBOX_CONFIG.uae.bounds; return ( lng >= bounds[0][0] && lng <= bounds[1][0] && lat >= bounds[0][1] && lat <= bounds[1][1] ); } // Find nearest UAE city to given coordinates findNearestCity(coordinates) { if (!coordinates || coordinates.length !== 2) return null; let nearestCity = null; let shortestDistance = Infinity; MAPBOX_CONFIG.uae.cities.forEach((city) => { const distance = this.calculateDistance(coordinates, city.coordinates); if (distance < shortestDistance) { shortestDistance = distance; nearestCity = { ...city, distance }; } }); return nearestCity; } // Format distance for display formatDistance(kilometers) { if (kilometers < 1) { return `${Math.round(kilometers * 1000)}m`; } return `${kilometers.toFixed(1)}km`; } // Format duration for display formatDuration(minutes) { if (minutes < 60) { return `${Math.round(minutes)}min`; } const hours = Math.floor(minutes / 60); const remainingMinutes = Math.round(minutes % 60); if (remainingMinutes === 0) { return `${hours}h`; } return `${hours}h ${remainingMinutes}min`; } // Get current user location async getCurrentLocation() { return new Promise((resolve, reject) => { if (!navigator.geolocation) { reject(new Error("Geolocation is not supported")); return; } navigator.geolocation.getCurrentPosition( (position) => { const coordinates = [ position.coords.longitude, position.coords.latitude, ]; resolve({ coordinates, accuracy: position.coords.accuracy, timestamp: position.timestamp, isWithinUAE: this.isWithinUAE(coordinates), nearestCity: this.findNearestCity(coordinates), }); }, (error) => { let message = "Failed to get location"; switch (error.code) { case error.PERMISSION_DENIED: message = "Location access denied by user"; break; case error.POSITION_UNAVAILABLE: message = "Location information unavailable"; break; case error.TIMEOUT: message = "Location request timed out"; break; } reject(new Error(message)); }, { enableHighAccuracy: true, timeout: 10000, maximumAge: 300000, // 5 minutes } ); }); } // Search for places within UAE async searchPlaces(query, options = {}) { try { const { types = "poi,address,place", proximity = MAPBOX_CONFIG.center, limit = 10, } = options; const response = await fetch( `${this.baseUrl}/geocoding/v5/mapbox.places/${encodeURIComponent( query )}.json?` + `access_token=${this.accessToken}&` + `country=AE&` + `types=${types}&` + `proximity=${proximity.join(",")}&` + `limit=${limit}&` + `bbox=${MAPBOX_CONFIG.uae.bounds.flat().join(",")}` ); if (!response.ok) { throw new Error(`Search failed: ${response.status}`); } const data = await response.json(); return { success: true, places: data.features.map((feature) => ({ id: feature.id, name: feature.place_name, coordinates: feature.center, category: feature.properties?.category, address: feature.properties?.address, city: this.extractCity(feature.context), type: feature.place_type?.[0], relevance: feature.relevance, })), }; } catch (error) { console.error("Places search error:", error); return { success: false, error: error.message }; } } // Validate Mapbox access token async validateToken() { try { const response = await fetch( `${this.baseUrl}/geocoding/v5/mapbox.places/dubai.json?access_token=${this.accessToken}&limit=1` ); return { valid: response.ok, status: response.status, message: response.ok ? "Token is valid" : "Token is invalid", }; } catch (error) { return { valid: false, status: 0, message: `Token validation failed: ${error.message}`, }; } } // Create a static map URL createStaticMapUrl(options = {}) { const { coordinates = MAPBOX_CONFIG.center, zoom = 12, width = 600, height = 400, style = "streets-v12", markers = [], } = options; let url = `${this.baseUrl}/styles/v1/mapbox/${style}/static`; // Add markers if (markers.length > 0) { const markerString = markers .map((marker) => { const { coordinates: coords, color = "red", size = "m" } = marker; return `pin-${size}-${color}(${coords.join(",")})`; }) .join(","); url += `/${markerString}`; } // Add center and zoom url += `/${coordinates.join(",")},${zoom}`; // Add dimensions url += `/${width}x${height}`; // Add access token url += `?access_token=${this.accessToken}`; return url; } } // Create singleton instance export const mapboxService = new MapboxService(); // Export utility functions export const { geocodeAddress, reverseGeocode, calculateDistance, getDirections, getCurrentLocation, searchPlaces, isWithinUAE, findNearestCity, formatDistance, formatDuration, } = mapboxService;
```

# utils\phoneUtils.js

```js
// utils/phoneUtils.js - COMPREHENSIVE FIXED VERSION /** * Format UAE phone number to international format with country code * @param {string} phone - Input phone number * @returns {string} - Formatted phone number with +971 prefix */ export const formatUAEPhone = (phone) => { if (!phone) return phone; // Remove all non-digit characters const cleanPhone = phone.replace(/\D/g, ""); // Handle different input formats if (cleanPhone.startsWith("971") && cleanPhone.length === 12) { // Already has country code: 971501234567 return `+${cleanPhone}`; } else if (cleanPhone.startsWith("00971") && cleanPhone.length === 14) { // International format: 00971501234567 return `+${cleanPhone.substring(2)}`; } else if (cleanPhone.startsWith("0") && cleanPhone.length === 10) { // Local format: 0501234567 (most common from frontend) return `+971${cleanPhone.substring(1)}`; } else if (cleanPhone.length === 9) { // Without leading zero: 501234567 return `+971${cleanPhone}`; } // Return as is if format is unclear return phone; }; /** * Validate UAE phone number against all valid patterns * @param {string} phone - Phone number to validate * @returns {boolean} - Whether the phone number is valid */ export const validateUAEPhone = (phone) => { if (!phone) return false; // Remove all non-digit characters const cleanPhone = phone.replace(/\D/g, ""); // UAE phone validation patterns const validPatterns = [ // === MOBILE NUMBERS === // Local format (most common from frontend) /^05[0-9]{8}$/, // 0501234567, 0551234567, etc. // Without leading zero /^5[0-9]{8}$/, // 501234567 // With country code /^9715[0-9]{8}$/, // 971501234567 // International format /^009715[0-9]{8}$/, // 00971501234567 // === LANDLINE NUMBERS === // Dubai (04) /^04[0-9]{7}$/, // 041234567 /^4[0-9]{7}$/, // 41234567 (without leading 0) /^9714[0-9]{7}$/, // 97141234567 (with country code) /^009714[0-9]{7}$/, // 0097141234567 (international) // Abu Dhabi (02) /^02[0-9]{7}$/, // 021234567 /^2[0-9]{7}$/, // 21234567 (without leading 0) /^9712[0-9]{7}$/, // 97121234567 (with country code) /^009712[0-9]{7}$/, // 0097121234567 (international) // Northern Emirates (03, 06, 07, 09) /^0[3679][0-9]{7}$/, // 031234567, 061234567, 071234567, 091234567 /^[3679][0-9]{7}$/, // Without leading 0 /^971[3679][0-9]{7}$/, // With country code /^00971[3679][0-9]{7}$/, // International format ]; const isValid = validPatterns.some((pattern) => pattern.test(cleanPhone)); // Additional length check for safety if (isValid) { return cleanPhone.length >= 9 && cleanPhone.length <= 14; } return false; }; /** * Display UAE phone number in user-friendly local format * @param {string} phone - Phone number to format for display * @returns {string} - Formatted display phone (e.g., "050 123 4567") */ export const displayUAEPhone = (phone) => { if (!phone) return phone; const cleanPhone = phone.replace(/\D/g, ""); // Convert to local display format if (cleanPhone.startsWith("971") && cleanPhone.length === 12) { // From international: 971501234567 -> 050 123 4567 const localNumber = cleanPhone.substring(3); if (localNumber.length === 9) { return `0${localNumber.substring(0, 2)} ${localNumber.substring( 2, 5 )} ${localNumber.substring(5)}`; } } else if (cleanPhone.startsWith("0") && cleanPhone.length === 10) { // From local: 0501234567 -> 050 123 4567 return `${cleanPhone.substring(0, 3)} ${cleanPhone.substring( 3, 6 )} ${cleanPhone.substring(6)}`; } else if (cleanPhone.length === 9) { // Add leading zero: 501234567 -> 050 123 4567 return `0${cleanPhone.substring(0, 2)} ${cleanPhone.substring( 2, 5 )} ${cleanPhone.substring(5)}`; } return phone; }; /** * Get phone number type (mobile, landline, etc.) * @param {string} phone - Phone number to analyze * @returns {string} - Phone type description */ export const getPhoneType = (phone) => { if (!phone || !validateUAEPhone(phone)) return "invalid"; const cleanPhone = phone.replace(/\D/g, ""); // Extract the significant digits (remove country code and leading zeros) let significantDigits = cleanPhone; if (cleanPhone.startsWith("00971")) { significantDigits = cleanPhone.substring(5); } else if (cleanPhone.startsWith("971")) { significantDigits = cleanPhone.substring(3); } else if (cleanPhone.startsWith("0")) { significantDigits = cleanPhone.substring(1); } // Determine type based on first digit const firstDigit = significantDigits.charAt(0); switch (firstDigit) { case "5": return "mobile"; case "4": return "Dubai landline"; case "2": return "Abu Dhabi landline"; case "3": return "Northern Emirates landline"; case "6": return "Al Ain landline"; case "7": case "9": return "Other UAE landline"; default: return "unknown"; } }; /** * Debug function for phone validation * @param {string} phone - Phone number to debug * @returns {object} - Debug information */ export const debugPhoneValidation = (phone) => { const cleanPhone = phone ? phone.replace(/\D/g, "") : ""; const debugInfo = { original: phone, cleaned: cleanPhone, length: cleanPhone.length, startsWithZero: cleanPhone.startsWith("0"), startsWithCountryCode: cleanPhone.startsWith("971"), isValid: validateUAEPhone(phone), formatted: formatUAEPhone(phone), display: displayUAEPhone(phone), type: getPhoneType(phone), }; console.log("Phone Debug Info:", debugInfo); return debugInfo; }; /** * Normalize phone number for database storage * Always stores in +971XXXXXXXXX format */ export const normalizePhoneForStorage = (phone) => { if (!phone || !validateUAEPhone(phone)) { throw new Error("Invalid UAE phone number"); } return formatUAEPhone(phone); }; /** * Extract local number without country code * @param {string} phone - Phone number * @returns {string} - Local number (e.g., "0501234567") */ export const getLocalNumber = (phone) => { if (!phone) return phone; const cleanPhone = phone.replace(/\D/g, ""); if (cleanPhone.startsWith("00971")) { return `0${cleanPhone.substring(5)}`; } else if (cleanPhone.startsWith("971")) { return `0${cleanPhone.substring(3)}`; } else if (cleanPhone.startsWith("0")) { return cleanPhone; } else if (cleanPhone.length === 9) { return `0${cleanPhone}`; } return phone; };
```

# utils\validators.js

```js
// utils/validators.js - FIXED VERSION import { body, param, query, validationResult } from "express-validator"; import rateLimit from "express-rate-limit"; import { validateUAEPhone } from "./phoneUtils.js"; // FIXED User validation rules export const validateSignup = [ body("name") .trim() .isLength({ min: 2, max: 50 }) .withMessage("Name must be between 2 and 50 characters"), body("email") .isEmail() .normalizeEmail() .withMessage("Please provide a valid email"), // FIXED: More flexible phone validation body("phone") .notEmpty() .withMessage("Phone number is required") .custom((value) => { console.log("Validating phone in validator:", value); if (!value) { throw new Error("Phone number is required"); } // Clean the phone number const cleanPhone = value.replace(/\D/g, ""); console.log("Clean phone in validator:", cleanPhone); if (!validateUAEPhone(value)) { console.log("Phone validation failed in validator for:", value); throw new Error( "Please provide a valid UAE phone number (e.g., 0501234567)" ); } console.log("Phone validation passed in validator"); return true; }), body("password") .isLength({ min: 6 }) .withMessage("Password must be at least 6 characters long"), body("role") .optional() .isIn(["renter", "owner"]) .withMessage("Role must be either renter or owner"), body("preferredCity") .optional() .isIn([ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", ]) .withMessage("Please select a valid UAE city"), ]; export const validateLogin = [ body("email") .isEmail() .normalizeEmail() .withMessage("Please provide a valid email"), body("password").notEmpty().withMessage("Password is required"), ]; // Car validation rules (unchanged) export const validateCreateCar = [ body("title") .trim() .isLength({ min: 3, max: 100 }) .withMessage("Title must be between 3 and 100 characters"), body("description") .trim() .isLength({ min: 10, max: 1000 }) .withMessage("Description must be between 10 and 1000 characters"), body("city") .isIn([ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", ]) .withMessage("Please select a valid UAE city"), body("make") .trim() .isLength({ min: 2, max: 50 }) .withMessage("Car make is required"), body("model") .trim() .isLength({ min: 1, max: 50 }) .withMessage("Car model is required"), body("year") .isInt({ min: 2010, max: new Date().getFullYear() + 1 }) .withMessage("Car year must be between 2010 and current year"), // Handle both price and pricePerDay body("price") .optional() .isFloat({ min: 50, max: 5000 }) .withMessage("Price must be between AED 50 and AED 5000 per day"), body("pricePerDay") .optional() .isFloat({ min: 50, max: 5000 }) .withMessage("Price per day must be between AED 50 and AED 5000 per day"), body("mileage") .isInt({ min: 0, max: 500000 }) .withMessage("Mileage must be between 0 and 500,000 km"), body("seatingCapacity") .isInt({ min: 2, max: 8 }) .withMessage("Seating capacity must be between 2 and 8"), body("plateNumber") .matches(/^[A-Z]{1,3}[0-9]{1,5}$/) .withMessage("Please provide a valid UAE plate number"), body("transmission") .isIn(["Automatic", "Manual", "CVT", "Semi-Automatic"]) .withMessage("Please select a valid transmission type"), body("fuelType") .isIn(["Petrol", "Diesel", "Electric", "Hybrid", "Plug-in Hybrid"]) .withMessage("Please select a valid fuel type"), body("availabilityFrom") .isISO8601() .withMessage("Please provide a valid availability start date"), body("availabilityTo") .isISO8601() .withMessage("Please provide a valid availability end date"), ]; // Booking validation rules export const validateCreateBooking = [ body("carId").isMongoId().withMessage("Please provide a valid car ID"), body("startDate") .isISO8601() .withMessage("Please provide a valid start date"), body("endDate").isISO8601().withMessage("Please provide a valid end date"), body("paymentMethod") .optional() .isIn(["Cash", "Card", "BankTransfer", "DigitalWallet"]) .withMessage("Please select a valid payment method"), body("pickupLocation") .optional() .trim() .isLength({ min: 5, max: 200 }) .withMessage("Pickup location must be between 5 and 200 characters"), body("returnLocation") .optional() .trim() .isLength({ min: 5, max: 200 }) .withMessage("Return location must be between 5 and 200 characters"), body("deliveryRequested") .optional() .isBoolean() .withMessage("Delivery requested must be true or false"), body("deliveryAddress") .optional() .trim() .isLength({ min: 10, max: 300 }) .withMessage("Delivery address must be between 10 and 300 characters"), body("renterNotes") .optional() .trim() .isLength({ max: 500 }) .withMessage("Notes must not exceed 500 characters"), ]; export const validateUpdateBookingStatus = [ body("status") .isIn([ "pending", "approved", "rejected", "cancelled", "confirmed", "active", "completed", ]) .withMessage("Please provide a valid booking status"), body("ownerNotes") .optional() .trim() .isLength({ max: 500 }) .withMessage("Owner notes must not exceed 500 characters"), body("rejectionReason") .optional() .trim() .isLength({ min: 10, max: 200 }) .withMessage("Rejection reason must be between 10 and 200 characters"), ]; export const validateAddReview = [ body("rating") .isInt({ min: 1, max: 5 }) .withMessage("Rating must be between 1 and 5"), body("comment") .optional() .trim() .isLength({ max: 500 }) .withMessage("Comment must not exceed 500 characters"), ]; // Query parameter validation export const validatePagination = [ query("page") .optional() .isInt({ min: 1 }) .withMessage("Page must be a positive integer"), query("limit") .optional() .isInt({ min: 1, max: 50 }) .withMessage("Limit must be between 1 and 50"), ]; // Enhanced validation error handler with better debugging export const handleValidationErrors = (req, res, next) => { const errors = validationResult(req); if (!errors.isEmpty()) { console.log("=== VALIDATION ERRORS ==="); console.log("Request body:", req.body); console.log("Validation errors:", errors.array()); const formattedErrors = errors.array().map((error) => ({ field: error.path || error.param, message: error.msg, value: error.value, location: error.location, })); return res.status(400).json({ success: false, message: "Validation failed", errors: formattedErrors, code: "VALIDATION_ERROR", debug: { totalErrors: formattedErrors.length, requestBody: req.body, }, }); } console.log("✅ Validation passed"); next(); }; // Rate limiting configurations export const generalLimiter = rateLimit({ windowMs: 15 * 60 * 1000, // 15 minutes max: 100, // Limit each IP to 100 requests per windowMs message: { success: false, message: "Too many requests from this IP, please try again later.", code: "RATE_LIMIT_EXCEEDED", }, standardHeaders: true, legacyHeaders: false, });
```

