# .gitignore

```
# Based on https://raw.githubusercontent.com/github/gitignore/main/Node.gitignore # Logs logs _.log npm-debug.log_ yarn-debug.log* yarn-error.log* lerna-debug.log* .pnpm-debug.log* # Caches .cache # Diagnostic reports (https://nodejs.org/api/report.html) report.[0-9]_.[0-9]_.[0-9]_.[0-9]_.json # Runtime data pids _.pid _.seed *.pid.lock # Directory for instrumented libs generated by jscoverage/JSCover lib-cov # Coverage directory used by tools like istanbul coverage *.lcov # nyc test coverage .nyc_output # Grunt intermediate storage (https://gruntjs.com/creating-plugins#storing-task-files) .grunt # Bower dependency directory (https://bower.io/) bower_components # node-waf configuration .lock-wscript # Compiled binary addons (https://nodejs.org/api/addons.html) build/Release # Dependency directories node_modules/ jspm_packages/ # Snowpack dependency directory (https://snowpack.dev/) web_modules/ # TypeScript cache *.tsbuildinfo # Optional npm cache directory .npm # Optional eslint cache .eslintcache # Optional stylelint cache .stylelintcache # Microbundle cache .rpt2_cache/ .rts2_cache_cjs/ .rts2_cache_es/ .rts2_cache_umd/ # Optional REPL history .node_repl_history # Output of 'npm pack' *.tgz # Yarn Integrity file .yarn-integrity # dotenv environment variable files .env .env.development.local .env.test.local .env.production.local .env.local # parcel-bundler cache (https://parceljs.org/) .parcel-cache # Next.js build output .next out # Nuxt.js build / generate output .nuxt dist # Gatsby files # Comment in the public line in if your project uses Gatsby and not Next.js # https://nextjs.org/blog/next-9-1#public-directory-support # public # vuepress build output .vuepress/dist # vuepress v2.x temp and cache directory .temp # Docusaurus cache and generated files .docusaurus # Serverless directories .serverless/ # FuseBox cache .fusebox/ # DynamoDB Local files .dynamodb/ # TernJS port file .tern-port # Stores VSCode versions used for testing VSCode extensions .vscode-test # yarn v2 .yarn/cache .yarn/unplugged .yarn/build-state.yml .yarn/install-state.gz .pnp.* # IntelliJ based IDEs .idea # Finder (MacOS) folder config .DS_Store
```

# borrowmycarfrontend\.gitignore

```
# Logs logs *.log npm-debug.log* yarn-debug.log* yarn-error.log* pnpm-debug.log* lerna-debug.log* node_modules dist dist-ssr *.local # Editor directories and files .vscode/* !.vscode/extensions.json .idea .DS_Store *.suo *.ntvs* *.njsproj *.sln *.sw?
```

# borrowmycarfrontend\eslint.config.js

```js
import js from '@eslint/js' import globals from 'globals' import reactHooks from 'eslint-plugin-react-hooks' import reactRefresh from 'eslint-plugin-react-refresh' export default [ { ignores: ['dist'] }, { files: ['**/*.{js,jsx}'], languageOptions: { ecmaVersion: 2020, globals: globals.browser, parserOptions: { ecmaVersion: 'latest', ecmaFeatures: { jsx: true }, sourceType: 'module', }, }, plugins: { 'react-hooks': reactHooks, 'react-refresh': reactRefresh, }, rules: { ...js.configs.recommended.rules, ...reactHooks.configs.recommended.rules, 'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }], 'react-refresh/only-export-components': [ 'warn', { allowConstantExport: true }, ], }, }, ]
```

# borrowmycarfrontend\index.html

```html
<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8" /> <link rel="icon" type="image/svg+xml" href="./src/assets/BorrowMyCar.png" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <title>BorrowMyCar</title> <link rel="stylesheet" href="src/global.css" /> </head> <body> <div id="root"></div> <script type="module" src="/src/index.jsx"></script> </body> </html>
```

# borrowmycarfrontend\package.json

```json
{ "name": "borrowmycarfrontend", "private": true, "version": "0.0.0", "type": "module", "scripts": { "dev": "vite", "build": "vite build", "lint": "eslint .", "preview": "vite preview" }, "dependencies": { "@tailwindcss/vite": "^4.1.8", "axios": "^1.9.0", "lucide-react": "^0.513.0", "react": "^19.1.0", "react-dom": "^19.1.0", "react-helmet": "^6.1.0", "react-router-dom": "^7.6.1", "tailwindcss": "^4.1.8" }, "devDependencies": { "@eslint/js": "^9.25.0", "@types/react": "^19.1.2", "@types/react-dom": "^19.1.2", "@vitejs/plugin-react": "^4.4.1", "eslint": "^9.25.0", "eslint-plugin-react-hooks": "^5.2.0", "eslint-plugin-react-refresh": "^0.4.19", "globals": "^16.0.0", "vite": "^6.3.5" } }
```

# borrowmycarfrontend\public\vite.svg

This is a file of the type: SVG Image

# borrowmycarfrontend\README.md

```md
# React + Vite This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules. Currently, two official plugins are available: - [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) for Fast Refresh - [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh ## Expanding the ESLint configuration If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.
```

# borrowmycarfrontend\src\api.js

```js
// borrowmycarfrontend/src/api.js (Fixed) import axios from "axios"; // Create API instance with base URL from environment variables const API = axios.create({ baseURL: import.meta.env.VITE_API_BASE_URL || "http://localhost:5000/api", timeout: 10000, // 10 second timeout headers: { "Content-Type": "application/json", }, }); // Request interceptor to automatically include token API.interceptors.request.use( (req) => { const token = localStorage.getItem("token"); if (token) { req.headers.Authorization = `Bearer ${token}`; } // Log request for debugging (remove in production) if (import.meta.env.DEV) { console.log(`${req.method?.toUpperCase()} ${req.url}`, { data: req.data, headers: req.headers, }); } return req; }, (error) => { console.error("Request interceptor error:", error); return Promise.reject(error); } ); // Response interceptor for better error handling API.interceptors.response.use( (response) => { // Log successful responses (remove in production) if (import.meta.env.DEV) { console.log(`Response ${response.status}:`, response.data); } return response; }, (error) => { console.error("API Error:", error); // Handle token expiration if (error.response?.status === 401) { const currentPath = window.location.pathname; // Clear auth data localStorage.removeItem("token"); localStorage.removeItem("user"); // Only redirect if not already on login/signup page if (!currentPath.includes("/login") && !currentPath.includes("/signup")) { window.location.href = "/login"; } } // Handle network errors if (error.code === "ECONNABORTED") { error.message = "Request timeout. Please check your connection."; } else if (!error.response) { error.message = "Network error. Please check your connection."; } else if (error.response?.data?.message) { // Use server error message if available error.message = error.response.data.message; } return Promise.reject(error); } ); export default API;
```

# borrowmycarfrontend\src\App.jsx

```jsx
import { Helmet } from "react-helmet"; import CarListingSection from "./CarListingSection"; const App = () => { return ( <> <Helmet> <title>BorrowMyCar | Home</title> </Helmet> <div className="min-h-screen"> <div className="min-h-fit"> <div className="max-w-7xl mx-auto px-4 py-6"> <h1 className="text-3xl font-bold text-gray-900"> Welcome to <span className="text-green-600">BorrowMyCar</span> </h1> <p className="mt-2 text-gray-600"> Your one-stop solution for car rentals. Explore our services and find the perfect car for your needs. </p> </div> <CarListingSection /> </div> </div> </> ); }; export default App;
```

# borrowmycarfrontend\src\assets\BorrowMyCar.png

This is a binary file of the type: Image

# borrowmycarfrontend\src\assets\catdriving-serious.gif

This is a binary file of the type: Image

# borrowmycarfrontend\src\assets\react.svg

This is a file of the type: SVG Image

# borrowmycarfrontend\src\BrowseCars.jsx

```jsx
import { Helmet } from "react-helmet"; import CarListingSection from "./CarListingSection"; const BrowseCars = () => { return ( <> <Helmet> <title>Browse Cars - BorrowMyCar</title> </Helmet> <div className="min-h-screen bg-gray-50"> <div className="max-w-7xl mx-auto px-4 py-6"> <h1 className="text-3xl font-bold text-gray-900 mb-6"> Find Your Perfect Car </h1> <CarListingSection /> </div> </div> </> ); }; export default BrowseCars;
```

# borrowmycarfrontend\src\CarDetails.jsx

```jsx
import { useEffect, useState } from "react"; import { useParams, useNavigate } from "react-router-dom"; import API from "./api"; const CarDetails = () => { const { id } = useParams(); const navigate = useNavigate(); const [car, setCar] = useState(null); const [loading, setLoading] = useState(true); const [error, setError] = useState(""); const [booking, setBooking] = useState({ startDate: "", endDate: "" }); const [bookingError, setBookingError] = useState(""); const [bookingLoading, setBookingLoading] = useState(false); const [user, setUser] = useState(null); const [currentImageIndex, setCurrentImageIndex] = useState(0); const [totalCost, setTotalCost] = useState(0); const [numberOfDays, setNumberOfDays] = useState(0); useEffect(() => { const fetchCar = async () => { try { const res = await API.get(`/cars/${id}`); setCar(res.data.data.car); } catch (err) { setError("Car not found or failed to load"); console.error("Error fetching car:", err); } finally { setLoading(false); } }; const getUser = () => { const token = localStorage.getItem("token"); if (token) { try { const payload = JSON.parse(atob(token.split(".")[1])); setUser(payload); } catch { setUser(null); } } }; fetchCar(); getUser(); }, [id]); // Calculate total cost and days when dates change useEffect(() => { if (booking.startDate && booking.endDate && car) { const start = new Date(booking.startDate); const end = new Date(booking.endDate); const diffTime = Math.abs(end - start); const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); if (diffDays > 0) { setNumberOfDays(diffDays); setTotalCost(diffDays * car.pricePerDay); } else { setNumberOfDays(0); setTotalCost(0); } } else { setNumberOfDays(0); setTotalCost(0); } }, [booking.startDate, booking.endDate, car]); const handleBookingChange = (e) => { const { name, value } = e.target; setBooking((prev) => ({ ...prev, [name]: value })); setBookingError(""); }; const validateBookingDates = () => { if (!booking.startDate || !booking.endDate) { setBookingError("Please select both start and end dates"); return false; } const start = new Date(booking.startDate); const end = new Date(booking.endDate); const today = new Date(); today.setHours(0, 0, 0, 0); if (start < today) { setBookingError("Start date cannot be in the past"); return false; } if (start >= end) { setBookingError("End date must be after start date"); return false; } const availableFrom = new Date(car.availabilityFrom); const availableTo = new Date(car.availabilityTo); if (start < availableFrom || end > availableTo) { setBookingError( `Selected dates must be between ${availableFrom.toLocaleDateString()} and ${availableTo.toLocaleDateString()}` ); return false; } return true; }; const handleBook = async (e) => { e.preventDefault(); if (!validateBookingDates()) { return; } setBookingLoading(true); setBookingError(""); try { const response = await API.post("/bookings", { carId: car._id, startDate: booking.startDate, endDate: booking.endDate, totalCost: totalCost, numberOfDays: numberOfDays, }); navigate("/my-bookings", { state: { message: "Booking confirmed successfully!", bookingId: response.data._id, }, }); } catch (err) { console.error("Booking error:", err); setBookingError( err.response?.data?.message || "Booking failed. Please try again." ); } finally { setBookingLoading(false); } }; const nextImage = () => { if (car?.images?.length > 1) { setCurrentImageIndex((prev) => (prev + 1) % car.images.length); } }; const prevImage = () => { if (car?.images?.length > 1) { setCurrentImageIndex((prev) => prev === 0 ? car.images.length - 1 : prev - 1 ); } }; if (loading) { return ( <div className="max-w-4xl mx-auto p-6"> <div className="animate-pulse"> <div className="grid md:grid-cols-2 gap-6"> <div className="bg-gray-200 h-64 rounded-xl"></div> <div className="space-y-4"> <div className="h-4 bg-gray-200 rounded w-3/4"></div> <div className="h-4 bg-gray-200 rounded w-1/2"></div> <div className="h-4 bg-gray-200 rounded w-full"></div> </div> </div> </div> </div> ); } if (error) { return ( <div className="max-w-4xl mx-auto p-6"> <div className="bg-red-50 border border-red-200 rounded-lg p-6 text-center"> <svg className="mx-auto h-12 w-12 text-red-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" /> </svg> <h3 className="text-lg font-medium text-red-800 mb-2"> Error Loading Car </h3> <p className="text-red-600 mb-4">{error}</p> <button onClick={() => navigate("/browse")} className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors" > Back to Browse </button> </div> </div> ); } if (!car) return null; return ( <div className="max-w-6xl mx-auto p-6"> {/* Breadcrumb */} <nav className="flex mb-6 text-sm"> <button onClick={() => navigate("/browse")} className="text-green-600 hover:text-green-800 font-medium" > ← Back to Browse </button> <span className="mx-2 text-gray-500">/</span> <span className="text-gray-700">{car.title}</span> </nav> <div className="grid lg:grid-cols-3 gap-8"> {/* Left Column - Images and Details */} <div className="lg:col-span-2 space-y-6"> {/* Image Gallery */} <div className="relative"> <div className="aspect-video bg-gray-100 rounded-xl overflow-hidden"> <img src={ car.images?.[currentImageIndex] || "https://via.placeholder.com/800x450?text=No+Image" } alt={`${car.title} - Image ${currentImageIndex + 1}`} className="w-full h-full object-cover" /> {/* Image Navigation */} {car.images?.length > 1 && ( <> <button onClick={prevImage} className="absolute left-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-2 rounded-full transition-all" > <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /> </svg> </button> <button onClick={nextImage} className="absolute right-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-2 rounded-full transition-all" > <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /> </svg> </button> {/* Image Counter */} <div className="absolute bottom-4 right-4 bg-black bg-opacity-70 text-white px-3 py-1 rounded-full text-sm"> {currentImageIndex + 1} / {car.images.length} </div> </> )} </div> {/* Thumbnail Strip */} {car.images?.length > 1 && ( <div className="flex gap-2 mt-4 overflow-x-auto pb-2"> {car.images.map((image, index) => ( <button key={index} onClick={() => setCurrentImageIndex(index)} className={`flex-shrink-0 w-20 h-16 rounded-lg overflow-hidden border-2 transition-all ${ index === currentImageIndex ? "border-green-500 ring-2 ring-green-200" : "border-gray-200 hover:border-gray-300" }`} > <img src={image} alt={`Thumbnail ${index + 1}`} className="w-full h-full object-cover" /> </button> ))} </div> )} </div> {/* Car Information */} <div className="bg-white border border-gray-200 rounded-xl p-6"> <div className="space-y-4"> <div> <h1 className="text-3xl font-bold text-gray-900 mb-2"> {car.title} </h1> <div className="flex items-center gap-4 text-sm text-gray-600"> <span className="flex items-center gap-1"> <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /> </svg> {car.city} </span> <span className="flex items-center gap-1"> <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" /> </svg> AED {car.pricePerDay} / day </span> </div> </div> <div className="border-t pt-4"> <h3 className="font-semibold text-gray-900 mb-2"> Description </h3> <p className="text-gray-700 leading-relaxed"> {car.description} </p> </div> <div className="border-t pt-4"> <h3 className="font-semibold text-gray-900 mb-2"> Availability </h3> <div className="flex items-center gap-2 text-sm text-gray-600"> <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /> </svg> {new Date(car.availabilityFrom).toLocaleDateString()} -{" "} {new Date(car.availabilityTo).toLocaleDateString()} </div> </div> </div> </div> </div> {/* Right Column - Booking */} <div className="lg:col-span-1"> <div className="sticky top-6"> {user && user.role === "renter" ? ( <div className="bg-white border border-gray-200 rounded-xl p-6 shadow-lg"> <h2 className="text-xl font-semibold text-gray-900 mb-4"> Book This Car </h2> <form onSubmit={handleBook} className="space-y-4"> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Start Date </label> <input type="date" name="startDate" value={booking.startDate} onChange={handleBookingChange} min={new Date().toISOString().split("T")[0]} max={car.availabilityTo} className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition-colors" required /> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> End Date </label> <input type="date" name="endDate" value={booking.endDate} onChange={handleBookingChange} min={ booking.startDate || new Date().toISOString().split("T")[0] } max={car.availabilityTo} className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition-colors" required /> </div> {/* Cost Breakdown */} {numberOfDays > 0 && ( <div className="bg-gray-50 p-4 rounded-lg space-y-2"> <div className="flex justify-between text-sm"> <span> AED {car.pricePerDay} × {numberOfDays} day {numberOfDays !== 1 ? "s" : ""} </span> <span>AED {totalCost}</span> </div> <div className="border-t pt-2 flex justify-between font-semibold"> <span>Total</span> <span className="text-green-600">AED {totalCost}</span> </div> </div> )} {bookingError && ( <div className="bg-red-50 border border-red-200 rounded-lg p-3"> <p className="text-sm text-red-600">{bookingError}</p> </div> )} <button type="submit" disabled={bookingLoading || numberOfDays === 0} className="w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center" > {bookingLoading ? ( <> <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" > <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" ></circle> <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" ></path> </svg> Processing... </> ) : ( "Confirm Booking" )} </button> </form> <div className="mt-4 text-xs text-gray-500 text-center"> 🔒 Your booking is secure and protected </div> </div> ) : user && user.role === "owner" ? ( <div className="bg-blue-50 border border-blue-200 rounded-xl p-6"> <div className="text-center"> <svg className="mx-auto h-12 w-12 text-blue-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /> </svg> <h3 className="text-lg font-medium text-blue-800 mb-2"> Car Owner View </h3> <p className="text-blue-700"> This is your listed car. Switch to a renter account to book cars. </p> </div> </div> ) : ( <div className="bg-yellow-50 border border-yellow-200 rounded-xl p-6"> <div className="text-center"> <svg className="mx-auto h-12 w-12 text-yellow-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /> </svg> <h3 className="text-lg font-medium text-yellow-800 mb-2"> Login Required </h3> <p className="text-yellow-700 mb-4"> Please log in to book this car and enjoy our rental service. </p> <button onClick={() => navigate("/login")} className="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 rounded-lg font-medium transition-colors" > Login to Book </button> </div> </div> )} </div> </div> </div> </div> ); }; export default CarDetails;
```

# borrowmycarfrontend\src\CarFilterBar.jsx

```jsx
import { useState, useEffect } from "react"; const CarFilterBar = ({ onFiltersChange, onReset }) => { const [filters, setFilters] = useState({ city: "", makeModel: "", priceMin: "", priceMax: "", year: "", kilometers: "", transmission: "", }); const [showMakeModelSuggestions, setShowMakeModelSuggestions] = useState(false); const [filteredMakeModels, setFilteredMakeModels] = useState([]); const [activeFiltersCount, setActiveFiltersCount] = useState(0); // Compact data arrays const cities = [ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Al Ain", "Fujairah", ]; const makeModels = [ "Toyota Camry", "Toyota Corolla", "Honda Civic", "BMW 3 Series", "Mercedes C-Class", "Nissan Altima", "Hyundai Elantra", "Audi A4", "Ford Mustang", "Kia Forte", ]; const years = ["2024", "2023", "2022", "2021", "2020"]; const kilometers = ["0-30k", "30k-60k", "60k-100k", "100k+"]; const transmissions = ["Automatic", "Manual"]; // Handle filter changes const handleFilterChange = (key, value) => { const newFilters = { ...filters, [key]: value }; setFilters(newFilters); if (key === "makeModel") { if (value.length > 0) { const filtered = makeModels .filter((model) => model.toLowerCase().includes(value.toLowerCase())) .slice(0, 5); setFilteredMakeModels(filtered); setShowMakeModelSuggestions(filtered.length > 0); } else { setShowMakeModelSuggestions(false); } } if (onFiltersChange) onFiltersChange(newFilters); }; const handleMakeModelSelect = (model) => { handleFilterChange("makeModel", model); setShowMakeModelSuggestions(false); }; // Count active filters useEffect(() => { const count = Object.values(filters).filter((value) => value !== "").length; setActiveFiltersCount(count); }, [filters]); // Reset filters const handleReset = () => { const resetFilters = { city: "", makeModel: "", priceMin: "", priceMax: "", year: "", kilometers: "", transmission: "", }; setFilters(resetFilters); setShowMakeModelSuggestions(false); if (onReset) onReset(); if (onFiltersChange) onFiltersChange(resetFilters); }; // Close suggestions when clicking outside useEffect(() => { const handleClickOutside = (event) => { if (!event.target.closest(".makemodel-container")) { setShowMakeModelSuggestions(false); } }; document.addEventListener("mousedown", handleClickOutside); return () => document.removeEventListener("mousedown", handleClickOutside); }, []); return ( <div className="w-full max-w-6xl mx-auto bg-white border rounded-2xl shadow-sm p-4"> {/* Header */} <div className="flex justify-between items-center mb-4"> <div className="flex items-center gap-2"> <h3 className="font-semibold text-gray-800">Filter Cars</h3> {activeFiltersCount > 0 && ( <span className="bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full"> {activeFiltersCount} </span> )} </div> {activeFiltersCount > 0 && ( <button onClick={handleReset} className="text-red-600 hover:text-red-800 text-xs font-medium" > Clear All </button> )} </div> {/* Compact Filter Grid */} <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3"> {/* City */} <div> <select value={filters.city} onChange={(e) => handleFilterChange("city", e.target.value)} className="w-full text-xs border border-gray-300 rounded-lg px-2 py-2 focus:ring-1 focus:ring-green-500 outline-none" > <option value="">City</option> {cities.map((city, idx) => ( <option key={idx} value={city}> {city} </option> ))} </select> </div> {/* Make & Model */} <div className="makemodel-container relative"> <input type="text" placeholder="Make, Model" value={filters.makeModel} onChange={(e) => handleFilterChange("makeModel", e.target.value)} className="w-full text-xs border border-gray-300 rounded-lg px-2 py-2 focus:ring-1 focus:ring-green-500 outline-none" autoComplete="off" /> {showMakeModelSuggestions && filteredMakeModels.length > 0 && ( <div className="absolute top-full left-0 right-0 mt-1 bg-white border rounded-lg shadow-lg max-h-40 overflow-y-auto z-10"> {filteredMakeModels.map((model, index) => ( <button key={index} onClick={() => handleMakeModelSelect(model)} className="w-full text-left px-2 py-2 text-xs hover:bg-green-50 border-b last:border-b-0" > {model} </button> ))} </div> )} </div> {/* Year */} <div> <select value={filters.year} onChange={(e) => handleFilterChange("year", e.target.value)} className="w-full text-xs border border-gray-300 rounded-lg px-2 py-2 focus:ring-1 focus:ring-green-500 outline-none" > <option value="">Year</option> {years.map((year, idx) => ( <option key={idx} value={year}> {year} </option> ))} </select> </div> {/* Price Min */} <div> <input type="number" placeholder="Min AED" value={filters.priceMin} onChange={(e) => handleFilterChange("priceMin", e.target.value)} className="w-full text-xs border border-gray-300 rounded-lg px-2 py-2 focus:ring-1 focus:ring-green-500 outline-none" /> </div> {/* Price Max */} <div> <input type="number" placeholder="Max AED" value={filters.priceMax} onChange={(e) => handleFilterChange("priceMax", e.target.value)} className="w-full text-xs border border-gray-300 rounded-lg px-2 py-2 focus:ring-1 focus:ring-green-500 outline-none" /> </div> {/* Kilometers */} <div> <select value={filters.kilometers} onChange={(e) => handleFilterChange("kilometers", e.target.value)} className="w-full text-xs border border-gray-300 rounded-lg px-2 py-2 focus:ring-1 focus:ring-green-500 outline-none" > <option value="">Mileage</option> {kilometers.map((km, idx) => ( <option key={idx} value={km}> {km} </option> ))} </select> </div> {/* Transmission */} <div> <select value={filters.transmission} onChange={(e) => handleFilterChange("transmission", e.target.value)} className="w-full text-xs border border-gray-300 rounded-lg px-2 py-2 focus:ring-1 focus:ring-green-500 outline-none" > <option value="">Transmission</option> {transmissions.map((trans, idx) => ( <option key={idx} value={trans}> {trans} </option> ))} </select> </div> </div> {/* Quick Filters */} {activeFiltersCount === 0 && ( <div className="mt-3 pt-3 border-t border-gray-100"> <div className="flex flex-wrap gap-2"> {[ { label: "Luxury", filter: { priceMin: "300" } }, { label: "Economy", filter: { priceMax: "150" } }, { label: "New", filter: { year: "2024" } }, { label: "Dubai", filter: { city: "Dubai" } }, ].map((quickFilter, idx) => ( <button key={idx} onClick={() => { const newFilters = { ...filters, ...quickFilter.filter }; setFilters(newFilters); if (onFiltersChange) onFiltersChange(newFilters); }} className="bg-gray-100 hover:bg-green-100 text-gray-600 hover:text-green-700 px-3 py-1 rounded-full text-xs transition-colors" > {quickFilter.label} </button> ))} </div> </div> )} </div> ); }; export default CarFilterBar;
```

# borrowmycarfrontend\src\CarListingSection.jsx

```jsx
// src/CarListingSection.jsx - Fixed price field references import { useState, useEffect } from "react"; import { Link } from "react-router-dom"; import CarFilterBar from "./CarFilterBar"; import API from "../src/api"; const CarListingSection = () => { const [cars, setCars] = useState([]); const [loading, setLoading] = useState(true); const [error, setError] = useState(""); const [filters, setFilters] = useState({}); const [pagination, setPagination] = useState({ currentPage: 1, totalPages: 1, totalCount: 0, limit: 12, }); const [sortBy, setSortBy] = useState("createdAt"); const [sortOrder, setSortOrder] = useState("desc"); // Fetch cars with filters const fetchCars = async (page = 1, newFilters = filters) => { setLoading(true); setError(""); try { const params = new URLSearchParams({ page: page.toString(), limit: pagination.limit.toString(), sortBy, sortOrder, ...newFilters, }); // Remove empty filter values Object.keys(newFilters).forEach((key) => { if (!newFilters[key]) { params.delete(key); } }); const response = await API.get(`/cars?${params.toString()}`); const { cars: fetchedCars, pagination: paginationData } = response.data .data || { cars: [], pagination: {} }; setCars(fetchedCars); setPagination((prev) => ({ ...prev, ...paginationData, })); } catch (err) { console.error("Error fetching cars:", err); setError("Failed to load cars. Please try again."); setCars([]); } finally { setLoading(false); } }; // Initial load useEffect(() => { fetchCars(); }, [sortBy, sortOrder]); // Handle filter changes const handleFiltersChange = (newFilters) => { setFilters(newFilters); fetchCars(1, newFilters); // Reset to page 1 when filters change }; // Handle filter reset const handleFiltersReset = () => { setFilters({}); fetchCars(1, {}); }; // Handle pagination const handlePageChange = (page) => { fetchCars(page); window.scrollTo({ top: 0, behavior: "smooth" }); }; // Handle sorting const handleSortChange = (newSortBy, newSortOrder = "desc") => { setSortBy(newSortBy); setSortOrder(newSortOrder); }; // Car Card Component const CarCard = ({ car }) => ( <div className="bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-200"> {/* Car Image */} <div className="relative aspect-video bg-gray-100 overflow-hidden"> <img src={ car.images?.[0] || "https://via.placeholder.com/400x240?text=No+Image" } alt={car.title} className="w-full h-full object-cover hover:scale-105 transition-transform duration-300" /> {/* Price Badge - FIXED: Use car.price not car.pricePerDay */} <div className="absolute top-3 right-3 bg-green-600 text-white px-3 py-1 rounded-full text-sm font-semibold"> AED {car.price || car.pricePerDay}/day </div> {/* Status Badge */} <div className="absolute top-3 left-3 bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium"> Available </div> </div> {/* Car Details */} <div className="p-4 space-y-3"> <div> <h3 className="font-semibold text-gray-900 text-lg mb-1 line-clamp-1"> {car.title} </h3> <p className="text-gray-600 text-sm line-clamp-2"> {car.description} </p> </div> {/* Car Info */} <div className="flex items-center justify-between text-sm text-gray-500"> <div className="flex items-center gap-1"> <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /> </svg> <span>{car.city}</span> </div> {car.year && ( <div className="flex items-center gap-1"> <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /> </svg> <span>{car.year}</span> </div> )} </div> {/* Additional Info */} <div className="flex items-center justify-between text-xs text-gray-400"> <span>{car.transmission || "Automatic"}</span> <span>{car.fuelType || "Petrol"}</span> {car.mileage && <span>{car.mileage} km</span>} </div> {/* Action Button */} <Link to={`/cars/${car._id}`} className="block w-full bg-green-600 hover:bg-green-700 text-white text-center py-2 px-4 rounded-lg font-medium transition-colors duration-200" > View Details </Link> </div> </div> ); // Loading Skeleton const LoadingSkeleton = () => ( <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"> {Array.from({ length: 8 }).map((_, index) => ( <div key={index} className="bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm animate-pulse" > <div className="aspect-video bg-gray-200"></div> <div className="p-4 space-y-3"> <div className="h-4 bg-gray-200 rounded w-3/4"></div> <div className="h-3 bg-gray-200 rounded w-full"></div> <div className="h-3 bg-gray-200 rounded w-2/3"></div> <div className="h-8 bg-gray-200 rounded"></div> </div> </div> ))} </div> ); // Pagination Component const Pagination = () => { if (pagination.totalPages <= 1) return null; const pages = []; const maxVisiblePages = 5; const halfVisible = Math.floor(maxVisiblePages / 2); let startPage = Math.max(1, pagination.currentPage - halfVisible); let endPage = Math.min( pagination.totalPages, startPage + maxVisiblePages - 1 ); if (endPage - startPage + 1 < maxVisiblePages) { startPage = Math.max(1, endPage - maxVisiblePages + 1); } for (let i = startPage; i <= endPage; i++) { pages.push(i); } return ( <div className="flex items-center justify-center space-x-2 mt-8"> {/* Previous Button */} <button onClick={() => handlePageChange(pagination.currentPage - 1)} disabled={!pagination.hasPrev} className="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" > Previous </button> {/* Page Numbers */} {pages.map((page) => ( <button key={page} onClick={() => handlePageChange(page)} className={`px-3 py-2 text-sm font-medium rounded-lg ${ page === pagination.currentPage ? "bg-green-600 text-white" : "text-gray-500 bg-white border border-gray-300 hover:bg-gray-50" }`} > {page} </button> ))} {/* Next Button */} <button onClick={() => handlePageChange(pagination.currentPage + 1)} disabled={!pagination.hasNext} className="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" > Next </button> </div> ); }; return ( <div className="max-w-7xl mx-auto p-6 space-y-6"> {/* Filter Bar */} <CarFilterBar onFiltersChange={handleFiltersChange} onReset={handleFiltersReset} /> {/* Results Header */} <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4"> <div className="flex items-center gap-4"> <h2 className="text-2xl font-bold text-gray-900">Available Cars</h2> {!loading && ( <span className="text-gray-600 text-sm"> {pagination.totalCount} cars found </span> )} </div> {/* Sort Options - FIXED: Use correct field names */} <div className="flex items-center gap-3"> <span className="text-sm text-gray-600">Sort by:</span> <select value={`${sortBy}-${sortOrder}`} onChange={(e) => { const [field, order] = e.target.value.split("-"); handleSortChange(field, order); }} className="text-sm border border-gray-300 rounded-lg px-3 py-2 focus:ring-1 focus:ring-green-500 outline-none" > <option value="createdAt-desc">Newest First</option> <option value="createdAt-asc">Oldest First</option> <option value="price-asc">Price: Low to High</option> <option value="price-desc">Price: High to Low</option> <option value="title-asc">Name: A to Z</option> <option value="title-desc">Name: Z to A</option> </select> </div> </div> {/* Error State */} {error && ( <div className="bg-red-50 border border-red-200 rounded-lg p-6 text-center"> <svg className="mx-auto h-12 w-12 text-red-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" /> </svg> <h3 className="text-lg font-medium text-red-800 mb-2"> Error Loading Cars </h3> <p className="text-red-600 mb-4">{error}</p> <button onClick={() => fetchCars()} className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors" > Try Again </button> </div> )} {/* Loading State */} {loading && <LoadingSkeleton />} {/* Empty State */} {!loading && !error && cars.length === 0 && ( <div className="text-center py-12"> <svg className="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /> </svg> <h3 className="text-lg font-medium text-gray-900 mb-2"> No Cars Found </h3> <p className="text-gray-600 mb-4"> Try adjusting your filters or search criteria to find more cars. </p> <button onClick={handleFiltersReset} className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors" > Clear All Filters </button> </div> )} {/* Cars Grid */} {!loading && !error && cars.length > 0 && ( <> <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"> {cars.map((car) => ( <CarCard key={car._id} car={car} /> ))} </div> {/* Pagination */} <Pagination /> </> )} </div> ); }; export default CarListingSection;
```

# borrowmycarfrontend\src\components\ButtonAccent.jsx

```jsx
const ButtonAccent = ({text}) => { return ( <button className="bg-green-600 text-white w-full px-4 py-2 cursor-pointer hover:bg-green-700 rounded-lg">{text}</button> ) } export default ButtonAccent
```

# borrowmycarfrontend\src\components\PhoneInput.jsx

```jsx
// src/components/PhoneInput.jsx - Create this new component file import { useState } from "react"; const PhoneInput = ({ value, onChange, error, placeholder = "0501234567", required = false, className = "", }) => { const [focused, setFocused] = useState(false); const formatPhoneDisplay = (phone) => { // Remove all non-digit characters const digits = phone.replace(/\D/g, ""); // Format as XXX XXX XXXX for display if (digits.length >= 10) { return `${digits.slice(0, 3)} ${digits.slice(3, 6)} ${digits.slice( 6, 10 )}`; } else if (digits.length >= 6) { return `${digits.slice(0, 3)} ${digits.slice(3, 6)} ${digits.slice(6)}`; } else if (digits.length >= 3) { return `${digits.slice(0, 3)} ${digits.slice(3)}`; } return digits; }; const handleInputChange = (e) => { const input = e.target.value; // Remove all non-digit characters const digits = input.replace(/\D/g, ""); // Limit to 10 digits (including leading 0) let formattedValue = digits.slice(0, 10); // Ensure it starts with 0 for UAE local format if (formattedValue.length > 0 && !formattedValue.startsWith("0")) { formattedValue = "0" + formattedValue.slice(0, 9); } onChange(formattedValue); }; const getDisplayValue = () => { if (!value) return ""; // During focus, show unformatted for easier editing if (focused) { return value; } // When not focused, show formatted for better readability return formatPhoneDisplay(value); }; const validatePhone = (phone) => { const digits = phone.replace(/\D/g, ""); // UAE mobile numbers start with 05X and are 10 digits total const validPatterns = [ /^05[0-9]{8}$/, // 0501234567 - UAE mobile format /^04[0-9]{7}$/, // 041234567 - UAE landline format (Dubai) /^02[0-9]{7}$/, // 021234567 - UAE landline format (Abu Dhabi) /^03[0-9]{7}$/, // 031234567 - UAE landline format (Northern Emirates) /^06[0-9]{7}$/, // 061234567 - UAE landline format (Al Ain) /^07[0-9]{7}$/, // 071234567 - UAE landline format (Other) /^09[0-9]{7}$/, // 091234567 - UAE landline format (Other) ]; return validPatterns.some((pattern) => pattern.test(digits)); }; const isValid = value ? validatePhone(value) : true; return ( <div className="space-y-1"> <div className="relative"> <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"> <span className="text-gray-500 text-sm">🇦🇪 +971</span> </div> <input type="text" value={getDisplayValue()} onChange={handleInputChange} onFocus={() => setFocused(true)} onBlur={() => setFocused(false)} placeholder={placeholder} required={required} className={` w-full pl-20 pr-4 py-3 border rounded-lg text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition-colors ${error ? "border-red-500 bg-red-50" : "border-gray-300"} ${!isValid && value ? "border-orange-400 bg-orange-50" : ""} ${className} `} /> {value && isValid && ( <div className="absolute inset-y-0 right-0 pr-3 flex items-center"> <span className="text-green-500 text-sm">✓</span> </div> )} </div> {/* Helper text */} <div className="text-xs space-y-1"> {error && <p className="text-red-600">{error}</p>} {!error && value && !isValid && ( <p className="text-orange-600"> Please enter a valid UAE phone number </p> )} {!error && !value && ( <p className="text-gray-500"> Enter your UAE phone number (e.g., 0501234567) </p> )} </div> {/* Format examples */} {focused && !value && ( <div className="text-xs text-gray-400 space-y-1"> <p className="font-medium">Accepted formats:</p> <ul className="space-y-0.5 ml-2"> <li>• Mobile: 0501234567, 0551234567</li> <li>• Landline: 043001234, 026001234</li> </ul> </div> )} </div> ); }; export default PhoneInput;
```

# borrowmycarfrontend\src\components\ProtectedRoute.jsx

```jsx
// Create src/components/ProtectedRoute.jsx import { useAuth } from "../context/AuthProvider"; import { Navigate, useLocation } from "react-router-dom"; const ProtectedRoute = ({ children, requiredRole = null, requireApproval = false, }) => { const { isAuthenticated, user, loading } = useAuth(); const location = useLocation(); if (loading) { return ( <div className="min-h-screen flex items-center justify-center"> <div className="animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full"></div> </div> ); } if (!isAuthenticated) { return <Navigate to="/login" state={{ from: location }} replace />; } if (requiredRole && user.role !== requiredRole) { return <Navigate to="/" replace />; } if (requireApproval && !user.isApproved) { return ( <div className="min-h-screen flex items-center justify-center"> <div className="text-center p-8"> <div className="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4"> <span className="text-2xl">⏳</span> </div> <h2 className="text-xl font-semibold text-gray-900 mb-2"> Account Pending Approval </h2> <p className="text-gray-600"> Your account is being reviewed. You'll receive an email once approved. </p> </div> </div> ); } return children; }; export default ProtectedRoute;
```

# borrowmycarfrontend\src\context\AuthContext.jsx

```jsx
// src/context/AuthContext.jsx import { createContext, useContext, useReducer, useEffect } from "react"; import API from "../api"; const AuthContext = createContext(); const authReducer = (state, action) => { switch (action.type) { case "LOGIN_START": return { ...state, loading: true, error: null }; case "LOGIN_SUCCESS": return { ...state, loading: false, isAuthenticated: true, user: action.payload.user, token: action.payload.token, }; case "LOGIN_FAILURE": return { ...state, loading: false, error: action.payload, isAuthenticated: false, }; case "LOGOUT": return { ...state, isAuthenticated: false, user: null, token: null, }; case "CLEAR_ERROR": return { ...state, error: null }; default: return state; } }; const initialState = { isAuthenticated: false, user: null, token: localStorage.getItem("token"), loading: false, error: null, }; export const AuthProvider = ({ children }) => { const [state, dispatch] = useReducer(authReducer, initialState); // Check if user is logged in on app start useEffect(() => { const token = localStorage.getItem("token"); if (token) { // Verify token and get user data getCurrentUser(); } }, []); const getCurrentUser = async () => { try { const res = await API.get("/auth/profile"); dispatch({ type: "LOGIN_SUCCESS", payload: { user: res.data.data.user, token: localStorage.getItem("token"), }, }); } catch (error) { localStorage.removeItem("token"); dispatch({ type: "LOGOUT" }); } }; const login = async (credentials) => { dispatch({ type: "LOGIN_START" }); try { const res = await API.post("/auth/login", credentials); const { token, user } = res.data.data; localStorage.setItem("token", token); dispatch({ type: "LOGIN_SUCCESS", payload: { user, token }, }); return { success: true }; } catch (error) { const message = error.response?.data?.message || "Login failed"; dispatch({ type: "LOGIN_FAILURE", payload: message }); return { success: false, error: message }; } }; const signup = async (userData) => { dispatch({ type: "LOGIN_START" }); try { const formData = new FormData(); // Append form fields Object.keys(userData).forEach((key) => { if (key !== "confirmPassword" && typeof userData[key] !== "object") { formData.append(key, userData[key]); } }); // Append files if they exist if (userData.files) { Object.keys(userData.files).forEach((key) => { if (userData.files[key]) { formData.append(key, userData.files[key]); } }); } const res = await API.post("/auth/signup", formData); const { token, user } = res.data.data; localStorage.setItem("token", token); dispatch({ type: "LOGIN_SUCCESS", payload: { user, token }, }); return { success: true }; } catch (error) { const message = error.response?.data?.message || "Signup failed"; dispatch({ type: "LOGIN_FAILURE", payload: message }); return { success: false, error: message }; } }; const logout = () => { localStorage.removeItem("token"); dispatch({ type: "LOGOUT" }); }; const clearError = () => { dispatch({ type: "CLEAR_ERROR" }); }; const value = { ...state, login, signup, logout, clearError, getCurrentUser, }; return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>; }; export const useAuth = () => { const context = useContext(AuthContext); if (!context) { throw new Error("useAuth must be used within an AuthProvider"); } return context; };
```

# borrowmycarfrontend\src\context\AuthProvider.jsx

```jsx
// src/context/AuthProvider.jsx - COMPLETE FIX import { createContext, useContext, useReducer, useEffect } from "react"; import API from "../api"; const AuthContext = createContext(); const authReducer = (state, action) => { switch (action.type) { case "LOGIN_START": return { ...state, loading: true, error: null }; case "LOGIN_SUCCESS": return { ...state, loading: false, isAuthenticated: true, user: action.payload.user, token: action.payload.token, error: null, }; case "LOGIN_FAILURE": return { ...state, loading: false, error: action.payload, isAuthenticated: false, user: null, token: null, }; case "LOGOUT": return { ...state, isAuthenticated: false, user: null, token: null, error: null, }; case "CLEAR_ERROR": return { ...state, error: null }; case "SET_LOADING": return { ...state, loading: action.payload }; default: return state; } }; const initialState = { isAuthenticated: false, user: null, token: localStorage.getItem("token"), loading: true, error: null, }; export const AuthProvider = ({ children }) => { const [state, dispatch] = useReducer(authReducer, initialState); // Check if user is logged in on app start useEffect(() => { const token = localStorage.getItem("token"); if (token) { getCurrentUser(); } else { dispatch({ type: "SET_LOADING", payload: false }); } }, []); const getCurrentUser = async () => { try { dispatch({ type: "SET_LOADING", payload: true }); const res = await API.get("/auth/profile"); // Handle profile response format const user = res.data.data?.user || res.data.user; if (user) { dispatch({ type: "LOGIN_SUCCESS", payload: { user, token: localStorage.getItem("token"), }, }); } else { throw new Error("No user data received"); } } catch (error) { console.error("Get current user error:", error); localStorage.removeItem("token"); localStorage.removeItem("user"); dispatch({ type: "LOGOUT" }); } finally { dispatch({ type: "SET_LOADING", payload: false }); } }; const login = async (credentials) => { dispatch({ type: "LOGIN_START" }); try { const res = await API.post("/auth/login", credentials); // ROBUST handling of different response formats let token = null; let user = null; // Check multiple possible response structures if (res.data.token && res.data.user) { // Direct format: { token, user } token = res.data.token; user = res.data.user; } else if (res.data.data?.token && res.data.data?.user) { // Nested format: { data: { token, user } } token = res.data.data.token; user = res.data.data.user; } else if (res.data.success && res.data.token) { // Success format: { success: true, token, user } token = res.data.token; user = res.data.user; } if (token && user) { localStorage.setItem("token", token); localStorage.setItem("user", JSON.stringify(user)); dispatch({ type: "LOGIN_SUCCESS", payload: { user, token }, }); return { success: true }; } else { throw new Error("Invalid login response format"); } } catch (error) { const message = error.response?.data?.message || error.message || "Login failed"; dispatch({ type: "LOGIN_FAILURE", payload: message }); return { success: false, error: message }; } }; const signup = async (userData) => { dispatch({ type: "LOGIN_START" }); try { const formData = new FormData(); // Append form fields Object.keys(userData).forEach((key) => { if ( key !== "confirmPassword" && key !== "files" && typeof userData[key] !== "object" ) { formData.append(key, userData[key]); } }); // Append files if they exist if (userData.files) { Object.keys(userData.files).forEach((key) => { if (userData.files[key]) { formData.append(key, userData.files[key]); } }); } const res = await API.post("/auth/signup", formData, { headers: { "Content-Type": "multipart/form-data" }, }); // Handle signup response (same robust logic as login) let token = null; let user = null; if (res.data.token && res.data.user) { token = res.data.token; user = res.data.user; } else if (res.data.data?.token && res.data.data?.user) { token = res.data.data.token; user = res.data.data.user; } if (token && user) { localStorage.setItem("token", token); localStorage.setItem("user", JSON.stringify(user)); dispatch({ type: "LOGIN_SUCCESS", payload: { user, token }, }); return { success: true }; } else { throw new Error("Invalid signup response format"); } } catch (error) { const message = error.response?.data?.message || error.message || "Signup failed"; dispatch({ type: "LOGIN_FAILURE", payload: message }); return { success: false, error: message }; } }; const logout = () => { localStorage.removeItem("token"); localStorage.removeItem("user"); dispatch({ type: "LOGOUT" }); }; const clearError = () => { dispatch({ type: "CLEAR_ERROR" }); }; const value = { ...state, login, signup, logout, clearError, getCurrentUser, }; return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>; }; export const useAuth = () => { const context = useContext(AuthContext); if (!context) { throw new Error("useAuth must be used within an AuthProvider"); } return context; };
```

# borrowmycarfrontend\src\Footer.jsx

```jsx
import Logo from "./assets/BorrowMyCar.png"; const Footer = () => { const currentYear = new Date().getFullYear(); const footerLinks = { company: [ { name: "About Us", href: "/about" }, { name: "How It Works", href: "/how-it-works" }, { name: "Our Story", href: "/story" }, { name: "Careers", href: "/careers" }, { name: "Contact Us", href: "/contact" }, ], services: [ { name: "Browse Cars", href: "/browse" }, { name: "List Your Car", href: "/list-car" }, { name: "My Bookings", href: "/my-bookings" }, { name: "My Listings", href: "/my-listings" }, { name: "Help Center", href: "/help" }, ], legal: [ { name: "Terms of Service", href: "/terms" }, { name: "Privacy Policy", href: "/privacy" }, { name: "Rental Agreement", href: "/rental-agreement" }, { name: "Insurance Policy", href: "/insurance" }, { name: "Refund Policy", href: "/refunds" }, ], social: [ { name: "Facebook", href: "https://facebook.com/borrowmycar", icon: ( <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"> <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" /> </svg> ), }, { name: "Instagram", href: "https://instagram.com/borrowmycar", icon: ( <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"> <path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 6.62 5.367 11.987 11.988 11.987 6.62 0 11.987-5.367 11.987-11.987C24.014 5.367 18.637.001 12.017.001zM8.449 16.988c-1.297 0-2.448-.49-3.328-1.297C4.243 14.894 3.752 13.743 3.752 12.446c0-1.297.49-2.448 1.369-3.328.879-.879 2.031-1.369 3.328-1.369 1.297 0 2.448.49 3.328 1.369.879.879 1.369 2.031 1.369 3.328 0 1.297-.49 2.448-1.369 3.328-.88.807-2.031 1.297-3.328 1.297z" /> </svg> ), }, { name: "Twitter", href: "https://twitter.com/borrowmycar", icon: ( <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"> <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z" /> </svg> ), }, { name: "LinkedIn", href: "https://linkedin.com/company/borrowmycar", icon: ( <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"> <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" /> </svg> ), }, ], }; const handleScrollToTop = () => { window.scrollTo({ top: 0, behavior: "smooth", }); }; return ( <footer className="w-full bg-white border-t border-gray-200"> {/* Main Footer Content */} <div className="max-w-7xl mx-auto px-4 py-12"> <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-8"> {/* Brand Section */} <div className="lg:col-span-2 space-y-4"> <a href="/" className="inline-block"> <img src={Logo} alt="BorrowMyCar Logo" className="h-12 w-auto hover:opacity-80 transition-opacity" /> </a> <h3 className="text-lg font-semibold text-gray-900"> Your Trusted Car Rental Platform </h3> <p className="text-sm text-gray-600 leading-relaxed max-w-md"> BorrowMyCar connects car owners and renters across the UAE, providing a secure, convenient, and affordable car sharing experience. Join thousands of satisfied users today. </p> {/* Social Media Links */} <div className="flex space-x-4 pt-2"> {footerLinks.social.map((social) => ( <a key={social.name} href={social.href} target="_blank" rel="noopener noreferrer" className="text-gray-400 hover:text-green-600 transition-colors duration-200" aria-label={`Follow us on ${social.name}`} > {social.icon} </a> ))} </div> </div> {/* Company Links */} <div className="space-y-4"> <h3 className="text-sm font-semibold text-gray-900 uppercase tracking-wider"> Company </h3> <ul className="space-y-3"> {footerLinks.company.map((link) => ( <li key={link.name}> <a href={link.href} className="text-sm text-gray-600 hover:text-green-600 transition-colors duration-200" > {link.name} </a> </li> ))} </ul> </div> {/* Services Links */} <div className="space-y-4"> <h3 className="text-sm font-semibold text-gray-900 uppercase tracking-wider"> Services </h3> <ul className="space-y-3"> {footerLinks.services.map((link) => ( <li key={link.name}> <a href={link.href} className="text-sm text-gray-600 hover:text-green-600 transition-colors duration-200" > {link.name} </a> </li> ))} </ul> </div> {/* Legal Links */} <div className="space-y-4"> <h3 className="text-sm font-semibold text-gray-900 uppercase tracking-wider"> Legal </h3> <ul className="space-y-3"> {footerLinks.legal.map((link) => ( <li key={link.name}> <a href={link.href} className="text-sm text-gray-600 hover:text-green-600 transition-colors duration-200" > {link.name} </a> </li> ))} </ul> </div> </div> {/* Newsletter Subscription */} <div className="mt-12 pt-8 border-t border-gray-200"> <div className="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0"> <div className="max-w-md"> <h4 className="text-sm font-semibold text-gray-900 mb-2"> Stay Updated </h4> <p className="text-sm text-gray-600"> Get the latest updates on new features, promotions, and car listings. </p> </div> <div className="flex flex-col sm:flex-row gap-3 max-w-md w-full md:w-auto"> <input type="email" placeholder="Enter your email" className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition-colors text-sm" /> <button className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium transition-colors text-sm whitespace-nowrap"> Subscribe </button> </div> </div> </div> {/* Back to Top Button */} <div className="mt-8 flex justify-center"> <button onClick={handleScrollToTop} className="flex items-center cursor-pointer gap-2 bg-gray-100 hover:bg-green-600 hover:text-white text-gray-700 px-6 py-3 rounded-lg font-medium transition-colors duration-200 group" aria-label="Scroll to top" > <span>Back to Top</span> <svg className="w-4 h-4 transform group-hover:-translate-y-1 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 10l7-7m0 0l7 7m-7-7v18" /> </svg> </button> </div> </div> {/* Bottom Bar */} <div className="bg-gray-50 border-t border-gray-200"> <div className="max-w-7xl mx-auto px-4 py-6"> <div className="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0"> <div className="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-6"> <p className="text-sm text-gray-600"> &copy; {currentYear} BorrowMyCar. All rights reserved. </p> <div className="flex items-center space-x-4 text-xs text-gray-500"> <a href="/terms" className="hover:text-green-600 transition-colors" > Terms </a> <span>•</span> <a href="/privacy" className="hover:text-green-600 transition-colors" > Privacy </a> <span>•</span> <a href="/cookies" className="hover:text-green-600 transition-colors" > Cookies </a> </div> </div> <div className="flex items-center space-x-2 text-sm text-gray-600"> <span>Made with</span> <span className="text-red-500 animate-pulse">❤️</span> <span>in UAE</span> </div> </div> </div> </div> </footer> ); }; export default Footer;
```

# borrowmycarfrontend\src\global.css

```css
@import "tailwindcss"; .input { @apply px-4 py-2 rounded-xl border-2 border-gray-300 focus:outline-none focus:bg-gray-50 focus:ring-2 focus:ring-green-500; } .accent-color { @apply text-green-500; } p { font-size: 1rem; line-height: 1.6; }
```

# borrowmycarfrontend\src\HowItWorks.jsx

```jsx
import { useState } from "react"; import { Link } from "react-router-dom"; import { Helmet } from "react-helmet"; import { Search, Car, Calendar, Shield, CreditCard, Key, CheckCircle, Users, Clock, MapPin, Star, ArrowRight, Phone, MessageCircle, AlertTriangle, Award, Smartphone, } from "lucide-react"; const HowItWorks = () => { const [activeTab, setActiveTab] = useState("renter"); const renterSteps = [ { step: 1, icon: Search, title: "Browse & Search", description: "Search thousands of verified cars across the UAE", details: [ "Filter by location, price, car type, and availability", "View detailed photos, specifications, and owner ratings", "Read reviews from previous renters", "Compare prices and features instantly", ], image: "🔍", }, { step: 2, icon: Calendar, title: "Book Your Ride", description: "Select dates and confirm your booking instantly", details: [ "Choose your rental dates and duration", "See instant pricing with no hidden fees", "Secure booking with instant confirmation", "Flexible cancellation options available", ], image: "📅", }, { step: 3, icon: CreditCard, title: "Secure Payment", description: "Pay safely with our encrypted payment system", details: [ "Multiple payment options: Credit card, debit card, digital wallets", "Bank-level security with SSL encryption", "Hold deposit released after safe return", "Transparent pricing with detailed breakdown", ], image: "💳", }, { step: 4, icon: Key, title: "Pick Up & Drive", description: "Meet the owner and start your journey", details: [ "Meet at agreed location with flexible timing", "Quick vehicle inspection with owner", "Receive keys and vehicle documents", "24/7 support throughout your rental", ], image: "🔑", }, ]; const ownerSteps = [ { step: 1, icon: Car, title: "List Your Car", description: "Create your car listing in minutes", details: [ "Upload high-quality photos of your vehicle", "Set your availability and pricing", "Add detailed description and features", "Verification process ensures quality listings", ], image: "🚗", }, { step: 2, icon: Users, title: "Get Verified", description: "Complete verification for trusted listings", details: [ "Submit required documents (Emirates ID, License)", "Vehicle inspection and documentation", "Background check and identity verification", "Approved listings get priority visibility", ], image: "✅", }, { step: 3, icon: Calendar, title: "Receive Bookings", description: "Accept or decline booking requests", details: [ "Instant notifications for new bookings", "Review renter profiles and ratings", "Accept bookings with one click", "Set automatic approval for verified renters", ], image: "📱", }, { step: 4, icon: CreditCard, title: "Earn Money", description: "Get paid automatically after each rental", details: [ "Automatic payment processing", "Competitive earning potential", "Weekly payouts to your bank account", "Detailed earnings reports and analytics", ], image: "💰", }, ]; const features = [ { icon: Shield, title: "Insurance Coverage", description: "Comprehensive insurance protection for all rentals", benefits: [ "Third-party liability coverage", "Collision damage protection", "Theft protection included", "24/7 roadside assistance", ], }, { icon: CheckCircle, title: "Verified Community", description: "All users undergo thorough verification", benefits: [ "ID and license verification", "Background checks for owners", "Rating system for accountability", "Trusted community of 50,000+ users", ], }, { icon: Clock, title: "24/7 Support", description: "Round-the-clock customer assistance", benefits: [ "Instant chat support", "Emergency helpline", "Multilingual support team", "Quick resolution guarantee", ], }, { icon: Smartphone, title: "Easy-to-Use Platform", description: "Intuitive interface designed for everyone", benefits: [ "Mobile-responsive design", "One-click booking process", "Real-time notifications", "Seamless user experience", ], }, ]; const faqs = [ { question: "What documents do I need to rent a car?", answer: "You need a valid UAE driving license, Emirates ID or passport, and a credit card for security deposit. International visitors need an International Driving Permit along with their home country license.", }, { question: "How does the insurance work?", answer: "All rentals include comprehensive insurance coverage including third-party liability, collision damage, and theft protection. There's a security deposit that covers any deductibles, which is released after safe return of the vehicle.", }, { question: "Can I extend my rental period?", answer: "Yes, you can extend your rental if the car is available. Simply contact the owner through our platform or reach out to customer support. Additional charges will apply based on the daily rate.", }, { question: "What happens if the car breaks down?", answer: "All rentals include 24/7 roadside assistance. Contact our emergency helpline and we'll arrange immediate help. If the issue is due to mechanical failure, we'll provide a replacement vehicle or full refund.", }, { question: "How much can I earn as a car owner?", answer: "Earnings vary based on your car type, location, and availability. On average, owners earn AED 100-300 per day. Popular cars in Dubai and Abu Dhabi tend to have higher demand and better earning potential.", }, { question: "Is my car protected when rented out?", answer: "Yes, comprehensive insurance covers your vehicle during rentals. All renters are verified and rated. You can set your own approval criteria and decline bookings if needed.", }, ]; const stats = [ { number: "50,000+", label: "Happy Users", icon: "👥" }, { number: "5,000+", label: "Available Cars", icon: "🚗" }, { number: "7", label: "Emirates Covered", icon: "🇦🇪" }, { number: "4.8/5", label: "Average Rating", icon: "⭐" }, ]; return ( <> <Helmet> <title>How It Works - BorrowMyCar | UAE Car Rental Platform</title> <meta name="description" content="Learn how BorrowMyCar works for renters and car owners. Simple steps to rent a car or earn money by listing your vehicle in the UAE." /> </Helmet> <div className="min-h-screen bg-white"> {/* Hero Section */} <div className="bg-gradient-to-br from-green-50 to-emerald-100 py-16 lg:py-24"> <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"> <div className="text-center space-y-6"> <h1 className="text-4xl lg:text-6xl font-bold text-gray-900"> How <span className="text-green-600">BorrowMyCar</span> Works </h1> <p className="text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed"> Whether you want to rent a car or earn money with your vehicle, our platform makes it simple, safe, and secure. </p> {/* Stats */} <div className="grid grid-cols-2 lg:grid-cols-4 gap-8 mt-12"> {stats.map((stat, index) => ( <div key={index} className="text-center"> <div className="text-4xl mb-2">{stat.icon}</div> <div className="text-2xl lg:text-3xl font-bold text-gray-900"> {stat.number} </div> <div className="text-gray-600">{stat.label}</div> </div> ))} </div> </div> </div> </div> {/* Tab Navigation */} <div className="border-b border-gray-200 bg-white sticky top-0 z-10"> <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"> <div className="flex justify-center"> <nav className="flex space-x-8"> {[ { id: "renter", label: "For Renters", icon: "🚗" }, { id: "owner", label: "For Car Owners", icon: "💰" }, ].map((tab) => ( <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`py-4 px-6 border-b-2 font-medium text-sm transition-colors ${ activeTab === tab.id ? "border-green-500 text-green-600" : "border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" }`} > <span className="mr-2">{tab.icon}</span> {tab.label} </button> ))} </nav> </div> </div> </div> {/* Steps Section */} <div className="py-16 lg:py-24"> <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"> <div className="text-center mb-16"> <h2 className="text-3xl lg:text-4xl font-bold text-gray-900 mb-4"> {activeTab === "renter" ? "Rent a Car in 4 Easy Steps" : "Start Earning with Your Car"} </h2> <p className="text-xl text-gray-600 max-w-2xl mx-auto"> {activeTab === "renter" ? "Get behind the wheel of your perfect car in minutes" : "Turn your parked car into a money-making asset"} </p> </div> <div className="space-y-16"> {(activeTab === "renter" ? renterSteps : ownerSteps).map( (step, index) => ( <div key={step.step} className={`flex flex-col lg:flex-row items-center gap-12 ${ index % 2 === 1 ? "lg:flex-row-reverse" : "" }`} > {/* Content */} <div className="flex-1 space-y-6"> <div className="flex items-center space-x-4"> <div className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center"> <step.icon className="h-6 w-6 text-green-600" /> </div> <div className="w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center font-bold"> {step.step} </div> </div> <div> <h3 className="text-2xl lg:text-3xl font-bold text-gray-900 mb-3"> {step.title} </h3> <p className="text-lg text-gray-600 mb-6"> {step.description} </p> <ul className="space-y-3"> {step.details.map((detail, idx) => ( <li key={idx} className="flex items-start space-x-3" > <CheckCircle className="h-5 w-5 text-green-500 flex-shrink-0 mt-0.5" /> <span className="text-gray-700">{detail}</span> </li> ))} </ul> </div> </div> {/* Visual */} <div className="flex-1 flex justify-center"> <div className="w-64 h-64 bg-gradient-to-br from-green-100 to-emerald-200 rounded-2xl flex items-center justify-center text-8xl shadow-lg"> {step.image} </div> </div> </div> ) )} </div> {/* CTA */} <div className="text-center mt-16"> <Link to={activeTab === "renter" ? "/browse" : "/signup"} className="inline-flex items-center px-8 py-4 border border-transparent text-lg font-medium rounded-lg text-white bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 transition-all duration-200 shadow-lg hover:shadow-xl" > {activeTab === "renter" ? "Start Browsing Cars" : "List Your Car Now"} <ArrowRight className="ml-2 h-5 w-5" /> </Link> </div> </div> </div> {/* Features Section */} <div className="bg-gray-50 py-16 lg:py-24"> <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"> <div className="text-center mb-16"> <h2 className="text-3xl lg:text-4xl font-bold text-gray-900 mb-4"> Why Choose BorrowMyCar? </h2> <p className="text-xl text-gray-600 max-w-2xl mx-auto"> We provide the safest, most convenient car sharing experience in the UAE </p> </div> <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8"> {features.map((feature, index) => ( <div key={index} className="bg-white rounded-2xl p-8 shadow-sm hover:shadow-md transition-shadow" > <div className="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center mb-6"> <feature.icon className="h-6 w-6 text-green-600" /> </div> <h3 className="text-xl font-bold text-gray-900 mb-3"> {feature.title} </h3> <p className="text-gray-600 mb-4">{feature.description}</p> <ul className="space-y-2"> {feature.benefits.map((benefit, idx) => ( <li key={idx} className="flex items-start space-x-2 text-sm text-gray-700" > <CheckCircle className="h-4 w-4 text-green-500 flex-shrink-0 mt-0.5" /> <span>{benefit}</span> </li> ))} </ul> </div> ))} </div> </div> </div> {/* FAQ Section */} <div className="py-16 lg:py-24"> <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8"> <div className="text-center mb-16"> <h2 className="text-3xl lg:text-4xl font-bold text-gray-900 mb-4"> Frequently Asked Questions </h2> <p className="text-xl text-gray-600"> Get answers to common questions about our platform </p> </div> <div className="space-y-6"> {faqs.map((faq, index) => ( <div key={index} className="bg-white border border-gray-200 rounded-xl p-6 hover:shadow-sm transition-shadow" > <h3 className="text-lg font-semibold text-gray-900 mb-3"> {faq.question} </h3> <p className="text-gray-700 leading-relaxed">{faq.answer}</p> </div> ))} </div> </div> </div> {/* Contact Section */} <div className="bg-gradient-to-r from-green-600 to-emerald-600 py-16"> <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center"> <h2 className="text-3xl lg:text-4xl font-bold text-white mb-4"> Still Have Questions? </h2> <p className="text-xl text-green-100 mb-8 max-w-2xl mx-auto"> Our support team is here to help you 24/7. Get in touch and we'll respond within minutes. </p> <div className="flex flex-col sm:flex-row gap-4 justify-center items-center"> <a href="tel:+971800266669" className="inline-flex items-center px-6 py-3 border-2 border-white text-white hover:bg-white hover:text-green-600 rounded-lg font-medium transition-colors" > <Phone className="h-5 w-5 mr-2" /> Call +971 800 BORROW </a> <a href="mailto:support@borrowmycar.ae" className="inline-flex items-center px-6 py-3 bg-white text-green-600 hover:bg-gray-100 rounded-lg font-medium transition-colors" > <MessageCircle className="h-5 w-5 mr-2" /> Email Support </a> </div> </div> </div> {/* Final CTA */} <div className="bg-white py-16"> <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center"> <h2 className="text-3xl lg:text-4xl font-bold text-gray-900 mb-6"> Ready to Get Started? </h2> <p className="text-xl text-gray-600 mb-8"> Join thousands of satisfied users across the UAE </p> <div className="flex flex-col sm:flex-row gap-4 justify-center"> <Link to="/browse" className="inline-flex items-center justify-center px-8 py-4 border border-transparent text-lg font-medium rounded-lg text-white bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 transition-all duration-200" > Browse Cars <Search className="ml-2 h-5 w-5" /> </Link> <Link to="/signup" className="inline-flex items-center justify-center px-8 py-4 border-2 border-green-600 text-lg font-medium rounded-lg text-green-600 bg-white hover:bg-green-50 transition-colors" > List Your Car <Car className="ml-2 h-5 w-5" /> </Link> </div> </div> </div> </div> </> ); }; export default HowItWorks;
```

# borrowmycarfrontend\src\index.jsx

```jsx
// borrowmycarfrontend/src/index.jsx - FIXED VERSION import { StrictMode } from "react"; import { createRoot } from "react-dom/client"; import { createBrowserRouter, RouterProvider, Outlet } from "react-router-dom"; import App from "./App.jsx"; import BrowseCars from "./BrowseCars.jsx"; import Login from "./Login.jsx"; import Signup from "./Signup.jsx"; import CarDetails from "./CarDetails.jsx"; import ListCar from "./ListCar.jsx"; import HowItWorks from "./HowItWorks.jsx"; import MyBookings from "./MyBookings.jsx"; import Settings from "./Settings.jsx"; import NotFound from "./NotFound.jsx"; import Navbar from "./Navbar.jsx"; import Footer from "./Footer.jsx"; import ProtectedRoute from "./components/ProtectedRoute.jsx"; import { AuthProvider } from "./context/AuthProvider.jsx"; import "./global.css"; // Main Layout Component const Layout = () => ( <> <Navbar /> <main className="min-h-screen"> <Outlet /> </main> <Footer /> </> ); // Auth Layout (no navbar/footer for login/signup) const AuthLayout = () => ( <main className="min-h-screen"> <Outlet /> </main> ); // Define routes properly const router = createBrowserRouter([ { path: "/", element: <Layout />, children: [ { index: true, element: <App /> }, { path: "browse", element: <BrowseCars /> }, { path: "how-it-works", element: <HowItWorks /> }, { path: "cars/:id", element: <CarDetails /> }, { path: "list-car", element: ( <ProtectedRoute requiredRole="owner" requireApproval={true}> <ListCar /> </ProtectedRoute> ), }, { path: "my-bookings", element: ( <ProtectedRoute> <MyBookings /> </ProtectedRoute> ), }, { path: "settings", element: ( <ProtectedRoute> <Settings /> </ProtectedRoute> ), }, ], }, { path: "/auth", element: <AuthLayout />, children: [ { path: "login", element: <Login /> }, { path: "signup", element: <Signup /> }, ], }, // Keep login/signup at root level for backward compatibility { path: "/login", element: <Login /> }, { path: "/signup", element: <Signup /> }, { path: "*", element: <NotFound /> }, ]); createRoot(document.getElementById("root")).render( <StrictMode> <AuthProvider> <RouterProvider router={router} /> </AuthProvider> </StrictMode> );
```

# borrowmycarfrontend\src\ListCar.jsx

```jsx
import { useState, useEffect } from "react"; import API from "../src/api"; import { useNavigate } from "react-router-dom"; const ListCar = () => { const [form, setForm] = useState({ title: "", description: "", city: "", pricePerDay: "", availabilityFrom: "", availabilityTo: "", }); const [images, setImages] = useState([]); const [error, setError] = useState(""); const [loading, setLoading] = useState(false); const [fileInputKey, setFileInputKey] = useState(Date.now()); // Add key to reset file input const [showSuggestions, setShowSuggestions] = useState(false); const [filteredSuggestions, setFilteredSuggestions] = useState([]); const [showCitySuggestions, setShowCitySuggestions] = useState(false); const [filteredCities, setFilteredCities] = useState([]); const navigate = useNavigate(); // UAE Cities database const uaeCities = [ // Major Emirates and Cities "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", // Dubai Areas/Districts "Dubai Marina", "Downtown Dubai", "Jumeirah", "Deira", "Bur Dubai", "Al Barsha", "Dubai Investment Park", "Dubai Silicon Oasis", "Dubai South", "Al Nahda Dubai", "Jumeirah Lake Towers", "Business Bay", "DIFC", "Dubai Hills", "Al Qusais", "Al Mizhar", "International City", "Discovery Gardens", "Dubai Sports City", // Abu Dhabi Areas "Abu Dhabi City", "Al Ain", "Al Ruwais", "Khalifa City", "Al Shamkha", "Yas Island", "Saadiyat Island", "Al Reef", "Al Rahba", "Masdar City", "Mohammed Bin Zayed City", "Al Falah", "Al Mushrif", "Tourist Club Area", // Sharjah Areas "Sharjah City", "Al Nahda Sharjah", "Al Qasimia", "Al Majaz", "Al Khan", "Al Taawun", "Al Suyoh", "Muwaileh", "University City Sharjah", // Northern Emirates "Al Dhaid", "Kalba", "Dibba Al Fujairah", "Khor Fakkan", "Masafi", "Hatta", "Liwa Oasis", "Ghayathi", "Madinat Zayed", "Sila", // Other Notable Areas "Jebel Ali", "Al Ain City", "Sohar", "Dibba Al Hisn", "Al Hamriyah", "Emirates Hills", "Arabian Ranches", "Motor City", "Al Warqa", "Mirdif", ]; // Car name suggestions database const carSuggestions = [ // Toyota "Toyota Camry 2024", "Toyota Corolla 2023", "Toyota RAV4 2024", "Toyota Highlander 2023", "Toyota Prius 2024", "Toyota Land Cruiser 2023", "Toyota Avalon 2023", "Toyota Sienna 2024", // Honda "Honda Civic 2024", "Honda Accord 2023", "Honda CR-V 2024", "Honda Pilot 2023", "Honda Fit 2023", "Honda HR-V 2024", "Honda Passport 2023", "Honda Ridgeline 2024", // BMW "BMW 3 Series 2024", "BMW 5 Series 2023", "BMW X3 2024", "BMW X5 2023", "BMW i4 2024", "BMW X1 2023", "BMW 7 Series 2024", "BMW X7 2023", // Mercedes-Benz "Mercedes-Benz C-Class 2024", "Mercedes-Benz E-Class 2023", "Mercedes-Benz GLE 2024", "Mercedes-Benz A-Class 2023", "Mercedes-Benz S-Class 2024", "Mercedes-Benz GLC 2023", // Audi "Audi A4 2024", "Audi A6 2023", "Audi Q5 2024", "Audi Q7 2023", "Audi A3 2024", "Audi Q3 2023", "Audi A8 2024", "Audi e-tron 2023", // Nissan "Nissan Altima 2024", "Nissan Sentra 2023", "Nissan Rogue 2024", "Nissan Pathfinder 2023", "Nissan Leaf 2024", "Nissan Murano 2023", "Nissan Armada 2024", "Nissan Kicks 2023", // Hyundai "Hyundai Elantra 2024", "Hyundai Sonata 2023", "Hyundai Tucson 2024", "Hyundai Santa Fe 2023", "Hyundai Ioniq 5 2024", "Hyundai Kona 2023", "Hyundai Palisade 2024", "Hyundai Venue 2023", // Kia "Kia Forte 2024", "Kia Optima 2023", "Kia Sportage 2024", "Kia Sorento 2023", "Kia EV6 2024", "Kia Soul 2023", "Kia Telluride 2024", "Kia Rio 2023", // Ford "Ford Mustang 2024", "Ford F-150 2023", "Ford Explorer 2024", "Ford Escape 2023", "Ford Bronco 2024", "Ford Edge 2023", "Ford Expedition 2024", "Ford Fusion 2023", // Chevrolet "Chevrolet Malibu 2024", "Chevrolet Equinox 2023", "Chevrolet Traverse 2024", "Chevrolet Silverado 2023", "Chevrolet Bolt 2024", "Chevrolet Tahoe 2023", "Chevrolet Suburban 2024", "Chevrolet Camaro 2023", // Luxury & Sports "Porsche 911 2024", "Porsche Cayenne 2023", "Jaguar F-PACE 2024", "Land Rover Discovery 2023", "Lexus RX 2024", "Lexus ES 2023", "Infiniti Q50 2024", "Acura MDX 2023", "Tesla Model 3 2024", "Tesla Model Y 2023", "Tesla Model S 2024", "Tesla Model X 2023", // Popular UAE Models "Mitsubishi Pajero 2024", "Toyota Prado 2023", "Nissan Patrol 2024", "Ford Raptor 2023", "Range Rover Evoque 2024", "Jeep Grand Cherokee 2023", "Volkswagen Tiguan 2024", "Mazda CX-5 2023", ]; const handleChange = (e) => { const { name, value } = e.target; setForm({ ...form, [name]: value }); // Handle car title suggestions if (name === "title") { if (value.length > 0) { const filtered = carSuggestions .filter((suggestion) => suggestion.toLowerCase().includes(value.toLowerCase()) ) .slice(0, 8); // Limit to 8 suggestions setFilteredSuggestions(filtered); setShowSuggestions(filtered.length > 0); } else { setShowSuggestions(false); setFilteredSuggestions([]); } } // Handle city suggestions if (name === "city") { if (value.length > 0) { const filtered = uaeCities .filter((city) => city.toLowerCase().includes(value.toLowerCase())) .slice(0, 10); // Limit to 10 city suggestions setFilteredCities(filtered); setShowCitySuggestions(filtered.length > 0); } else { setShowCitySuggestions(false); setFilteredCities([]); } } }; const handleSuggestionClick = (suggestion) => { setForm({ ...form, title: suggestion }); setShowSuggestions(false); setFilteredSuggestions([]); }; const handleCityClick = (city) => { setForm({ ...form, city: city }); setShowCitySuggestions(false); setFilteredCities([]); }; // Close suggestions when clicking outside useEffect(() => { const handleClickOutside = (event) => { if (!event.target.closest(".suggestion-container")) { setShowSuggestions(false); } if (!event.target.closest(".city-suggestion-container")) { setShowCitySuggestions(false); } }; document.addEventListener("mousedown", handleClickOutside); return () => { document.removeEventListener("mousedown", handleClickOutside); }; }, []); const handleFileChange = (e) => { const files = Array.from(e.target.files); setImages(files); }; const removeImage = (indexToRemove) => { const updatedImages = images.filter((_, index) => index !== indexToRemove); setImages(updatedImages); // Reset the file input to clear the displayed filename setFileInputKey(Date.now()); }; const validateForm = () => { const { title, description, city, pricePerDay, availabilityFrom, availabilityTo, } = form; if (!title.trim() || !description.trim() || !city.trim()) { setError("All text fields are required"); return false; } if (parseFloat(pricePerDay) <= 0) { setError("Price per day must be greater than 0"); return false; } const fromDate = new Date(availabilityFrom); const toDate = new Date(availabilityTo); const today = new Date(); today.setHours(0, 0, 0, 0); if (fromDate < today) { setError("Availability start date cannot be in the past"); return false; } if (toDate <= fromDate) { setError("End date must be after start date"); return false; } if (images.length === 0) { setError("Please upload at least one image"); return false; } // Validate image files const validTypes = ["image/jpeg", "image/png", "image/jpg"]; const maxSize = 5 * 1024 * 1024; // 5MB for (let file of images) { if (!validTypes.includes(file.type)) { setError("Only JPEG, PNG images are allowed"); return false; } if (file.size > maxSize) { setError("Each image must be less than 5MB"); return false; } } return true; }; const handleSubmit = async (e) => { e.preventDefault(); setError(""); if (!validateForm()) { return; } setLoading(true); try { const formData = new FormData(); // Append form fields Object.keys(form).forEach((key) => { formData.append(key, form[key]); }); // Append images images.forEach((image, index) => { formData.append(`images`, image); }); const response = await API.post("/cars", formData, { headers: { "Content-Type": "multipart/form-data", }, }); // Reset form on success setForm({ title: "", description: "", city: "", pricePerDay: "", availabilityFrom: "", availabilityTo: "", }); setImages([]); setFileInputKey(Date.now()); // Reset file input navigate("/browse", { state: { message: "Car listed successfully!" }, }); } catch (err) { console.error("Error listing car:", err); setError( err.response?.data?.message || "Failed to list car. Please check your connection and try again." ); } finally { setLoading(false); } }; return ( <div className="max-w-3xl mx-auto p-6 bg-white rounded-lg shadow-lg"> <h1 className="text-3xl font-bold text-gray-800 mb-6">List Your Car</h1> <form onSubmit={handleSubmit} className="space-y-6"> {/* Title with Suggestions */} <div className="suggestion-container relative"> <label className="block text-sm font-medium text-gray-700 mb-2"> Car Title * </label> <input type="text" name="title" value={form.title} placeholder="Start typing... e.g., Toyota Camry" onChange={handleChange} onFocus={() => { if (form.title.length > 0 && filteredSuggestions.length > 0) { setShowSuggestions(true); } }} required className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors" autoComplete="off" /> {/* Suggestions Dropdown */} {showSuggestions && filteredSuggestions.length > 0 && ( <div className="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto"> {filteredSuggestions.map((suggestion, index) => ( <button key={index} type="button" onClick={() => handleSuggestionClick(suggestion)} className="w-full text-left px-4 py-3 hover:bg-green-50 focus:bg-green-50 focus:outline-none border-b border-gray-100 last:border-b-0 transition-colors" > <span className="text-gray-900 font-medium"> {suggestion.split(" ").slice(0, -1).join(" ")} </span> <span className="text-gray-500 ml-2"> {suggestion.split(" ").slice(-1)[0]} </span> </button> ))} {/* Show popular suggestions hint */} <div className="px-4 py-2 bg-gray-50 text-xs text-gray-600 border-t"> 💡 Popular car models in UAE </div> </div> )} </div> {/* Description */} <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Description * </label> <textarea name="description" value={form.description} placeholder="Describe your car's features, condition, and any special notes..." onChange={handleChange} required rows="4" className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors resize-vertical" /> </div> {/* City and Price */} <div className="grid grid-cols-1 md:grid-cols-2 gap-4"> <div className="city-suggestion-container relative"> <label className="block text-sm font-medium text-gray-700 mb-2"> City * </label> <input type="text" name="city" value={form.city} placeholder="Start typing... e.g., Dubai" onChange={handleChange} onFocus={() => { if (form.city.length > 0 && filteredCities.length > 0) { setShowCitySuggestions(true); } }} required className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors" autoComplete="off" /> {/* City Suggestions Dropdown */} {showCitySuggestions && filteredCities.length > 0 && ( <div className="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto"> {filteredCities.map((city, index) => { const isMainEmirate = [ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", ].includes(city); return ( <button key={index} type="button" onClick={() => handleCityClick(city)} className="w-full text-left px-4 py-3 hover:bg-green-50 focus:bg-green-50 focus:outline-none border-b border-gray-100 last:border-b-0 transition-colors flex items-center justify-between" > <span className={`${ isMainEmirate ? "font-semibold text-gray-900" : "text-gray-700" }`} > {city} </span> {isMainEmirate && ( <span className="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full"> Emirate </span> )} </button> ); })} {/* Show UAE locations hint */} <div className="px-4 py-2 bg-gray-50 text-xs text-gray-600 border-t"> 🇦🇪 UAE Cities & Emirates </div> </div> )} </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Price Per Day (AED) * </label> <input type="number" name="pricePerDay" value={form.pricePerDay} placeholder="150" min="1" step="0.01" onChange={handleChange} required className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors" /> </div> </div> {/* Availability Dates */} <div className="grid grid-cols-1 md:grid-cols-2 gap-4"> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Available From * </label> <input type="date" name="availabilityFrom" value={form.availabilityFrom} onChange={handleChange} required min={new Date().toISOString().split("T")[0]} className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors" /> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Available Until * </label> <input type="date" name="availabilityTo" value={form.availabilityTo} onChange={handleChange} required min={ form.availabilityFrom || new Date().toISOString().split("T")[0] } className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors" /> </div> </div> {/* Image Upload */} <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Car Images * (Max 5MB each, JPEG/PNG only) </label> <input key={fileInputKey} // Add key prop to force re-render and reset type="file" name="images" accept="image/jpeg,image/png,image/jpg" multiple onChange={handleFileChange} className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-green-50 file:text-green-700 hover:file:bg-green-100" /> {/* Image Previews */} {images.length > 0 && ( <div className="mt-4"> <p className="text-sm text-gray-600 mb-3"> {images.length} image(s) selected </p> <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"> {images.map((image, index) => ( <div key={index} className="relative group"> <div className="aspect-square bg-gray-100 rounded-lg overflow-hidden border border-gray-200"> <img src={URL.createObjectURL(image)} alt={`Preview ${index + 1}`} className="w-full h-full object-cover" onLoad={() => URL.revokeObjectURL(image)} /> </div> {/* Remove Button */} <button type="button" onClick={() => removeImage(index)} className="absolute -top-2 -right-2 bg-red-500 hover:bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold shadow-lg transition-colors opacity-0 group-hover:opacity-100" title="Remove image" > × </button> {/* Image Info */} <div className="mt-2"> <p className="text-xs text-gray-500 truncate"> {image.name} </p> <p className="text-xs text-gray-400"> {(image.size / 1024 / 1024).toFixed(1)} MB </p> </div> </div> ))} </div> {/* Upload Tips */} <div className="mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"> <p className="text-sm text-blue-800"> 💡 <strong>Photo Tips:</strong> Include exterior, interior, dashboard, and engine photos for better visibility </p> </div> </div> )} </div> {/* Error Message */} {error && ( <div className="bg-red-50 border border-red-200 rounded-lg p-4"> <p className="text-red-600 text-sm font-medium">{error}</p> </div> )} {/* Submit Button */} <button type="submit" disabled={loading} className="w-full bg-green-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors" > {loading ? ( <span className="flex items-center justify-center"> <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" > <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" ></circle> <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" ></path> </svg> Uploading... </span> ) : ( "List Car" )} </button> </form> </div> ); }; export default ListCar;
```

# borrowmycarfrontend\src\Login.jsx

```jsx
import { useState } from "react"; import { Link, useNavigate } from "react-router-dom"; import API from "./api"; import Logo from "./assets/BorrowMyCar.png"; import { Helmet } from "react-helmet"; const Login = () => { const [form, setForm] = useState({ email: "", password: "" }); const [isLoading, setIsLoading] = useState(false); const [error, setError] = useState(""); const navigate = useNavigate(); const handleChange = (e) => { setForm({ ...form, [e.target.name]: e.target.value }); if (error) setError(""); // Clear error when user starts typing }; const handleSubmit = async (e) => { e.preventDefault(); // Basic validation if (!form.email || !form.password) { setError("Please fill in all fields"); return; } setIsLoading(true); setError(""); try { console.log("Attempting login with:", { email: form.email }); const response = await API.post("/auth/login", { email: form.email.trim(), password: form.password, }); console.log("Login response:", response.data); // FIXED: Handle both response structures let token = null; let userData = null; // Try to get token from multiple possible locations if (response.data.token) { token = response.data.token; userData = response.data.user; } else if (response.data.data && response.data.data.token) { token = response.data.data.token; userData = response.data.data.user; } if (token) { // Store token and user data localStorage.setItem("token", token); if (userData) { localStorage.setItem("user", JSON.stringify(userData)); console.log("User data stored:", userData); } console.log("Login successful, token stored"); // Redirect to homepage or dashboard navigate("/", { replace: true }); } else { console.error("No token in response:", response.data); setError( "Login successful but no authentication token received. Please try again." ); } } catch (err) { console.error("Login error:", err); // Handle different error types if (err.response) { // Server responded with error status const message = err.response.data?.message || err.response.data?.error || `Login failed (${err.response.status})`; setError(message); } else if (err.request) { // Network error setError("Network error. Please check your connection and try again."); } else { // Other error setError("An unexpected error occurred. Please try again."); } } finally { setIsLoading(false); } }; return ( <> <Helmet> <title>Login - BorrowMyCar</title> </Helmet> <div className="min-h-screen bg-gray-50 flex flex-col lg:flex-row"> {/* Left Side - Form */} <div className="flex-1 flex items-center justify-center p-4 sm:p-6 lg:p-8"> <div className="w-full max-w-md space-y-8"> {/* Header */} <div> <div className="mx-auto h-20 sm:h-24 w-48 sm:w-64 flex items-center justify-center"> <img src={Logo} alt="BorrowMyCar Logo" className="h-full w-full object-contain" /> </div> <div className="space-y-2 text-center"> <h1 className="text-2xl sm:text-3xl font-bold text-gray-900"> Welcome Back </h1> <p className="text-sm sm:text-base text-gray-600"> Sign in to your{" "} <span className="font-semibold text-green-500"> BorrowMyCar </span>{" "} account </p> </div> </div> {/* Form */} <form onSubmit={handleSubmit} className="space-y-6"> <div className="space-y-4"> {/* Email Input */} <div> <label htmlFor="email" className="sr-only"> Email address </label> <input id="email" name="email" type="email" value={form.email} onChange={handleChange} placeholder="Email address" required autoComplete="email" className="input w-full text-sm sm:text-base" /> </div> {/* Password Input */} <div> <label htmlFor="password" className="sr-only"> Password </label> <input id="password" name="password" type="password" value={form.password} onChange={handleChange} placeholder="Password" required autoComplete="current-password" className="input w-full text-sm sm:text-base" /> </div> </div> {/* Error Message */} {error && ( <div className="text-red-600 text-sm text-center bg-red-50 border border-red-200 rounded-lg p-3"> {error} </div> )} {/* Remember Me & Forgot Password */} <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 text-sm"> <label className="flex items-center cursor-pointer"> <input type="checkbox" className="w-4 h-4 text-green-500 border-gray-300 rounded focus:ring-green-500 focus:ring-2" /> <span className="ml-2 text-gray-700">Remember me</span> </label> <Link to="/forgot-password" className="accent-color hover:text-green-700 hover:underline transition-colors duration-200" > Forgot your password? </Link> </div> {/* Submit Button */} <button type="submit" disabled={isLoading} className="w-full bg-green-500 hover:bg-green-600 disabled:bg-green-300 disabled:cursor-not-allowed text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 text-sm sm:text-base focus:ring-2 focus:ring-green-500 focus:ring-offset-2" > {isLoading ? ( <div className="flex items-center justify-center"> <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" > <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" ></circle> <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" ></path> </svg> Signing in... </div> ) : ( "Sign In" )} </button> {/* Sign Up Link */} <p className="text-center text-sm text-gray-600"> Don't have an account?{" "} <Link to="/signup" className="font-semibold accent-color hover:text-green-700 hover:underline transition-colors duration-200" > Sign up here </Link> </p> </form> </div> </div> {/* Right Side - Welcome Section */} <div className="hidden lg:flex lg:flex-1 lg:items-center lg:justify-center bg-gradient-to-br from-green-50 to-emerald-100 p-8"> <div className="text-center max-w-md space-y-6"> <div className="relative"> <div className="mx-auto w-64 h-48 bg-gradient-to-r from-green-400 to-emerald-500 rounded-2xl shadow-lg flex items-center justify-center"> <div className="text-white text-6xl">🚗</div> </div> </div> <div className="space-y-3"> <h2 className="text-2xl xl:text-3xl font-bold text-gray-800"> Welcome Back! 👋 </h2> <p className="text-gray-600 text-lg"> Ready to hit the road again? </p> <p className="text-sm text-gray-500"> Access your bookings, browse available cars, and manage your rentals. </p> </div> </div> </div> {/* Mobile Welcome Section */} <div className="lg:hidden bg-gradient-to-r from-green-50 to-emerald-50 p-6 text-center border-t"> <div className="flex items-center justify-center space-x-4"> <div className="w-16 h-16 bg-gradient-to-r from-green-400 to-emerald-500 rounded-lg flex items-center justify-center text-2xl"> 🚗 </div> <div className="text-left"> <p className="font-semibold text-gray-800">Ready to drive?</p> <p className="text-sm text-gray-600"> Your next adventure awaits </p> </div> </div> </div> </div> </> ); }; export default Login;
```

# borrowmycarfrontend\src\MyBookings.jsx

```jsx
// Update src/MyBookings.jsx with complete implementation import { useState, useEffect } from "react"; import { useAuth } from "./context/AuthProvider"; import API from "./api"; import { Helmet } from "react-helmet"; const MyBookings = () => { const { user } = useAuth(); const [bookings, setBookings] = useState([]); const [loading, setLoading] = useState(true); const [error, setError] = useState(""); const [activeTab, setActiveTab] = useState("all"); useEffect(() => { fetchBookings(); }, []); const fetchBookings = async () => { try { setLoading(true); const endpoint = user.role === "owner" ? "/bookings/owner" : "/bookings/me"; const response = await API.get(endpoint); setBookings(response.data.data.bookings || []); } catch (err) { setError("Failed to fetch bookings"); console.error("Booking fetch error:", err); } finally { setLoading(false); } }; const handleStatusUpdate = async (bookingId, newStatus) => { try { await API.put(`/bookings/${bookingId}`, { status: newStatus }); await fetchBookings(); // Refresh bookings } catch (err) { setError("Failed to update booking status"); console.error("Status update error:", err); } }; const getStatusColor = (status) => { const colors = { pending: "bg-yellow-100 text-yellow-800", approved: "bg-blue-100 text-blue-800", confirmed: "bg-green-100 text-green-800", active: "bg-purple-100 text-purple-800", completed: "bg-gray-100 text-gray-800", cancelled: "bg-red-100 text-red-800", rejected: "bg-red-100 text-red-800", }; return colors[status] || "bg-gray-100 text-gray-800"; }; const filterBookings = (status) => { if (status === "all") return bookings; if (status === "active") { return bookings.filter((b) => ["pending", "approved", "confirmed", "active"].includes(b.status) ); } return bookings.filter((b) => b.status === status); }; const filteredBookings = filterBookings(activeTab); if (loading) { return ( <div className="max-w-7xl mx-auto px-4 py-8"> <div className="animate-pulse space-y-4"> <div className="h-8 bg-gray-200 rounded w-1/4"></div> <div className="space-y-3"> {Array.from({ length: 3 }).map((_, i) => ( <div key={i} className="h-32 bg-gray-200 rounded"></div> ))} </div> </div> </div> ); } return ( <> <Helmet> <title>My Bookings - BorrowMyCar</title> </Helmet> <div className="max-w-7xl mx-auto px-4 py-8"> <div className="mb-8"> <h1 className="text-3xl font-bold text-gray-900 mb-2"> {user.role === "owner" ? "Booking Requests" : "My Bookings"} </h1> <p className="text-gray-600"> {user.role === "owner" ? "Manage booking requests for your vehicles" : "Track your car rental history and active bookings"} </p> </div> {/* Tabs */} <div className="border-b border-gray-200 mb-6"> <nav className="-mb-px flex space-x-8"> {[ { id: "all", label: "All Bookings" }, { id: "active", label: "Active" }, { id: "pending", label: "Pending" }, { id: "completed", label: "Completed" }, ].map((tab) => ( <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`py-2 px-1 border-b-2 font-medium text-sm transition-colors ${ activeTab === tab.id ? "border-green-500 text-green-600" : "border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" }`} > {tab.label} <span className="ml-2 bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs"> {filterBookings(tab.id).length} </span> </button> ))} </nav> </div> {error && ( <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6"> <p className="text-red-600">{error}</p> </div> )} {/* Bookings List */} {filteredBookings.length === 0 ? ( <div className="text-center py-12"> <div className="w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center"> <svg className="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" /> </svg> </div> <h3 className="text-lg font-medium text-gray-900 mb-2"> No bookings found </h3> <p className="text-gray-600"> {activeTab === "all" ? "You haven't made any bookings yet." : `No ${activeTab} bookings found.`} </p> </div> ) : ( <div className="space-y-6"> {filteredBookings.map((booking) => ( <div key={booking._id} className="bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow" > <div className="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4"> {/* Car Info */} <div className="flex items-start gap-4"> <img src={booking.car?.images?.[0] || "/placeholder-car.jpg"} alt={booking.car?.title} className="w-20 h-16 object-cover rounded-lg flex-shrink-0" /> <div className="flex-1 min-w-0"> <h3 className="font-semibold text-gray-900 mb-1 truncate"> {booking.car?.title} </h3> <p className="text-sm text-gray-600 mb-2"> {new Date(booking.startDate).toLocaleDateString()} -{" "} {new Date(booking.endDate).toLocaleDateString()} </p> <div className="flex items-center gap-4 text-sm text-gray-500"> <span> {booking.totalDays} day {booking.totalDays !== 1 ? "s" : ""} </span> <span>AED {booking.totalPayable}</span> {user.role === "owner" && booking.renter && ( <span>Renter: {booking.renter.name}</span> )} </div> </div> </div> {/* Status and Actions */} <div className="flex flex-col sm:flex-row items-start sm:items-center gap-3"> <span className={`px-3 py-1 rounded-full text-sm font-medium ${getStatusColor( booking.status )}`} > {booking.status.charAt(0).toUpperCase() + booking.status.slice(1)} </span> {/* Action Buttons */} {user.role === "owner" && booking.status === "pending" && ( <div className="flex gap-2"> <button onClick={() => handleStatusUpdate(booking._id, "approved") } className="px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition-colors" > Approve </button> <button onClick={() => handleStatusUpdate(booking._id, "rejected") } className="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors" > Reject </button> </div> )} {user.role === "renter" && ["pending", "approved"].includes(booking.status) && ( <button onClick={() => handleStatusUpdate(booking._id, "cancelled") } className="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors" > Cancel </button> )} </div> </div> {/* Additional Info */} <div className="mt-4 pt-4 border-t border-gray-100"> <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm"> <div> <span className="text-gray-500">Pickup:</span> <span className="ml-2 text-gray-900"> {booking.pickupLocation} </span> </div> <div> <span className="text-gray-500">Return:</span> <span className="ml-2 text-gray-900"> {booking.returnLocation} </span> </div> <div> <span className="text-gray-500">Payment:</span> <span className="ml-2 text-gray-900"> {booking.paymentMethod} </span> </div> </div> {booking.renterNotes && ( <div className="mt-3"> <span className="text-gray-500 text-sm">Notes:</span> <p className="text-gray-900 text-sm mt-1"> {booking.renterNotes} </p> </div> )} </div> </div> ))} </div> )} </div> </> ); }; export default MyBookings;
```

# borrowmycarfrontend\src\Navbar.jsx

```jsx
import React, { useState, useEffect, useRef } from "react"; import { useNavigate, useLocation, Link } from "react-router-dom"; import { Menu, X, Bell, MessageCircle, Car, Calendar, Settings, LogOut, User, Shield, BarChart3, Plus, Search, MapPin, ChevronDown, Home, HelpCircle, } from "lucide-react"; import API from "./api"; const Navbar = () => { const [isMenuOpen, setIsMenuOpen] = useState(false); const [isProfileOpen, setIsProfileOpen] = useState(false); const [isSearchOpen, setIsSearchOpen] = useState(false); const [scrolled, setScrolled] = useState(false); const [user, setUser] = useState(null); const [loading, setLoading] = useState(true); const [notifications, setNotifications] = useState([]); const [searchQuery, setSearchQuery] = useState(""); const [searchResults, setSearchResults] = useState([]); const [searchLoading, setSearchLoading] = useState(false); const navigate = useNavigate(); const location = useLocation(); const profileRef = useRef(null); const searchRef = useRef(null); // Get current user on component mount useEffect(() => { const getCurrentUser = async () => { const token = localStorage.getItem("token"); if (token) { try { const response = await API.get("/auth/profile"); setUser(response.data.data.user); fetchNotifications(); } catch (error) { console.error("Failed to get user profile:", error); // Token might be invalid, remove it localStorage.removeItem("token"); } } setLoading(false); }; getCurrentUser(); }, []); // Fetch notifications for authenticated users const fetchNotifications = async () => { try { // Replace with actual notifications endpoint when available // const response = await API.get('/notifications'); // setNotifications(response.data.data.notifications); // Mock notifications for now setNotifications([ { id: 1, type: "booking", message: "New booking request received", unread: true, }, { id: 2, type: "message", message: "You have a new message", unread: true, }, { id: 3, type: "system", message: "Your car listing was approved", unread: false, }, ]); } catch (error) { console.error("Failed to fetch notifications:", error); } }; // Handle scroll effect useEffect(() => { const handleScroll = () => { setScrolled(window.scrollY > 10); }; window.addEventListener("scroll", handleScroll); return () => window.removeEventListener("scroll", handleScroll); }, []); // Close dropdowns when clicking outside useEffect(() => { const handleClickOutside = (event) => { if (profileRef.current && !profileRef.current.contains(event.target)) { setIsProfileOpen(false); } if (searchRef.current && !searchRef.current.contains(event.target)) { setIsSearchOpen(false); setSearchQuery(""); setSearchResults([]); } }; document.addEventListener("mousedown", handleClickOutside); return () => document.removeEventListener("mousedown", handleClickOutside); }, []); // Close mobile menu when route changes useEffect(() => { setIsMenuOpen(false); }, [location.pathname]); // Search functionality useEffect(() => { const searchCars = async () => { if (searchQuery.trim().length < 2) { setSearchResults([]); return; } setSearchLoading(true); try { const response = await API.get( `/cars?search=${encodeURIComponent(searchQuery)}&limit=5` ); setSearchResults(response.data.data.cars || []); } catch (error) { console.error("Search failed:", error); setSearchResults([]); } finally { setSearchLoading(false); } }; const debounceTimer = setTimeout(searchCars, 300); return () => clearTimeout(debounceTimer); }, [searchQuery]); // Navigation items based on user role const getNavItems = () => { if (!user) { return [ { label: "Browse Cars", path: "/", icon: Car }, { label: "How It Works", path: "/how-it-works", icon: HelpCircle }, ]; } const baseItems = [ { label: "Home", path: "/", icon: Home }, { label: "Browse Cars", path: "/browse", icon: Car }, ]; if (user.role === "admin") { return [ ...baseItems, { label: "Dashboard", path: "/admin", icon: BarChart3 }, { label: "Users", path: "/admin/users", icon: User }, { label: "Car Approvals", path: "/admin/cars", icon: Shield }, ]; } if (user.role === "owner") { return [ ...baseItems, { label: "My Cars", path: "/my-cars", icon: Car }, { label: "My Bookings", path: "/my-bookings", icon: Calendar }, { label: "Messages", path: "/messages", icon: MessageCircle, badge: getUnreadMessagesCount(), }, ]; } // Default renter return [ ...baseItems, { label: "My Bookings", path: "/my-bookings", icon: Calendar }, { label: "Messages", path: "/messages", icon: MessageCircle, badge: getUnreadMessagesCount(), }, ]; }; const getUnreadMessagesCount = () => { return notifications.filter((n) => n.type === "message" && n.unread).length; }; const getUnreadNotificationsCount = () => { return notifications.filter((n) => n.unread).length; }; const navItems = getNavItems(); const profileMenuItems = [ { label: "View Profile", path: "/profile", icon: User }, { label: "Account Settings", path: "/settings", icon: Settings }, ...(user?.role === "owner" ? [{ label: "Earnings", path: "/earnings", icon: BarChart3 }] : []), { label: "Support", path: "/support", icon: MessageCircle }, ]; const handleLogout = async () => { try { // Call logout endpoint if available // await API.post('/auth/logout'); localStorage.removeItem("token"); setUser(null); setNotifications([]); setIsProfileOpen(false); navigate("/"); } catch (error) { console.error("Logout failed:", error); // Force logout even if API call fails localStorage.removeItem("token"); setUser(null); navigate("/"); } }; const handleSearchResultClick = (car) => { navigate(`/cars/${car._id}`); setIsSearchOpen(false); setSearchQuery(""); setSearchResults([]); }; const handleSearchSubmit = (e) => { e.preventDefault(); if (searchQuery.trim()) { navigate(`/browse?search=${encodeURIComponent(searchQuery.trim())}`); setIsSearchOpen(false); setSearchQuery(""); setSearchResults([]); } }; const isActivePath = (path) => { if (path === "/" && location.pathname === "/") return true; if (path !== "/" && location.pathname.startsWith(path)) return true; return false; }; const toggleMenu = () => setIsMenuOpen(!isMenuOpen); const toggleProfile = () => setIsProfileOpen(!isProfileOpen); if (loading) { return ( <nav className="sticky top-0 z-50 bg-white border-b border-gray-100"> <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"> <div className="flex justify-between items-center h-16"> <div className="flex-shrink-0"> <div className="flex items-center"> <div className="w-10 h-10 bg-gray-200 rounded-xl mr-3 animate-pulse"></div> <div className="hidden sm:block"> <div className="w-32 h-5 bg-gray-200 rounded animate-pulse"></div> </div> </div> </div> <div className="hidden lg:flex space-x-4"> <div className="w-20 h-8 bg-gray-200 rounded animate-pulse"></div> <div className="w-20 h-8 bg-gray-200 rounded animate-pulse"></div> </div> <div className="flex items-center space-x-3"> <div className="w-8 h-8 bg-gray-200 rounded-full animate-pulse"></div> </div> </div> </div> </nav> ); } return ( <nav className={`sticky top-0 z-50 bg-white border-b transition-all duration-300 ${ scrolled ? "shadow-lg border-gray-200" : "border-gray-100" }`} > <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"> <div className="flex justify-between items-center h-16"> {/* Logo */} <div className="flex-shrink-0"> <Link to="/" className="flex items-center group"> <div className="flex items-center justify-center w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl mr-3 group-hover:shadow-lg transition-all duration-200"> <Car className="h-6 w-6 text-white" /> </div> <div className="hidden sm:block"> <span className="font-bold text-xl text-gray-900"> BorrowMyCar </span> <div className="text-xs text-gray-500 -mt-1"> UAE Car Rental </div> </div> </Link> </div> {/* Search Bar (Desktop) */} <div className="hidden lg:flex flex-1 max-w-lg mx-8" ref={searchRef}> <form onSubmit={handleSearchSubmit} className="relative w-full"> <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"> <Search className="h-5 w-5 text-gray-400" /> </div> <input type="text" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} placeholder="Search cars by make, model, or location..." className="block w-full pl-10 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition-colors" onFocus={() => setIsSearchOpen(true)} /> <div className="absolute inset-y-0 right-0 pr-3 flex items-center"> <MapPin className="h-4 w-4 text-gray-400" /> </div> {/* Search Dropdown */} {isSearchOpen && ( <div className="absolute top-full left-0 right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-96 overflow-y-auto"> {searchLoading ? ( <div className="p-4 text-center"> <div className="animate-spin w-6 h-6 border-2 border-green-500 border-t-transparent rounded-full mx-auto"></div> <div className="text-sm text-gray-500 mt-2"> Searching... </div> </div> ) : searchResults.length > 0 ? ( <div className="py-2"> <div className="text-xs text-gray-500 px-4 py-2 font-medium"> Search Results </div> {searchResults.map((car) => ( <button key={car._id} onClick={() => handleSearchResultClick(car)} className="w-full flex items-center px-4 py-3 hover:bg-gray-50 transition-colors text-left" > <img src={car.images?.[0] || "/placeholder-car.jpg"} alt={car.title} className="w-12 h-8 object-cover rounded mr-3" /> <div className="flex-1 min-w-0"> <div className="text-sm font-medium text-gray-900 truncate"> {car.title} </div> <div className="text-xs text-gray-500"> {car.city} • AED {car.price}/day </div> </div> </button> ))} {searchQuery.trim() && ( <button onClick={handleSearchSubmit} className="w-full flex items-center px-4 py-3 border-t border-gray-100 hover:bg-gray-50 transition-colors text-left" > <Search className="h-4 w-4 text-gray-400 mr-3" /> <span className="text-sm text-gray-700"> See all results for "{searchQuery}" </span> </button> )} </div> ) : searchQuery.trim().length > 1 ? ( <div className="p-4 text-center text-sm text-gray-500"> No cars found for "{searchQuery}" </div> ) : ( <div className="p-4"> <div className="text-sm text-gray-600 mb-3"> Popular Searches </div> <div className="space-y-2"> {[ "BMW 3 Series Dubai", "Toyota Camry Abu Dhabi", "Mercedes C-Class Sharjah", ].map((search, index) => ( <button key={index} onClick={() => { setSearchQuery(search); handleSearchSubmit({ preventDefault: () => {} }); }} className="flex items-center w-full text-left px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors" > <Search className="h-4 w-4 text-gray-400 mr-3" /> <span className="text-sm text-gray-700"> {search} </span> </button> ))} </div> </div> )} </div> )} </form> </div> {/* Desktop Navigation */} <div className="hidden lg:flex items-center space-x-6"> {navItems.map((item) => ( <Link key={item.label} to={item.path} className={`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all relative group ${ isActivePath(item.path) ? "text-green-600 bg-green-50" : "text-gray-700 hover:text-green-600 hover:bg-green-50" }`} > {item.icon && <item.icon className="h-4 w-4 mr-2" />} {item.label} {item.badge > 0 && ( <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse"> {item.badge} </span> )} </Link> ))} </div> {/* Auth Buttons / Profile */} <div className="flex items-center space-x-4"> {!user ? ( <> <Link to="/login" className="text-gray-700 hover:text-green-600 px-3 py-2 rounded-lg text-sm font-medium transition-colors" > Sign In </Link> <Link to="/signup" className="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 shadow-md hover:shadow-lg" > Get Started </Link> </> ) : ( <div className="flex items-center space-x-3"> {/* Quick Action Button (for owners) */} {user.role === "owner" && user.isApproved && ( <Link to="/list-car" className="hidden md:flex items-center bg-green-50 hover:bg-green-100 text-green-700 px-3 py-2 rounded-lg text-sm font-medium transition-colors border border-green-200" > <Plus className="h-4 w-4 mr-1" /> List Car </Link> )} {/* Notifications */} <button onClick={() => navigate("/notifications")} className="relative p-2 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors" > <Bell className="h-5 w-5" /> {getUnreadNotificationsCount() > 0 && ( <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse"> {getUnreadNotificationsCount()} </span> )} </button> {/* Profile Dropdown */} <div className="relative" ref={profileRef}> <button onClick={toggleProfile} className="flex items-center space-x-3 text-gray-700 hover:text-green-600 p-1 rounded-lg focus:outline-none transition-colors" > <div className="flex items-center space-x-2"> <img className="h-8 w-8 rounded-full object-cover ring-2 ring-white shadow-sm" src={ user.profileImage || "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" } alt="Profile" onError={(e) => { e.target.src = "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"; }} /> <div className="hidden md:block text-left"> <div className="text-sm font-medium">{user.name}</div> <div className="text-xs text-gray-500 capitalize"> {user.role} </div> </div> <ChevronDown className={`h-4 w-4 transition-transform duration-200 ${ isProfileOpen ? "rotate-180" : "" }`} /> </div> </button> {/* Profile Dropdown Menu */} {isProfileOpen && ( <div className="absolute right-0 mt-3 w-64 bg-white rounded-xl shadow-lg border border-gray-200 py-2 z-50"> {/* User Info */} <div className="px-4 py-3 border-b border-gray-100"> <div className="flex items-center space-x-3"> <img className="h-10 w-10 rounded-full object-cover" src={ user.profileImage || "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" } alt="Profile" onError={(e) => { e.target.src = "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"; }} /> <div> <div className="font-medium text-gray-900"> {user.name} </div> <div className="text-sm text-gray-500"> {user.email} </div> <div className="flex items-center space-x-2 mt-1"> <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${ user.isApproved ? "bg-green-100 text-green-800" : "bg-yellow-100 text-yellow-800" }`} > {user.isApproved ? "Verified" : "Pending"} </span> <span className="text-xs text-gray-500 capitalize"> {user.role} </span> </div> </div> </div> </div> {/* Menu Items */} <div className="py-2"> {profileMenuItems.map((item) => ( <Link key={item.label} to={item.path} className="w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:text-gray-900 hover:bg-gray-50 transition-colors" onClick={() => setIsProfileOpen(false)} > <item.icon className="h-4 w-4 mr-3" /> {item.label} </Link> ))} {/* Logout Button */} <button onClick={handleLogout} className="w-full flex items-center px-4 py-2 text-sm text-red-600 hover:text-red-700 hover:bg-red-50 transition-colors" > <LogOut className="h-4 w-4 mr-3" /> Logout </button> </div> </div> )} </div> </div> )} {/* Mobile Menu Button */} <button onClick={toggleMenu} className="lg:hidden p-2 rounded-lg text-gray-600 hover:text-green-600 hover:bg-green-50 focus:outline-none transition-colors" > {isMenuOpen ? ( <X className="h-6 w-6" /> ) : ( <Menu className="h-6 w-6" /> )} </button> </div> </div> </div> {/* Mobile Menu */} {isMenuOpen && ( <div className="lg:hidden bg-white border-t border-gray-200"> {/* Mobile Search */} <div className="px-4 py-3 border-b border-gray-100"> <form onSubmit={handleSearchSubmit} className="relative"> <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"> <Search className="h-5 w-5 text-gray-400" /> </div> <input type="text" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} placeholder="Search cars..." className="block w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none" /> </form> </div> {/* Mobile Navigation Items */} <div className="px-4 py-3 space-y-1"> {navItems.map((item) => ( <Link key={item.label} to={item.path} className={`flex items-center w-full px-3 py-3 rounded-lg text-base font-medium transition-colors relative ${ isActivePath(item.path) ? "text-green-600 bg-green-50" : "text-gray-700 hover:text-green-600 hover:bg-green-50" }`} > {item.icon && <item.icon className="h-5 w-5 mr-3" />} {item.label} {item.badge > 0 && ( <span className="ml-auto bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center"> {item.badge} </span> )} </Link> ))} {!user && ( <> <Link to="/login" className="flex items-center w-full text-gray-700 hover:text-green-600 hover:bg-green-50 px-3 py-3 rounded-lg text-base font-medium transition-colors" > Sign In </Link> <Link to="/signup" className="flex items-center w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white px-3 py-3 rounded-lg text-base font-medium transition-colors" > Get Started </Link> </> )} {user?.role === "owner" && user?.isApproved && ( <Link to="/list-car" className="flex items-center w-full bg-green-50 text-green-700 hover:bg-green-100 px-3 py-3 rounded-lg text-base font-medium transition-colors border border-green-200" > <Plus className="h-5 w-5 mr-3" /> List New Car </Link> )} </div> </div> )} {/* Overlay for dropdowns */} {(isProfileOpen || isSearchOpen) && ( <div className="fixed inset-0 z-40" onClick={() => { setIsProfileOpen(false); setIsSearchOpen(false); }} /> )} </nav> ); }; export default Navbar;
```

# borrowmycarfrontend\src\NotFound.jsx

```jsx
import { useEffect, useState } from 'react'; import { Link, useNavigate } from 'react-router-dom'; const NotFound = () => { const navigate = useNavigate(); const [secondsLeft, setSecondsLeft] = useState(3); // Initial countdown value useEffect(() => { // Set up the interval to decrement the countdown every second const interval = setInterval(() => { setSecondsLeft((prev) => prev - 1); }, 1000); // Set up the timeout to navigate after the countdown completes const timeout = setTimeout(() => { navigate('/'); }, secondsLeft * 1000); // Cleanup function to clear the interval and timeout when the component unmounts return () => { clearInterval(interval); clearTimeout(timeout); }; }, [navigate, secondsLeft]); return ( <div className="m-auto flex justify-center items-center h-screen"> <div className="flex flex-col items-center justify-center h-full"> <h1 className="text-4xl font-bold mb-4"> <span className="text-green-600">404 </span>Page Not Found </h1> <p className="text-lg mb-4">The page you are looking for does not exist.</p> <p className="text-sm text-gray-500 mb-8"> Redirecting to home in {secondsLeft} second{secondsLeft !== 1 ? 's' : ''}... </p> <Link to="/" className="bg-green-600 text-white p-4 hover:bg-green-700"> Go back to Home </Link> </div> </div> ); }; export default NotFound;
```

# borrowmycarfrontend\src\SeedData.jsx

```jsx
import mongoose from "mongoose"; import bcrypt from "bcryptjs"; import { User } from "../models/User.js"; import Car from "../models/Car.js"; import dotenv from "dotenv"; dotenv.config(); const seedDatabase = async () => { try { await mongoose.connect(process.env.MONGO_URI); // Clear existing data await User.deleteMany({}); await Car.deleteMany({}); // Create test users const testOwner = await User.create({ name: "Ahmed Al-Mansouri", email: "ahmed@test.com", phone: "+971501234567", password: "password123", role: "owner", isApproved: true, preferredCity: "Dubai", drivingLicenseUrl: "https://via.placeholder.com/400x300", }); const testRenter = await User.create({ name: "Sarah Johnson", email: "sarah@test.com", phone: "+971509876543", password: "password123", role: "renter", isApproved: true, preferredCity: "Dubai", drivingLicenseUrl: "https://via.placeholder.com/400x300", }); // Create test cars await Car.create({ owner: testOwner._id, title: "Toyota Camry 2023 - Luxury Sedan", description: "Premium Toyota Camry with leather seats, GPS navigation, and excellent fuel economy.", city: "Dubai", price: 180, availabilityFrom: new Date(), availabilityTo: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000), make: "Toyota", model: "Camry", year: 2023, color: "Pearl White", plateNumber: "A12345", transmission: "Automatic", fuelType: "Petrol", mileage: 15000, seatingCapacity: 5, specifications: "GCC Specs", features: [ "GPS Navigation", "Bluetooth", "Leather Seats", "Backup Camera", ], images: [ "https://via.placeholder.com/800x600/2563eb/ffffff?text=Toyota+Camry+1", "https://via.placeholder.com/800x600/1d4ed8/ffffff?text=Toyota+Camry+2", "https://via.placeholder.com/800x600/1e40af/ffffff?text=Toyota+Camry+3", ], status: "active", }); console.log("✅ Database seeded successfully"); process.exit(0); } catch (error) { console.error("❌ Error seeding database:", error); process.exit(1); } }; seedDatabase();
```

# borrowmycarfrontend\src\Settings.jsx

```jsx
import { useState, useEffect } from "react"; import { useNavigate } from "react-router-dom"; import { Helmet } from "react-helmet"; import { Shield, Bell, Eye, EyeOff, Lock, Mail, Phone, Trash2, Save, AlertCircle, CheckCircle, Key, Database, Download, UserX, } from "lucide-react"; import API from "./api"; const Settings = () => { const [user, setUser] = useState(null); const [loading, setLoading] = useState(true); const [activeTab, setActiveTab] = useState("security"); const [updateLoading, setUpdateLoading] = useState(false); const [message, setMessage] = useState({ type: "", text: "" }); // Security settings const [passwordForm, setPasswordForm] = useState({ currentPassword: "", newPassword: "", confirmPassword: "", }); const [showPasswords, setShowPasswords] = useState({ current: false, new: false, confirm: false, }); // Notification settings const [notifications, setNotifications] = useState({ emailBookings: true, emailPromotions: false, smsBookings: true, smsReminders: true, pushNotifications: true, }); // Privacy settings const [privacy, setPrivacy] = useState({ profileVisibility: "public", showPhone: false, showEmail: false, allowMessages: true, }); const navigate = useNavigate(); useEffect(() => { fetchUserData(); }, []); const fetchUserData = async () => { try { const response = await API.get("/auth/profile"); setUser(response.data.data.user); // Load user preferences (mock data for now) // In real app, these would come from the API } catch (err) { if (err.response?.status === 401) { navigate("/login"); } else { setMessage({ type: "error", text: "Failed to load user data", }); } } finally { setLoading(false); } }; const showMessage = (type, text) => { setMessage({ type, text }); setTimeout(() => setMessage({ type: "", text: "" }), 5000); }; const handlePasswordUpdate = async (e) => { e.preventDefault(); if (passwordForm.newPassword !== passwordForm.confirmPassword) { showMessage("error", "New passwords do not match"); return; } if (passwordForm.newPassword.length < 6) { showMessage("error", "Password must be at least 6 characters long"); return; } setUpdateLoading(true); try { await API.patch("/auth/change-password", { currentPassword: passwordForm.currentPassword, newPassword: passwordForm.newPassword, }); setPasswordForm({ currentPassword: "", newPassword: "", confirmPassword: "", }); showMessage("success", "Password updated successfully"); } catch (err) { showMessage( "error", err.response?.data?.message || "Failed to update password" ); } finally { setUpdateLoading(false); } }; const handleNotificationUpdate = async () => { setUpdateLoading(true); try { await API.patch("/auth/preferences", { notifications }); showMessage("success", "Notification preferences updated"); } catch (err) { showMessage("error", "Failed to update notification preferences"); } finally { setUpdateLoading(false); } }; const handlePrivacyUpdate = async () => { setUpdateLoading(true); try { await API.patch("/auth/preferences", { privacy }); showMessage("success", "Privacy settings updated"); } catch (err) { showMessage("error", "Failed to update privacy settings"); } finally { setUpdateLoading(false); } }; const handleDataExport = async () => { setUpdateLoading(true); try { const response = await API.get("/auth/export-data", { responseType: "blob", }); const url = window.URL.createObjectURL(new Blob([response.data])); const link = document.createElement("a"); link.href = url; link.setAttribute("download", "borrowmycar-data.json"); document.body.appendChild(link); link.click(); link.remove(); showMessage( "success", "Data export started. Download will begin shortly." ); } catch (err) { showMessage("error", "Failed to export data"); } finally { setUpdateLoading(false); } }; const handleAccountDeletion = async () => { const confirmDelete = window.confirm( "Are you sure you want to delete your account? This action cannot be undone." ); if (!confirmDelete) return; const finalConfirm = window.confirm( "This will permanently delete all your data, bookings, and car listings. Type 'DELETE' to confirm." ); if (!finalConfirm) return; setUpdateLoading(true); try { await API.delete("/auth/account"); localStorage.removeItem("token"); localStorage.removeItem("user"); navigate("/", { replace: true }); } catch (err) { showMessage("error", "Failed to delete account"); } finally { setUpdateLoading(false); } }; const tabs = [ { id: "security", label: "Security", icon: Shield }, { id: "notifications", label: "Notifications", icon: Bell }, { id: "privacy", label: "Privacy", icon: Eye }, { id: "data", label: "Data & Account", icon: Database }, ]; if (loading) { return ( <div className="max-w-4xl mx-auto p-6"> <div className="animate-pulse"> <div className="h-8 bg-gray-200 rounded w-1/4 mb-6"></div> <div className="bg-white rounded-xl shadow-sm p-6"> <div className="space-y-4"> <div className="h-4 bg-gray-200 rounded w-3/4"></div> <div className="h-4 bg-gray-200 rounded w-1/2"></div> <div className="h-4 bg-gray-200 rounded w-2/3"></div> </div> </div> </div> </div> ); } return ( <> <Helmet> <title>Account Settings - BorrowMyCar</title> </Helmet> <div className="max-w-4xl mx-auto p-6"> {/* Header */} <div className="mb-6"> <h1 className="text-3xl font-bold text-gray-900">Account Settings</h1> <p className="text-gray-600 mt-2"> Manage your account preferences and security settings </p> </div> {/* Message Display */} {message.text && ( <div className={`mb-6 p-4 rounded-lg flex items-center ${ message.type === "error" ? "bg-red-50 border border-red-200 text-red-700" : "bg-green-50 border border-green-200 text-green-700" }`} > {message.type === "error" ? ( <AlertCircle className="w-5 h-5 mr-2" /> ) : ( <CheckCircle className="w-5 h-5 mr-2" /> )} {message.text} </div> )} <div className="bg-white rounded-xl shadow-sm"> {/* Tab Navigation */} <div className="border-b border-gray-200"> <nav className="flex space-x-8 px-6"> {tabs.map((tab) => ( <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex items-center py-4 px-1 border-b-2 font-medium text-sm transition-colors ${ activeTab === tab.id ? "border-green-500 text-green-600" : "border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" }`} > <tab.icon className="w-4 h-4 mr-2" /> {tab.label} </button> ))} </nav> </div> {/* Tab Content */} <div className="p-6"> {/* Security Tab */} {activeTab === "security" && ( <div className="space-y-6"> <div> <h2 className="text-xl font-semibold text-gray-900 mb-4"> Password & Security </h2> <form onSubmit={handlePasswordUpdate} className="space-y-4"> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Current Password </label> <div className="relative"> <input type={showPasswords.current ? "text" : "password"} value={passwordForm.currentPassword} onChange={(e) => setPasswordForm({ ...passwordForm, currentPassword: e.target.value, }) } className="w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required /> <button type="button" onClick={() => setShowPasswords({ ...showPasswords, current: !showPasswords.current, }) } className="absolute inset-y-0 right-0 pr-3 flex items-center" > {showPasswords.current ? ( <EyeOff className="w-5 h-5 text-gray-400" /> ) : ( <Eye className="w-5 h-5 text-gray-400" /> )} </button> </div> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> New Password </label> <div className="relative"> <input type={showPasswords.new ? "text" : "password"} value={passwordForm.newPassword} onChange={(e) => setPasswordForm({ ...passwordForm, newPassword: e.target.value, }) } className="w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required minLength={6} /> <button type="button" onClick={() => setShowPasswords({ ...showPasswords, new: !showPasswords.new, }) } className="absolute inset-y-0 right-0 pr-3 flex items-center" > {showPasswords.new ? ( <EyeOff className="w-5 h-5 text-gray-400" /> ) : ( <Eye className="w-5 h-5 text-gray-400" /> )} </button> </div> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Confirm New Password </label> <div className="relative"> <input type={showPasswords.confirm ? "text" : "password"} value={passwordForm.confirmPassword} onChange={(e) => setPasswordForm({ ...passwordForm, confirmPassword: e.target.value, }) } className="w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required /> <button type="button" onClick={() => setShowPasswords({ ...showPasswords, confirm: !showPasswords.confirm, }) } className="absolute inset-y-0 right-0 pr-3 flex items-center" > {showPasswords.confirm ? ( <EyeOff className="w-5 h-5 text-gray-400" /> ) : ( <Eye className="w-5 h-5 text-gray-400" /> )} </button> </div> </div> <button type="submit" disabled={updateLoading} className="flex items-center bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white px-6 py-2 rounded-lg transition-colors" > {updateLoading ? ( <> <div className="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div> Updating... </> ) : ( <> <Lock className="w-4 h-4 mr-2" /> Update Password </> )} </button> </form> </div> {/* Two-Factor Authentication */} <div className="border-t pt-6"> <h3 className="text-lg font-medium text-gray-900 mb-4"> Two-Factor Authentication </h3> <div className="bg-gray-50 p-4 rounded-lg"> <div className="flex items-center justify-between"> <div> <p className="font-medium text-gray-900"> SMS Authentication </p> <p className="text-sm text-gray-600"> Add an extra layer of security to your account </p> </div> <button className="bg-gray-200 text-gray-600 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors"> Enable </button> </div> </div> </div> </div> )} {/* Notifications Tab */} {activeTab === "notifications" && ( <div className="space-y-6"> <div> <h2 className="text-xl font-semibold text-gray-900 mb-4"> Notification Preferences </h2> <div className="space-y-4"> {/* Email Notifications */} <div> <h3 className="text-lg font-medium text-gray-900 mb-3"> Email Notifications </h3> <div className="space-y-3"> <div className="flex items-center justify-between"> <div> <p className="font-medium text-gray-900"> Booking Updates </p> <p className="text-sm text-gray-600"> Get notified about booking confirmations, cancellations, and changes </p> </div> <label className="relative inline-flex items-center cursor-pointer"> <input type="checkbox" checked={notifications.emailBookings} onChange={(e) => setNotifications({ ...notifications, emailBookings: e.target.checked, }) } className="sr-only peer" /> <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div> </label> </div> <div className="flex items-center justify-between"> <div> <p className="font-medium text-gray-900"> Promotions & Offers </p> <p className="text-sm text-gray-600"> Receive emails about special deals and promotions </p> </div> <label className="relative inline-flex items-center cursor-pointer"> <input type="checkbox" checked={notifications.emailPromotions} onChange={(e) => setNotifications({ ...notifications, emailPromotions: e.target.checked, }) } className="sr-only peer" /> <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div> </label> </div> </div> </div> {/* SMS Notifications */} <div className="border-t pt-4"> <h3 className="text-lg font-medium text-gray-900 mb-3"> SMS Notifications </h3> <div className="space-y-3"> <div className="flex items-center justify-between"> <div> <p className="font-medium text-gray-900"> Booking Alerts </p> <p className="text-sm text-gray-600"> Important booking updates via SMS </p> </div> <label className="relative inline-flex items-center cursor-pointer"> <input type="checkbox" checked={notifications.smsBookings} onChange={(e) => setNotifications({ ...notifications, smsBookings: e.target.checked, }) } className="sr-only peer" /> <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div> </label> </div> <div className="flex items-center justify-between"> <div> <p className="font-medium text-gray-900"> Pickup Reminders </p> <p className="text-sm text-gray-600"> Reminders about upcoming car pickups </p> </div> <label className="relative inline-flex items-center cursor-pointer"> <input type="checkbox" checked={notifications.smsReminders} onChange={(e) => setNotifications({ ...notifications, smsReminders: e.target.checked, }) } className="sr-only peer" /> <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div> </label> </div> </div> </div> <div className="pt-4"> <button onClick={handleNotificationUpdate} disabled={updateLoading} className="flex items-center bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white px-6 py-2 rounded-lg transition-colors" > {updateLoading ? ( <> <div className="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div> Saving... </> ) : ( <> <Save className="w-4 h-4 mr-2" /> Save Preferences </> )} </button> </div> </div> </div> </div> )} {/* Privacy Tab */} {activeTab === "privacy" && ( <div className="space-y-6"> <div> <h2 className="text-xl font-semibold text-gray-900 mb-4"> Privacy Settings </h2> <div className="space-y-4"> <div> <h3 className="text-lg font-medium text-gray-900 mb-3"> Profile Visibility </h3> <div className="space-y-3"> <div className="flex items-center"> <input type="radio" id="public" name="profileVisibility" value="public" checked={privacy.profileVisibility === "public"} onChange={(e) => setPrivacy({ ...privacy, profileVisibility: e.target.value, }) } className="w-4 h-4 text-green-600 border-gray-300 focus:ring-green-500" /> <label htmlFor="public" className="ml-3"> <span className="font-medium text-gray-900"> Public </span> <p className="text-sm text-gray-600"> Your profile is visible to all users </p> </label> </div> <div className="flex items-center"> <input type="radio" id="private" name="profileVisibility" value="private" checked={privacy.profileVisibility === "private"} onChange={(e) => setPrivacy({ ...privacy, profileVisibility: e.target.value, }) } className="w-4 h-4 text-green-600 border-gray-300 focus:ring-green-500" /> <label htmlFor="private" className="ml-3"> <span className="font-medium text-gray-900"> Private </span> <p className="text-sm text-gray-600"> Only you can see your full profile details </p> </label> </div> </div> </div> <div className="border-t pt-4"> <h3 className="text-lg font-medium text-gray-900 mb-3"> Contact Information </h3> <div className="space-y-3"> <div className="flex items-center justify-between"> <div> <p className="font-medium text-gray-900"> Show Phone Number </p> <p className="text-sm text-gray-600"> Allow other users to see your phone number </p> </div> <label className="relative inline-flex items-center cursor-pointer"> <input type="checkbox" checked={privacy.showPhone} onChange={(e) => setPrivacy({ ...privacy, showPhone: e.target.checked, }) } className="sr-only peer" /> <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div> </label> </div> <div className="flex items-center justify-between"> <div> <p className="font-medium text-gray-900"> Show Email Address </p> <p className="text-sm text-gray-600"> Allow other users to see your email address </p> </div> <label className="relative inline-flex items-center cursor-pointer"> <input type="checkbox" checked={privacy.showEmail} onChange={(e) => setPrivacy({ ...privacy, showEmail: e.target.checked, }) } className="sr-only peer" /> <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div> </label> </div> <div className="flex items-center justify-between"> <div> <p className="font-medium text-gray-900"> Allow Messages </p> <p className="text-sm text-gray-600"> Let other users send you messages through the platform </p> </div> <label className="relative inline-flex items-center cursor-pointer"> <input type="checkbox" checked={privacy.allowMessages} onChange={(e) => setPrivacy({ ...privacy, allowMessages: e.target.checked, }) } className="sr-only peer" /> <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div> </label> </div> </div> </div> <div className="pt-4"> <button onClick={handlePrivacyUpdate} disabled={updateLoading} className="flex items-center bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white px-6 py-2 rounded-lg transition-colors" > {updateLoading ? ( <> <div className="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div> Saving... </> ) : ( <> <Save className="w-4 h-4 mr-2" /> Save Settings </> )} </button> </div> </div> </div> </div> )} {/* Data & Account Tab */} {activeTab === "data" && ( <div className="space-y-6"> <div> <h2 className="text-xl font-semibold text-gray-900 mb-4"> Data & Account Management </h2> <div className="space-y-6"> {/* Data Export */} <div className="bg-blue-50 p-4 rounded-lg"> <div className="flex items-start"> <Download className="w-6 h-6 text-blue-600 mt-1 mr-3" /> <div className="flex-1"> <h3 className="font-medium text-blue-900 mb-2"> Export Your Data </h3> <p className="text-blue-800 mb-4"> Download a copy of all your personal data, including profile information, bookings, and car listings. </p> <button onClick={handleDataExport} disabled={updateLoading} className="bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-4 py-2 rounded-lg transition-colors" > {updateLoading ? "Preparing..." : "Download Data"} </button> </div> </div> </div> {/* Account Deletion */} <div className="bg-red-50 p-4 rounded-lg"> <div className="flex items-start"> <UserX className="w-6 h-6 text-red-600 mt-1 mr-3" /> <div className="flex-1"> <h3 className="font-medium text-red-900 mb-2"> Delete Account </h3> <p className="text-red-800 mb-4"> Permanently delete your account and all associated data. This action cannot be undone. </p> <div className="space-y-2 text-sm text-red-700 mb-4"> <p>• All your bookings will be cancelled</p> <p>• Your car listings will be removed</p> <p> • Your profile and data will be permanently deleted </p> <p> • You will lose access to all account features </p> </div> <button onClick={handleAccountDeletion} disabled={updateLoading} className="bg-red-600 hover:bg-red-700 disabled:bg-red-400 text-white px-4 py-2 rounded-lg transition-colors flex items-center" > <Trash2 className="w-4 h-4 mr-2" /> {updateLoading ? "Deleting..." : "Delete Account"} </button> </div> </div> </div> </div> </div> </div> )} </div> </div> </div> </> ); }; export default Settings;
```

# borrowmycarfrontend\src\Signup.jsx

```jsx
import { useState, useEffect } from "react"; import { Link, useNavigate } from "react-router-dom"; import API from "./api"; const Signup = () => { const [form, setForm] = useState({ name: "", email: "", phone: "", password: "", confirmPassword: "", role: "renter", preferredCity: "Dubai", }); const [files, setFiles] = useState({ drivingLicense: null, emiratesId: null, visa: null, passport: null, profileImage: null, }); const [step, setStep] = useState(1); const [isLoading, setIsLoading] = useState(false); const [errors, setErrors] = useState({}); const [passwordStrength, setPasswordStrength] = useState(0); const [showPassword, setShowPassword] = useState(false); const navigate = useNavigate(); const uaeCities = [ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", ]; const calculatePasswordStrength = (password) => { let strength = 0; if (password.length >= 8) strength += 1; if (/[A-Z]/.test(password)) strength += 1; if (/[a-z]/.test(password)) strength += 1; if (/[0-9]/.test(password)) strength += 1; if (/[^A-Za-z0-9]/.test(password)) strength += 1; return strength; }; const getPasswordStrengthText = () => { switch (passwordStrength) { case 0: case 1: return { text: "Very Weak", color: "text-red-500", bg: "bg-red-500" }; case 2: return { text: "Weak", color: "text-orange-500", bg: "bg-orange-500" }; case 3: return { text: "Fair", color: "text-yellow-500", bg: "bg-yellow-500" }; case 4: return { text: "Good", color: "text-green-500", bg: "bg-green-500" }; case 5: return { text: "Strong", color: "text-green-600", bg: "bg-green-600" }; default: return { text: "", color: "", bg: "" }; } }; const handleChange = (e) => { const { name, value } = e.target; setForm({ ...form, [name]: value }); // Clear specific error when user starts typing if (errors[name]) { setErrors({ ...errors, [name]: "" }); } // Check password strength if (name === "password") { setPasswordStrength(calculatePasswordStrength(value)); } }; const handleFileChange = (e) => { const { name, files: selectedFiles } = e.target; const file = selectedFiles[0]; if (file) { // Validate file size (5MB max) if (file.size > 5 * 1024 * 1024) { setErrors({ ...errors, [name]: "File size must be less than 5MB" }); return; } // Validate file type const allowedTypes = [ "image/jpeg", "image/jpg", "image/png", "image/webp", ]; if (!allowedTypes.includes(file.type)) { setErrors({ ...errors, [name]: "Only JPEG, PNG, and WebP files are allowed", }); return; } setFiles({ ...files, [name]: file }); setErrors({ ...errors, [name]: "" }); } }; const validateStep1 = () => { const newErrors = {}; if (!form.name.trim() || form.name.length < 2) { newErrors.name = "Name must be at least 2 characters"; } if (!form.email.trim() || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(form.email)) { newErrors.email = "Please enter a valid email address"; } if ( !form.phone.trim() || !/^(\+971|00971|971)?[0-9]{8,9}$/.test(form.phone) ) { newErrors.phone = "Please enter a valid UAE phone number"; } if (!form.password || form.password.length < 6) { newErrors.password = "Password must be at least 6 characters"; } if (form.password !== form.confirmPassword) { newErrors.confirmPassword = "Passwords do not match"; } setErrors(newErrors); return Object.keys(newErrors).length === 0; }; const validateStep2 = () => { const newErrors = {}; if (!files.drivingLicense) { newErrors.drivingLicense = "Driving license is required"; } setErrors(newErrors); return Object.keys(newErrors).length === 0; }; const handleNext = () => { if (step === 1 && validateStep1()) { setStep(2); } else if (step === 2 && validateStep2()) { setStep(3); } }; const handleBack = () => { setStep(step - 1); }; const handleSubmit = async (e) => { e.preventDefault(); if (!validateStep1() || !validateStep2()) { return; } setIsLoading(true); setErrors({}); try { const formData = new FormData(); // Append form data (exclude confirmPassword) Object.keys(form).forEach((key) => { if (key !== "confirmPassword") { formData.append(key, form[key]); } }); // Append files Object.keys(files).forEach((key) => { if (files[key]) { formData.append(key, files[key]); } }); console.log("Submitting registration..."); const response = await API.post("/auth/register", formData, { headers: { "Content-Type": "multipart/form-data", }, }); console.log("Registration response:", response.data); // Registration successful setStep(4); // Success step } catch (error) { console.error("Registration error:", error); if (error.response) { // Server responded with error status const message = error.response.data?.message || error.response.data?.error || "Registration failed"; setErrors({ submit: message }); } else if (error.request) { // Network error setErrors({ submit: "Network error. Please check your connection and try again.", }); } else { // Other error setErrors({ submit: "An unexpected error occurred. Please try again.", }); } } finally { setIsLoading(false); } }; const strengthText = getPasswordStrengthText(); // Step 1: Basic Information const renderStep1 = () => ( <div className="space-y-6"> <div className="text-center space-y-2"> <h2 className="text-2xl font-bold text-gray-900"> Create Your Account </h2> <p className="text-gray-600">Let's start with your basic information</p> </div> <div className="space-y-4"> {/* Name */} <div> <label htmlFor="name" className="block text-sm font-medium text-gray-700 mb-1" > Full Name * </label> <input id="name" name="name" type="text" value={form.name} onChange={handleChange} placeholder="Enter your full name" className={`w-full px-3 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 ${ errors.name ? "border-red-500" : "border-gray-300" }`} /> {errors.name && ( <p className="text-red-500 text-xs mt-1">{errors.name}</p> )} </div> {/* Email */} <div> <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-1" > Email Address * </label> <input id="email" name="email" type="email" value={form.email} onChange={handleChange} placeholder="your.email@example.com" className={`w-full px-3 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 ${ errors.email ? "border-red-500" : "border-gray-300" }`} /> {errors.email && ( <p className="text-red-500 text-xs mt-1">{errors.email}</p> )} </div> {/* Phone */} <div> <label htmlFor="phone" className="block text-sm font-medium text-gray-700 mb-1" > UAE Phone Number * </label> <input id="phone" name="phone" type="tel" value={form.phone} onChange={handleChange} placeholder="+971 50 123 4567" className={`w-full px-3 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 ${ errors.phone ? "border-red-500" : "border-gray-300" }`} /> {errors.phone && ( <p className="text-red-500 text-xs mt-1">{errors.phone}</p> )} </div> {/* Role */} <div> <label htmlFor="role" className="block text-sm font-medium text-gray-700 mb-1" > I want to * </label> <select id="role" name="role" value={form.role} onChange={handleChange} className="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-green-500 focus:border-green-500" > <option value="renter">Rent cars from others</option> <option value="owner">List my car for rent</option> </select> </div> {/* Preferred City */} <div> <label htmlFor="preferredCity" className="block text-sm font-medium text-gray-700 mb-1" > Preferred City * </label> <select id="preferredCity" name="preferredCity" value={form.preferredCity} onChange={handleChange} className="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-green-500 focus:border-green-500" > {uaeCities.map((city) => ( <option key={city} value={city}> {city} </option> ))} </select> </div> {/* Password */} <div> <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-1" > Password * </label> <div className="relative"> <input id="password" name="password" type={showPassword ? "text" : "password"} value={form.password} onChange={handleChange} placeholder="Create a strong password" className={`w-full px-3 py-2 pr-10 border rounded-lg shadow-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 ${ errors.password ? "border-red-500" : "border-gray-300" }`} /> <button type="button" className="absolute inset-y-0 right-0 pr-3 flex items-center" onClick={() => setShowPassword(!showPassword)} > {showPassword ? "👁️" : "👁️‍🗨️"} </button> </div> {/* Password Strength Indicator */} {form.password && ( <div className="mt-2 space-y-2"> <div className="flex space-x-1"> {[1, 2, 3, 4, 5].map((level) => ( <div key={level} className={`h-2 flex-1 rounded ${ level <= passwordStrength ? strengthText.bg : "bg-gray-200" }`} /> ))} </div> <p className={`text-xs ${strengthText.color}`}> Password strength: {strengthText.text} </p> </div> )} {errors.password && ( <p className="text-red-500 text-xs mt-1">{errors.password}</p> )} </div> {/* Confirm Password */} <div> <label htmlFor="confirmPassword" className="block text-sm font-medium text-gray-700 mb-1" > Confirm Password * </label> <input id="confirmPassword" name="confirmPassword" type="password" value={form.confirmPassword} onChange={handleChange} placeholder="Repeat your password" className={`w-full px-3 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 ${ errors.confirmPassword ? "border-red-500" : "border-gray-300" }`} /> {/* Password Match Indicator */} {form.confirmPassword && ( <div className="mt-1"> {form.password === form.confirmPassword ? ( <p className="text-xs text-green-600">✓ Passwords match</p> ) : ( <p className="text-xs text-red-600">✗ Passwords do not match</p> )} </div> )} {errors.confirmPassword && ( <p className="text-red-500 text-xs mt-1"> {errors.confirmPassword} </p> )} </div> </div> </div> ); // Step 2: Document Upload const renderStep2 = () => ( <div className="space-y-6"> <div className="text-center space-y-2"> <h2 className="text-2xl font-bold text-gray-900">Upload Documents</h2> <p className="text-gray-600"> We need to verify your identity for safety </p> </div> <div className="space-y-4"> {/* Driving License - Required */} <div> <label className="block text-sm font-medium text-gray-700 mb-2"> UAE Driving License * <span className="text-green-600 text-xs ml-1">(Required)</span> </label> <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-green-500 transition-colors"> <input type="file" name="drivingLicense" accept="image/*" onChange={handleFileChange} className="hidden" id="drivingLicense" /> <label htmlFor="drivingLicense" className="cursor-pointer"> {files.drivingLicense ? ( <div className="text-green-600"> <p className="font-medium">✓ {files.drivingLicense.name}</p> <p className="text-xs">Click to change</p> </div> ) : ( <div className="text-gray-500"> <p className="font-medium">📄 Upload Driving License</p> <p className="text-xs">Click to select file</p> </div> )} </label> </div> {errors.drivingLicense && ( <p className="text-red-500 text-xs mt-1">{errors.drivingLicense}</p> )} </div> {/* Emirates ID - Optional */} <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Emirates ID <span className="text-gray-500 text-xs ml-1">(Optional)</span> </label> <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-green-500 transition-colors"> <input type="file" name="emiratesId" accept="image/*" onChange={handleFileChange} className="hidden" id="emiratesId" /> <label htmlFor="emiratesId" className="cursor-pointer"> {files.emiratesId ? ( <div className="text-green-600"> <p className="font-medium">✓ {files.emiratesId.name}</p> <p className="text-xs">Click to change</p> </div> ) : ( <div className="text-gray-500"> <p className="font-medium">🆔 Upload Emirates ID</p> <p className="text-xs">Click to select file</p> </div> )} </label> </div> </div> {/* Profile Image - Optional */} <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Profile Photo <span className="text-gray-500 text-xs ml-1">(Optional)</span> </label> <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-green-500 transition-colors"> <input type="file" name="profileImage" accept="image/*" onChange={handleFileChange} className="hidden" id="profileImage" /> <label htmlFor="profileImage" className="cursor-pointer"> {files.profileImage ? ( <div className="text-green-600"> <p className="font-medium">✓ {files.profileImage.name}</p> <p className="text-xs">Click to change</p> </div> ) : ( <div className="text-gray-500"> <p className="font-medium">📸 Upload Profile Photo</p> <p className="text-xs">Click to select file</p> </div> )} </label> </div> </div> </div> <div className="bg-blue-50 border border-blue-200 rounded-lg p-4"> <div className="flex items-start"> <div className="flex-shrink-0"> <span className="text-blue-500 text-lg">ℹ️</span> </div> <div className="ml-3"> <h3 className="text-sm font-medium text-blue-800"> Document Guidelines </h3> <div className="mt-2 text-sm text-blue-700"> <ul className="list-disc space-y-1 ml-4"> <li>All files must be less than 5MB</li> <li>Accepted formats: JPEG, PNG, WebP</li> <li>Ensure documents are clear and readable</li> <li>Your information will be kept secure and private</li> </ul> </div> </div> </div> </div> </div> ); // Step 3: Review and Submit const renderStep3 = () => ( <div className="space-y-6"> <div className="text-center space-y-2"> <h2 className="text-2xl font-bold text-gray-900"> Review Your Information </h2> <p className="text-gray-600"> Please review your details before submitting </p> </div> <div className="bg-gray-50 rounded-lg p-6 space-y-4"> <div> <h3 className="font-medium text-gray-900 mb-3"> Personal Information </h3> <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"> <div> <span className="text-gray-500">Name:</span> <span className="ml-2 font-medium">{form.name}</span> </div> <div> <span className="text-gray-500">Email:</span> <span className="ml-2 font-medium">{form.email}</span> </div> <div> <span className="text-gray-500">Phone:</span> <span className="ml-2 font-medium">{form.phone}</span> </div> <div> <span className="text-gray-500">Role:</span> <span className="ml-2 font-medium capitalize">{form.role}</span> </div> <div> <span className="text-gray-500">Preferred City:</span> <span className="ml-2 font-medium">{form.preferredCity}</span> </div> </div> </div> <hr className="border-gray-200" /> <div> <h3 className="font-medium text-gray-900 mb-3">Uploaded Documents</h3> <div className="space-y-2 text-sm"> <div className="flex items-center"> <span className="text-green-600">✓</span> <span className="ml-2"> Driving License: {files.drivingLicense?.name} </span> </div> {files.emiratesId && ( <div className="flex items-center"> <span className="text-green-600">✓</span> <span className="ml-2"> Emirates ID: {files.emiratesId.name} </span> </div> )} {files.profileImage && ( <div className="flex items-center"> <span className="text-green-600">✓</span> <span className="ml-2"> Profile Photo: {files.profileImage.name} </span> </div> )} </div> </div> </div> <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4"> <div className="flex items-start"> <div className="flex-shrink-0"> <span className="text-yellow-500 text-lg">⚠️</span> </div> <div className="ml-3"> <h3 className="text-sm font-medium text-yellow-800"> Account Approval Required </h3> <p className="mt-1 text-sm text-yellow-700"> Your account will be reviewed by our team within 24-48 hours. You'll receive an email notification once approved. </p> </div> </div> </div> {errors.submit && ( <div className="text-red-600 text-sm text-center bg-red-50 border border-red-200 rounded-lg p-3"> {errors.submit} </div> )} </div> ); // Step 4: Success const renderStep4 = () => ( <div className="text-center space-y-6"> <div className="mx-auto w-24 h-24 bg-green-100 rounded-full flex items-center justify-center"> <span className="text-green-600 text-4xl">✓</span> </div> <div className="space-y-2"> <h2 className="text-2xl font-bold text-gray-900"> Registration Successful! </h2> <p className="text-gray-600"> Welcome to BorrowMyCar! Your account has been created successfully. </p> </div> <div className="bg-blue-50 border border-blue-200 rounded-lg p-4"> <h3 className="font-medium text-blue-900 mb-2">What's Next?</h3> <div className="text-sm text-blue-800 space-y-1"> <p>📧 Check your email for verification instructions</p> <p>⏱️ Our team will review your documents within 24-48 hours</p> <p>🎉 You'll receive approval notification via email</p> </div> </div> <div className="space-y-3"> <Link to="/login" className="w-full inline-flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors" > Sign In to Your Account </Link> <Link to="/" className="w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors" > Return to Homepage </Link> </div> </div> ); return ( <div className="min-h-screen bg-gray-50 flex flex-col lg:flex-row"> {/* Left Side - Progress & Branding */} <div className="lg:flex-1 lg:max-w-md bg-gradient-to-br from-green-50 to-emerald-100 p-8"> <div className="max-w-md mx-auto space-y-8"> {/* Logo */} <div className="text-center"> <div className="mx-auto w-16 h-16 bg-gradient-to-r from-green-400 to-emerald-500 rounded-xl shadow-lg flex items-center justify-center text-2xl"> 🚗 </div> <h1 className="mt-4 text-2xl font-bold text-gray-900"> BorrowMyCar </h1> <p className="text-gray-600">Your trusted car sharing platform</p> </div> {/* Progress Indicator */} {step < 4 && ( <div className="space-y-4"> <h3 className="font-medium text-gray-900"> Registration Progress </h3> <div className="space-y-3"> {[ { step: 1, label: "Basic Information", icon: "👤" }, { step: 2, label: "Document Upload", icon: "📄" }, { step: 3, label: "Review & Submit", icon: "✅" }, ].map((item) => ( <div key={item.step} className="flex items-center space-x-3"> <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm ${ step >= item.step ? "bg-green-500 text-white" : step === item.step - 1 ? "bg-green-100 text-green-600 border-2 border-green-500" : "bg-gray-200 text-gray-500" }`} > {step > item.step ? "✓" : item.step} </div> <div className="flex-1"> <p className={`text-sm font-medium ${ step >= item.step ? "text-green-600" : "text-gray-500" }`} > {item.label} </p> </div> <span className="text-lg">{item.icon}</span> </div> ))} </div> </div> )} {/* Features */} <div className="space-y-3"> <h3 className="font-medium text-gray-900">Why Choose Us?</h3> <div className="space-y-2 text-sm text-gray-600"> <div className="flex items-center space-x-2"> <span className="text-green-500">✓</span> <span>24/7 customer support</span> </div> <div className="flex items-center space-x-2"> <span className="text-green-500">✓</span> <span>Flexible rental periods</span> </div> <div className="flex items-center space-x-2"> <span className="text-green-500">✓</span> <span>Secure payment processing</span> </div> </div> </div> </div> </div> {/* Right Side - Form */} <div className="flex-1 flex items-center justify-center p-4 sm:p-6 lg:p-8"> <div className="w-full max-w-md space-y-8"> {/* Form Container */} <form onSubmit={handleSubmit} className="space-y-6"> {step === 1 && renderStep1()} {step === 2 && renderStep2()} {step === 3 && renderStep3()} {step === 4 && renderStep4()} {/* Navigation Buttons */} {step < 4 && ( <div className="flex space-x-4"> {step > 1 && ( <button type="button" onClick={handleBack} className="flex-1 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors" > Back </button> )} {step < 3 ? ( <button type="button" onClick={handleNext} className="flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors" > Next Step </button> ) : ( <button type="submit" disabled={isLoading} className="flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors" > {isLoading ? ( <span className="flex items-center justify-center"> <svg className="animate-spin -ml-1 mr-3 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" > <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" ></circle> <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" ></path> </svg> Creating Account... </span> ) : ( "Create Account" )} </button> )} </div> )} </form> {/* Login Link */} {step < 4 && ( <p className="text-center text-sm text-gray-600"> Already have an account?{" "} <Link to="/login" className="font-medium text-green-600 hover:text-green-500 hover:underline transition-colors" > Sign in here </Link> </p> )} </div> </div> </div> ); }; export default Signup;
```

# borrowmycarfrontend\vite.config.js

```js
import { defineConfig } from 'vite' import react from '@vitejs/plugin-react' import tailwindcss from '@tailwindcss/vite' // https://vite.dev/config/ export default defineConfig({ plugins: [tailwindcss(),react()], })
```

# config\db.js

```js
// config/db.js (Enhanced) import mongoose from "mongoose"; import dotenv from "dotenv"; dotenv.config(); // Enhanced MongoDB connection with better error handling and options export const connectDB = async () => { try { // Connection options for better performance and reliability const options = { dbName: "borrowmycar", maxPoolSize: 10, // Maintain up to 10 socket connections serverSelectionTimeoutMS: 5000, // Keep trying to send operations for 5 seconds socketTimeoutMS: 45000, // Close sockets after 45 seconds of inactivity // Removed deprecated options: bufferMaxEntries, bufferCommands }; const conn = await mongoose.connect(process.env.MONGO_URI, options); console.log(`✅ MongoDB Connected: ${conn.connection.host}`); console.log(`📊 Database: ${conn.connection.name}`); // Handle connection events mongoose.connection.on("error", (error) => { console.error("❌ MongoDB connection error:", error); }); mongoose.connection.on("disconnected", () => { console.log("⚠️ MongoDB disconnected"); }); mongoose.connection.on("reconnected", () => { console.log("✅ MongoDB reconnected"); }); // Graceful shutdown process.on("SIGINT", async () => { try { await mongoose.connection.close(); console.log("📴 MongoDB connection closed through app termination"); process.exit(0); } catch (error) { console.error("❌ Error during MongoDB disconnection:", error); process.exit(1); } }); } catch (error) { console.error("❌ MongoDB connection error:", error.message); // Exit process with failure process.exit(1); } }; // Health check function export const checkDBHealth = async () => { try { const state = mongoose.connection.readyState; const states = { 0: "disconnected", 1: "connected", 2: "connecting", 3: "disconnecting", }; return { status: states[state], host: mongoose.connection.host, name: mongoose.connection.name, port: mongoose.connection.port, }; } catch (error) { return { status: "error", error: error.message, }; } };
```

# controllers\authController.js

```js
// controllers/authController.js (Complete Fixed Version) import jwt from "jsonwebtoken"; import bcrypt from "bcryptjs"; import { User } from "../models/User.js"; import { uploadImagesToCloud, deleteImagesFromCloud, } from "../utils/cloudUploader.js"; // Enhanced async error handler const handleAsyncErrorLocal = (fn) => { return (req, res, next) => { Promise.resolve(fn(req, res, next)).catch(next); }; }; // Token generator with enhanced payload const generateToken = (user) => { return jwt.sign( { id: user._id, role: user.role, isApproved: user.isApproved, }, process.env.JWT_SECRET, { expiresIn: "7d" } ); }; // Enhanced data sanitizer for user const sanitizeUserData = (data) => { const sanitized = {}; if (data.name) sanitized.name = data.name.toString().trim(); if (data.email) sanitized.email = data.email.toString().toLowerCase().trim(); if (data.phone) sanitized.phone = data.phone.toString().trim(); if (data.password) sanitized.password = data.password.toString(); if (data.role) sanitized.role = data.role.toString().trim(); if (data.preferredCity) sanitized.preferredCity = data.preferredCity.toString().trim(); return sanitized; }; // Enhanced user validation const validateUserData = (data, isSignup = false) => { const errors = []; if (isSignup) { if (!data.name || data.name.length < 2) { errors.push("Name must be at least 2 characters long"); } if (!data.email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(data.email)) { errors.push("Please provide a valid email address"); } if (!data.phone || !/^(\+971|00971|971)?[0-9]{8,9}$/.test(data.phone)) { errors.push("Please provide a valid UAE phone number"); } if (!data.password || data.password.length < 6) { errors.push("Password must be at least 6 characters long"); } if (data.role && !["renter", "owner"].includes(data.role)) { errors.push("Role must be either 'renter' or 'owner'"); } } return { isValid: errors.length === 0, errors, }; }; // SIGNUP CONTROLLER export const signup = handleAsyncErrorLocal(async (req, res) => { // Sanitize input data const userData = sanitizeUserData(req.body); const { name, email, phone, password, role = "renter", preferredCity, } = userData; // Validate input const validationResult = validateUserData(userData, true); if (!validationResult.isValid) { return res.status(400).json({ success: false, message: "Validation failed", errors: validationResult.errors, code: "VALIDATION_ERROR", }); } // Check if user already exists const existingUser = await User.findOne({ $or: [{ email }, { phone }], }); if (existingUser) { return res.status(400).json({ success: false, message: existingUser.email === email ? "Email already registered" : "Phone number already registered", code: "USER_EXISTS", }); } // Handle document uploads let documentUrls = {}; if (req.files) { try { // Validate required documents if (!req.files.drivingLicense) { return res.status(400).json({ success: false, message: "Driving license is required", code: "MISSING_DOCUMENTS", }); } // Upload documents to cloud if (req.files.drivingLicense) { const [drivingLicenseUrl] = await uploadImagesToCloud( req.files.drivingLicense ); documentUrls.drivingLicenseUrl = drivingLicenseUrl; } if (req.files.emiratesId) { const [emiratesIdUrl] = await uploadImagesToCloud(req.files.emiratesId); documentUrls.emiratesIdUrl = emiratesIdUrl; } if (req.files.visa) { const [visaUrl] = await uploadImagesToCloud(req.files.visa); documentUrls.visaUrl = visaUrl; } if (req.files.passport) { const [passportUrl] = await uploadImagesToCloud(req.files.passport); documentUrls.passportUrl = passportUrl; } if (req.files.profileImage) { const [profileImageUrl] = await uploadImagesToCloud( req.files.profileImage ); documentUrls.profileImage = profileImageUrl; } } catch (uploadError) { console.error("Document upload error:", uploadError); return res.status(500).json({ success: false, message: "Failed to upload documents. Please try again.", code: "UPLOAD_FAILED", }); } } // Create user const user = await User.create({ name, email, phone, password, role, preferredCity, ...documentUrls, isApproved: false, // Requires admin approval }); const token = generateToken(user); // Return consistent response structure res.status(201).json({ success: true, message: "Account created successfully. Awaiting admin approval.", token, // Root level token user: { id: user._id, name: user.name, email: user.email, phone: user.phone, role: user.role, isApproved: user.isApproved, profileImage: user.profileImage, }, data: { token, user: { id: user._id, name: user.name, email: user.email, phone: user.phone, role: user.role, isApproved: user.isApproved, profileImage: user.profileImage, }, }, }); }); // LOGIN CONTROLLER export const login = handleAsyncErrorLocal(async (req, res) => { const { email, password } = req.body; console.log("Login attempt for:", email); // Input validation if (!email || !password) { return res.status(400).json({ success: false, message: "Please provide email and password", code: "MISSING_CREDENTIALS", }); } try { // Find user and include password for comparison const user = await User.findOne({ email }).select("+password"); if (!user) { console.log("User not found:", email); return res.status(401).json({ success: false, message: "Invalid email or password", code: "INVALID_CREDENTIALS", }); } // Check password const isPasswordValid = await user.matchPassword(password); if (!isPasswordValid) { console.log("Invalid password for user:", email); return res.status(401).json({ success: false, message: "Invalid email or password", code: "INVALID_CREDENTIALS", }); } // Update last login user.lastLoginAt = new Date(); await user.save({ validateBeforeSave: false }); const token = generateToken(user); console.log("Login successful for:", email); // Return token at root level for frontend compatibility res.status(200).json({ success: true, message: "Login successful", token, // Root level token (frontend expects this) user: { id: user._id, name: user.name, email: user.email, phone: user.phone, role: user.role, isApproved: user.isApproved, profileImage: user.profileImage, lastLoginAt: user.lastLoginAt, }, data: { token, user: { id: user._id, name: user.name, email: user.email, phone: user.phone, role: user.role, isApproved: user.isApproved, profileImage: user.profileImage, lastLoginAt: user.lastLoginAt, }, }, }); } catch (error) { console.error("Login error:", error); res.status(500).json({ success: false, message: "Internal server error", code: "INTERNAL_ERROR", }); } }); // GET USER PROFILE export const getProfile = handleAsyncErrorLocal(async (req, res) => { try { const user = await User.findById(req.user.id).select("-password"); if (!user) { return res.status(404).json({ success: false, message: "User not found", code: "USER_NOT_FOUND", }); } res.json({ success: true, data: { user: { id: user._id, name: user.name, email: user.email, phone: user.phone, role: user.role, isApproved: user.isApproved, profileImage: user.profileImage, preferredCity: user.preferredCity, createdAt: user.createdAt, lastLoginAt: user.lastLoginAt, }, }, }); } catch (error) { console.error("Get profile error:", error); res.status(500).json({ success: false, message: "Failed to fetch profile", code: "INTERNAL_ERROR", }); } }); // UPDATE USER PROFILE export const updateProfile = handleAsyncErrorLocal(async (req, res) => { try { const userId = req.user.id; const updates = sanitizeUserData(req.body); // Remove sensitive fields that shouldn't be updated via this endpoint delete updates.password; delete updates.email; delete updates.role; delete updates.isApproved; // Handle profile image upload if (req.files && req.files.profileImage) { try { const user = await User.findById(userId); // Delete old profile image if exists if (user.profileImage) { await deleteImagesFromCloud([user.profileImage]).catch(console.error); } // Upload new profile image const [profileImageUrl] = await uploadImagesToCloud( req.files.profileImage ); updates.profileImage = profileImageUrl; } catch (uploadError) { return res.status(500).json({ success: false, message: "Failed to upload profile image", code: "UPLOAD_FAILED", }); } } const updatedUser = await User.findByIdAndUpdate(userId, updates, { new: true, runValidators: true, }).select("-password"); res.json({ success: true, message: "Profile updated successfully", data: { user: { id: updatedUser._id, name: updatedUser.name, email: updatedUser.email, phone: updatedUser.phone, role: updatedUser.role, isApproved: updatedUser.isApproved, profileImage: updatedUser.profileImage, preferredCity: updatedUser.preferredCity, }, }, }); } catch (error) { console.error("Update profile error:", error); res.status(500).json({ success: false, message: "Failed to update profile", code: "INTERNAL_ERROR", }); } }); // CHANGE PASSWORD export const changePassword = handleAsyncErrorLocal(async (req, res) => { try { const { currentPassword, newPassword } = req.body; if (!currentPassword || !newPassword) { return res.status(400).json({ success: false, message: "Current password and new password are required", code: "MISSING_FIELDS", }); } if (newPassword.length < 6) { return res.status(400).json({ success: false, message: "New password must be at least 6 characters long", code: "INVALID_PASSWORD", }); } const user = await User.findById(req.user.id).select("+password"); const isPasswordValid = await user.matchPassword(currentPassword); if (!isPasswordValid) { return res.status(400).json({ success: false, message: "Current password is incorrect", code: "INVALID_CURRENT_PASSWORD", }); } user.password = newPassword; await user.save(); res.json({ success: true, message: "Password updated successfully", }); } catch (error) { console.error("Change password error:", error); res.status(500).json({ success: false, message: "Failed to change password", code: "INTERNAL_ERROR", }); } }); // LOGOUT (Optional - mainly client-side) export const logout = handleAsyncErrorLocal(async (req, res) => { // Since we're using stateless JWT, logout is mainly handled on the client side // But we can track logout time if needed try { res.json({ success: true, message: "Logged out successfully", }); } catch (error) { console.error("Logout error:", error); res.status(500).json({ success: false, message: "Logout failed", code: "INTERNAL_ERROR", }); } }); // EXPORT ALTERNATIVE NAMES FOR COMPATIBILITY export const register = signup; // Alternative name for signup
```

# controllers\bookingController.js

```js
// controllers/bookingController.js (Fixed Imports) import Booking from "../models/Booking.js"; // Default import import Car from "../models/Car.js"; // Default import // Simple async error handler (if you don't have it in utils) const handleAsyncError = (fn) => { return (req, res, next) => { Promise.resolve(fn(req, res, next)).catch(next); }; }; // Check for booking conflicts const checkBookingConflicts = async ( carId, startDate, endDate, excludeBookingId = null ) => { const filter = { car: carId, status: { $in: ["pending", "approved", "confirmed", "active"] }, $or: [ { startDate: { $lte: new Date(endDate) }, endDate: { $gte: new Date(startDate) }, }, ], }; if (excludeBookingId) { filter._id = { $ne: excludeBookingId }; } const conflictingBooking = await Booking.findOne(filter); return conflictingBooking; }; // Calculate booking pricing const calculateBookingPricing = ( car, startDate, endDate, deliveryRequested = false ) => { const start = new Date(startDate); const end = new Date(endDate); const totalDays = Math.ceil((end - start) / (1000 * 60 * 60 * 24)); const dailyRate = car.price; const totalAmount = dailyRate * totalDays; const securityDeposit = car.securityDeposit || 0; const deliveryFee = deliveryRequested ? car.deliveryFee || 0 : 0; const totalPayable = totalAmount + securityDeposit + deliveryFee; return { totalDays, dailyRate, totalAmount, securityDeposit, deliveryFee, totalPayable, }; }; // CREATE BOOKING export const createBooking = handleAsyncError(async (req, res) => { const user = req.user; const { carId, startDate, endDate, paymentMethod = "Cash", pickupLocation, returnLocation, deliveryRequested = false, deliveryAddress, renterNotes, } = req.body; // Basic validation if (!carId || !startDate || !endDate) { return res.status(400).json({ success: false, message: "Missing required fields: carId, startDate, endDate", }); } try { // Get car details const car = await Car.findById(carId); if (!car) { return res.status(404).json({ success: false, message: "Car not found", }); } // Calculate pricing const pricing = calculateBookingPricing( car, startDate, endDate, deliveryRequested ); // Create booking const booking = new Booking({ renter: user.id, car: carId, startDate: new Date(startDate), endDate: new Date(endDate), totalDays: pricing.totalDays, dailyRate: pricing.dailyRate, totalAmount: pricing.totalAmount, securityDeposit: pricing.securityDeposit, deliveryFee: pricing.deliveryFee, totalPayable: pricing.totalPayable, paymentMethod, pickupLocation: pickupLocation || "To be determined", returnLocation: returnLocation || "To be determined", deliveryRequested, deliveryAddress, renterNotes: renterNotes || "", }); const savedBooking = await booking.save(); res.status(201).json({ success: true, message: "Booking created successfully", data: { booking: savedBooking }, }); } catch (error) { console.error("Booking creation error:", error); res.status(500).json({ success: false, message: "Failed to create booking", error: error.message, }); } }); // GET MY BOOKINGS export const getMyBookings = handleAsyncError(async (req, res) => { try { const bookings = await Booking.find({ renter: req.user.id }) .populate("car", "title make model year price images") .sort({ createdAt: -1 }); res.json({ success: true, data: { bookings }, }); } catch (error) { res.status(500).json({ success: false, message: "Failed to fetch bookings", error: error.message, }); } }); // GET BOOKINGS FOR OWNER export const getBookingsForOwner = handleAsyncError(async (req, res) => { try { // Get all cars owned by the user const ownedCars = await Car.find({ owner: req.user.id }).select("_id"); const carIds = ownedCars.map((car) => car._id); const bookings = await Booking.find({ car: { $in: carIds } }) .populate("car", "title make model year price images") .populate("renter", "name email phone") .sort({ createdAt: -1 }); res.json({ success: true, data: { bookings }, }); } catch (error) { res.status(500).json({ success: false, message: "Failed to fetch owner bookings", error: error.message, }); } }); // UPDATE BOOKING STATUS export const updateBookingStatus = handleAsyncError(async (req, res) => { const { id } = req.params; const { status } = req.body; try { const booking = await Booking.findById(id).populate("car"); if (!booking) { return res.status(404).json({ success: false, message: "Booking not found", }); } // Simple authorization check const isOwner = booking.car.owner.toString() === req.user.id; const isRenter = booking.renter.toString() === req.user.id; if (!isOwner && !isRenter) { return res.status(403).json({ success: false, message: "Not authorized to update this booking", }); } // Update booking status booking.status = status; await booking.save(); res.json({ success: true, message: "Booking status updated successfully", data: { booking }, }); } catch (error) { res.status(500).json({ success: false, message: "Failed to update booking status", error: error.message, }); } }); // GET SINGLE BOOKING export const getBookingById = handleAsyncError(async (req, res) => { const { id } = req.params; try { const booking = await Booking.findById(id) .populate("car", "title make model year price images city") .populate("renter", "name email phone"); if (!booking) { return res.status(404).json({ success: false, message: "Booking not found", }); } res.json({ success: true, data: { booking }, }); } catch (error) { res.status(500).json({ success: false, message: "Failed to fetch booking", error: error.message, }); } }); // CANCEL BOOKING export const cancelBooking = handleAsyncError(async (req, res) => { const { id } = req.params; try { const booking = await Booking.findById(id); if (!booking) { return res.status(404).json({ success: false, message: "Booking not found", }); } booking.status = "cancelled"; await booking.save(); res.json({ success: true, message: "Booking cancelled successfully", data: { booking }, }); } catch (error) { res.status(500).json({ success: false, message: "Failed to cancel booking", error: error.message, }); } }); // ADD REVIEW export const addReview = handleAsyncError(async (req, res) => { const { id } = req.params; const { rating, comment } = req.body; try { const booking = await Booking.findById(id); if (!booking) { return res.status(404).json({ success: false, message: "Booking not found", }); } // Simple review logic - you can enhance this const reviewData = { rating: parseInt(rating), comment: comment || "", reviewedAt: new Date(), }; // Determine if this is renter or owner review const isRenter = booking.renter.toString() === req.user.id; if (isRenter) { booking.renterReview = reviewData; } else { booking.ownerReview = reviewData; } await booking.save(); res.json({ success: true, message: "Review added successfully", data: { booking }, }); } catch (error) { res.status(500).json({ success: false, message: "Failed to add review", error: error.message, }); } });
```

# controllers\carController.js

```js
// controllers/carController.js - CRITICAL FIX import Car from "../models/Car.js"; import Booking from "../models/Booking.js"; import { uploadImagesToCloud, deleteImagesFromCloud, } from "../utils/cloudUploader.js"; import { handleAsyncError } from "../utils/errorHandler.js"; // Enhanced car data sanitizer with FIXED field mapping const sanitizeCarData = (data) => { const sanitized = {}; // Basic fields if (data.title) sanitized.title = data.title.toString().trim(); if (data.description) sanitized.description = data.description.toString().trim(); if (data.city) sanitized.city = data.city.toString().trim(); if (data.make) sanitized.make = data.make.toString().trim(); if (data.model) sanitized.model = data.model.toString().trim(); if (data.color) sanitized.color = data.color.toString().trim(); if (data.plateNumber) sanitized.plateNumber = data.plateNumber.toString().toUpperCase().trim(); // CRITICAL FIX: Handle both pricePerDay (frontend) and price (backend) if (data.pricePerDay) { sanitized.price = parseFloat(data.pricePerDay); } else if (data.price) { sanitized.price = parseFloat(data.price); } // Numeric fields if (data.year) sanitized.year = parseInt(data.year); if (data.mileage) sanitized.mileage = parseInt(data.mileage); if (data.seatingCapacity) sanitized.seatingCapacity = parseInt(data.seatingCapacity); // Enum fields if (data.transmission) sanitized.transmission = data.transmission.toString().trim(); if (data.fuelType) sanitized.fuelType = data.fuelType.toString().trim(); if (data.specifications) sanitized.specifications = data.specifications.toString().trim(); // Array fields if (data.features) { sanitized.features = Array.isArray(data.features) ? data.features.map((f) => f.toString().trim()) : [data.features.toString().trim()]; } // Date fields if (data.availabilityFrom) sanitized.availabilityFrom = data.availabilityFrom; if (data.availabilityTo) sanitized.availabilityTo = data.availabilityTo; return sanitized; }; // CREATE CAR - FIXED export const createCar = handleAsyncError(async (req, res) => { const user = req.user; // Check if user is approved if (!user.isApproved) { return res.status(403).json({ success: false, message: "Your account must be approved before listing cars", code: "ACCOUNT_NOT_APPROVED", }); } // Role-based authorization if (user.role !== "owner") { return res.status(403).json({ success: false, message: "Access denied. Only car owners can list vehicles.", code: "INSUFFICIENT_PERMISSIONS", }); } // Extract and sanitize input data const carData = sanitizeCarData(req.body); // VALIDATION: Ensure price is set if (!carData.price || carData.price <= 0) { return res.status(400).json({ success: false, message: "Valid price per day is required", code: "INVALID_PRICE", }); } // Handle images upload - REQUIRE MINIMUM 3 IMAGES let imageUrls = []; if (req.files && req.files.length > 0) { if (req.files.length < 3) { return res.status(400).json({ success: false, message: "Minimum 3 images required", code: "INSUFFICIENT_IMAGES", }); } try { imageUrls = await uploadImagesToCloud(req.files); } catch (uploadError) { return res.status(500).json({ success: false, message: "Failed to upload images. Please try again.", code: "IMAGE_UPLOAD_FAILED", }); } } else { return res.status(400).json({ success: false, message: "Car images are required", code: "MISSING_IMAGES", }); } // Create car document const newCar = new Car({ ...carData, images: imageUrls, owner: user.id, status: "active", // Set to active instead of pending for demo }); const savedCar = await newCar.save(); await savedCar.populate("owner", "name email phone"); res.status(201).json({ success: true, message: "Car listed successfully!", data: { car: savedCar }, }); }); // GET CARS - FIXED to handle both price fields export const getCars = handleAsyncError(async (req, res) => { const { page = 1, limit = 12, city, priceMin, priceMax, makeModel, make, year, transmission, fuelType, seatingCapacity, features, deliveryAvailable, sortBy = "createdAt", sortOrder = "desc", search, } = req.query; // Build filter object const filter = { status: "active" }; // City filter if (city) filter.city = city; // Price range filter if (priceMin || priceMax) { filter.price = {}; if (priceMin) filter.price.$gte = parseFloat(priceMin); if (priceMax) filter.price.$lte = parseFloat(priceMax); } // Car specifications if (make) filter.make = new RegExp(make, "i"); if (makeModel) { filter.$or = [ { make: new RegExp(makeModel, "i") }, { model: new RegExp(makeModel, "i") }, { title: new RegExp(makeModel, "i") }, ]; } if (year) filter.year = parseInt(year); if (transmission) filter.transmission = transmission; if (fuelType) filter.fuelType = fuelType; if (seatingCapacity) filter.seatingCapacity = parseInt(seatingCapacity); // Features filter if (features) { const featureArray = Array.isArray(features) ? features : [features]; filter.features = { $in: featureArray }; } // Search in title, description, make, and model if (search) { filter.$or = [ { title: new RegExp(search, "i") }, { description: new RegExp(search, "i") }, { make: new RegExp(search, "i") }, { model: new RegExp(search, "i") }, ]; } // Only show available cars filter.availabilityTo = { $gte: new Date() }; // Pagination const skip = (parseInt(page) - 1) * parseInt(limit); const sortOptions = {}; sortOptions[sortBy] = sortOrder === "desc" ? -1 : 1; // Execute query with LEAN for better performance const [cars, totalCount] = await Promise.all([ Car.find(filter) .populate("owner", "name email phone averageRating") .sort(sortOptions) .skip(skip) .limit(parseInt(limit)) .lean(), Car.countDocuments(filter), ]); // ADD pricePerDay field for frontend compatibility const enhancedCars = cars.map((car) => ({ ...car, pricePerDay: car.price, // Frontend expects this field })); const totalPages = Math.ceil(totalCount / parseInt(limit)); res.json({ success: true, data: { cars: enhancedCars, pagination: { currentPage: parseInt(page), totalPages, totalCount, hasNext: parseInt(page) < totalPages, hasPrev: parseInt(page) > 1, limit: parseInt(limit), }, }, }); }); // Get single car by ID - FIXED export const getCarById = handleAsyncError(async (req, res) => { const { id } = req.params; let car = await Car.findById(id) .populate( "owner", "name email phone profileImage averageRating totalBookings createdAt" ) .lean(); if (!car || car.status === "deleted") { return res.status(404).json({ success: false, message: "Car not found", code: "CAR_NOT_FOUND", }); } // Check if car is still available const today = new Date(); if (new Date(car.availabilityTo) < today) { return res.status(410).json({ success: false, message: "This car listing has expired", code: "LISTING_EXPIRED", }); } // CRITICAL FIX: Add pricePerDay for frontend compatibility car.pricePerDay = car.price; res.json({ success: true, data: { car }, }); }); // Export other functions... export { updateCar, deleteCar, getCarsByOwner } from "./carController.js";
```

# index.js

```js
// index.js import dotenv from "dotenv"; dotenv.config(); // Load environment variables ASAP import express from "express"; import cors from "cors"; import { connectDB, checkDBHealth } from "./config/db.js"; import { globalErrorHandler } from "./utils/errorHandler.js"; import { generalLimiter } from "./utils/validators.js"; import { checkCloudinaryHealth } from "./utils/cloudinary.js"; // Routes import authRoutes from "./routes/authRoutes.js"; import carRoutes from "./routes/carRoutes.js"; import bookingRoutes from "./routes/bookingRoutes.js"; const app = express(); // Connect to database (with try/catch) try { await connectDB(); console.log("✅ Database connected"); } catch (err) { console.error("❌ Database connection failed:", err.message); process.exit(1); // Stop app if DB fails to connect } // CORS config // index.js - Updated CORS configuration // CORS config - UPDATED to handle multiple origins const corsOptions = { origin: [ "http://localhost:3000", "http://localhost:5173", // Vite default port "http://127.0.0.1:5173", process.env.FRONTEND_URL, ].filter(Boolean), // Remove any undefined values credentials: true, optionsSuccessStatus: 200, methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"], allowedHeaders: [ "Content-Type", "Authorization", "Origin", "X-Requested-With", "Accept", ], }; // Middlewares app.use(cors(corsOptions)); app.use(express.json({ limit: "10mb" })); app.use(express.urlencoded({ extended: true, limit: "10mb" })); // Security headers app.use((req, res, next) => { res.setHeader("X-Content-Type-Options", "nosniff"); res.setHeader("X-Frame-Options", "DENY"); res.setHeader("X-XSS-Protection", "1; mode=block"); next(); }); // Rate limiter app.use(generalLimiter); // API routes app.use("/api/auth", authRoutes); app.use("/api/cars", carRoutes); app.use("/api/bookings", bookingRoutes); // Health check app.get("/api/health", async (req, res) => { try { const [dbHealth, cloudinaryHealth] = await Promise.all([ checkDBHealth(), checkCloudinaryHealth(), ]); res.json({ success: true, message: "BorrowMyCar API is running", timestamp: new Date().toISOString(), services: { database: dbHealth, cloudinary: cloudinaryHealth, server: { status: "running", environment: process.env.NODE_ENV || "development", version: process.env.npm_package_version || "1.0.0", }, }, }); } catch (error) { res.status(500).json({ success: false, message: "Health check failed", error: error.message, }); } }); // API info app.get("/api", (req, res) => { res.json({ success: true, message: "Welcome to BorrowMyCar API", version: "1.0.0", endpoints: { auth: "/api/auth", cars: "/api/cars", bookings: "/api/bookings", health: "/api/health", }, documentation: "https://api.borrowmycar.com/docs", // Replace with real link }); }); // Handle unknown routes app.use((req, res) => { res.status(404).json({ success: false, message: `Route ${req.originalUrl} not found`, code: "ROUTE_NOT_FOUND", }); }); // Global error handler app.use(globalErrorHandler); // Start server const PORT = process.env.PORT || 5000; const server = app.listen(PORT, () => { console.log(`🚀 Server running on port ${PORT}`); console.log(`🌍 Environment: ${process.env.NODE_ENV || "development"}`); console.log(`📝 API Info: http://localhost:${PORT}/api`); console.log(`💚 Health Check: http://localhost:${PORT}/api/health`); }); // Graceful shutdown process.on("SIGTERM", () => { console.log("👋 SIGTERM received. Shutting down..."); server.close(() => { console.log("💥 Server closed."); }); }); process.on("unhandledRejection", (err) => { console.error("💥 UNHANDLED PROMISE REJECTION!"); console.error(err); server.close(() => process.exit(1)); }); process.on("uncaughtException", (err) => { console.error("💥 UNCAUGHT EXCEPTION!"); console.error(err); process.exit(1); }); export default app;
```

# jsconfig.json

```json
{ "compilerOptions": { // Enable latest features "lib": ["ESNext", "DOM"], "target": "ESNext", "module": "ESNext", "moduleDetection": "force", "jsx": "react-jsx", "allowJs": true, // Bundler mode "moduleResolution": "bundler", "allowImportingTsExtensions": true, "verbatimModuleSyntax": true, "noEmit": true, // Best practices "strict": true, "skipLibCheck": true, "noFallthroughCasesInSwitch": true, // Some stricter flags (disabled by default) "noUnusedLocals": false, "noUnusedParameters": false, "noPropertyAccessFromIndexSignature": false } }
```

# middlewares\authMiddleware.js

```js
// middlewares/authMiddleware.js (Fixed Imports) import jwt from "jsonwebtoken"; import { User } from "../models/User.js"; // Fixed import import rateLimit from "express-rate-limit"; // Enhanced async error handler const handleAsyncError = (fn) => { return (req, res, next) => { Promise.resolve(fn(req, res, next)).catch(next); }; }; // Enhanced JWT protection middleware export const protect = handleAsyncError(async (req, res, next) => { let token; // Extract token from different sources if ( req.headers.authorization && req.headers.authorization.startsWith("Bearer") ) { token = req.headers.authorization.split(" ")[1]; } else if (req.cookies && req.cookies.jwt) { token = req.cookies.jwt; } // Check if token exists if (!token) { return res.status(401).json({ success: false, message: "Access denied. No token provided.", code: "NO_TOKEN_PROVIDED", }); } try { // Verify token const decoded = jwt.verify(token, process.env.JWT_SECRET); // Check if user still exists const user = await User.findById(decoded.id).select("-password"); if (!user) { return res.status(401).json({ success: false, message: "The user belonging to this token no longer exists.", code: "USER_NOT_FOUND", }); } // Check if user account is not deleted if (user.deletedAt) { return res.status(401).json({ success: false, message: "User account has been deactivated.", code: "ACCOUNT_DEACTIVATED", }); } // Add user to request object req.user = user; next(); } catch (error) { let message = "Invalid token"; let code = "INVALID_TOKEN"; if (error.name === "TokenExpiredError") { message = "Token has expired"; code = "TOKEN_EXPIRED"; } else if (error.name === "JsonWebTokenError") { message = "Invalid token format"; code = "MALFORMED_TOKEN"; } return res.status(401).json({ success: false, message, code, }); } }); // Role-based authorization middleware export const restrictTo = (...roles) => { return (req, res, next) => { if (!roles.includes(req.user.role)) { return res.status(403).json({ success: false, message: "You do not have permission to perform this action.", code: "INSUFFICIENT_PERMISSIONS", }); } next(); }; }; // Account approval requirement middleware export const requireApproval = (req, res, next) => { if (!req.user.isApproved) { return res.status(403).json({ success: false, message: "Your account must be approved by admin before performing this action.", code: "ACCOUNT_NOT_APPROVED", }); } next(); }; // Optional authentication - doesn't fail if no token export const optionalAuth = handleAsyncError(async (req, res, next) => { let token; if ( req.headers.authorization && req.headers.authorization.startsWith("Bearer") ) { token = req.headers.authorization.split(" ")[1]; } else if (req.cookies && req.cookies.jwt) { token = req.cookies.jwt; } if (token) { try { const decoded = jwt.verify(token, process.env.JWT_SECRET); const user = await User.findById(decoded.id).select("-password"); if (user && !user.deletedAt) { req.user = user; } } catch (error) { // Silently fail for optional auth console.log("Optional auth failed:", error.message); } } next(); }); // Auth rate limiter (stricter for login/signup) export const authLimiter = rateLimit({ windowMs: 15 * 60 * 1000, // 15 minutes max: 5, // Limit each IP to 5 auth requests per windowMs skipSuccessfulRequests: true, message: { success: false, message: "Too many authentication attempts, please try again later.", code: "AUTH_RATE_LIMIT_EXCEEDED", }, }); // Upload rate limiter export const uploadLimiter = rateLimit({ windowMs: 60 * 60 * 1000, // 1 hour max: 20, // Limit each IP to 20 uploads per hour message: { success: false, message: "Too many upload attempts, please try again later.", code: "UPLOAD_RATE_LIMIT_EXCEEDED", }, });
```

# middlewares\multer.js

```js
// middlewares/multer.js (Enhanced) import multer from "multer"; import path from "path"; import { storage } from "../utils/cloudinary.js"; // Enhanced file filter with comprehensive validation const fileFilter = (req, file, cb) => { // Allowed file types const allowedTypes = ["image/jpeg", "image/jpg", "image/png", "image/webp"]; // Check file type if (!allowedTypes.includes(file.mimetype)) { const error = new Error( "Invalid file type. Only JPEG, PNG, and WebP images are allowed." ); error.code = "INVALID_FILE_TYPE"; return cb(error, false); } // Check file extension as additional security const allowedExtensions = [".jpg", ".jpeg", ".png", ".webp"]; const fileExtension = path.extname(file.originalname).toLowerCase(); if (!allowedExtensions.includes(fileExtension)) { const error = new Error("Invalid file extension."); error.code = "INVALID_FILE_EXTENSION"; return cb(error, false); } cb(null, true); }; // Enhanced multer configuration const upload = multer({ storage, fileFilter, limits: { fileSize: 5 * 1024 * 1024, // 5MB per file files: 10, // Maximum 10 files per request }, }); // Different upload configurations for different use cases export const uploadCarImages = upload.array("images", 10); export const uploadUserDocuments = upload.fields([ { name: "drivingLicense", maxCount: 1 }, { name: "emiratesId", maxCount: 1 }, { name: "visa", maxCount: 1 }, { name: "passport", maxCount: 1 }, { name: "profileImage", maxCount: 1 }, ]); export const uploadProfileImage = upload.single("profileImage"); // Default export for backward compatibility export default upload;
```

# models\Booking.js

```js
// models/Booking.js (Complete Fixed Version) import mongoose from "mongoose"; const bookingSchema = new mongoose.Schema( { renter: { type: mongoose.Schema.Types.ObjectId, ref: "User", required: true, }, car: { type: mongoose.Schema.Types.ObjectId, ref: "Car", required: true, }, // Booking dates startDate: { type: Date, required: true }, endDate: { type: Date, required: true }, totalDays: { type: Number, required: true, min: 1, }, // Pricing dailyRate: { type: Number, required: true }, totalAmount: { type: Number, required: true }, securityDeposit: { type: Number, default: 0 }, deliveryFee: { type: Number, default: 0 }, totalPayable: { type: Number, required: true }, // totalAmount + securityDeposit + deliveryFee // Status tracking status: { type: String, enum: [ "pending", // Waiting owner approval "approved", // Owner approved, payment pending "confirmed", // Payment confirmed, booking active "active", // Car picked up, rental in progress "completed", // Car returned, booking finished "cancelled", // Cancelled by renter/owner "rejected", // Rejected by owner "expired", // Booking expired without approval ], default: "pending", }, // Payment details paymentMethod: { type: String, enum: ["Cash", "Card", "BankTransfer", "DigitalWallet"], required: true, default: "Cash", }, paymentStatus: { type: String, enum: ["pending", "paid", "failed", "refunded", "partial"], default: "pending", }, transactionId: { type: String }, // For card payments // Pickup/Return details pickupLocation: { type: String, required: true }, returnLocation: { type: String, required: true }, pickupTime: { type: Date }, returnTime: { type: Date }, actualReturnTime: { type: Date }, // Delivery options deliveryRequested: { type: Boolean, default: false }, deliveryAddress: { type: String }, // Communication renterNotes: { type: String, maxlength: 500 }, ownerNotes: { type: String, maxlength: 500 }, adminNotes: { type: String, maxlength: 500 }, // Car condition tracking preRentalCondition: { type: String }, // Photos/notes before rental postRentalCondition: { type: String }, // Photos/notes after return damageReported: { type: Boolean, default: false }, damageDescription: { type: String }, // Cancellation cancellationReason: { type: String }, cancelledBy: { type: String, enum: ["renter", "owner", "admin", "system"], }, cancellationFee: { type: Number, default: 0 }, // Review system renterReview: { rating: { type: Number, min: 1, max: 5 }, comment: { type: String, maxlength: 500 }, reviewedAt: { type: Date }, }, ownerReview: { rating: { type: Number, min: 1, max: 5 }, comment: { type: String, maxlength: 500 }, reviewedAt: { type: Date }, }, // System tracking approvedAt: { type: Date }, confirmedAt: { type: Date }, completedAt: { type: Date }, expiresAt: { type: Date }, // Auto-expire pending bookings after 24h }, { timestamps: true, } ); // Indexes for performance bookingSchema.index({ renter: 1, status: 1 }); bookingSchema.index({ car: 1, status: 1 }); bookingSchema.index({ startDate: 1, endDate: 1 }); bookingSchema.index({ status: 1, expiresAt: 1 }); // For cleanup jobs // Calculate total days before saving bookingSchema.pre("save", function () { if (this.isModified("startDate") || this.isModified("endDate")) { const diffTime = this.endDate - this.startDate; this.totalDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); if (this.totalDays < 1) { throw new Error("End date must be after start date"); } } // Calculate totalPayable if ( this.isModified("totalAmount") || this.isModified("securityDeposit") || this.isModified("deliveryFee") ) { this.totalPayable = (this.totalAmount || 0) + (this.securityDeposit || 0) + (this.deliveryFee || 0); } }); export const Booking = mongoose.model("Booking", bookingSchema); export default Booking;
```

# models\Car.js

```js
// models/Car.js - Fixed with consistent field naming import mongoose from "mongoose"; const carSchema = new mongoose.Schema( { owner: { type: mongoose.Schema.Types.ObjectId, ref: "User", required: true, }, title: { type: String, required: true, trim: true, maxlength: 100, }, description: { type: String, required: true, maxlength: 1000, }, city: { type: String, required: true, enum: [ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", ], }, // FIXED: Use consistent field name 'price' (not pricePerDay) price: { type: Number, required: true, min: 50, // Minimum AED 50 per day max: 5000, // Maximum AED 5000 per day }, // Availability availabilityFrom: { type: Date, required: true, }, availabilityTo: { type: Date, required: true, }, // Car details make: { type: String, required: true, trim: true, }, model: { type: String, required: true, trim: true, }, year: { type: Number, required: true, min: 2010, max: new Date().getFullYear() + 1, }, color: { type: String, required: true, trim: true, }, plateNumber: { type: String, required: true, uppercase: true, validate: { validator: function (v) { return /^[A-Z]{1,3}[0-9]{1,5}$/.test(v); }, message: "Please enter a valid UAE plate number", }, }, // Technical specs transmission: { type: String, enum: ["Automatic", "Manual", "CVT", "Semi-Automatic"], required: true, default: "Automatic", }, fuelType: { type: String, enum: ["Petrol", "Diesel", "Electric", "Hybrid", "Plug-in Hybrid"], required: true, default: "Petrol", }, mileage: { type: Number, required: true, min: 0, max: 500000, }, seatingCapacity: { type: Number, required: true, min: 2, max: 8, }, specifications: { type: String, enum: [ "GCC Specs", "US Specs", "Japanese Specs", "European Specs", "Canadian Specs", "Korean Specs", ], required: true, default: "GCC Specs", }, // Features features: [ { type: String, enum: [ "GPS Navigation", "Bluetooth", "USB Charging", "Wireless Charging", "Sunroof", "Leather Seats", "Heated Seats", "Cooled Seats", "Backup Camera", "Parking Sensors", "Cruise Control", "Keyless Entry", "Push Start", "Auto AC", "Dual Zone AC", "Premium Sound System", ], }, ], // Media images: [ { type: String, required: true, }, ], // Booking settings isInstantApproval: { type: Boolean, default: true, }, minimumRentalDays: { type: Number, default: 1, min: 1, }, maximumRentalDays: { type: Number, default: 30, min: 1, }, // Delivery options deliveryAvailable: { type: Boolean, default: false, }, deliveryFee: { type: Number, default: 0, min: 0, }, pickupLocations: [{ type: String }], // Insurance & Security insuranceIncluded: { type: Boolean, default: true, }, securityDeposit: { type: Number, default: 500, min: 0, }, // Status and metrics status: { type: String, enum: ["active", "inactive", "deleted", "pending", "maintenance"], default: "pending", }, totalBookings: { type: Number, default: 0, }, averageRating: { type: Number, default: 0, min: 0, max: 5, }, // Admin fields adminNotes: { type: String, }, rejectionReason: { type: String, }, // Soft delete deletedAt: { type: Date, default: null, }, }, { timestamps: true, } ); // Indexes for performance and search carSchema.index({ city: 1, status: 1 }); carSchema.index({ price: 1 }); carSchema.index({ make: 1, model: 1 }); carSchema.index({ availabilityFrom: 1, availabilityTo: 1 }); carSchema.index({ owner: 1 }); carSchema.index({ title: "text", description: "text", make: "text", model: "text", }); // Pre-save validation carSchema.pre("save", function () { // Validate date range if (this.availabilityTo <= this.availabilityFrom) { throw new Error("Availability end date must be after start date"); } // Validate minimum number of images if (this.images && this.images.length < 3) { throw new Error("At least 3 images are required"); } }); // Hide deleted cars in queries carSchema.pre(/^find/, function () { this.find({ deletedAt: null }); }); // Virtual for frontend compatibility carSchema.virtual("pricePerDay").get(function () { return this.price; }); // Ensure virtual fields are serialized carSchema.set("toJSON", { virtuals: true }); carSchema.set("toObject", { virtuals: true }); export const Car = mongoose.model("Car", carSchema); export default Car;
```

# models\User.js

```js
// models/User.js (Updated with UAE Phone Validation) import mongoose from "mongoose"; import bcrypt from "bcryptjs"; import { formatUAEPhone, validateUAEPhone, displayUAEPhone, } from "../utils/phoneUtils.js"; const userSchema = new mongoose.Schema( { name: { type: String, required: true, trim: true, }, email: { type: String, required: true, unique: true, lowercase: true, trim: true, }, phone: { type: String, required: true, validate: { validator: function (v) { return validateUAEPhone(v); }, message: "Please enter a valid UAE phone number (e.g., 0501234567)", }, }, password: { type: String, required: true, minlength: 6, select: false, // Don't include password by default }, profileImage: { type: String, }, role: { type: String, enum: ["renter", "owner", "admin"], default: "renter", }, isApproved: { type: Boolean, default: false, }, // Document URLs drivingLicenseUrl: { type: String, required: true, }, emiratesIdUrl: { type: String, }, visaUrl: { type: String, }, passportUrl: { type: String, }, // User preferences preferredCity: { type: String, enum: [ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", ], }, // Account status isEmailVerified: { type: Boolean, default: false, }, isPhoneVerified: { type: Boolean, default: false, }, lastLoginAt: { type: Date, }, // Soft delete deletedAt: { type: Date, default: null, }, }, { timestamps: true, } ); // Indexes for performance userSchema.index({ email: 1 }); userSchema.index({ phone: 1 }); userSchema.index({ isApproved: 1, role: 1 }); userSchema.index({ role: 1 }); userSchema.index({ deletedAt: 1 }); // Pre-save middleware to format phone number userSchema.pre("save", function (next) { if (this.isModified("phone")) { this.phone = formatUAEPhone(this.phone); } next(); }); // Hash password before saving userSchema.pre("save", async function (next) { // Only hash the password if it has been modified (or is new) if (!this.isModified("password")) return next(); try { // Hash password with cost of 12 this.password = await bcrypt.hash(this.password, 12); next(); } catch (error) { next(error); } }); // Instance method to check password userSchema.methods.matchPassword = async function (enteredPassword) { return await bcrypt.compare(enteredPassword, this.password); }; // Hide deleted users in queries userSchema.pre(/^find/, function (next) { // this points to the current query this.find({ deletedAt: null }); next(); }); // Virtual for displaying phone in local format userSchema.virtual("phoneDisplay").get(function () { return displayUAEPhone(this.phone); }); // Ensure virtual fields are serialized userSchema.set("toJSON", { virtuals: true }); userSchema.set("toObject", { virtuals: true }); // Create and export the model const User = mongoose.model("User", userSchema); // Export both named and default exports for compatibility export { User }; export default User;
```

# package.json

```json
{ "name": "borrowmycar-vibecoding", "module": "index.js", "type": "module", "devDependencies": { "@types/bun": "latest", "nodemon": "^3.0.0", "concurrently": "^8.2.2" }, "peerDependencies": { "typescript": "^5.0.0" }, "scripts": { "start": "node index.js", "dev": "nodemon index.js", "dev:frontend": "cd borrowmycarfrontend && npm run dev", "dev:both": "concurrently \"npm run dev\" \"npm run dev:frontend\"", "seed": "node scripts/seedData.js", "setup": "npm install && cd borrowmycarfrontend && npm install", "prod": "NODE_ENV=production node index.js", "test": "echo \"Error: no test specified\" && exit 1" }, "dependencies": { "bcryptjs": "^3.0.2", "cloudinary": "^2.6.1", "cors": "^2.8.5", "dotenv": "^16.5.0", "express": "^5.1.0", "express-rate-limit": "^7.5.0", "express-validator": "^7.2.1", "jsonwebtoken": "^9.0.2", "mongoose": "^8.15.1", "morgan": "^1.10.0", "multer": "^2.0.0", "multer-storage-cloudinary": "^4.0.0" } }
```

# README.md

```md
# borrowmycar-vibecoding To install dependencies: \`\`\`bash bun install \`\`\` To run: \`\`\`bash bun run index.js \`\`\` This project was created using `bun init` in bun v1.1.6. [Bun](https://bun.sh) is a fast all-in-one JavaScript runtime.
```

# routes\authRoutes.js

```js
// routes/authRoutes.js - FIXED VERSION import express from "express"; import { signup, login, getProfile, updateProfile, changePassword, logout, } from "../controllers/authController.js"; import { protect, authLimiter } from "../middlewares/authMiddleware.js"; import { uploadUserDocuments, uploadProfileImage, } from "../middlewares/multer.js"; import { validateSignup, validateLogin, handleValidationErrors, } from "../utils/validators.js"; const router = express.Router(); // PUBLIC ROUTES (No authentication required) router.post( "/signup", authLimiter, uploadUserDocuments, validateSignup, handleValidationErrors, signup ); router.post( "/register", // Alternative endpoint name authLimiter, uploadUserDocuments, validateSignup, handleValidationErrors, signup ); router.post( "/login", authLimiter, validateLogin, handleValidationErrors, login ); // PROTECTED ROUTES (Authentication required) router.use(protect); // Apply protection to all routes below router.get("/profile", getProfile); router.patch("/profile", uploadProfileImage, updateProfile); router.patch("/change-password", changePassword); router.post("/logout", logout); export default router;
```

# routes\bookingRoutes.js

```js
// routes/bookingRoutes.js - FIXED VERSION import express from "express"; import { createBooking, getMyBookings, getBookingsForOwner, updateBookingStatus, getBookingById, cancelBooking, addReview, } from "../controllers/bookingController.js"; import { protect, restrictTo } from "../middlewares/authMiddleware.js"; import { validateCreateBooking, validateUpdateBookingStatus, validateAddReview, handleValidationErrors, } from "../utils/validators.js"; const router = express.Router(); // All routes require authentication router.use(protect); // POST /api/bookings - Create new booking (renters only) router.post( "/", restrictTo("renter"), validateCreateBooking, handleValidationErrors, createBooking ); // GET /api/bookings/me - Get my bookings (renter's bookings) router.get("/me", restrictTo("renter"), getMyBookings); // GET /api/bookings/owner - Get bookings for my cars (owner's received bookings) router.get("/owner", restrictTo("owner"), getBookingsForOwner); // GET /api/bookings/:id - Get single booking details router.get("/:id", getBookingById); // PUT /api/bookings/:id - Update booking status (owner can approve/reject, renter can cancel) router.put( "/:id", validateUpdateBookingStatus, handleValidationErrors, updateBookingStatus ); // PATCH /api/bookings/:id/cancel - Cancel booking router.patch("/:id/cancel", cancelBooking); // POST /api/bookings/:id/review - Add review to completed booking router.post( "/:id/review", validateAddReview, handleValidationErrors, addReview ); export default router;
```

# routes\carRoutes.js

```js
// routes/carRoutes.js (Fully Consistent - Fixed Upload Limits) import express from "express"; import { createCar, getCars, getCarById, updateCar, deleteCar, getCarsByOwner, } from "../controllers/carController.js"; import { protect, restrictTo, requireApproval, optionalAuth, uploadLimiter, } from "../middlewares/authMiddleware.js"; import { uploadCarImages } from "../middlewares/multer.js"; // Uses proper middleware that allows up to 10 images import { body, validationResult } from "express-validator"; const router = express.Router(); // Car validation rules to match model fields const carValidationRules = [ body("title") .notEmpty() .withMessage("Title is required") .isLength({ min: 3, max: 100 }) .withMessage("Title must be between 3 and 100 characters"), body("description") .notEmpty() .withMessage("Description is required") .isLength({ min: 10, max: 1000 }) .withMessage("Description must be between 10 and 1000 characters"), body("city") .notEmpty() .withMessage("City is required") .isIn([ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", ]) .withMessage("Please select a valid UAE city"), body("price") .isNumeric() .withMessage("Price must be a number") .isFloat({ min: 50, max: 5000 }) .withMessage("Price must be between AED 50 and AED 5000 per day"), body("make") .notEmpty() .withMessage("Car make is required") .isLength({ min: 2 }) .withMessage("Car make must be at least 2 characters"), body("model").notEmpty().withMessage("Car model is required"), body("year") .isInt({ min: 2010, max: new Date().getFullYear() + 1 }) .withMessage("Car year must be between 2010 and current year"), body("color").notEmpty().withMessage("Car color is required"), body("plateNumber") .notEmpty() .withMessage("Plate number is required") .matches(/^[A-Z]{1,3}[0-9]{1,5}$/) .withMessage( "Please enter a valid UAE plate number (e.g., A12345, ABC123)" ), body("transmission") .isIn(["Automatic", "Manual", "CVT", "Semi-Automatic"]) .withMessage("Please select a valid transmission type"), body("fuelType") .isIn(["Petrol", "Diesel", "Electric", "Hybrid", "Plug-in Hybrid"]) .withMessage("Please select a valid fuel type"), body("mileage") .isInt({ min: 0, max: 500000 }) .withMessage("Mileage must be between 0 and 500,000 km"), body("seatingCapacity") .isInt({ min: 2, max: 8 }) .withMessage("Seating capacity must be between 2 and 8"), body("availabilityFrom") .isISO8601() .withMessage("Please provide a valid availability start date"), body("availabilityTo") .isISO8601() .withMessage("Please provide a valid availability end date"), ]; // Enhanced validation error handler const handleValidationErrors = (req, res, next) => { const errors = validationResult(req); if (!errors.isEmpty()) { const formattedErrors = errors.array().map((error) => ({ field: error.path || error.param, message: error.msg, value: error.value, })); return res.status(400).json({ success: false, message: "Validation failed", errors: formattedErrors, code: "VALIDATION_ERROR", }); } next(); }; // REMOVED: Custom image processing middleware - let controller handle image validation // The uploadCarImages middleware from multer.js already handles the file processing // and the controller has proper validation for 3-10 images // PUBLIC ROUTES // GET /api/cars - Get all cars with filtering router.get( "/", optionalAuth, // Optional authentication for personalized results getCars ); // GET /api/cars/:id - Get single car router.get("/:id", optionalAuth, getCarById); // GET /api/cars/owner/:ownerId - Get cars by owner router.get("/owner/:ownerId", getCarsByOwner); // PROTECTED ROUTES (Authentication required) router.use(protect); // All routes below require authentication // POST /api/cars - Create new car (Owner only) router.post( "/", restrictTo("owner"), // Only owners can create cars requireApproval, // Account must be approved uploadLimiter, // Rate limiting for uploads uploadCarImages, // Handle file upload (up to 10 images) - from middlewares/multer.js carValidationRules, // Validate input data handleValidationErrors, // Handle validation errors createCar // Create car controller (handles image validation internally) ); // PUT /api/cars/:id - Update car (Owner only, own cars) router.put( "/:id", restrictTo("owner"), uploadCarImages, // Allow image updates (up to 10 images) carValidationRules, // Validate updated data handleValidationErrors, updateCar ); // PATCH /api/cars/:id - Partial update car (Owner only, own cars) router.patch( "/:id", restrictTo("owner"), uploadCarImages, // Allow image updates updateCar ); // DELETE /api/cars/:id - Delete car (Owner only, own cars) router.delete("/:id", restrictTo("owner"), deleteCar); export default router;
```

# scripts\seedData.js

```js
// scripts/seedData.js - Updated with UAE Phone Format import mongoose from "mongoose"; import bcrypt from "bcryptjs"; import { User } from "../models/User.js"; import Car from "../models/Car.js"; import Booking from "../models/Booking.js"; import dotenv from "dotenv"; dotenv.config(); const seedDatabase = async () => { try { console.log("🌱 Starting database seeding..."); // Connect to MongoDB await mongoose.connect(process.env.MONGO_URI, { dbName: "borrowmycar", }); console.log("✅ Connected to MongoDB"); // Clear existing data await User.deleteMany({}); await Car.deleteMany({}); await Booking.deleteMany({}); console.log("🧹 Cleared existing data"); // Create admin user const admin = await User.create({ name: "Admin User", email: "admin@borrowmycar.ae", phone: "0501234567", // UAE local format password: "admin123", role: "admin", isApproved: true, preferredCity: "Dubai", drivingLicenseUrl: "https://via.placeholder.com/400x300?text=Admin+License", }); // Create test car owners const owner1 = await User.create({ name: "Ahmed Al-Mansouri", email: "ahmed@test.com", phone: "0502345678", // UAE local format password: "password123", role: "owner", isApproved: true, preferredCity: "Dubai", drivingLicenseUrl: "https://via.placeholder.com/400x300?text=Ahmed+License", }); const owner2 = await User.create({ name: "Fatima Al-Zahra", email: "fatima@test.com", phone: "0503456789", // UAE local format password: "password123", role: "owner", isApproved: true, preferredCity: "Abu Dhabi", drivingLicenseUrl: "https://via.placeholder.com/400x300?text=Fatima+License", }); // Create test renters const renter1 = await User.create({ name: "Sarah Johnson", email: "sarah@test.com", phone: "0504567890", // UAE local format password: "password123", role: "renter", isApproved: true, preferredCity: "Dubai", drivingLicenseUrl: "https://via.placeholder.com/400x300?text=Sarah+License", }); const renter2 = await User.create({ name: "Michael Chen", email: "michael@test.com", phone: "0505678901", // UAE local format password: "password123", role: "renter", isApproved: true, preferredCity: "Sharjah", drivingLicenseUrl: "https://via.placeholder.com/400x300?text=Michael+License", }); console.log("👥 Created test users"); // Create test cars const cars = []; // Ahmed's cars const car1 = await Car.create({ owner: owner1._id, title: "Toyota Camry 2023 - Luxury Sedan", description: "Premium Toyota Camry with leather seats, GPS navigation, and excellent fuel economy. Perfect for business trips or family outings.", city: "Dubai", price: 180, // Using 'price' field consistently availabilityFrom: new Date(), availabilityTo: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000), // 90 days make: "Toyota", model: "Camry", year: 2023, color: "Pearl White", plateNumber: "A12345", transmission: "Automatic", fuelType: "Petrol", mileage: 15000, seatingCapacity: 5, specifications: "GCC Specs", features: [ "GPS Navigation", "Bluetooth", "Leather Seats", "Backup Camera", ], images: [ "https://images.unsplash.com/photo-1621007947382-bb3c3994e3fb?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1550355291-bbee04a92027?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1494976888653-603eb4928b84?w=800&h=600&fit=crop", ], status: "active", }); const car2 = await Car.create({ owner: owner1._id, title: "BMW X3 2024 - Premium SUV", description: "Luxury SUV with all-wheel drive, premium sound system, and spacious interior. Ideal for family adventures.", city: "Dubai", price: 320, availabilityFrom: new Date(), availabilityTo: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000), // 60 days make: "BMW", model: "X3", year: 2024, color: "Space Gray", plateNumber: "B67890", transmission: "Automatic", fuelType: "Petrol", mileage: 8000, seatingCapacity: 5, specifications: "GCC Specs", features: [ "GPS Navigation", "Sunroof", "Leather Seats", "Premium Sound System", ], images: [ "https://images.unsplash.com/photo-1555215695-3004980ad54e?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1549317661-bd32c8ce0db2?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1563720223185-11003d516935?w=800&h=600&fit=crop", ], status: "active", }); // Fatima's cars const car3 = await Car.create({ owner: owner2._id, title: "Honda Civic 2023 - Compact Sedan", description: "Fuel-efficient and reliable Honda Civic, perfect for city driving and daily commutes.", city: "Abu Dhabi", price: 150, availabilityFrom: new Date(), availabilityTo: new Date(Date.now() + 120 * 24 * 60 * 60 * 1000), // 120 days make: "Honda", model: "Civic", year: 2023, color: "Midnight Blue", plateNumber: "C11111", transmission: "Automatic", fuelType: "Petrol", mileage: 12000, seatingCapacity: 5, specifications: "GCC Specs", features: [ "Bluetooth", "USB Charging", "Backup Camera", "Cruise Control", ], images: [ "https://images.unsplash.com/photo-1606664515524-ed2f786a0bd6?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1583121274602-3e2820c69888?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1552519507-da3b142c6e3d?w=800&h=600&fit=crop", ], status: "active", }); const car4 = await Car.create({ owner: owner2._id, title: "Mercedes C-Class 2024 - Executive Sedan", description: "Elegant Mercedes C-Class with premium interior, advanced safety features, and smooth performance.", city: "Abu Dhabi", price: 280, availabilityFrom: new Date(), availabilityTo: new Date(Date.now() + 75 * 24 * 60 * 60 * 1000), // 75 days make: "Mercedes-Benz", model: "C-Class", year: 2024, color: "Obsidian Black", plateNumber: "D22222", transmission: "Automatic", fuelType: "Petrol", mileage: 5000, seatingCapacity: 5, specifications: "GCC Specs", features: [ "GPS Navigation", "Leather Seats", "Heated Seats", "Premium Sound System", ], images: [ "https://images.unsplash.com/photo-1618843479313-40f8afb4b4d8?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1606114737970-346c60ef1069?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1563694983011-6f4d90358083?w=800&h=600&fit=crop", ], status: "active", }); // Add more diverse cars for better testing const car5 = await Car.create({ owner: owner1._id, title: "Nissan Patrol 2023 - Family SUV", description: "Spacious family SUV perfect for desert trips and large groups. Comes with advanced safety features.", city: "Dubai", price: 250, availabilityFrom: new Date(), availabilityTo: new Date(Date.now() + 45 * 24 * 60 * 60 * 1000), // 45 days make: "Nissan", model: "Patrol", year: 2023, color: "Arctic White", plateNumber: "E33333", transmission: "Automatic", fuelType: "Petrol", mileage: 25000, seatingCapacity: 8, specifications: "GCC Specs", features: [ "GPS Navigation", "Third Row Seating", "4WD", "Premium Sound System", "Parking Sensors", ], images: [ "https://images.unsplash.com/photo-1544636331-e26879cd4d9b?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1519641471654-76ce0107ad1b?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1553440569-bcc63803a83d?w=800&h=600&fit=crop", ], status: "active", }); const car6 = await Car.create({ owner: owner2._id, title: "Hyundai Elantra 2022 - Economy Sedan", description: "Affordable and fuel-efficient sedan, perfect for daily commuting and city driving.", city: "Sharjah", price: 120, availabilityFrom: new Date(), availabilityTo: new Date(Date.now() + 100 * 24 * 60 * 60 * 1000), // 100 days make: "Hyundai", model: "Elantra", year: 2022, color: "Silver", plateNumber: "F44444", transmission: "Automatic", fuelType: "Petrol", mileage: 35000, seatingCapacity: 5, specifications: "GCC Specs", features: ["Bluetooth", "USB Charging", "Auto AC", "Cruise Control"], images: [ "https://images.unsplash.com/photo-1605559424843-9e4c228bf1c2?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1552519507-da3b142c6e3d?w=800&h=600&fit=crop", "https://images.unsplash.com/photo-1494976888653-603eb4928b84?w=800&h=600&fit=crop", ], status: "active", }); cars.push(car1, car2, car3, car4, car5, car6); console.log("🚗 Created test cars"); // Create some test bookings const booking1 = await Booking.create({ renter: renter1._id, car: car1._id, startDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), // 7 days from now endDate: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000), // 10 days from now totalDays: 3, dailyRate: 180, totalAmount: 540, totalPayable: 540, paymentMethod: "Card", pickupLocation: "Dubai Mall", returnLocation: "Dubai Mall", status: "pending", }); const booking2 = await Booking.create({ renter: renter2._id, car: car3._id, startDate: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000), // 14 days from now endDate: new Date(Date.now() + 17 * 24 * 60 * 60 * 1000), // 17 days from now totalDays: 3, dailyRate: 150, totalAmount: 450, totalPayable: 450, paymentMethod: "Cash", pickupLocation: "Abu Dhabi Airport", returnLocation: "Abu Dhabi Airport", status: "approved", }); const booking3 = await Booking.create({ renter: renter1._id, car: car5._id, startDate: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000), // 5 days ago endDate: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000), // 2 days ago totalDays: 3, dailyRate: 250, totalAmount: 750, totalPayable: 750, paymentMethod: "Card", pickupLocation: "Dubai Marina", returnLocation: "Dubai Marina", status: "completed", }); console.log("📅 Created test bookings"); console.log("\n✅ Database seeded successfully!"); console.log("\n📊 Summary:"); console.log(`👥 Users: 5 (1 admin, 2 owners, 2 renters)`); console.log(`🚗 Cars: ${cars.length}`); console.log(`📅 Bookings: 3`); console.log("\n🔑 Test Accounts:"); console.log("Admin: admin@borrowmycar.ae / admin123"); console.log("Owner 1: ahmed@test.com / password123 (Phone: 0502345678)"); console.log("Owner 2: fatima@test.com / password123 (Phone: 0503456789)"); console.log("Renter 1: sarah@test.com / password123 (Phone: 0504567890)"); console.log("Renter 2: michael@test.com / password123 (Phone: 0505678901)"); console.log("\n📱 Phone Format Examples:"); console.log("✓ Local format: 0501234567 (recommended)"); console.log("✓ With country code: +971501234567"); console.log("✓ International: 00971501234567"); process.exit(0); } catch (error) { console.error("❌ Error seeding database:", error); process.exit(1); } }; // Run the seeding function seedDatabase();
```

# utils\cloudinary.js

```js
// utils/cloudinary.js (Enhanced) import { v2 as cloudinary } from "cloudinary"; import { CloudinaryStorage } from "multer-storage-cloudinary"; import dotenv from "dotenv"; dotenv.config(); // Configure Cloudinary cloudinary.config({ cloud_name: process.env.CLOUDINARY_CLOUD_NAME, api_key: process.env.CLOUDINARY_API_KEY, api_secret: process.env.CLOUDINARY_API_SECRET, }); // Enhanced storage configuration with organized folders and transformations export const storage = new CloudinaryStorage({ cloudinary: cloudinary, params: async (req, file) => { // Determine folder based on file field and user role let folder = "borrowmycar/misc"; if (file.fieldname === "images") { folder = "borrowmycar/cars"; } else if ( ["drivingLicense", "emiratesId", "visa", "passport"].includes( file.fieldname ) ) { folder = "borrowmycar/documents"; } else if (file.fieldname === "profileImage") { folder = "borrowmycar/profiles"; } // Generate unique filename const uniqueSuffix = Date.now() + "-" + Math.round(Math.random() * 1e9); return { folder: folder, public_id: `${file.fieldname}-${uniqueSuffix}`, allowed_formats: ["jpg", "jpeg", "png", "webp"], transformation: [ { quality: "auto:good", fetch_format: "auto", }, ], // Add different transformations based on file type ...(file.fieldname === "profileImage" && { transformation: [ { width: 300, height: 300, crop: "fill", gravity: "face" }, { quality: "auto:good", fetch_format: "auto" }, ], }), ...(file.fieldname === "images" && { transformation: [ { width: 1200, height: 800, crop: "limit" }, { quality: "auto:good", fetch_format: "auto" }, ], }), }; }, }); // Health check for Cloudinary export const checkCloudinaryHealth = async () => { try { const result = await cloudinary.api.ping(); return { status: "connected", response: result, }; } catch (error) { return { status: "error", error: error.message, }; } }; export { cloudinary };
```

# utils\cloudUploader.js

```js
// utils/cloudUploader.js (Enhanced) import { v2 as cloudinary } from "cloudinary"; // Upload multiple images to Cloudinary export const uploadImagesToCloud = async (files) => { try { if (!files || files.length === 0) { throw new Error("No files provided for upload"); } // Handle both array of files and single file const fileArray = Array.isArray(files) ? files : [files]; const uploadPromises = fileArray.map(async (file) => { // Each file should already be uploaded by multer-storage-cloudinary // Just return the secure_url if (file.path) { return file.path; // This is the Cloudinary URL } // Fallback: manual upload if needed const result = await cloudinary.uploader.upload( file.path || file.buffer, { folder: "borrowmycar/uploads", quality: "auto:good", fetch_format: "auto", } ); return result.secure_url; }); const imageUrls = await Promise.all(uploadPromises); return imageUrls; } catch (error) { console.error("Cloudinary upload error:", error); throw new Error(`Image upload failed: ${error.message}`); } }; // Delete images from Cloudinary export const deleteImagesFromCloud = async (imageUrls) => { try { if (!imageUrls || imageUrls.length === 0) { return { success: true, message: "No images to delete" }; } // Handle both array and single URL const urlArray = Array.isArray(imageUrls) ? imageUrls : [imageUrls]; const deletePromises = urlArray.map(async (url) => { try { // Extract public_id from Cloudinary URL const publicId = extractPublicIdFromUrl(url); if (publicId) { const result = await cloudinary.uploader.destroy(publicId); return { url, publicId, result: result.result, success: result.result === "ok", }; } return { url, publicId: null, result: "invalid_url", success: false, }; } catch (error) { console.error(`Failed to delete image ${url}:`, error); return { url, error: error.message, success: false, }; } }); const results = await Promise.all(deletePromises); const successCount = results.filter((r) => r.success).length; const failureCount = results.length - successCount; return { success: failureCount === 0, total: results.length, successful: successCount, failed: failureCount, details: results, }; } catch (error) { console.error("Cloudinary deletion error:", error); throw new Error(`Image deletion failed: ${error.message}`); } }; // Extract public_id from Cloudinary URL const extractPublicIdFromUrl = (url) => { try { if (!url || typeof url !== "string") { return null; } // Handle Cloudinary URLs if (url.includes("cloudinary.com")) { // Extract everything after the last folder and before file extension const matches = url.match( /\/([^\/]+)\.(jpg|jpeg|png|gif|webp|bmp|tiff|svg)$/i ); if (matches) { // Get the full path including folders const pathMatch = url.match( /\/upload\/(?:v\d+\/)?(.+)\.(jpg|jpeg|png|gif|webp|bmp|tiff|svg)$/i ); return pathMatch ? pathMatch[1] : matches[1]; } } return null; } catch (error) { console.error("Error extracting public_id:", error); return null; } }; // Upload single file with specific transformations export const uploadSingleImage = async (file, options = {}) => { try { if (!file) { throw new Error("No file provided for upload"); } const uploadOptions = { folder: options.folder || "borrowmycar/uploads", quality: options.quality || "auto:good", fetch_format: "auto", ...options, }; // If file is already uploaded by multer-storage-cloudinary if (file.path) { return file.path; } // Manual upload const result = await cloudinary.uploader.upload( file.path || file.buffer, uploadOptions ); return result.secure_url; } catch (error) { console.error("Single image upload error:", error); throw new Error(`Image upload failed: ${error.message}`); } }; // Get image info from Cloudinary export const getImageInfo = async (publicId) => { try { const result = await cloudinary.api.resource(publicId, { image_metadata: true, colors: true, faces: true, }); return { success: true, data: { publicId: result.public_id, format: result.format, width: result.width, height: result.height, bytes: result.bytes, url: result.secure_url, createdAt: result.created_at, metadata: result.image_metadata, colors: result.colors, faces: result.faces, }, }; } catch (error) { console.error("Get image info error:", error); return { success: false, error: error.message, }; } }; // Optimize image URL with transformations export const optimizeImageUrl = (url, transformations = {}) => { try { if (!url || !url.includes("cloudinary.com")) { return url; } const { width, height, crop = "fill", quality = "auto:good", format = "auto", } = transformations; // Build transformation string let transformString = ""; if (width || height) { transformString += `w_${width || "auto"},h_${ height || "auto" },c_${crop}/`; } transformString += `q_${quality},f_${format}`; // Insert transformation into URL const transformedUrl = url.replace( "/upload/", `/upload/${transformString}/` ); return transformedUrl; } catch (error) { console.error("URL optimization error:", error); return url; // Return original URL on error } };
```

# utils\errorHandler.js

```js
// utils/errorHandler.js (Enhanced) // Custom error class export class AppError extends Error { constructor(message, statusCode, code = null) { super(message); this.statusCode = statusCode; this.status = `${statusCode}`.startsWith("4") ? "fail" : "error"; this.isOperational = true; this.code = code; Error.captureStackTrace(this, this.constructor); } } // Handle specific MongoDB errors const handleCastErrorDB = (err) => { const message = `Invalid ${err.path}: ${err.value}`; return new AppError(message, 400, "INVALID_ID"); }; const handleDuplicateFieldsDB = (err) => { const field = Object.keys(err.keyValue)[0]; const value = err.keyValue[field]; const message = `${ field.charAt(0).toUpperCase() + field.slice(1) } '${value}' already exists`; return new AppError(message, 400, "DUPLICATE_FIELD"); }; const handleValidationErrorDB = (err) => { const errors = Object.values(err.errors).map((el) => el.message); const message = `Invalid input data: ${errors.join(". ")}`; return new AppError(message, 400, "VALIDATION_ERROR"); }; const handleJWTError = () => new AppError("Invalid token. Please log in again!", 401, "INVALID_TOKEN"); const handleJWTExpiredError = () => new AppError( "Your token has expired! Please log in again.", 401, "TOKEN_EXPIRED" ); // Handle Multer errors const handleMulterError = (err) => { if (err.code === "LIMIT_FILE_SIZE") { return new AppError( "File size too large. Maximum 5MB allowed.", 400, "FILE_TOO_LARGE" ); } if (err.code === "LIMIT_FILE_COUNT") { return new AppError( "Too many files. Maximum 10 files allowed.", 400, "TOO_MANY_FILES" ); } if (err.code === "INVALID_FILE_TYPE") { return new AppError(err.message, 400, "INVALID_FILE_TYPE"); } return new AppError(err.message, 400, "FILE_UPLOAD_ERROR"); }; // Development error response const sendErrorDev = (err, res) => { res.status(err.statusCode).json({ success: false, error: err, message: err.message, code: err.code, stack: err.stack, }); }; // Production error response const sendErrorProd = (err, res) => { // Operational, trusted error: send message to client if (err.isOperational) { res.status(err.statusCode).json({ success: false, message: err.message, code: err.code, }); } else { // Programming or other unknown error: don't leak error details console.error("ERROR 💥:", err); res.status(500).json({ success: false, message: "Something went wrong!", code: "INTERNAL_SERVER_ERROR", }); } }; // Global error handling middleware export const globalErrorHandler = (err, req, res, next) => { err.statusCode = err.statusCode || 500; err.status = err.status || "error"; if (process.env.NODE_ENV === "development") { sendErrorDev(err, res); } else { let error = { ...err }; error.message = err.message; // Handle specific error types if (error.name === "CastError") error = handleCastErrorDB(error); if (error.code === 11000) error = handleDuplicateFieldsDB(error); if (error.name === "ValidationError") error = handleValidationErrorDB(error); if (error.name === "JsonWebTokenError") error = handleJWTError(); if (error.name === "TokenExpiredError") error = handleJWTExpiredError(); if (error.name === "MulterError" || error.code === "INVALID_FILE_TYPE") { error = handleMulterError(error); } sendErrorProd(error, res); } }; // Async error wrapper export const handleAsyncError = (fn) => { return (req, res, next) => { Promise.resolve(fn(req, res, next)).catch(next); }; };
```

# utils\phoneUtils.js

```js
// utils/phoneUtils.js - Create this new file export const formatUAEPhone = (phone) => { if (!phone) return phone; // Remove all non-digit characters const cleanPhone = phone.replace(/\D/g, ""); // Handle different input formats if (cleanPhone.startsWith("971")) { // Already has country code: 971501234567 return `+${cleanPhone}`; } else if (cleanPhone.startsWith("00971")) { // International format: 00971501234567 return `+${cleanPhone.substring(2)}`; } else if (cleanPhone.startsWith("0") && cleanPhone.length === 10) { // Local format: 0501234567 return `+971${cleanPhone.substring(1)}`; } else if (cleanPhone.length === 9) { // Without leading zero: 501234567 return `+971${cleanPhone}`; } // Return as is if format is unclear return phone; }; export const validateUAEPhone = (phone) => { if (!phone) return false; // Remove all non-digit characters const cleanPhone = phone.replace(/\D/g, ""); // Valid formats: // 0501234567 (10 digits starting with 0) // 501234567 (9 digits) // 971501234567 (12 digits starting with 971) // 00971501234567 (14 digits starting with 00971) const validPatterns = [ /^0[5][0-9]{8}$/, // 0501234567 - local format with leading 0 /^[5][0-9]{8}$/, // 501234567 - local format without leading 0 /^971[5][0-9]{8}$/, // 971501234567 - with country code /^00971[5][0-9]{8}$/, // 00971501234567 - international format ]; return validPatterns.some((pattern) => pattern.test(cleanPhone)); }; export const displayUAEPhone = (phone) => { if (!phone) return phone; const cleanPhone = phone.replace(/\D/g, ""); // Convert to local display format (0XX XXX XXXX) if (cleanPhone.startsWith("971") && cleanPhone.length === 12) { const localNumber = cleanPhone.substring(3); return `0${localNumber.substring(0, 2)} ${localNumber.substring( 2, 5 )} ${localNumber.substring(5)}`; } else if (cleanPhone.startsWith("0") && cleanPhone.length === 10) { return `${cleanPhone.substring(0, 3)} ${cleanPhone.substring( 3, 6 )} ${cleanPhone.substring(6)}`; } return phone; };
```

# utils\validators.js

```js
// utils/validators.js (Updated Phone Validation) import { body, param, query, validationResult } from "express-validator"; import rateLimit from "express-rate-limit"; import { validateUAEPhone } from "./phoneUtils.js"; // User validation rules export const validateSignup = [ body("name") .trim() .isLength({ min: 2, max: 50 }) .withMessage("Name must be between 2 and 50 characters"), body("email") .isEmail() .normalizeEmail() .withMessage("Please provide a valid email"), body("phone").custom((value) => { if (!validateUAEPhone(value)) { throw new Error( "Please provide a valid UAE phone number (e.g., 0501234567)" ); } return true; }), body("password") .isLength({ min: 6 }) .withMessage("Password must be at least 6 characters long"), body("role") .optional() .isIn(["renter", "owner"]) .withMessage("Role must be either renter or owner"), ]; export const validateLogin = [ body("email") .isEmail() .normalizeEmail() .withMessage("Please provide a valid email"), body("password").notEmpty().withMessage("Password is required"), ]; // Car validation rules export const validateCreateCar = [ body("title") .trim() .isLength({ min: 3, max: 100 }) .withMessage("Title must be between 3 and 100 characters"), body("description") .trim() .isLength({ min: 10, max: 1000 }) .withMessage("Description must be between 10 and 1000 characters"), body("city") .isIn([ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", ]) .withMessage("Please select a valid UAE city"), body("make") .trim() .isLength({ min: 2, max: 50 }) .withMessage("Car make is required"), body("model") .trim() .isLength({ min: 1, max: 50 }) .withMessage("Car model is required"), body("year") .isInt({ min: 2010, max: new Date().getFullYear() + 1 }) .withMessage("Car year must be between 2010 and current year"), body("price") .isFloat({ min: 50, max: 5000 }) .withMessage("Price must be between AED 50 and AED 5000 per day"), body("mileage") .isInt({ min: 0, max: 500000 }) .withMessage("Mileage must be between 0 and 500,000 km"), body("seatingCapacity") .isInt({ min: 2, max: 8 }) .withMessage("Seating capacity must be between 2 and 8"), body("plateNumber") .matches(/^[A-Z]{1,3}[0-9]{1,5}$/) .withMessage("Please provide a valid UAE plate number"), body("transmission") .isIn(["Automatic", "Manual", "CVT", "Semi-Automatic"]) .withMessage("Please select a valid transmission type"), body("fuelType") .isIn(["Petrol", "Diesel", "Electric", "Hybrid", "Plug-in Hybrid"]) .withMessage("Please select a valid fuel type"), body("availabilityFrom") .isISO8601() .withMessage("Please provide a valid availability start date"), body("availabilityTo") .isISO8601() .withMessage("Please provide a valid availability end date"), ]; // Booking validation rules export const validateCreateBooking = [ body("carId").isMongoId().withMessage("Please provide a valid car ID"), body("startDate") .isISO8601() .withMessage("Please provide a valid start date"), body("endDate").isISO8601().withMessage("Please provide a valid end date"), body("paymentMethod") .optional() .isIn(["Cash", "Card", "BankTransfer", "DigitalWallet"]) .withMessage("Please select a valid payment method"), body("pickupLocation") .trim() .isLength({ min: 5, max: 200 }) .withMessage("Pickup location must be between 5 and 200 characters"), body("returnLocation") .trim() .isLength({ min: 5, max: 200 }) .withMessage("Return location must be between 5 and 200 characters"), body("deliveryRequested") .optional() .isBoolean() .withMessage("Delivery requested must be true or false"), body("deliveryAddress") .optional() .trim() .isLength({ min: 10, max: 300 }) .withMessage("Delivery address must be between 10 and 300 characters"), body("renterNotes") .optional() .trim() .isLength({ max: 500 }) .withMessage("Notes must not exceed 500 characters"), ]; export const validateUpdateBookingStatus = [ body("status") .isIn([ "pending", "approved", "rejected", "cancelled", "confirmed", "active", "completed", ]) .withMessage("Please provide a valid booking status"), body("ownerNotes") .optional() .trim() .isLength({ max: 500 }) .withMessage("Owner notes must not exceed 500 characters"), body("rejectionReason") .optional() .trim() .isLength({ min: 10, max: 200 }) .withMessage("Rejection reason must be between 10 and 200 characters"), ]; export const validateAddReview = [ body("rating") .isInt({ min: 1, max: 5 }) .withMessage("Rating must be between 1 and 5"), body("comment") .optional() .trim() .isLength({ max: 500 }) .withMessage("Comment must not exceed 500 characters"), ]; // Query parameter validation export const validatePagination = [ query("page") .optional() .isInt({ min: 1 }) .withMessage("Page must be a positive integer"), query("limit") .optional() .isInt({ min: 1, max: 50 }) .withMessage("Limit must be between 1 and 50"), ]; export const validateCarFilters = [ query("city") .optional() .isIn([ "Dubai", "Abu Dhabi", "Sharjah", "Ajman", "Fujairah", "Ras Al Khaimah", "Umm Al Quwain", ]) .withMessage("Please select a valid UAE city"), query("minPrice") .optional() .isFloat({ min: 0 }) .withMessage("Minimum price must be a positive number"), query("maxPrice") .optional() .isFloat({ min: 0 }) .withMessage("Maximum price must be a positive number"), query("year") .optional() .isInt({ min: 2010, max: new Date().getFullYear() + 1 }) .withMessage("Year must be between 2010 and current year"), query("transmission") .optional() .isIn(["Automatic", "Manual", "CVT", "Semi-Automatic"]) .withMessage("Please select a valid transmission type"), query("fuelType") .optional() .isIn(["Petrol", "Diesel", "Electric", "Hybrid", "Plug-in Hybrid"]) .withMessage("Please select a valid fuel type"), query("seatingCapacity") .optional() .isInt({ min: 2, max: 8 }) .withMessage("Seating capacity must be between 2 and 8"), query("sortBy") .optional() .isIn(["createdAt", "price", "year", "totalBookings", "averageRating"]) .withMessage("Please select a valid sort field"), query("sortOrder") .optional() .isIn(["asc", "desc"]) .withMessage("Sort order must be asc or desc"), ]; // Parameter validation export const validateMongoId = [ param("id").isMongoId().withMessage("Please provide a valid ID"), ]; // Custom validation functions export const customValidations = { // Check if end date is after start date isEndDateAfterStartDate: (endDate, { req }) => { if ( req.body.startDate && new Date(endDate) <= new Date(req.body.startDate) ) { throw new Error("End date must be after start date"); } return true; }, // Check if date is not in the past isNotPastDate: (date) => { const today = new Date(); today.setHours(0, 0, 0, 0); if (new Date(date) < today) { throw new Error("Date cannot be in the past"); } return true; }, // Check UAE phone number format isValidUAEPhone: (phone) => { if (!validateUAEPhone(phone)) { throw new Error( "Please provide a valid UAE phone number (e.g., 0501234567)" ); } return true; }, // Check UAE plate number format isValidUAEPlate: (plateNumber) => { const uaePlateRegex = /^[A-Z]{1,3}[0-9]{1,5}$/; if (!uaePlateRegex.test(plateNumber.toUpperCase())) { throw new Error( "Please provide a valid UAE plate number (e.g., A12345, ABC123)" ); } return true; }, }; // Express validator error handler middleware export const handleValidationErrors = (req, res, next) => { const errors = validationResult(req); if (!errors.isEmpty()) { const formattedErrors = errors.array().map((error) => ({ field: error.path || error.param, message: error.msg, value: error.value, })); return res.status(400).json({ success: false, message: "Validation failed", errors: formattedErrors, code: "VALIDATION_ERROR", }); } next(); }; // Rate limiting configurations // General rate limiter export const generalLimiter = rateLimit({ windowMs: 15 * 60 * 1000, // 15 minutes max: 100, // Limit each IP to 100 requests per windowMs message: { success: false, message: "Too many requests from this IP, please try again later.", code: "RATE_LIMIT_EXCEEDED", }, standardHeaders: true, legacyHeaders: false, });
```

